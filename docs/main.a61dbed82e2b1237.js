(self.webpackChunkgui_prototype=self.webpackChunkgui_prototype||[]).push([[179],{939:(hf,zc,Bc)=>{"use strict";function qa(t){return"function"==typeof t}let ah=!1;const Wo={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const e=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+e.stack)}else ah&&console.log("RxJS: Back to a better error behavior. Thank you. <3");ah=t},get useDeprecatedSynchronousErrorHandling(){return ah}};function d(t){setTimeout(()=>{throw t},0)}const Ge={closed:!0,next(t){},error(t){if(Wo.useDeprecatedSynchronousErrorHandling)throw t;d(t)},complete(){}},Po=Array.isArray||(t=>t&&"number"==typeof t.length);function Jr(t){return null!==t&&"object"==typeof t}const Lt=(()=>{function t(e){return Error.call(this),this.message=e?`${e.length} errors occurred during unsubscription:\n${e.map((n,s)=>`${s+1}) ${n.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=e,this}return t.prototype=Object.create(Error.prototype),t})();class hn{constructor(e){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,e&&(this._ctorUnsubscribe=!0,this._unsubscribe=e)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:s,_unsubscribe:c,_subscriptions:f}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof hn)n.remove(this);else if(null!==n)for(let y=0;y<n.length;++y)n[y].remove(this);if(qa(c)){s&&(this._unsubscribe=void 0);try{c.call(this)}catch(y){e=y instanceof Lt?ao(y.errors):[y]}}if(Po(f)){let y=-1,E=f.length;for(;++y<E;){const S=f[y];if(Jr(S))try{S.unsubscribe()}catch(R){e=e||[],R instanceof Lt?e=e.concat(ao(R.errors)):e.push(R)}}}if(e)throw new Lt(e)}add(e){let n=e;if(!e)return hn.EMPTY;switch(typeof e){case"function":n=new hn(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof hn)){const f=n;n=new hn,n._subscriptions=[f]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:s}=n;if(null===s)n._parentOrParents=this;else if(s instanceof hn){if(s===this)return n;n._parentOrParents=[s,this]}else{if(-1!==s.indexOf(this))return n;s.push(this)}const c=this._subscriptions;return null===c?this._subscriptions=[n]:c.push(n),n}remove(e){const n=this._subscriptions;if(n){const s=n.indexOf(e);-1!==s&&n.splice(s,1)}}}var t;function ao(t){return t.reduce((e,n)=>e.concat(n instanceof Lt?n.errors:n),[])}hn.EMPTY=((t=new hn).closed=!0,t);const Ft="function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random();class $n extends hn{constructor(e,n,s){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=Ge;break;case 1:if(!e){this.destination=Ge;break}if("object"==typeof e){e instanceof $n?(this.syncErrorThrowable=e.syncErrorThrowable,this.destination=e,e.add(this)):(this.syncErrorThrowable=!0,this.destination=new Za(this,e));break}default:this.syncErrorThrowable=!0,this.destination=new Za(this,e,n,s)}}[Ft](){return this}static create(e,n,s){const c=new $n(e,n,s);return c.syncErrorThrowable=!1,c}next(e){this.isStopped||this._next(e)}error(e){this.isStopped||(this.isStopped=!0,this._error(e))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(e){this.destination.next(e)}_error(e){this.destination.error(e),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:e}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=e,this}}class Za extends $n{constructor(e,n,s,c){super(),this._parentSubscriber=e;let f,y=this;qa(n)?f=n:n&&(f=n.next,s=n.error,c=n.complete,n!==Ge&&(y=Object.create(n),qa(y.unsubscribe)&&this.add(y.unsubscribe.bind(y)),y.unsubscribe=this.unsubscribe.bind(this))),this._context=y,this._next=f,this._error=s,this._complete=c}next(e){if(!this.isStopped&&this._next){const{_parentSubscriber:n}=this;Wo.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?this.__tryOrSetError(n,this._next,e)&&this.unsubscribe():this.__tryOrUnsub(this._next,e)}}error(e){if(!this.isStopped){const{_parentSubscriber:n}=this,{useDeprecatedSynchronousErrorHandling:s}=Wo;if(this._error)s&&n.syncErrorThrowable?(this.__tryOrSetError(n,this._error,e),this.unsubscribe()):(this.__tryOrUnsub(this._error,e),this.unsubscribe());else if(n.syncErrorThrowable)s?(n.syncErrorValue=e,n.syncErrorThrown=!0):d(e),this.unsubscribe();else{if(this.unsubscribe(),s)throw e;d(e)}}}complete(){if(!this.isStopped){const{_parentSubscriber:e}=this;if(this._complete){const n=()=>this._complete.call(this._context);Wo.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(e,n){try{e.call(this._context,n)}catch(s){if(this.unsubscribe(),Wo.useDeprecatedSynchronousErrorHandling)throw s;d(s)}}__tryOrSetError(e,n,s){if(!Wo.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{n.call(this._context,s)}catch(c){return Wo.useDeprecatedSynchronousErrorHandling?(e.syncErrorValue=c,e.syncErrorThrown=!0,!0):(d(c),!0)}return!1}_unsubscribe(){const{_parentSubscriber:e}=this;this._context=null,this._parentSubscriber=null,e.unsubscribe()}}const Et="function"==typeof Symbol&&Symbol.observable||"@@observable";function Ti(t){return t}let kn=(()=>{class t{constructor(n){this._isScalar=!1,n&&(this._subscribe=n)}lift(n){const s=new t;return s.source=this,s.operator=n,s}subscribe(n,s,c){const{operator:f}=this,y=function Wa(t,e,n){if(t){if(t instanceof $n)return t;if(t[Ft])return t[Ft]()}return t||e||n?new $n(t,e,n):new $n(Ge)}(n,s,c);if(y.add(f?f.call(y,this.source):this.source||Wo.useDeprecatedSynchronousErrorHandling&&!y.syncErrorThrowable?this._subscribe(y):this._trySubscribe(y)),Wo.useDeprecatedSynchronousErrorHandling&&y.syncErrorThrowable&&(y.syncErrorThrowable=!1,y.syncErrorThrown))throw y.syncErrorValue;return y}_trySubscribe(n){try{return this._subscribe(n)}catch(s){Wo.useDeprecatedSynchronousErrorHandling&&(n.syncErrorThrown=!0,n.syncErrorValue=s),function sa(t){for(;t;){const{closed:e,destination:n,isStopped:s}=t;if(e||s)return!1;t=n&&n instanceof $n?n:null}return!0}(n)?n.error(s):console.warn(s)}}forEach(n,s){return new(s=_r(s))((c,f)=>{let y;y=this.subscribe(E=>{try{n(E)}catch(S){f(S),y&&y.unsubscribe()}},f,c)})}_subscribe(n){const{source:s}=this;return s&&s.subscribe(n)}[Et](){return this}pipe(...n){return 0===n.length?this:function Xo(t){return 0===t.length?Ti:1===t.length?t[0]:function(n){return t.reduce((s,c)=>c(s),n)}}(n)(this)}toPromise(n){return new(n=_r(n))((s,c)=>{let f;this.subscribe(y=>f=y,y=>c(y),()=>s(f))})}}return t.create=e=>new t(e),t})();function _r(t){if(t||(t=Wo.Promise||Promise),!t)throw new Error("no Promise impl found");return t}const lo=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})();class Xa extends hn{constructor(e,n){super(),this.subject=e,this.subscriber=n,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const e=this.subject,n=e.observers;if(this.subject=null,!n||0===n.length||e.isStopped||e.closed)return;const s=n.indexOf(this.subscriber);-1!==s&&n.splice(s,1)}}class Ol extends $n{constructor(e){super(e),this.destination=e}}let Ui=(()=>{class t extends kn{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[Ft](){return new Ol(this)}lift(n){const s=new Yo(this,this);return s.operator=n,s}next(n){if(this.closed)throw new lo;if(!this.isStopped){const{observers:s}=this,c=s.length,f=s.slice();for(let y=0;y<c;y++)f[y].next(n)}}error(n){if(this.closed)throw new lo;this.hasError=!0,this.thrownError=n,this.isStopped=!0;const{observers:s}=this,c=s.length,f=s.slice();for(let y=0;y<c;y++)f[y].error(n);this.observers.length=0}complete(){if(this.closed)throw new lo;this.isStopped=!0;const{observers:n}=this,s=n.length,c=n.slice();for(let f=0;f<s;f++)c[f].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(n){if(this.closed)throw new lo;return super._trySubscribe(n)}_subscribe(n){if(this.closed)throw new lo;return this.hasError?(n.error(this.thrownError),hn.EMPTY):this.isStopped?(n.complete(),hn.EMPTY):(this.observers.push(n),new Xa(this,n))}asObservable(){const n=new kn;return n.source=this,n}}return t.create=(e,n)=>new Yo(e,n),t})();class Yo extends Ui{constructor(e,n){super(),this.destination=e,this.source=n}next(e){const{destination:n}=this;n&&n.next&&n.next(e)}error(e){const{destination:n}=this;n&&n.error&&this.destination.error(e)}complete(){const{destination:e}=this;e&&e.complete&&this.destination.complete()}_subscribe(e){const{source:n}=this;return n?this.source.subscribe(e):hn.EMPTY}}function Ko(t){return t&&"function"==typeof t.schedule}function Vt(t,e){return function(s){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return s.lift(new la(t,e))}}class la{constructor(e,n){this.project=e,this.thisArg=n}call(e,n){return n.subscribe(new ji(e,this.project,this.thisArg))}}class ji extends $n{constructor(e,n,s){super(e),this.project=n,this.count=0,this.thisArg=s||this}_next(e){let n;try{n=this.project.call(this.thisArg,e,this.count++)}catch(s){return void this.destination.error(s)}this.destination.next(n)}}const Ya=t=>e=>{for(let n=0,s=t.length;n<s&&!e.closed;n++)e.next(t[n]);e.complete()},$i=function Ur(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}(),ca=t=>t&&"number"==typeof t.length&&"function"!=typeof t;function Ka(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}const co=t=>{if(t&&"function"==typeof t[Et])return(t=>e=>{const n=t[Et]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(e)})(t);if(ca(t))return Ya(t);if(Ka(t))return(t=>e=>(t.then(n=>{e.closed||(e.next(n),e.complete())},n=>e.error(n)).then(null,d),e))(t);if(t&&"function"==typeof t[$i])return(t=>e=>{const n=t[$i]();for(;;){let s;try{s=n.next()}catch(c){return e.error(c),e}if(s.done){e.complete();break}if(e.next(s.value),e.closed)break}return"function"==typeof n.return&&e.add(()=>{n.return&&n.return()}),e})(t);{const n=`You provided ${Jr(t)?"an invalid object":`'${t}'`} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`;throw new TypeError(n)}};function es(t,e){return new kn(n=>{const s=new hn;let c=0;return s.add(e.schedule(function(){c!==t.length?(n.next(t[c++]),n.closed||s.add(this.schedule())):n.complete()})),s})}function zn(t,e){return e?function ko(t,e){if(null!=t){if(function ts(t){return t&&"function"==typeof t[Et]}(t))return function Nc(t,e){return new kn(n=>{const s=new hn;return s.add(e.schedule(()=>{const c=t[Et]();s.add(c.subscribe({next(f){s.add(e.schedule(()=>n.next(f)))},error(f){s.add(e.schedule(()=>n.error(f)))},complete(){s.add(e.schedule(()=>n.complete()))}}))})),s})}(t,e);if(Ka(t))return function ua(t,e){return new kn(n=>{const s=new hn;return s.add(e.schedule(()=>t.then(c=>{s.add(e.schedule(()=>{n.next(c),s.add(e.schedule(()=>n.complete()))}))},c=>{s.add(e.schedule(()=>n.error(c)))}))),s})}(t,e);if(ca(t))return es(t,e);if(function ha(t){return t&&"function"==typeof t[$i]}(t)||"string"==typeof t)return function en(t,e){if(!t)throw new Error("Iterable cannot be null");return new kn(n=>{const s=new hn;let c;return s.add(()=>{c&&"function"==typeof c.return&&c.return()}),s.add(e.schedule(()=>{c=t[$i](),s.add(e.schedule(function(){if(n.closed)return;let f,y;try{const E=c.next();f=E.value,y=E.done}catch(E){return void n.error(E)}y?n.complete():(n.next(f),this.schedule())}))})),s})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof kn?t:new kn(co(t))}class Ds extends $n{constructor(e){super(),this.parent=e}_next(e){this.parent.notifyNext(e)}_error(e){this.parent.notifyError(e),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class Ro extends $n{notifyNext(e){this.destination.next(e)}notifyError(e){this.destination.error(e)}notifyComplete(){this.destination.complete()}}function uo(t,e){if(e.closed)return;if(t instanceof kn)return t.subscribe(e);let n;try{n=co(t)(e)}catch(s){e.error(s)}return n}function ir(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?s=>s.pipe(ir((c,f)=>zn(t(c,f)).pipe(Vt((y,E)=>e(c,y,f,E))),n)):("number"==typeof e&&(n=e),s=>s.lift(new Ja(t,n)))}class Ja{constructor(e,n=Number.POSITIVE_INFINITY){this.project=e,this.concurrent=n}call(e,n){return n.subscribe(new zl(e,this.project,this.concurrent))}}class zl extends Ro{constructor(e,n,s=Number.POSITIVE_INFINITY){super(e),this.project=n,this.concurrent=s,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(e){this.active<this.concurrent?this._tryNext(e):this.buffer.push(e)}_tryNext(e){let n;const s=this.index++;try{n=this.project(e,s)}catch(c){return void this.destination.error(c)}this.active++,this._innerSub(n)}_innerSub(e){const n=new Ds(this),s=this.destination;s.add(n);const c=uo(e,n);c!==n&&s.add(c)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(e){this.destination.next(e)}notifyComplete(){const e=this.buffer;this.active--,e.length>0?this._next(e.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}function Or(t=Number.POSITIVE_INFINITY){return ir(Ti,t)}function Hi(t,e){return e?es(t,e):new kn(Ya(t))}function Qa(){return function(e){return e.lift(new Di(e))}}class Di{constructor(e){this.connectable=e}call(e,n){const{connectable:s}=this;s._refCount++;const c=new ns(e,s),f=n.subscribe(c);return c.closed||(c.connection=s.connect()),f}}class ns extends $n{constructor(e,n){super(e),this.connectable=n}_unsubscribe(){const{connectable:e}=this;if(!e)return void(this.connection=null);this.connectable=null;const n=e._refCount;if(n<=0)return void(this.connection=null);if(e._refCount=n-1,n>1)return void(this.connection=null);const{connection:s}=this,c=e._connection;this.connection=null,c&&(!s||c===s)&&c.unsubscribe()}}class Bl extends kn{constructor(e,n){super(),this.source=e,this.subjectFactory=n,this._refCount=0,this._isComplete=!1}_subscribe(e){return this.getSubject().subscribe(e)}getSubject(){const e=this._subject;return(!e||e.isStopped)&&(this._subject=this.subjectFactory()),this._subject}connect(){let e=this._connection;return e||(this._isComplete=!1,e=this._connection=new hn,e.add(this.source.subscribe(new Vl(this.getSubject(),this))),e.closed&&(this._connection=null,e=hn.EMPTY)),e}refCount(){return Qa()(this)}}const Nl=(()=>{const t=Bl.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class Vl extends Ol{constructor(e,n){super(e),this.connectable=n}_error(e){this._unsubscribe(),super._error(e)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const e=this.connectable;if(e){this.connectable=null;const n=e._connection;e._refCount=0,e._subject=null,e._connection=null,n&&n.unsubscribe()}}}class $c{constructor(e,n){this.subjectFactory=e,this.selector=n}call(e,n){const{selector:s}=this,c=this.subjectFactory(),f=s(c).subscribe(e);return f.add(n.subscribe(c)),f}}function lh(){return new Ui}function sn(t){for(let e in t)if(t[e]===sn)return e;throw Error("Could not find renamed property on target object.")}function As(t,e){for(const n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function mn(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(mn).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function jr(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const jl=sn({__forward_ref__:sn});function Y(t){return t.__forward_ref__=Y,t.toString=function(){return mn(this())},t}function O(t){return V(t)?t():t}function V(t){return"function"==typeof t&&t.hasOwnProperty(jl)&&t.__forward_ref__===Y}class K extends Error{constructor(e,n){super(function fe(t,e){return`NG0${Math.abs(t)}${e?": "+e:""}`}(e,n)),this.code=e}}function de(t){return"string"==typeof t?t:null==t?"":String(t)}function ge(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():de(t)}function et(t,e){const n=e?` in ${e}`:"";throw new K(-201,`No provider for ${ge(t)} found${n}`)}function Si(t,e){null==t&&function qt(t,e,n,s){throw new Error(`ASSERTION ERROR: ${t}`+(null==s?"":` [Expected=> ${n} ${s} ${e} <=Actual]`))}(e,t,null,"!=")}function ke(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function wt(t){return{providers:t.providers||[],imports:t.imports||[]}}function Mi(t){return Is(t,Ps)||Is(t,Gn)}function Is(t,e){return t.hasOwnProperty(e)?t[e]:null}function pa(t){return t&&(t.hasOwnProperty(mi)||t.hasOwnProperty(Ed))?t[mi]:null}const Ps=sn({\u0275prov:sn}),mi=sn({\u0275inj:sn}),Gn=sn({ngInjectableDef:sn}),Ed=sn({ngInjectorDef:sn});var Tt=(()=>((Tt=Tt||{})[Tt.Default=0]="Default",Tt[Tt.Host=1]="Host",Tt[Tt.Self=2]="Self",Tt[Tt.SkipSelf=4]="SkipSelf",Tt[Tt.Optional=8]="Optional",Tt))();let el;function Ai(t){const e=el;return el=t,e}function uh(t,e,n){const s=Mi(t);return s&&"root"==s.providedIn?void 0===s.value?s.value=s.factory():s.value:n&Tt.Optional?null:void 0!==e?e:void et(mn(t),"Injector")}function Cn(t){return{toString:t}.toString()}var lr=(()=>((lr=lr||{})[lr.OnPush=0]="OnPush",lr[lr.Default=1]="Default",lr))(),hr=(()=>(function(t){t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom"}(hr||(hr={})),hr))();const Hc="undefined"!=typeof globalThis&&globalThis,$l="undefined"!=typeof window&&window,Qn="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,Tn=Hc||"undefined"!=typeof global&&global||$l||Qn,is={},bn=[],Zi=sn({\u0275cmp:sn}),Fo=sn({\u0275dir:sn}),rl=sn({\u0275pipe:sn}),Td=sn({\u0275mod:sn}),po=sn({\u0275fac:sn}),Lo=sn({__NG_ELEMENT_ID__:sn});let pf=0;function ti(t){return Cn(()=>{const n={},s={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:n,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===lr.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||bn,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||hr.Emulated,id:"c",styles:t.styles||bn,_:null,setInput:null,schemas:t.schemas||null,tView:null},c=t.directives,f=t.features,y=t.pipes;return s.id+=pf++,s.inputs=Dd(t.inputs,n),s.outputs=Dd(t.outputs),f&&f.forEach(E=>E(s)),s.directiveDefs=c?()=>("function"==typeof c?c():c).map(Oo):null,s.pipeDefs=y?()=>("function"==typeof y?y():y).map(ks):null,s})}function Oo(t){return zr(t)||function Wi(t){return t[Fo]||null}(t)}function ks(t){return function fa(t){return t[rl]||null}(t)}const os={};function gi(t){return Cn(()=>{const e={type:t.type,bootstrap:t.bootstrap||bn,declarations:t.declarations||bn,imports:t.imports||bn,exports:t.exports||bn,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&(os[t.id]=t.type),e})}function Dd(t,e){if(null==t)return is;const n={};for(const s in t)if(t.hasOwnProperty(s)){let c=t[s],f=c;Array.isArray(c)&&(f=c[1],c=c[0]),n[c]=s,e&&(e[c]=f)}return n}const St=ti;function zr(t){return t[Zi]||null}function Ii(t,e){const n=t[Td]||null;if(!n&&!0===e)throw new Error(`Type ${mn(t)} does not have '\u0275mod' property.`);return n}function Pi(t){return Array.isArray(t)&&"object"==typeof t[1]}function _i(t){return Array.isArray(t)&&!0===t[1]}function Hl(t){return 0!=(8&t.flags)}function ql(t){return 2==(2&t.flags)}function Zl(t){return 1==(1&t.flags)}function oi(t){return null!==t.template}function sl(t){return 0!=(512&t[2])}function Xi(t,e){return t.hasOwnProperty(po)?t[po]:null}class vf{constructor(e,n,s){this.previousValue=e,this.currentValue=n,this.firstChange=s}isFirstChange(){return this.firstChange}}function si(){return mh}function mh(t){return t.type.prototype.ngOnChanges&&(t.setInput=xf),Fd}function Fd(){const t=Jc(this),e=null==t?void 0:t.current;if(e){const n=t.previous;if(n===is)t.previous=e;else for(let s in e)n[s]=e[s];t.current=null,this.ngOnChanges(e)}}function xf(t,e,n,s){const c=Jc(t)||function Qc(t,e){return t[Ld]=e}(t,{previous:is,current:null}),f=c.current||(c.current={}),y=c.previous,E=this.declaredInputs[n],S=y[E];f[E]=new vf(S&&S.currentValue,e,y===is),t[s]=e}si.ngInherit=!0;const Ld="__ngSimpleChanges__";function Jc(t){return t[Ld]||null}let zs;function Wn(t){return!!t.listen}const zd={createRenderer:(t,e)=>function ll(){return void 0!==zs?zs:"undefined"!=typeof document?document:void 0}()};function wn(t){for(;Array.isArray(t);)t=t[0];return t}function Kl(t,e){return wn(e[t])}function Yi(t,e){return wn(e[t.index])}function cl(t,e){return t.data[e]}function Hr(t,e){const n=e[t];return Pi(n)?n:n[0]}function ul(t){return 4==(4&t[2])}function hl(t){return 128==(128&t[2])}function ki(t,e){return null==e?null:t[e]}function nt(t){t[18]=0}function yi(t,e){t[5]+=e;let n=t,s=t[3];for(;null!==s&&(1===e&&1===n[5]||-1===e&&0===n[5]);)s[5]+=e,n=s,s=s[3]}const Mt={lFrame:wa(null),bindingsEnabled:!0};function nu(){return Mt.bindingsEnabled}function $e(){return Mt.lFrame.lView}function Zt(){return Mt.lFrame.tView}function ru(t){return Mt.lFrame.contextLView=t,t[8]}function Cr(){let t=dl();for(;null!==t&&64===t.type;)t=t.parent;return t}function dl(){return Mt.lFrame.currentTNode}function tr(t,e){const n=Mt.lFrame;n.currentTNode=t,n.isParent=e}function xa(){return Mt.lFrame.isParent}function iu(){Mt.lFrame.isParent=!1}function go(){return Mt.lFrame.bindingIndex++}function Qi(t){const e=Mt.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+t,n}function bh(t,e){const n=Mt.lFrame;n.bindingIndex=n.bindingRootIndex=t,pl(e)}function pl(t){Mt.lFrame.currentDirectiveIndex=t}function wh(){return Mt.lFrame.currentQueryIndex}function su(t){Mt.lFrame.currentQueryIndex=t}function Gd(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function Hd(t,e,n){if(n&Tt.SkipSelf){let c=e,f=t;for(;!(c=c.parent,null!==c||n&Tt.Host||(c=Gd(f),null===c||(f=f[15],10&c.type))););if(null===c)return!1;e=c,t=f}const s=Mt.lFrame=Eh();return s.currentTNode=e,s.lView=t,!0}function vi(t){const e=Eh(),n=t[1];Mt.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function Eh(){const t=Mt.lFrame,e=null===t?null:t.child;return null===e?wa(t):e}function wa(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function _o(){const t=Mt.lFrame;return Mt.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const ec=_o;function tt(){const t=_o();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function Tr(){return Mt.lFrame.selectedIndex}function eo(t){Mt.lFrame.selectedIndex=t}function or(){const t=Mt.lFrame;return cl(t.tView,t.selectedIndex)}function Ea(t,e){for(let n=e.directiveStart,s=e.directiveEnd;n<s;n++){const f=t.data[n].type.prototype,{ngAfterContentInit:y,ngAfterContentChecked:E,ngAfterViewInit:S,ngAfterViewChecked:R,ngOnDestroy:N}=f;y&&(t.contentHooks||(t.contentHooks=[])).push(-n,y),E&&((t.contentHooks||(t.contentHooks=[])).push(n,E),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,E)),S&&(t.viewHooks||(t.viewHooks=[])).push(-n,S),R&&((t.viewHooks||(t.viewHooks=[])).push(n,R),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,R)),null!=N&&(t.destroyHooks||(t.destroyHooks=[])).push(n,N)}}function Ca(t,e,n){au(t,e,3,n)}function Ta(t,e,n,s){(3&t[2])===n&&au(t,e,n,s)}function rc(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function au(t,e,n,s){const f=null!=s?s:-1,y=e.length-1;let E=0;for(let S=void 0!==s?65535&t[18]:0;S<y;S++)if("number"==typeof e[S+1]){if(E=e[S],null!=s&&E>=s)break}else e[S]<0&&(t[18]+=65536),(E<f||-1==f)&&(Ch(t,n,e,S),t[18]=(4294901760&t[18])+S+2),S++}function Ch(t,e,n,s){const c=n[s]<0,f=n[s+1],E=t[c?-n[s]:n[s]];if(c){if(t[2]>>11<t[18]>>16&&(3&t[2])===e){t[2]+=2048;try{f.call(E)}finally{}}}else try{f.call(E)}finally{}}class Ns{constructor(e,n,s){this.factory=e,this.resolving=!1,this.canSeeViewProviders=n,this.injectImpl=s}}function ic(t,e,n){const s=Wn(t);let c=0;for(;c<n.length;){const f=n[c];if("number"==typeof f){if(0!==f)break;c++;const y=n[c++],E=n[c++],S=n[c++];s?t.setAttribute(e,E,S,y):e.setAttributeNS(y,E,S)}else{const y=f,E=n[++c];hu(y)?s&&t.setProperty(e,y,E):s?t.setAttribute(e,y,E):e.setAttribute(y,E),c++}}return c}function Vs(t){return 3===t||4===t||6===t}function hu(t){return 64===t.charCodeAt(0)}function fl(t,e){if(null!==e&&0!==e.length)if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let s=0;s<e.length;s++){const c=e[s];"number"==typeof c?n=c:0===n||oc(t,n,c,null,-1===n||2===n?e[++s]:null)}}return t}function oc(t,e,n,s,c){let f=0,y=t.length;if(-1===e)y=-1;else for(;f<t.length;){const E=t[f++];if("number"==typeof E){if(E===e){y=-1;break}if(E>e){y=f-1;break}}}for(;f<t.length;){const E=t[f];if("number"==typeof E)break;if(E===n){if(null===s)return void(null!==c&&(t[f+1]=c));if(s===t[f+1])return void(t[f+2]=c)}f++,null!==s&&f++,null!==c&&f++}-1!==y&&(t.splice(y,0,e),f=y+1),t.splice(f++,0,n),null!==s&&t.splice(f++,0,s),null!==c&&t.splice(f++,0,c)}function Sa(t){return-1!==t}function p(t){return 32767&t}function u(t,e){let n=function i(t){return t>>16}(t),s=e;for(;n>0;)s=s[15],n--;return s}let g=!0;function v(t){const e=g;return g=t,e}let A=0;function L(t,e){const n=j(t,e);if(-1!==n)return n;const s=e[1];s.firstCreatePass&&(t.injectorIndex=e.length,B(s.data,t),B(e,null),B(s.blueprint,null));const c=H(t,e),f=t.injectorIndex;if(Sa(c)){const y=p(c),E=u(c,e),S=E[1].data;for(let R=0;R<8;R++)e[f+R]=E[y+R]|S[y+R]}return e[f+8]=c,f}function B(t,e){t.push(0,0,0,0,0,0,0,0,e)}function j(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function H(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,s=null,c=e;for(;null!==c;){const f=c[1],y=f.type;if(s=2===y?f.declTNode:1===y?c[6]:null,null===s)return-1;if(n++,c=c[15],-1!==s.injectorIndex)return s.injectorIndex|n<<16}return-1}function Z(t,e,n){!function k(t,e,n){let s;"string"==typeof n?s=n.charCodeAt(0)||0:n.hasOwnProperty(Lo)&&(s=n[Lo]),null==s&&(s=n[Lo]=A++);const c=255&s;e.data[t+(c>>5)]|=1<<c}(t,e,n)}function ne(t,e,n){if(n&Tt.Optional)return t;et(e,"NodeInjector")}function W(t,e,n,s){if(n&Tt.Optional&&void 0===s&&(s=null),0==(n&(Tt.Self|Tt.Host))){const c=t[9],f=Ai(void 0);try{return c?c.get(e,s,n&Tt.Optional):uh(e,s,n&Tt.Optional)}finally{Ai(f)}}return ne(s,e,n)}function Q(t,e,n,s=Tt.Default,c){if(null!==t){const f=function Ce(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty(Lo)?t[Lo]:void 0;return"number"==typeof e?e>=0?255&e:le:e}(n);if("function"==typeof f){if(!Hd(e,t,s))return s&Tt.Host?ne(c,n,s):W(e,n,s,c);try{const y=f(s);if(null!=y||s&Tt.Optional)return y;et(n)}finally{ec()}}else if("number"==typeof f){let y=null,E=j(t,e),S=-1,R=s&Tt.Host?e[16][6]:null;for((-1===E||s&Tt.SkipSelf)&&(S=-1===E?H(t,e):e[E+8],-1!==S&&be(s,!1)?(y=e[1],E=p(S),e=u(S,e)):E=-1);-1!==E;){const N=e[1];if(Se(f,E,N.data)){const $=te(E,e,n,y,s,R);if($!==q)return $}S=e[E+8],-1!==S&&be(s,e[1].data[E+8]===R)&&Se(f,E,e)?(y=N,E=p(S),e=u(S,e)):E=-1}}}return W(e,n,s,c)}const q={};function le(){return new Ve(Cr(),$e())}function te(t,e,n,s,c,f){const y=e[1],E=y.data[t+8],N=re(E,y,n,null==s?ql(E)&&g:s!=y&&0!=(3&E.type),c&Tt.Host&&f===E);return null!==N?ue(e,y,N,E):q}function re(t,e,n,s,c){const f=t.providerIndexes,y=e.data,E=1048575&f,S=t.directiveStart,N=f>>20,oe=c?E+N:t.directiveEnd;for(let ae=s?E:E+N;ae<oe;ae++){const Ee=y[ae];if(ae<S&&n===Ee||ae>=S&&Ee.type===n)return ae}if(c){const ae=y[S];if(ae&&oi(ae)&&ae.type===n)return S}return null}function ue(t,e,n,s){let c=t[n];const f=e.data;if(function lu(t){return t instanceof Ns}(c)){const y=c;y.resolving&&function me(t,e){const n=e?`. Dependency path: ${e.join(" > ")} > ${t}`:"";throw new K(-200,`Circular dependency in DI detected for ${t}${n}`)}(ge(f[n]));const E=v(y.canSeeViewProviders);y.resolving=!0;const S=y.injectImpl?Ai(y.injectImpl):null;Hd(t,s,Tt.Default);try{c=t[n]=y.factory(void 0,f,t,s),e.firstCreatePass&&n>=s.directiveStart&&function nc(t,e,n){const{ngOnChanges:s,ngOnInit:c,ngDoCheck:f}=e.type.prototype;if(s){const y=mh(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,y),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,y)}c&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,c),f&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,f),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,f))}(n,f[n],e)}finally{null!==S&&Ai(S),v(E),y.resolving=!1,ec()}}return c}function Se(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function be(t,e){return!(t&Tt.Self||t&Tt.Host&&e)}class Ve{constructor(e,n){this._tNode=e,this._lView=n}get(e,n,s){return Q(this._tNode,this._lView,e,s,n)}}function ie(t){return Cn(()=>{const e=t.prototype.constructor,n=e[po]||ve(e),s=Object.prototype;let c=Object.getPrototypeOf(t.prototype).constructor;for(;c&&c!==s;){const f=c[po]||ve(c);if(f&&f!==n)return f;c=Object.getPrototypeOf(c)}return f=>new f})}function ve(t){return V(t)?()=>{const e=ve(O(t));return e&&e()}:Xi(t)}function Ie(t){return function G(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const s=n.length;let c=0;for(;c<s;){const f=n[c];if(Vs(f))break;if(0===f)c+=2;else if("number"==typeof f)for(c++;c<s&&"string"==typeof n[c];)c++;else{if(f===e)return n[c+1];c+=2}}}return null}(Cr(),t)}const Me="__parameters__";function We(t,e,n){return Cn(()=>{const s=function Ke(t){return function(...n){if(t){const s=t(...n);for(const c in s)this[c]=s[c]}}}(e);function c(...f){if(this instanceof c)return s.apply(this,f),this;const y=new c(...f);return E.annotation=y,E;function E(S,R,N){const $=S.hasOwnProperty(Me)?S[Me]:Object.defineProperty(S,Me,{value:[]})[Me];for(;$.length<=N;)$.push(null);return($[N]=$[N]||[]).push(y),S}}return n&&(c.prototype=Object.create(n.prototype)),c.prototype.ngMetadataName=t,c.annotationCls=c,c})}class qe{constructor(e,n){this._desc=e,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof n?this.__NG_ELEMENT_ID__=n:void 0!==n&&(this.\u0275prov=ke({token:this,providedIn:n.providedIn||"root",factory:n.factory}))}toString(){return`InjectionToken ${this._desc}`}}const Dt=new qe("AnalyzeForEntryComponents");function Un(t,e){void 0===e&&(e=t);for(let n=0;n<t.length;n++){let s=t[n];Array.isArray(s)?(e===t&&(e=t.slice(0,n)),Un(s,e)):e!==t&&e.push(s)}return e}function Qt(t,e){t.forEach(n=>Array.isArray(n)?Qt(n,e):e(n))}function Yn(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function Vo(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function Dr(t,e,n){let s=sc(t,e);return s>=0?t[1|s]=n:(s=~s,function Us(t,e,n,s){let c=t.length;if(c==e)t.push(n,s);else if(1===c)t.push(s,t[0]),t[0]=n;else{for(c--,t.push(t[c-1],t[c]);c>e;)t[c]=t[c-2],c--;t[e]=n,t[e+1]=s}}(t,s,e,n)),s}function tp(t,e){const n=sc(t,e);if(n>=0)return t[1|n]}function sc(t,e){return function np(t,e,n){let s=0,c=t.length>>n;for(;c!==s;){const f=s+(c-s>>1),y=t[f<<n];if(e===y)return f<<n;y>e?c=f:s=f+1}return~(c<<n)}(t,e,1)}const du={},ip="__NG_DI_FLAG__",Dh="ngTempTokenPath",Dv=/\n/gm,Ng="__source",Sh=sn({provide:String,useValue:sn});let Mh;function Ah(t){const e=Mh;return Mh=t,e}function Vg(t,e=Tt.Default){if(void 0===Mh)throw new K(203,"");return null===Mh?uh(t,void 0,e):Mh.get(t,e&Tt.Optional?null:void 0,e)}function xt(t,e=Tt.Default){return(function tl(){return el}()||Vg)(O(t),e)}const Ia=xt;function pu(t){const e=[];for(let n=0;n<t.length;n++){const s=O(t[n]);if(Array.isArray(s)){if(0===s.length)throw new K(900,"");let c,f=Tt.Default;for(let y=0;y<s.length;y++){const E=s[y],S=Ug(E);"number"==typeof S?-1===S?c=E.token:f|=S:c=E}e.push(xt(c,f))}else e.push(xt(s))}return e}function fu(t,e){return t[ip]=e,t.prototype[ip]=e,t}function Ug(t){return t[ip]}const op=fu(We("Inject",t=>({token:t})),-1),js=fu(We("Optional"),8),$s=fu(We("SkipSelf"),4);class cc{constructor(e){this.changingThisBreaksApplicationSecurity=e}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}function ka(t){return t instanceof cc?t.changingThisBreaksApplicationSecurity:t}const Lv=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Wg=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;var Kn=(()=>((Kn=Kn||{})[Kn.NONE=0]="NONE",Kn[Kn.HTML=1]="HTML",Kn[Kn.STYLE=2]="STYLE",Kn[Kn.SCRIPT=3]="SCRIPT",Kn[Kn.URL=4]="URL",Kn[Kn.RESOURCE_URL=5]="RESOURCE_URL",Kn))();function Eu(t){const e=function Fa(){const t=$e();return t&&t[12]}();return e?e.sanitize(Kn.URL,t)||"":function kh(t,e){const n=function Ra(t){return t instanceof cc&&t.getTypeName()||null}(t);if(null!=n&&n!==e){if("ResourceURL"===n&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===e}(t,"URL")?ka(t):function Rh(t){return(t=String(t)).match(Lv)||t.match(Wg)?t:"unsafe:"+t}(de(t))}const zf="__ngContext__";function xr(t,e){t[zf]=e}function up(t){const e=function Cu(t){return t[zf]||null}(t);return e?Array.isArray(e)?e:e.lView:null}function pp(t){return t.ngOriginalError}function Uf(t,...e){t.error(...e)}class bo{constructor(){this._console=console}handleError(e){const n=this._findOriginalError(e),s=function i_(t){return t&&t.ngErrorLogger||Uf}(e);s(this._console,"ERROR",e),n&&s(this._console,"ORIGINAL ERROR",n)}_findOriginalError(e){let n=e&&pp(e);for(;n&&pp(n);)n=pp(n);return n||null}}const vl=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(Tn))();function Zs(t){return t instanceof Function?t():t}var wo=(()=>((wo=wo||{})[wo.Important=1]="Important",wo[wo.DashCase=2]="DashCase",wo))();function $f(t,e){return undefined(t,e)}function Du(t){const e=t[3];return _i(e)?e[3]:e}function pc(t){return Gf(t[13])}function gp(t){return Gf(t[4])}function Gf(t){for(;null!==t&&!_i(t);)t=t[4];return t}function bl(t,e,n,s,c){if(null!=s){let f,y=!1;_i(s)?f=s:Pi(s)&&(y=!0,s=s[0]);const E=wn(s);0===t&&null!==n?null==c?p_(e,n,E):gc(e,n,E,c||null,!0):1===t&&null!==n?gc(e,n,E,c||null,!0):2===t?function em(t,e,n){const s=vp(t,e);s&&function f_(t,e,n,s){Wn(t)?t.removeChild(e,n,s):e.removeChild(n)}(t,s,e,n)}(e,E,y):3===t&&e.destroyNode(E),null!=f&&function __(t,e,n,s,c){const f=n[7];f!==wn(n)&&bl(e,t,s,f,c);for(let E=10;E<n.length;E++){const S=n[E];Gh(S[1],S,t,e,s,f)}}(e,t,f,n,c)}}function fc(t,e,n){if(Wn(t))return t.createElement(e,n);{const s=null!==n?function al(t){const e=t.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(n):null;return null===s?t.createElement(e):t.createElementNS(s,e)}}function h_(t,e){const n=t[9],s=n.indexOf(e),c=e[3];1024&e[2]&&(e[2]&=-1025,yi(c,-1)),n.splice(s,1)}function Wf(t,e){if(t.length<=10)return;const n=10+e,s=t[n];if(s){const c=s[17];null!==c&&c!==t&&h_(c,s),e>0&&(t[n-1][4]=s[4]);const f=Vo(t,10+e);!function qv(t,e){Gh(t,e,e[11],2,null,null),e[0]=null,e[6]=null}(s[1],s);const y=f[19];null!==y&&y.detachView(f[1]),s[3]=null,s[4]=null,s[2]&=-129}return s}function d_(t,e){if(!(256&e[2])){const n=e[11];Wn(n)&&n.destroyNode&&Gh(t,e,n,3,null,null),function qf(t){let e=t[13];if(!e)return Xf(t[1],t);for(;e;){let n=null;if(Pi(e))n=e[13];else{const s=e[10];s&&(n=s)}if(!n){for(;e&&!e[4]&&e!==t;)Pi(e)&&Xf(e[1],e),e=e[3];null===e&&(e=t),Pi(e)&&Xf(e[1],e),n=e&&e[4]}e=n}}(e)}}function Xf(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function Xv(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let s=0;s<n.length;s+=2){const c=e[n[s]];if(!(c instanceof Ns)){const f=n[s+1];if(Array.isArray(f))for(let y=0;y<f.length;y+=2){const E=c[f[y]],S=f[y+1];try{S.call(E)}finally{}}else try{f.call(c)}finally{}}}}(t,e),function Wv(t,e){const n=t.cleanup,s=e[7];let c=-1;if(null!==n)for(let f=0;f<n.length-1;f+=2)if("string"==typeof n[f]){const y=n[f+1],E="function"==typeof y?y(e):wn(e[y]),S=s[c=n[f+2]],R=n[f+3];"boolean"==typeof R?E.removeEventListener(n[f],S,R):R>=0?s[c=R]():s[c=-R].unsubscribe(),f+=2}else{const y=s[c=n[f+1]];n[f].call(y)}if(null!==s){for(let f=c+1;f<s.length;f++)s[f]();e[7]=null}}(t,e),1===e[1].type&&Wn(e[11])&&e[11].destroy();const n=e[17];if(null!==n&&_i(e[3])){n!==e[3]&&h_(n,e);const s=e[19];null!==s&&s.detachView(t)}}}function Yf(t,e,n){return function mc(t,e,n){let s=e;for(;null!==s&&40&s.type;)s=(e=s).parent;if(null===s)return n[0];if(2&s.flags){const c=t.data[s.directiveStart].encapsulation;if(c===hr.None||c===hr.Emulated)return null}return Yi(s,n)}(t,e.parent,n)}function gc(t,e,n,s,c){Wn(t)?t.insertBefore(e,n,s,c):e.insertBefore(n,s,c)}function p_(t,e,n){Wn(t)?t.appendChild(e,n):e.appendChild(n)}function Kf(t,e,n,s,c){null!==s?gc(t,e,n,s,c):p_(t,e,n)}function vp(t,e){return Wn(t)?t.parentNode(e):e.parentNode}let m_=function jh(t,e,n){return 40&t.type?Yi(t,n):null};function El(t,e,n,s){const c=Yf(t,s,e),f=e[11],E=function wl(t,e,n){return m_(t,e,n)}(s.parent||e[6],s,e);if(null!=c)if(Array.isArray(n))for(let S=0;S<n.length;S++)Kf(f,c,n[S],E,!1);else Kf(f,c,n,E,!1)}function $h(t,e){if(null!==e){const n=e.type;if(3&n)return Yi(e,t);if(4&n)return Qf(-1,t[e.index]);if(8&n){const s=e.child;if(null!==s)return $h(t,s);{const c=t[e.index];return _i(c)?Qf(-1,c):wn(c)}}if(32&n)return $f(e,t)()||wn(t[e.index]);{const s=Mu(t,e);return null!==s?Array.isArray(s)?s[0]:$h(Du(t[16]),s):$h(t,e.next)}}return null}function Mu(t,e){return null!==e?t[16][6].projection[e.projection]:null}function Qf(t,e){const n=10+t+1;if(n<e.length){const s=e[n],c=s[1].firstChild;if(null!==c)return $h(s,c)}return e[7]}function xp(t,e,n,s,c,f,y){for(;null!=n;){const E=s[n.index],S=n.type;if(y&&0===e&&(E&&xr(wn(E),s),n.flags|=4),64!=(64&n.flags))if(8&S)xp(t,e,n.child,s,c,f,!1),bl(e,t,c,E,f);else if(32&S){const R=$f(n,s);let N;for(;N=R();)bl(e,t,c,N,f);bl(e,t,c,E,f)}else 16&S?Hh(t,e,s,n,c,f):bl(e,t,c,E,f);n=y?n.projectionNext:n.next}}function Gh(t,e,n,s,c,f){xp(n,s,t.firstChild,e,c,f,!1)}function Hh(t,e,n,s,c,f){const y=n[16],S=y[6].projection[s.projection];if(Array.isArray(S))for(let R=0;R<S.length;R++)bl(e,t,c,S[R],f);else xp(t,e,S,y[3],c,f,!0)}function Au(t,e,n){Wn(t)?t.setAttribute(e,"style",n):e.style.cssText=n}function _c(t,e,n){Wn(t)?""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n):e.className=n}function tm(t,e,n){let s=t.length;for(;;){const c=t.indexOf(e,n);if(-1===c)return c;if(0===c||t.charCodeAt(c-1)<=32){const f=e.length;if(c+f===s||t.charCodeAt(c+f)<=32)return c}n=c+1}}const rm="ng-template";function Kv(t,e,n){let s=0;for(;s<t.length;){let c=t[s++];if(n&&"class"===c){if(c=t[s],-1!==tm(c.toLowerCase(),e,0))return!0}else if(1===c){for(;s<t.length&&"string"==typeof(c=t[s++]);)if(c.toLowerCase()===e)return!0;return!1}}return!1}function y_(t){return 4===t.type&&t.value!==rm}function Jv(t,e,n){return e===(4!==t.type||n?t.value:rm)}function Qv(t,e,n){let s=4;const c=t.attrs||[],f=function v_(t){for(let e=0;e<t.length;e++)if(Vs(t[e]))return e;return t.length}(c);let y=!1;for(let E=0;E<e.length;E++){const S=e[E];if("number"!=typeof S){if(!y)if(4&s){if(s=2|1&s,""!==S&&!Jv(t,S,n)||""===S&&1===e.length){if(gs(s))return!1;y=!0}}else{const R=8&s?S:e[++E];if(8&s&&null!==t.attrs){if(!Kv(t.attrs,R,n)){if(gs(s))return!1;y=!0}continue}const $=ex(8&s?"class":S,c,y_(t),n);if(-1===$){if(gs(s))return!1;y=!0;continue}if(""!==R){let oe;oe=$>f?"":c[$+1].toLowerCase();const ae=8&s?oe:null;if(ae&&-1!==tm(ae,R,0)||2&s&&R!==oe){if(gs(s))return!1;y=!0}}}}else{if(!y&&!gs(s)&&!gs(S))return!1;if(y&&gs(S))continue;y=!1,s=S|1&s}}return gs(s)||y}function gs(t){return 0==(1&t)}function ex(t,e,n,s){if(null===e)return-1;let c=0;if(s||!n){let f=!1;for(;c<e.length;){const y=e[c];if(y===t)return c;if(3===y||6===y)f=!0;else{if(1===y||2===y){let E=e[++c];for(;"string"==typeof E;)E=e[++c];continue}if(4===y)break;if(0===y){c+=4;continue}}c+=f?1:2}return-1}return function x_(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const s=t[n];if("number"==typeof s)return-1;if(s===e)return n;n++}return-1}(e,t)}function qh(t,e,n=!1){for(let s=0;s<e.length;s++)if(Qv(t,e[s],n))return!0;return!1}function w_(t,e){return t?":not("+e.trim()+")":e}function nx(t){let e=t[0],n=1,s=2,c="",f=!1;for(;n<t.length;){let y=t[n];if("string"==typeof y)if(2&s){const E=t[++n];c+="["+y+(E.length>0?'="'+E+'"':"")+"]"}else 8&s?c+="."+y:4&s&&(c+=" "+y);else""!==c&&!gs(y)&&(e+=w_(f,c),c=""),s=y,f=f||!gs(s);n++}return""!==c&&(e+=w_(f,c)),e}const $t={};function In(t){E_(Zt(),$e(),Tr()+t,!1)}function E_(t,e,n,s){if(!s)if(3==(3&e[2])){const f=t.preOrderCheckHooks;null!==f&&Ca(e,f,n)}else{const f=t.preOrderHooks;null!==f&&Ta(e,f,0,n)}eo(n)}function Eo(t,e){return t<<17|e<<2}function Co(t){return t>>17&32767}function im(t){return 2|t}function La(t){return(131068&t)>>2}function yc(t,e){return-131069&t|e<<2}function om(t){return 1|t}function Ys(t,e){const n=t.contentQueries;if(null!==n)for(let s=0;s<n.length;s+=2){const c=n[s],f=n[s+1];if(-1!==f){const y=t.data[f];su(c),y.contentQueries(2,e[f],f)}}}function Ru(t,e,n,s,c,f,y,E,S,R){const N=e.blueprint.slice();return N[0]=c,N[2]=140|s,nt(N),N[3]=N[15]=t,N[8]=n,N[10]=y||t&&t[10],N[11]=E||t&&t[11],N[12]=S||t&&t[12]||null,N[9]=R||t&&t[9]||null,N[6]=f,N[16]=2==e.type?t[16]:N,N}function vc(t,e,n,s,c){let f=t.data[e];if(null===f)f=function cm(t,e,n,s,c){const f=dl(),y=xa(),S=t.data[e]=function px(t,e,n,s,c,f){return{type:n,index:s,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:c,attrs:f,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,y?f:f&&f.parent,n,e,s,c);return null===t.firstChild&&(t.firstChild=S),null!==f&&(y?null==f.child&&null!==S.parent&&(f.child=S):null===f.next&&(f.next=S)),S}(t,e,n,s,c),function jd(){return Mt.lFrame.inI18n}()&&(f.flags|=64);else if(64&f.type){f.type=n,f.value=s,f.attrs=c;const y=function mo(){const t=Mt.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();f.injectorIndex=null===y?-1:y.injectorIndex}return tr(f,!0),f}function Fu(t,e,n,s){if(0===n)return-1;const c=e.length;for(let f=0;f<n;f++)e.push(s),t.blueprint.push(s),t.data.push(null);return c}function Lu(t,e,n){vi(e);try{const s=t.viewQuery;null!==s&&za(1,s,n);const c=t.template;null!==c&&um(t,e,c,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&Ys(t,e),t.staticViewQueries&&za(2,t.viewQuery,n);const f=t.components;null!==f&&function O_(t,e){for(let n=0;n<e.length;n++)kp(t,e[n])}(e,f)}catch(s){throw t.firstCreatePass&&(t.incompleteFirstPass=!0,t.firstCreatePass=!1),s}finally{e[2]&=-5,tt()}}function xc(t,e,n,s){const c=e[2];if(256!=(256&c)){vi(e);try{nt(e),function xh(t){return Mt.lFrame.bindingIndex=t}(t.bindingStartIndex),null!==n&&um(t,e,n,2,s);const y=3==(3&c);if(y){const R=t.preOrderCheckHooks;null!==R&&Ca(e,R,null)}else{const R=t.preOrderHooks;null!==R&&Ta(e,R,0,null),rc(e,0)}if(function Z_(t){for(let e=pc(t);null!==e;e=gp(e)){if(!e[2])continue;const n=e[9];for(let s=0;s<n.length;s++){const c=n[s],f=c[3];0==(1024&c[2])&&yi(f,1),c[2]|=1024}}}(e),function ym(t){for(let e=pc(t);null!==e;e=gp(e))for(let n=10;n<e.length;n++){const s=e[n],c=s[1];hl(s)&&xc(c,s,c.template,s[8])}}(e),null!==t.contentQueries&&Ys(t,e),y){const R=t.contentCheckHooks;null!==R&&Ca(e,R)}else{const R=t.contentHooks;null!==R&&Ta(e,R,1),rc(e,1)}!function F_(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let s=0;s<n.length;s++){const c=n[s];if(c<0)eo(~c);else{const f=c,y=n[++s],E=n[++s];bh(y,f),E(2,e[f])}}}finally{eo(-1)}}(t,e);const E=t.components;null!==E&&function L_(t,e){for(let n=0;n<e.length;n++)Ci(t,e[n])}(e,E);const S=t.viewQuery;if(null!==S&&za(2,S,s),y){const R=t.viewCheckHooks;null!==R&&Ca(e,R)}else{const R=t.viewHooks;null!==R&&Ta(e,R,2),rc(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),e[2]&=-73,1024&e[2]&&(e[2]&=-1025,yi(e[3],-1))}finally{tt()}}}function Yh(t,e,n,s){const c=e[10],y=ul(e);try{!y&&c.begin&&c.begin(),y&&Lu(t,e,s),xc(t,e,n,s)}finally{!y&&c.end&&c.end()}}function um(t,e,n,s,c){const f=Tr(),y=2&s;try{eo(-1),y&&e.length>20&&E_(t,e,20,!1),n(s,c)}finally{eo(f)}}function hm(t,e,n){if(Hl(e)){const c=e.directiveEnd;for(let f=e.directiveStart;f<c;f++){const y=t.data[f];y.contentQueries&&y.contentQueries(1,n[f],f)}}}function Kh(t,e,n){!nu()||(function gx(t,e,n,s){const c=n.directiveStart,f=n.directiveEnd;t.firstCreatePass||L(n,e),xr(s,e);const y=n.initialInputs;for(let E=c;E<f;E++){const S=t.data[E],R=oi(S);R&&ro(e,n,S);const N=ue(e,t,E,n);xr(N,e),null!==y&&yx(0,E-c,N,S,0,y),R&&(Hr(n.index,e)[8]=N)}}(t,e,n,Yi(n,e)),128==(128&n.flags)&&function _x(t,e,n){const s=n.directiveStart,c=n.directiveEnd,y=n.index,E=function $d(){return Mt.lFrame.currentDirectiveIndex}();try{eo(y);for(let S=s;S<c;S++){const R=t.data[S],N=e[S];pl(S),(null!==R.hostBindings||0!==R.hostVars||null!==R.hostAttrs)&&mm(R,N)}}finally{eo(-1),pl(E)}}(t,e,n))}function Tl(t,e,n=Yi){const s=e.localNames;if(null!==s){let c=e.index+1;for(let f=0;f<s.length;f+=2){const y=s[f+1],E=-1===y?n(e,t):t[y];t[c++]=E}}}function dm(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=bc(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function bc(t,e,n,s,c,f,y,E,S,R){const N=20+s,$=N+c,oe=function z_(t,e){const n=[];for(let s=0;s<e;s++)n.push(s<t?null:$t);return n}(N,$),ae="function"==typeof R?R():R;return oe[1]={type:t,blueprint:oe,template:n,queries:null,viewQuery:E,declTNode:e,data:oe.slice().fill(null,N),bindingStartIndex:N,expandoStartIndex:$,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof f?f():f,pipeRegistry:"function"==typeof y?y():y,firstChild:null,schemas:S,consts:ae,incompleteFirstPass:!1}}function N_(t,e,n,s){const c=X_(e);null===n?c.push(s):(c.push(n),t.firstCreatePass&&Bu(t).push(s,c.length-1))}function V_(t,e,n){for(let s in t)if(t.hasOwnProperty(s)){const c=t[s];(n=null===n?{}:n).hasOwnProperty(s)?n[s].push(e,c):n[s]=[e,c]}return n}function Fi(t,e,n,s,c,f,y,E){const S=Yi(e,n);let N,R=e.inputs;!E&&null!=R&&(N=R[s])?(Uu(t,n,N,s,c),ql(e)&&function mx(t,e){const n=Hr(e,t);16&n[2]||(n[2]|=64)}(n,e.index)):3&e.type&&(s=function Ou(t){return"class"===t?"className":"for"===t?"htmlFor":"formaction"===t?"formAction":"innerHtml"===t?"innerHTML":"readonly"===t?"readOnly":"tabindex"===t?"tabIndex":t}(s),c=null!=y?y(c,e.value||"",s):c,Wn(f)?f.setProperty(S,s,c):hu(s)||(S.setProperty?S.setProperty(s,c):S[s]=c))}function Ap(t,e,n,s){let c=!1;if(nu()){const f=function H_(t,e,n){const s=t.directiveRegistry;let c=null;if(s)for(let f=0;f<s.length;f++){const y=s[f];qh(n,y.selectors,!1)&&(c||(c=[]),Z(L(n,e),t,y.type),oi(y)?(zu(t,n),c.unshift(y)):c.push(y))}return c}(t,e,n),y=null===s?null:{"":-1};if(null!==f){c=!0,Cc(n,t.data.length,f.length);for(let N=0;N<f.length;N++){const $=f[N];$.providersResolver&&$.providersResolver($)}let E=!1,S=!1,R=Fu(t,e,f.length,null);for(let N=0;N<f.length;N++){const $=f[N];n.mergedAttrs=fl(n.mergedAttrs,$.hostAttrs),Li(t,n,e,R,$),gm(R,$,y),null!==$.contentQueries&&(n.flags|=8),(null!==$.hostBindings||null!==$.hostAttrs||0!==$.hostVars)&&(n.flags|=128);const oe=$.type.prototype;!E&&(oe.ngOnChanges||oe.ngOnInit||oe.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),E=!0),!S&&(oe.ngOnChanges||oe.ngDoCheck)&&((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),S=!0),R++}!function fx(t,e){const s=e.directiveEnd,c=t.data,f=e.attrs,y=[];let E=null,S=null;for(let R=e.directiveStart;R<s;R++){const N=c[R],$=N.inputs,oe=null===f||y_(e)?null:_m($,f);y.push(oe),E=V_($,R,E),S=V_(N.outputs,R,S)}null!==E&&(E.hasOwnProperty("class")&&(e.flags|=16),E.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=y,e.inputs=E,e.outputs=S}(t,n)}y&&function Ec(t,e,n){if(e){const s=t.localNames=[];for(let c=0;c<e.length;c+=2){const f=n[e[c+1]];if(null==f)throw new K(-301,!1);s.push(e[c],f)}}}(n,s,y)}return n.mergedAttrs=fl(n.mergedAttrs,n.attrs),c}function Qh(t,e,n,s,c,f){const y=f.hostBindings;if(y){let E=t.hostBindingOpCodes;null===E&&(E=t.hostBindingOpCodes=[]);const S=~e.index;(function fm(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(E)!=S&&E.push(S),E.push(s,c,y)}}function mm(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function zu(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function gm(t,e,n){if(n){if(e.exportAs)for(let s=0;s<e.exportAs.length;s++)n[e.exportAs[s]]=t;oi(e)&&(n[""]=t)}}function Cc(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function Li(t,e,n,s,c){t.data[s]=c;const f=c.factory||(c.factory=Xi(c.type)),y=new Ns(f,oi(c),null);t.blueprint[s]=y,n[s]=y,Qh(t,e,0,s,Fu(t,n,c.hostVars,$t),c)}function ro(t,e,n){const s=Yi(e,t),c=dm(n),f=t[10],y=td(t,Ru(t,c,null,n.onPush?64:16,s,e,f,f.createRenderer(s,n),null,null));t[e.index]=y}function Ks(t,e,n,s,c,f){const y=Yi(t,e);!function Ip(t,e,n,s,c,f,y){if(null==f)Wn(t)?t.removeAttribute(e,c,n):e.removeAttribute(c);else{const E=null==y?de(f):y(f,s||"",c);Wn(t)?t.setAttribute(e,c,E,n):n?e.setAttributeNS(n,c,E):e.setAttribute(c,E)}}(e[11],y,f,t.value,n,s,c)}function yx(t,e,n,s,c,f){const y=f[e];if(null!==y){const E=s.setInput;for(let S=0;S<y.length;){const R=y[S++],N=y[S++],$=y[S++];null!==E?s.setInput(n,$,R,N):n[N]=$}}}function _m(t,e){let n=null,s=0;for(;s<e.length;){const c=e[s];if(0!==c)if(5!==c){if("number"==typeof c)break;t.hasOwnProperty(c)&&(null===n&&(n=[]),n.push(c,t[c],e[s+1])),s+=2}else s+=2;else s+=4}return n}function q_(t,e,n,s){return new Array(t,!0,!1,e,null,0,s,n,null,null)}function Ci(t,e){const n=Hr(e,t);if(hl(n)){const s=n[1];80&n[2]?xc(s,n,s.template,n[8]):n[5]>0&&Pp(n)}}function Pp(t){for(let s=pc(t);null!==s;s=gp(s))for(let c=10;c<s.length;c++){const f=s[c];if(1024&f[2]){const y=f[1];xc(y,f,y.template,f[8])}else f[5]>0&&Pp(f)}const n=t[1].components;if(null!==n)for(let s=0;s<n.length;s++){const c=Hr(n[s],t);hl(c)&&c[5]>0&&Pp(c)}}function kp(t,e){const n=Hr(e,t),s=n[1];(function ed(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])})(s,n),Lu(s,n,n[8])}function td(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function Rp(t){for(;t;){t[2]|=64;const e=Du(t);if(sl(t)&&!e)return t;t=e}return null}function W_(t){!function Fp(t){for(let e=0;e<t.components.length;e++){const n=t.components[e],s=up(n),c=s[1];Yh(c,s,c.template,n)}}(t[8])}function za(t,e,n){su(0),e(t,n)}const Dl=(()=>Promise.resolve(null))();function X_(t){return t[7]||(t[7]=[])}function Bu(t){return t.cleanup||(t.cleanup=[])}function Vu(t,e){const n=t[9],s=n?n.get(bo,null):null;s&&s.handleError(e)}function Uu(t,e,n,s,c){for(let f=0;f<n.length;){const y=n[f++],E=n[f++],S=e[y],R=t.data[y];null!==R.setInput?R.setInput(S,c,s,E):S[E]=c}}function Ho(t,e,n){const s=Kl(e,t);!function c_(t,e,n){Wn(t)?t.setValue(e,n):e.textContent=n}(t[11],s,n)}function Op(t,e,n){let s=n?t.styles:null,c=n?t.classes:null,f=0;if(null!==e)for(let y=0;y<e.length;y++){const E=e[y];"number"==typeof E?f=E:1==f?c=jr(c,E):2==f&&(s=jr(s,E+": "+e[++y]+";"))}n?t.styles=s:t.stylesWithoutHost=s,n?t.classes=c:t.classesWithoutHost=c}const bm=new qe("INJECTOR",-1);class wm{get(e,n=du){if(n===du){const s=new Error(`NullInjectorError: No provider for ${mn(e)}!`);throw s.name="NullInjectorError",s}return n}}const zp=new qe("Set Injector scope."),nd={},Y_={};let Em;function Cm(){return void 0===Em&&(Em=new wm),Em}function K_(t,e=null,n=null,s){const c=Tm(t,e,n,s);return c._resolveInjectorDefTypes(),c}function Tm(t,e=null,n=null,s){return new bx(t,n,e||Cm(),s)}class bx{constructor(e,n,s,c=null){this.parent=s,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const f=[];n&&Qt(n,E=>this.processProvider(E,e,n)),Qt([e],E=>this.processInjectorType(E,[],f)),this.records.set(bm,$u(void 0,this));const y=this.records.get(zp);this.scope=null!=y?y.value:null,this.source=c||("object"==typeof e?null:mn(e))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(e=>e.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(e,n=du,s=Tt.Default){this.assertNotDestroyed();const c=Ah(this),f=Ai(void 0);try{if(!(s&Tt.SkipSelf)){let E=this.records.get(e);if(void 0===E){const S=function wx(t){return"function"==typeof t||"object"==typeof t&&t instanceof qe}(e)&&Mi(e);E=S&&this.injectableDefInScope(S)?$u(Dm(e),nd):null,this.records.set(e,E)}if(null!=E)return this.hydrate(e,E)}return(s&Tt.Self?Cm():this.parent).get(e,n=s&Tt.Optional&&n===du?null:n)}catch(y){if("NullInjectorError"===y.name){if((y[Dh]=y[Dh]||[]).unshift(mn(e)),c)throw y;return function Sv(t,e,n,s){const c=t[Dh];throw e[Ng]&&c.unshift(e[Ng]),t.message=function Mv(t,e,n,s=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let c=mn(e);if(Array.isArray(e))c=e.map(mn).join(" -> ");else if("object"==typeof e){let f=[];for(let y in e)if(e.hasOwnProperty(y)){let E=e[y];f.push(y+":"+("string"==typeof E?JSON.stringify(E):mn(E)))}c=`{${f.join(", ")}}`}return`${n}${s?"("+s+")":""}[${c}]: ${t.replace(Dv,"\n  ")}`}("\n"+t.message,c,n,s),t.ngTokenPath=c,t[Dh]=null,t}(y,e,"R3InjectorError",this.source)}throw y}finally{Ai(f),Ah(c)}}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(e=>this.get(e))}toString(){const e=[];return this.records.forEach((s,c)=>e.push(mn(c))),`R3Injector[${e.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new K(205,!1)}processInjectorType(e,n,s){if(!(e=O(e)))return!1;let c=pa(e);const f=null==c&&e.ngModule||void 0,y=void 0===f?e:f,E=-1!==s.indexOf(y);if(void 0!==f&&(c=pa(f)),null==c)return!1;if(null!=c.imports&&!E){let N;s.push(y);try{Qt(c.imports,$=>{this.processInjectorType($,n,s)&&(void 0===N&&(N=[]),N.push($))})}finally{}if(void 0!==N)for(let $=0;$<N.length;$++){const{ngModule:oe,providers:ae}=N[$];Qt(ae,Ee=>this.processProvider(Ee,oe,ae||bn))}}this.injectorDefTypes.add(y);const S=Xi(y)||(()=>new y);this.records.set(y,$u(S,nd));const R=c.providers;if(null!=R&&!E){const N=e;Qt(R,$=>this.processProvider($,N,R))}return void 0!==f&&void 0!==e.providers}processProvider(e,n,s){let c=Gu(e=O(e))?e:O(e&&e.provide);const f=function Np(t,e,n){return Vp(t)?$u(void 0,t.useValue):$u(rd(t),nd)}(e);if(Gu(e)||!0!==e.multi)this.records.get(c);else{let y=this.records.get(c);y||(y=$u(void 0,nd,!0),y.factory=()=>pu(y.multi),this.records.set(c,y)),c=e,y.multi.push(e)}this.records.set(c,f)}hydrate(e,n){return n.value===nd&&(n.value=Y_,n.value=n.factory()),"object"==typeof n.value&&n.value&&function Up(t){return null!==t&&"object"==typeof t&&"function"==typeof t.ngOnDestroy}(n.value)&&this.onDestroy.add(n.value),n.value}injectableDefInScope(e){if(!e.providedIn)return!1;const n=O(e.providedIn);return"string"==typeof n?"any"===n||n===this.scope:this.injectorDefTypes.has(n)}}function Dm(t){const e=Mi(t),n=null!==e?e.factory:Xi(t);if(null!==n)return n;if(t instanceof qe)throw new K(204,!1);if(t instanceof Function)return function Bp(t){const e=t.length;if(e>0)throw function xi(t,e){const n=[];for(let s=0;s<t;s++)n.push(e);return n}(e,"?"),new K(204,!1);const n=function It(t){const e=t&&(t[Ps]||t[Gn]);if(e){const n=function rs(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new K(204,!1)}function rd(t,e,n){let s;if(Gu(t)){const c=O(t);return Xi(c)||Dm(c)}if(Vp(t))s=()=>O(t.useValue);else if(function Sl(t){return!(!t||!t.useFactory)}(t))s=()=>t.useFactory(...pu(t.deps||[]));else if(function Sm(t){return!(!t||!t.useExisting)}(t))s=()=>xt(O(t.useExisting));else{const c=O(t&&(t.useClass||t.provide));if(!function J_(t){return!!t.deps}(t))return Xi(c)||Dm(c);s=()=>new c(...pu(t.deps))}return s}function $u(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function Vp(t){return null!==t&&"object"==typeof t&&Sh in t}function Gu(t){return"function"==typeof t}let Oi=(()=>{class t{static create(n,s){var c;if(Array.isArray(n))return K_({name:""},s,n,"");{const f=null!==(c=n.name)&&void 0!==c?c:"";return K_({name:f},n.parent,n.providers,f)}}}return t.THROW_IF_NOT_FOUND=du,t.NULL=new wm,t.\u0275prov=ke({token:t,providedIn:"any",factory:()=>xt(bm)}),t.__NG_ELEMENT_ID__=-1,t})();function oy(t,e){Ea(up(t)[1],Cr())}function Fn(t){let e=function Na(t){return Object.getPrototypeOf(t.prototype).constructor}(t.type),n=!0;const s=[t];for(;e;){let c;if(oi(t))c=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new K(903,"");c=e.\u0275dir}if(c){if(n){s.push(c);const y=t;y.inputs=Om(t.inputs),y.declaredInputs=Om(t.declaredInputs),y.outputs=Om(t.outputs);const E=c.hostBindings;E&&Bm(t,E);const S=c.viewQuery,R=c.contentQueries;if(S&&Zu(t,S),R&&zm(t,R),As(t.inputs,c.inputs),As(t.declaredInputs,c.declaredInputs),As(t.outputs,c.outputs),oi(c)&&c.data.animation){const N=t.data;N.animation=(N.animation||[]).concat(c.data.animation)}}const f=c.features;if(f)for(let y=0;y<f.length;y++){const E=f[y];E&&E.ngInherit&&E(t),E===Fn&&(n=!1)}}e=Object.getPrototypeOf(e)}!function $p(t){let e=0,n=null;for(let s=t.length-1;s>=0;s--){const c=t[s];c.hostVars=e+=c.hostVars,c.hostAttrs=fl(c.hostAttrs,n=fl(n,c.hostAttrs))}}(s)}function Om(t){return t===is?{}:t===bn?[]:t}function Zu(t,e){const n=t.viewQuery;t.viewQuery=n?(s,c)=>{e(s,c),n(s,c)}:e}function zm(t,e){const n=t.contentQueries;t.contentQueries=n?(s,c,f)=>{e(s,c,f),n(s,c,f)}:e}function Bm(t,e){const n=t.hostBindings;t.hostBindings=n?(s,c)=>{e(s,c),n(s,c)}:e}let io=null;function qo(){if(!io){const t=Tn.Symbol;if(t&&t.iterator)io=t.iterator;else{const e=Object.getOwnPropertyNames(Map.prototype);for(let n=0;n<e.length;++n){const s=e[n];"entries"!==s&&"size"!==s&&Map.prototype[s]===Map.prototype.entries&&(io=s)}}}return io}function Wu(t){return!!function Hp(t){return null!==t&&("function"==typeof t||"object"==typeof t)}(t)&&(Array.isArray(t)||!(t instanceof Map)&&qo()in t)}function ui(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function xs(t,e,n,s){const c=$e();return ui(c,go(),e)&&(Zt(),Ks(or(),c,t,e,n,s)),xs}function r(t,e,n,s){return ui(t,go(),n)?e+de(n)+s:$t}function a(t,e,n,s,c,f){const E=function Dc(t,e,n,s){const c=ui(t,e,n);return ui(t,e+1,s)||c}(t,function Ji(){return Mt.lFrame.bindingIndex}(),n,c);return Qi(2),E?e+de(n)+s+de(c)+f:$t}function se(t,e,n,s,c,f,y,E){const S=$e(),R=Zt(),N=t+20,$=R.firstCreatePass?function ce(t,e,n,s,c,f,y,E,S){const R=e.consts,N=vc(e,t,4,y||null,ki(R,E));Ap(e,n,N,ki(R,S)),Ea(e,N);const $=N.tViews=bc(2,N,s,c,f,e.directiveRegistry,e.pipeRegistry,null,e.schemas,R);return null!==e.queries&&(e.queries.template(e,N),$.queries=e.queries.embeddedTView(N)),N}(N,R,S,e,n,s,c,f,y):R.data[N];tr($,!1);const oe=S[11].createComment("");El(R,S,oe,$),xr(oe,S),td(S,S[N]=q_(oe,S,oe,$)),Zl($)&&Kh(R,S,$),null!=y&&Tl(S,$,E)}function he(t){return function Ki(t,e){return t[e]}(function vh(){return Mt.lFrame.contextLView}(),20+t)}function ze(t,e=Tt.Default){const n=$e();return null===n?xt(t,e):Q(Cr(),n,O(t),e)}function Mr(){throw new Error("invalid")}function vn(t,e,n){const s=$e();return ui(s,go(),e)&&Fi(Zt(),or(),s,t,e,s[11],n,!1),vn}function Al(t,e,n,s,c){const y=c?"class":"style";Uu(t,n,e.inputs[y],y,s)}function mt(t,e,n,s){const c=$e(),f=Zt(),y=20+t,E=c[11],S=c[y]=fc(E,e,function Kd(){return Mt.lFrame.currentNamespace}()),R=f.firstCreatePass?function sd(t,e,n,s,c,f,y){const E=e.consts,R=vc(e,t,2,c,ki(E,f));return Ap(e,n,R,ki(E,y)),null!==R.attrs&&Op(R,R.attrs,!1),null!==R.mergedAttrs&&Op(R,R.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,R),R}(y,f,c,0,e,n,s):f.data[y];tr(R,!0);const N=R.mergedAttrs;null!==N&&ic(E,S,N);const $=R.classes;null!==$&&_c(E,S,$);const oe=R.styles;return null!==oe&&Au(E,S,oe),64!=(64&R.flags)&&El(f,c,S,R),0===function ya(){return Mt.lFrame.elementDepthCount}()&&xr(S,c),function tu(){Mt.lFrame.elementDepthCount++}(),Zl(R)&&(Kh(f,c,R),hm(f,R,c)),null!==s&&Tl(c,R),mt}function pt(){let t=Cr();xa()?iu():(t=t.parent,tr(t,!1));const e=t;!function Ql(){Mt.lFrame.elementDepthCount--}();const n=Zt();return n.firstCreatePass&&(Ea(n,t),Hl(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function uu(t){return 0!=(16&t.flags)}(e)&&Al(n,e,$e(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function Qd(t){return 0!=(32&t.flags)}(e)&&Al(n,e,$e(),e.stylesWithoutHost,!1),pt}function kr(t,e,n,s){return mt(t,e,n,s),pt(),kr}function Yu(t,e,n){const s=$e(),c=Zt(),f=t+20,y=c.firstCreatePass?function Um(t,e,n,s,c){const f=e.consts,y=ki(f,s),E=vc(e,t,8,"ng-container",y);return null!==y&&Op(E,y,!0),Ap(e,n,E,ki(f,c)),null!==e.queries&&e.queries.elementStart(e,E),E}(f,c,s,e,n):c.data[f];tr(y,!0);const E=s[f]=s[11].createComment("");return El(c,s,E,y),xr(E,s),Zl(y)&&(Kh(c,s,y),hm(c,y,s)),null!=n&&Tl(s,y),Yu}function So(){let t=Cr();const e=Zt();return xa()?iu():(t=t.parent,tr(t,!1)),e.firstCreatePass&&(Ea(e,t),Hl(t)&&e.queries.elementEnd(t)),So}function ea(){return $e()}function Sc(t){return!!t&&"function"==typeof t.then}const ta=function qp(t){return!!t&&"function"==typeof t.subscribe};function Rr(t,e,n,s){const c=$e(),f=Zt(),y=Cr();return function Bi(t,e,n,s,c,f,y,E){const S=Zl(s),N=t.firstCreatePass&&Bu(t),$=e[8],oe=X_(e);let ae=!0;if(3&s.type||E){const Qe=Yi(s,e),ot=E?E(Qe):Qe,Fe=oe.length,bt=E?Kt=>E(wn(Kt[s.index])):s.index;if(Wn(n)){let Kt=null;if(!E&&S&&(Kt=function oo(t,e,n,s){const c=t.cleanup;if(null!=c)for(let f=0;f<c.length-1;f+=2){const y=c[f];if(y===n&&c[f+1]===s){const E=e[7],S=c[f+2];return E.length>S?E[S]:null}"string"==typeof y&&(f+=2)}return null}(t,e,c,s.index)),null!==Kt)(Kt.__ngLastListenerFn__||Kt).__ngNextListenerFn__=f,Kt.__ngLastListenerFn__=f,ae=!1;else{f=ad(s,e,$,f,!1);const Pn=n.listen(ot,c,f);oe.push(f,Pn),N&&N.push(c,bt,Fe,Fe+1)}}else f=ad(s,e,$,f,!0),ot.addEventListener(c,f,y),oe.push(f),N&&N.push(c,bt,Fe,y)}else f=ad(s,e,$,f,!1);const Ee=s.outputs;let je;if(ae&&null!==Ee&&(je=Ee[c])){const Qe=je.length;if(Qe)for(let ot=0;ot<Qe;ot+=2){const Ts=e[je[ot]][je[ot+1]].subscribe(f),bd=oe.length;oe.push(f,Ts),N&&N.push(c,s.index,bd,-(bd+1))}}}(f,c,c[11],y,t,e,!!n,s),Rr}function Ku(t,e,n,s){try{return!1!==n(s)}catch(c){return Vu(t,c),!1}}function ad(t,e,n,s,c){return function f(y){if(y===Function)return s;const E=2&t.flags?Hr(t.index,e):e;0==(32&e[2])&&Rp(E);let S=Ku(e,0,s,y),R=f.__ngNextListenerFn__;for(;R;)S=Ku(e,0,R,y)&&S,R=R.__ngNextListenerFn__;return c&&!1===S&&(y.preventDefault(),y.returnValue=!1),S}}function na(t=1){return function qd(t){return(Mt.lFrame.contextLView=function Zd(t,e){for(;t>0;)e=e[15],t--;return e}(t,Mt.lFrame.contextLView))[8]}(t)}function ly(t,e,n){return Ix(t,"",e,"",n),ly}function Ix(t,e,n,s,c){const f=$e(),y=r(f,e,n,s);return y!==$t&&Fi(Zt(),or(),f,t,y,f[11],c,!1),Ix}function _1(t,e,n,s,c){const f=t[n+1],y=null===e;let E=s?Co(f):La(f),S=!1;for(;0!==E&&(!1===S||y);){const N=t[E+1];zD(t[E],e)&&(S=!0,t[E+1]=s?om(N):im(N)),E=s?Co(N):La(N)}S&&(t[n+1]=s?im(f):om(f))}function zD(t,e){return null===t||null==e||(Array.isArray(t)?t[1]:t)===e||!(!Array.isArray(t)||"string"!=typeof e)&&sc(t,e)>=0}function cy(t,e){return function Va(t,e,n,s){const c=$e(),f=Zt(),y=Qi(2);f.firstUpdatePass&&function D1(t,e,n,s){const c=t.data;if(null===c[n+1]){const f=c[Tr()],y=function T1(t,e){return e>=t.expandoStartIndex}(t,n);(function I1(t,e){return 0!=(t.flags&(e?16:32))})(f,s)&&null===e&&!y&&(e=!1),e=function qD(t,e,n,s){const c=function dr(t){const e=Mt.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}(t);let f=s?e.residualClasses:e.residualStyles;if(null===c)0===(s?e.classBindings:e.styleBindings)&&(n=$m(n=Px(null,t,e,n,s),e.attrs,s),f=null);else{const y=e.directiveStylingLast;if(-1===y||t[y]!==c)if(n=Px(c,t,e,n,s),null===f){let S=function ZD(t,e,n){const s=n?e.classBindings:e.styleBindings;if(0!==La(s))return t[Co(s)]}(t,e,s);void 0!==S&&Array.isArray(S)&&(S=Px(null,t,e,S[1],s),S=$m(S,e.attrs,s),function WD(t,e,n,s){t[Co(n?e.classBindings:e.styleBindings)]=s}(t,e,s,S))}else f=function XD(t,e,n){let s;const c=e.directiveEnd;for(let f=1+e.directiveStylingLast;f<c;f++)s=$m(s,t[f].hostAttrs,n);return $m(s,e.attrs,n)}(t,e,s)}return void 0!==f&&(s?e.residualClasses=f:e.residualStyles=f),n}(c,f,e,s),function LD(t,e,n,s,c,f){let y=f?e.classBindings:e.styleBindings,E=Co(y),S=La(y);t[s]=n;let N,R=!1;if(Array.isArray(n)){const $=n;N=$[1],(null===N||sc($,N)>0)&&(R=!0)}else N=n;if(c)if(0!==S){const oe=Co(t[E+1]);t[s+1]=Eo(oe,E),0!==oe&&(t[oe+1]=yc(t[oe+1],s)),t[E+1]=function Iu(t,e){return 131071&t|e<<17}(t[E+1],s)}else t[s+1]=Eo(E,0),0!==E&&(t[E+1]=yc(t[E+1],s)),E=s;else t[s+1]=Eo(S,0),0===E?E=s:t[S+1]=yc(t[S+1],s),S=s;R&&(t[s+1]=im(t[s+1])),_1(t,N,s,!0),_1(t,N,s,!1),function OD(t,e,n,s,c){const f=c?t.residualClasses:t.residualStyles;null!=f&&"string"==typeof e&&sc(f,e)>=0&&(n[s+1]=om(n[s+1]))}(e,N,t,s,f),y=Eo(E,S),f?e.classBindings=y:e.styleBindings=y}(c,f,e,n,y,s)}}(f,t,y,s),e!==$t&&ui(c,y,e)&&function M1(t,e,n,s,c,f,y,E){if(!(3&e.type))return;const S=t.data,R=S[E+1];uy(function C_(t){return 1==(1&t)}(R)?A1(S,e,n,c,La(R),y):void 0)||(uy(f)||function Zh(t){return 2==(2&t)}(R)&&(f=A1(S,null,n,c,E,y)),function Ei(t,e,n,s,c){const f=Wn(t);if(e)c?f?t.addClass(n,s):n.classList.add(s):f?t.removeClass(n,s):n.classList.remove(s);else{let y=-1===s.indexOf("-")?void 0:wo.DashCase;if(null==c)f?t.removeStyle(n,s,y):n.style.removeProperty(s);else{const E="string"==typeof c&&c.endsWith("!important");E&&(c=c.slice(0,-10),y|=wo.Important),f?t.setStyle(n,s,c,y):n.style.setProperty(s,c,E?"important":"")}}}(s,y,Kl(Tr(),n),c,f))}(f,f.data[Tr()],c,c[11],t,c[y+1]=function JD(t,e){return null==t||("string"==typeof e?t+=e:"object"==typeof t&&(t=mn(ka(t)))),t}(e,n),s,y)}(t,e,null,!0),cy}function Px(t,e,n,s,c){let f=null;const y=n.directiveEnd;let E=n.directiveStylingLast;for(-1===E?E=n.directiveStart:E++;E<y&&(f=e[E],s=$m(s,f.hostAttrs,c),f!==t);)E++;return null!==t&&(n.directiveStylingLast=E),s}function $m(t,e,n){const s=n?1:2;let c=-1;if(null!==e)for(let f=0;f<e.length;f++){const y=e[f];"number"==typeof y?c=y:c===s&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),Dr(t,y,!!n||e[++f]))}return void 0===t?null:t}function A1(t,e,n,s,c,f){const y=null===e;let E;for(;c>0;){const S=t[c],R=Array.isArray(S),N=R?S[1]:S,$=null===N;let oe=n[c+1];oe===$t&&(oe=$?bn:void 0);let ae=$?tp(oe,s):N===s?oe:void 0;if(R&&!uy(ae)&&(ae=tp(S,s)),uy(ae)&&(E=ae,y))return E;const Ee=t[c+1];c=y?Co(Ee):La(Ee)}if(null!==e){let S=f?e.residualClasses:e.residualStyles;null!=S&&(E=tp(S,s))}return E}function uy(t){return void 0!==t}function Xt(t,e=""){const n=$e(),s=Zt(),c=t+20,f=s.firstCreatePass?vc(s,c,1,e,null):s.data[c],y=n[c]=function Uh(t,e){return Wn(t)?t.createText(e):t.createTextNode(e)}(n[11],e);El(s,n,y,f),tr(f,!1)}function Wp(t){return Gm("",t,""),Wp}function Gm(t,e,n){const s=$e(),c=r(s,t,e,n);return c!==$t&&Ho(s,Tr(),c),Gm}function kx(t,e,n,s,c){const f=$e(),y=a(f,t,e,n,s,c);return y!==$t&&Ho(f,Tr(),y),kx}const hy="en-US";let K1=hy;function Lx(t,e,n,s,c){if(t=O(t),Array.isArray(t))for(let f=0;f<t.length;f++)Lx(t[f],e,n,s,c);else{const f=Zt(),y=$e();let E=Gu(t)?t:O(t.provide),S=rd(t);const R=Cr(),N=1048575&R.providerIndexes,$=R.directiveStart,oe=R.providerIndexes>>20;if(Gu(t)||!t.multi){const ae=new Ns(S,c,ze),Ee=zx(E,e,c?N:N+oe,$);-1===Ee?(Z(L(R,y),f,E),Ox(f,t,e.length),e.push(E),R.directiveStart++,R.directiveEnd++,c&&(R.providerIndexes+=1048576),n.push(ae),y.push(ae)):(n[Ee]=ae,y[Ee]=ae)}else{const ae=zx(E,e,N+oe,$),Ee=zx(E,e,N,N+oe),je=ae>=0&&n[ae],Qe=Ee>=0&&n[Ee];if(c&&!Qe||!c&&!je){Z(L(R,y),f,E);const ot=function _M(t,e,n,s,c){const f=new Ns(t,n,ze);return f.multi=[],f.index=e,f.componentProviders=0,bw(f,c,s&&!n),f}(c?gM:mM,n.length,c,s,S);!c&&Qe&&(n[Ee].providerFactory=ot),Ox(f,t,e.length,0),e.push(E),R.directiveStart++,R.directiveEnd++,c&&(R.providerIndexes+=1048576),n.push(ot),y.push(ot)}else Ox(f,t,ae>-1?ae:Ee,bw(n[c?Ee:ae],S,!c&&s));!c&&s&&Qe&&n[Ee].componentProviders++}}}function Ox(t,e,n,s){const c=Gu(e),f=function Mm(t){return!!t.useClass}(e);if(c||f){const S=(f?O(e.useClass):e).prototype.ngOnDestroy;if(S){const R=t.destroyHooks||(t.destroyHooks=[]);if(!c&&e.multi){const N=R.indexOf(n);-1===N?R.push(n,[s,S]):R[N+1].push(s,S)}else R.push(n,S)}}}function bw(t,e,n){return n&&t.componentProviders++,t.multi.push(e)-1}function zx(t,e,n,s){for(let c=n;c<s;c++)if(e[c]===t)return c;return-1}function mM(t,e,n,s){return Bx(this.multi,[])}function gM(t,e,n,s){const c=this.multi;let f;if(this.providerFactory){const y=this.providerFactory.componentProviders,E=ue(n,n[1],this.providerFactory.index,s);f=E.slice(0,y),Bx(c,f);for(let S=y;S<E.length;S++)f.push(E[S])}else f=[],Bx(c,f);return f}function Bx(t,e){for(let n=0;n<t.length;n++)e.push((0,t[n])());return e}function wr(t,e=[]){return n=>{n.providersResolver=(s,c)=>function fM(t,e,n){const s=Zt();if(s.firstCreatePass){const c=oi(t);Lx(n,s.data,s.blueprint,c,!0),Lx(e,s.data,s.blueprint,c,!1)}}(s,c?c(t):t,e)}}class ww{}class xM{resolveComponentFactory(e){throw function vM(t){const e=Error(`No component factory found for ${mn(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(e)}}let Xm=(()=>{class t{}return t.NULL=new xM,t})();function bM(){return Kp(Cr(),$e())}function Kp(t,e){return new bs(Yi(t,e))}let bs=(()=>{class t{constructor(n){this.nativeElement=n}}return t.__NG_ELEMENT_ID__=bM,t})();function wM(t){return t instanceof bs?t.nativeElement:t}class Cw{}let Ac=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>function CM(){const t=$e(),n=Hr(Cr().index,t);return function EM(t){return t[11]}(Pi(n)?n:t)}(),t})(),TM=(()=>{class t{}return t.\u0275prov=ke({token:t,providedIn:"root",factory:()=>null}),t})();class Ym{constructor(e){this.full=e,this.major=e.split(".")[0],this.minor=e.split(".")[1],this.patch=e.split(".").slice(2).join(".")}}const DM=new Ym("13.3.11"),Nx={};function gy(t,e,n,s,c=!1){for(;null!==n;){const f=e[n.index];if(null!==f&&s.push(wn(f)),_i(f))for(let E=10;E<f.length;E++){const S=f[E],R=S[1].firstChild;null!==R&&gy(S[1],S,R,s)}const y=n.type;if(8&y)gy(t,e,n.child,s);else if(32&y){const E=$f(n,e);let S;for(;S=E();)s.push(S)}else if(16&y){const E=Mu(e,n);if(Array.isArray(E))s.push(...E);else{const S=Du(e[16]);gy(S[1],S,E,s,!0)}}n=c?n.projectionNext:n.next}return s}class Km{constructor(e,n){this._lView=e,this._cdRefInjectingView=n,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const e=this._lView,n=e[1];return gy(n,e,n.firstChild,[])}get context(){return this._lView[8]}set context(e){this._lView[8]=e}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const e=this._lView[3];if(_i(e)){const n=e[8],s=n?n.indexOf(this):-1;s>-1&&(Wf(e,s),Vo(n,s))}this._attachedToViewContainer=!1}d_(this._lView[1],this._lView)}onDestroy(e){N_(this._lView[1],this._lView,null,e)}markForCheck(){Rp(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){!function Lp(t,e,n){const s=e[10];s.begin&&s.begin();try{xc(t,e,t.template,n)}catch(c){throw Vu(e,c),c}finally{s.end&&s.end()}}(this._lView[1],this._lView,this.context)}checkNoChanges(){}attachToViewContainerRef(){if(this._appRef)throw new K(902,"");this._attachedToViewContainer=!0}detachFromAppRef(){this._appRef=null,function Zv(t,e){Gh(t,e,e[11],2,null,null)}(this._lView[1],this._lView)}attachToAppRef(e){if(this._attachedToViewContainer)throw new K(902,"");this._appRef=e}}class SM extends Km{constructor(e){super(e),this._view=e}detectChanges(){W_(this._view)}checkNoChanges(){}get context(){return null}}class Tw extends Xm{constructor(e){super(),this.ngModule=e}resolveComponentFactory(e){const n=zr(e);return new Vx(n,this.ngModule)}}function Dw(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}class Vx extends ww{constructor(e,n){super(),this.componentDef=e,this.ngModule=n,this.componentType=e.type,this.selector=function rx(t){return t.map(nx).join(",")}(e.selectors),this.ngContentSelectors=e.ngContentSelectors?e.ngContentSelectors:[],this.isBoundToModule=!!n}get inputs(){return Dw(this.componentDef.inputs)}get outputs(){return Dw(this.componentDef.outputs)}create(e,n,s,c){const f=(c=c||this.ngModule)?function AM(t,e){return{get:(n,s,c)=>{const f=t.get(n,Nx,c);return f!==Nx||s===Nx?f:e.get(n,s,c)}}}(e,c.injector):e,y=f.get(Cw,zd),E=f.get(TM,null),S=y.createRenderer(null,this.componentDef),R=this.componentDef.selectors[0][0]||"div",N=s?function B_(t,e,n){if(Wn(t))return t.selectRootElement(e,n===hr.ShadowDom);let s="string"==typeof e?t.querySelector(e):e;return s.textContent="",s}(S,s,this.componentDef.encapsulation):fc(y.createRenderer(null,this.componentDef),R,function MM(t){const e=t.toLowerCase();return"svg"===e?"svg":"math"===e?"math":null}(R)),$=this.componentDef.onPush?576:528,oe=function Lm(t,e){return{components:[],scheduler:t||vl,clean:Dl,playerHandler:e||null,flags:0}}(),ae=bc(0,null,null,1,0,null,null,null,null,null),Ee=Ru(null,ae,oe,$,null,null,y,S,E,f);let je,Qe;vi(Ee);try{const ot=function Rm(t,e,n,s,c,f){const y=n[1];n[20]=t;const S=vc(y,20,2,"#host",null),R=S.mergedAttrs=e.hostAttrs;null!==R&&(Op(S,R,!0),null!==t&&(ic(c,t,R),null!==S.classes&&_c(c,t,S.classes),null!==S.styles&&Au(c,t,S.styles)));const N=s.createRenderer(t,e),$=Ru(n,dm(e),null,e.onPush?64:16,n[20],S,s,N,f||null,null);return y.firstCreatePass&&(Z(L(S,n),y,e.type),zu(y,S),Cc(S,n.length,1)),td(n,$),n[20]=$}(N,this.componentDef,Ee,y,S);if(N)if(s)ic(S,N,["ng-version",DM.full]);else{const{attrs:Fe,classes:bt}=function ix(t){const e=[],n=[];let s=1,c=2;for(;s<t.length;){let f=t[s];if("string"==typeof f)2===c?""!==f&&e.push(f,t[++s]):8===c&&n.push(f);else{if(!gs(c))break;c=f}s++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);Fe&&ic(S,N,Fe),bt&&bt.length>0&&_c(S,N,bt.join(" "))}if(Qe=cl(ae,20),void 0!==n){const Fe=Qe.projection=[];for(let bt=0;bt<this.ngContentSelectors.length;bt++){const Kt=n[bt];Fe.push(null!=Kt?Array.from(Kt):null)}}je=function Fm(t,e,n,s,c){const f=n[1],y=function G_(t,e,n){const s=Cr();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),Li(t,s,e,Fu(t,e,1,null),n));const c=ue(e,t,s.directiveStart,s);xr(c,e);const f=Yi(s,e);return f&&xr(f,e),c}(f,n,e);if(s.components.push(y),t[8]=y,c&&c.forEach(S=>S(y,e)),e.contentQueries){const S=Cr();e.contentQueries(1,y,S.directiveStart)}const E=Cr();return!f.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(eo(E.index),Qh(n[1],E,0,E.directiveStart,E.directiveEnd,e),mm(e,y)),y}(ot,this.componentDef,Ee,oe,[oy]),Lu(ae,Ee,null)}finally{tt()}return new PM(this.componentType,je,Kp(Qe,Ee),Ee,Qe)}}class PM extends class yM{}{constructor(e,n,s,c,f){super(),this.location=s,this._rootLView=c,this._tNode=f,this.instance=n,this.hostView=this.changeDetectorRef=new SM(c),this.componentType=e}get injector(){return new Ve(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(e){this.hostView.onDestroy(e)}}class Ic{}class Sw{}const Jp=new Map;class Iw extends Ic{constructor(e,n){super(),this._parent=n,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Tw(this);const s=Ii(e);this._bootstrapComponents=Zs(s.bootstrap),this._r3Injector=Tm(e,n,[{provide:Ic,useValue:this},{provide:Xm,useValue:this.componentFactoryResolver}],mn(e)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(e)}get(e,n=Oi.THROW_IF_NOT_FOUND,s=Tt.Default){return e===Oi||e===Ic||e===bm?this:this._r3Injector.get(e,n,s)}destroy(){const e=this._r3Injector;!e.destroyed&&e.destroy(),this.destroyCbs.forEach(n=>n()),this.destroyCbs=null}onDestroy(e){this.destroyCbs.push(e)}}class Ux extends Sw{constructor(e){super(),this.moduleType=e,null!==Ii(e)&&function RM(t){const e=new Set;!function n(s){const c=Ii(s,!0),f=c.id;null!==f&&(function Mw(t,e,n){if(e&&e!==n)throw new Error(`Duplicate module registered for ${t} - ${mn(e)} vs ${mn(e.name)}`)}(f,Jp.get(f),s),Jp.set(f,s));const y=Zs(c.imports);for(const E of y)e.has(E)||(e.add(E),n(E))}(t)}(e)}create(e){return new Iw(this.moduleType,e)}}function Pw(t,e,n){const s=function qr(){const t=Mt.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}()+t,c=$e();return c[s]===$t?function vs(t,e,n){return t[e]=n}(c,s,n?e.call(n):e()):function od(t,e){return t[e]}(c,s)}function jx(t){return e=>{setTimeout(t,void 0,e)}}const Lr=class YM extends Ui{constructor(e=!1){super(),this.__isAsync=e}emit(e){super.next(e)}subscribe(e,n,s){var c,f,y;let E=e,S=n||(()=>null),R=s;if(e&&"object"==typeof e){const $=e;E=null===(c=$.next)||void 0===c?void 0:c.bind($),S=null===(f=$.error)||void 0===f?void 0:f.bind($),R=null===(y=$.complete)||void 0===y?void 0:y.bind($)}this.__isAsync&&(S=jx(S),E&&(E=jx(E)),R&&(R=jx(R)));const N=super.subscribe({next:E,error:S,complete:R});return e instanceof hn&&e.add(N),N}};function KM(){return this._results[qo()]()}class $x{constructor(e=!1){this._emitDistinctChangesOnly=e,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const n=qo(),s=$x.prototype;s[n]||(s[n]=KM)}get changes(){return this._changes||(this._changes=new Lr)}get(e){return this._results[e]}map(e){return this._results.map(e)}filter(e){return this._results.filter(e)}find(e){return this._results.find(e)}reduce(e,n){return this._results.reduce(e,n)}forEach(e){this._results.forEach(e)}some(e){return this._results.some(e)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(e,n){const s=this;s.dirty=!1;const c=Un(e);(this._changesDetected=!function pr(t,e,n){if(t.length!==e.length)return!1;for(let s=0;s<t.length;s++){let c=t[s],f=e[s];if(n&&(c=n(c),f=n(f)),f!==c)return!1}return!0}(s._results,c,n))&&(s._results=c,s.length=c.length,s.last=c[this.length-1],s.first=c[0])}notifyOnChanges(){this._changes&&(this._changesDetected||!this._emitDistinctChangesOnly)&&this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}Symbol;let Pc=(()=>{class t{}return t.__NG_ELEMENT_ID__=eA,t})();const JM=Pc,QM=class extends JM{constructor(e,n,s){super(),this._declarationLView=e,this._declarationTContainer=n,this.elementRef=s}createEmbeddedView(e){const n=this._declarationTContainer.tViews,s=Ru(this._declarationLView,n,e,16,null,n.declTNode,null,null,null,null);s[17]=this._declarationLView[this._declarationTContainer.index];const f=this._declarationLView[19];return null!==f&&(s[19]=f.createEmbeddedView(n)),Lu(n,s,e),new Km(s)}};function eA(){return _y(Cr(),$e())}function _y(t,e){return 4&t.type?new QM(e,t,Kp(t,e)):null}let ja=(()=>{class t{}return t.__NG_ELEMENT_ID__=tA,t})();function tA(){return Nw(Cr(),$e())}const nA=ja,zw=class extends nA{constructor(e,n,s){super(),this._lContainer=e,this._hostTNode=n,this._hostLView=s}get element(){return Kp(this._hostTNode,this._hostLView)}get injector(){return new Ve(this._hostTNode,this._hostLView)}get parentInjector(){const e=H(this._hostTNode,this._hostLView);if(Sa(e)){const n=u(e,this._hostLView),s=p(e);return new Ve(n[1].data[s+8],n)}return new Ve(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(e){const n=Bw(this._lContainer);return null!==n&&n[e]||null}get length(){return this._lContainer.length-10}createEmbeddedView(e,n,s){const c=e.createEmbeddedView(n||{});return this.insert(c,s),c}createComponent(e,n,s,c,f){const y=e&&!function An(t){return"function"==typeof t}(e);let E;if(y)E=n;else{const $=n||{};E=$.index,s=$.injector,c=$.projectableNodes,f=$.ngModuleRef}const S=y?e:new Vx(zr(e)),R=s||this.parentInjector;if(!f&&null==S.ngModule){const oe=(y?R:this.parentInjector).get(Ic,null);oe&&(f=oe)}const N=S.create(R,c,void 0,f);return this.insert(N.hostView,E),N}insert(e,n){const s=e._lView,c=s[1];if(function Jl(t){return _i(t[3])}(s)){const N=this.indexOf(e);if(-1!==N)this.detach(N);else{const $=s[3],oe=new zw($,$[6],$[3]);oe.detach(oe.indexOf(e))}}const f=this._adjustIndex(n),y=this._lContainer;!function Zf(t,e,n,s){const c=10+s,f=n.length;s>0&&(n[c-1][4]=e),s<f-10?(e[4]=n[c],Yn(n,10+s,e)):(n.push(e),e[4]=null),e[3]=n;const y=e[17];null!==y&&n!==y&&function yp(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(y,e);const E=e[19];null!==E&&E.insertView(t),e[2]|=128}(c,s,y,f);const E=Qf(f,y),S=s[11],R=vp(S,y[7]);return null!==R&&function Hf(t,e,n,s,c,f){s[0]=c,s[6]=e,Gh(t,s,n,1,c,f)}(c,y[6],S,s,R,E),e.attachToViewContainerRef(),Yn(Gx(y),f,e),e}move(e,n){return this.insert(e,n)}indexOf(e){const n=Bw(this._lContainer);return null!==n?n.indexOf(e):-1}remove(e){const n=this._adjustIndex(e,-1),s=Wf(this._lContainer,n);s&&(Vo(Gx(this._lContainer),n),d_(s[1],s))}detach(e){const n=this._adjustIndex(e,-1),s=Wf(this._lContainer,n);return s&&null!=Vo(Gx(this._lContainer),n)?new Km(s):null}_adjustIndex(e,n=0){return null==e?this.length+n:e}};function Bw(t){return t[8]}function Gx(t){return t[8]||(t[8]=[])}function Nw(t,e){let n;const s=e[t.index];if(_i(s))n=s;else{let c;if(8&t.type)c=wn(s);else{const f=e[11];c=f.createComment("");const y=Yi(t,e);gc(f,vp(f,y),c,function Yv(t,e){return Wn(t)?t.nextSibling(e):e.nextSibling}(f,y),!1)}e[t.index]=n=q_(s,e,c,t),td(e,n)}return new zw(n,t,e)}class Hx{constructor(e){this.queryList=e,this.matches=null}clone(){return new Hx(this.queryList)}setDirty(){this.queryList.setDirty()}}class qx{constructor(e=[]){this.queries=e}createEmbeddedView(e){const n=e.queries;if(null!==n){const s=null!==e.contentQueries?e.contentQueries[0]:n.length,c=[];for(let f=0;f<s;f++){const y=n.getByIndex(f);c.push(this.queries[y.indexInDeclarationView].clone())}return new qx(c)}return null}insertView(e){this.dirtyQueriesWithMatches(e)}detachView(e){this.dirtyQueriesWithMatches(e)}dirtyQueriesWithMatches(e){for(let n=0;n<this.queries.length;n++)null!==Gw(e,n).matches&&this.queries[n].setDirty()}}class Vw{constructor(e,n,s=null){this.predicate=e,this.flags=n,this.read=s}}class Zx{constructor(e=[]){this.queries=e}elementStart(e,n){for(let s=0;s<this.queries.length;s++)this.queries[s].elementStart(e,n)}elementEnd(e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementEnd(e)}embeddedTView(e){let n=null;for(let s=0;s<this.length;s++){const c=null!==n?n.length:0,f=this.getByIndex(s).embeddedTView(e,c);f&&(f.indexInDeclarationView=s,null!==n?n.push(f):n=[f])}return null!==n?new Zx(n):null}template(e,n){for(let s=0;s<this.queries.length;s++)this.queries[s].template(e,n)}getByIndex(e){return this.queries[e]}get length(){return this.queries.length}track(e){this.queries.push(e)}}class Wx{constructor(e,n=-1){this.metadata=e,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=n}elementStart(e,n){this.isApplyingToNode(n)&&this.matchTNode(e,n)}elementEnd(e){this._declarationNodeIndex===e.index&&(this._appliesToNextNode=!1)}template(e,n){this.elementStart(e,n)}embeddedTView(e,n){return this.isApplyingToNode(e)?(this.crossesNgTemplate=!0,this.addMatch(-e.index,n),new Wx(this.metadata)):null}isApplyingToNode(e){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const n=this._declarationNodeIndex;let s=e.parent;for(;null!==s&&8&s.type&&s.index!==n;)s=s.parent;return n===(null!==s?s.index:-1)}return this._appliesToNextNode}matchTNode(e,n){const s=this.metadata.predicate;if(Array.isArray(s))for(let c=0;c<s.length;c++){const f=s[c];this.matchTNodeWithReadOption(e,n,oA(n,f)),this.matchTNodeWithReadOption(e,n,re(n,e,f,!1,!1))}else s===Pc?4&n.type&&this.matchTNodeWithReadOption(e,n,-1):this.matchTNodeWithReadOption(e,n,re(n,e,s,!1,!1))}matchTNodeWithReadOption(e,n,s){if(null!==s){const c=this.metadata.read;if(null!==c)if(c===bs||c===ja||c===Pc&&4&n.type)this.addMatch(n.index,-2);else{const f=re(n,e,c,!1,!1);null!==f&&this.addMatch(n.index,f)}else this.addMatch(n.index,s)}}addMatch(e,n){null===this.matches?this.matches=[e,n]:this.matches.push(e,n)}}function oA(t,e){const n=t.localNames;if(null!==n)for(let s=0;s<n.length;s+=2)if(n[s]===e)return n[s+1];return null}function aA(t,e,n,s){return-1===n?function sA(t,e){return 11&t.type?Kp(t,e):4&t.type?_y(t,e):null}(e,t):-2===n?function lA(t,e,n){return n===bs?Kp(e,t):n===Pc?_y(e,t):n===ja?Nw(e,t):void 0}(t,e,s):ue(t,t[1],n,e)}function Uw(t,e,n,s){const c=e[19].queries[s];if(null===c.matches){const f=t.data,y=n.matches,E=[];for(let S=0;S<y.length;S+=2){const R=y[S];E.push(R<0?null:aA(e,f[R],y[S+1],n.metadata.read))}c.matches=E}return c.matches}function Xx(t,e,n,s){const c=t.queries.getByIndex(n),f=c.matches;if(null!==f){const y=Uw(t,e,c,n);for(let E=0;E<f.length;E+=2){const S=f[E];if(S>0)s.push(y[E/2]);else{const R=f[E+1],N=e[-S];for(let $=10;$<N.length;$++){const oe=N[$];oe[17]===oe[3]&&Xx(oe[1],oe,R,s)}if(null!==N[9]){const $=N[9];for(let oe=0;oe<$.length;oe++){const ae=$[oe];Xx(ae[1],ae,R,s)}}}}}return s}function Yx(t){const e=$e(),n=Zt(),s=wh();su(s+1);const c=Gw(n,s);if(t.dirty&&ul(e)===(2==(2&c.metadata.flags))){if(null===c.matches)t.reset([]);else{const f=c.crossesNgTemplate?Xx(n,e,s,[]):Uw(n,e,c,s);t.reset(f,wM),t.notifyOnChanges()}return!0}return!1}function Kx(t,e,n,s){const c=Zt();if(c.firstCreatePass){const f=Cr();(function $w(t,e,n){null===t.queries&&(t.queries=new Zx),t.queries.track(new Wx(e,n))})(c,new Vw(e,n,s),f.index),function hA(t,e){const n=t.contentQueries||(t.contentQueries=[]);e!==(n.length?n[n.length-1]:-1)&&n.push(t.queries.length-1,e)}(c,t),2==(2&n)&&(c.staticContentQueries=!0)}!function jw(t,e,n){const s=new $x(4==(4&n));N_(t,e,s,s.destroy),null===e[19]&&(e[19]=new qx),e[19].queries.push(new Hx(s))}(c,$e(),n)}function Jx(){return function uA(t,e){return t[19].queries[e].queryList}($e(),wh())}function Gw(t,e){return t.queries.getByIndex(e)}function Qx(t,e){return _y(t,e)}function xy(...t){}const s0=new qe("Application Initializer");let a0=(()=>{class t{constructor(n){this.appInits=n,this.resolve=xy,this.reject=xy,this.initialized=!1,this.done=!1,this.donePromise=new Promise((s,c)=>{this.resolve=s,this.reject=c})}runInitializers(){if(this.initialized)return;const n=[],s=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let c=0;c<this.appInits.length;c++){const f=this.appInits[c]();if(Sc(f))n.push(f);else if(ta(f)){const y=new Promise((E,S)=>{f.subscribe({complete:E,error:S})});n.push(y)}}Promise.all(n).then(()=>{s()}).catch(c=>{this.reject(c)}),0===n.length&&s(),this.initialized=!0}}return t.\u0275fac=function(n){return new(n||t)(xt(s0,8))},t.\u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const tg=new qe("AppId",{providedIn:"root",factory:function aE(){return`${l0()}${l0()}${l0()}`}});function l0(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const lE=new qe("Platform Initializer"),c0=new qe("Platform ID",{providedIn:"platform",factory:()=>"unknown"}),cE=new qe("appBootstrapListener");let MA=(()=>{class t{log(n){console.log(n)}warn(n){console.warn(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();const Ju=new qe("LocaleId",{providedIn:"root",factory:()=>Ia(Ju,Tt.Optional|Tt.SkipSelf)||function AA(){return"undefined"!=typeof $localize&&$localize.locale||hy}()});class PA{constructor(e,n){this.ngModuleFactory=e,this.componentFactories=n}}let uE=(()=>{class t{compileModuleSync(n){return new Ux(n)}compileModuleAsync(n){return Promise.resolve(this.compileModuleSync(n))}compileModuleAndAllComponentsSync(n){const s=this.compileModuleSync(n),f=Zs(Ii(n).declarations).reduce((y,E)=>{const S=zr(E);return S&&y.push(new Vx(S)),y},[]);return new PA(s,f)}compileModuleAndAllComponentsAsync(n){return Promise.resolve(this.compileModuleAndAllComponentsSync(n))}clearCache(){}clearCacheFor(n){}getModuleId(n){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();const RA=(()=>Promise.resolve(0))();function u0(t){"undefined"==typeof Zone?RA.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Ni{constructor({enableLongStackTrace:e=!1,shouldCoalesceEventChangeDetection:n=!1,shouldCoalesceRunChangeDetection:s=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Lr(!1),this.onMicrotaskEmpty=new Lr(!1),this.onStable=new Lr(!1),this.onError=new Lr(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const c=this;c._nesting=0,c._outer=c._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(c._inner=c._inner.fork(new Zone.TaskTrackingZoneSpec)),e&&Zone.longStackTraceZoneSpec&&(c._inner=c._inner.fork(Zone.longStackTraceZoneSpec)),c.shouldCoalesceEventChangeDetection=!s&&n,c.shouldCoalesceRunChangeDetection=s,c.lastRequestAnimationFrameId=-1,c.nativeRequestAnimationFrame=function FA(){let t=Tn.requestAnimationFrame,e=Tn.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const s=e[Zone.__symbol__("OriginalDelegate")];s&&(e=s)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function zA(t){const e=()=>{!function OA(t){t.isCheckStableRunning||-1!==t.lastRequestAnimationFrameId||(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(Tn,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,d0(t),t.isCheckStableRunning=!0,h0(t),t.isCheckStableRunning=!1},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),d0(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,s,c,f,y,E)=>{try{return hE(t),n.invokeTask(c,f,y,E)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===f.type||t.shouldCoalesceRunChangeDetection)&&e(),dE(t)}},onInvoke:(n,s,c,f,y,E,S)=>{try{return hE(t),n.invoke(c,f,y,E,S)}finally{t.shouldCoalesceRunChangeDetection&&e(),dE(t)}},onHasTask:(n,s,c,f)=>{n.hasTask(c,f),s===c&&("microTask"==f.change?(t._hasPendingMicrotasks=f.microTask,d0(t),h0(t)):"macroTask"==f.change&&(t.hasPendingMacrotasks=f.macroTask))},onHandleError:(n,s,c,f)=>(n.handleError(c,f),t.runOutsideAngular(()=>t.onError.emit(f)),!1)})}(c)}static isInAngularZone(){return"undefined"!=typeof Zone&&!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Ni.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Ni.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(e,n,s){return this._inner.run(e,n,s)}runTask(e,n,s,c){const f=this._inner,y=f.scheduleEventTask("NgZoneEvent: "+c,e,LA,xy,xy);try{return f.runTask(y,n,s)}finally{f.cancelTask(y)}}runGuarded(e,n,s){return this._inner.runGuarded(e,n,s)}runOutsideAngular(e){return this._outer.run(e)}}const LA={};function h0(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function d0(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function hE(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function dE(t){t._nesting--,h0(t)}class BA{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Lr,this.onMicrotaskEmpty=new Lr,this.onStable=new Lr,this.onError=new Lr}run(e,n,s){return e.apply(n,s)}runGuarded(e,n,s){return e.apply(n,s)}runOutsideAngular(e){return e()}runTask(e,n,s,c){return e.apply(n,s)}}let p0=(()=>{class t{constructor(n){this._ngZone=n,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),n.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Ni.assertNotInAngularZone(),u0(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())u0(()=>{for(;0!==this._callbacks.length;){let n=this._callbacks.pop();clearTimeout(n.timeoutId),n.doneCb(this._didWork)}this._didWork=!1});else{let n=this.getPendingTasks();this._callbacks=this._callbacks.filter(s=>!s.updateCb||!s.updateCb(n)||(clearTimeout(s.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(n=>({source:n.source,creationLocation:n.creationLocation,data:n.data})):[]}addCallback(n,s,c){let f=-1;s&&s>0&&(f=setTimeout(()=>{this._callbacks=this._callbacks.filter(y=>y.timeoutId!==f),n(this._didWork,this.getPendingTasks())},s)),this._callbacks.push({doneCb:n,timeoutId:f,updateCb:c})}whenStable(n,s,c){if(c&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/plugins/task-tracking" loaded?');this.addCallback(n,s,c),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(n,s,c){return[]}}return t.\u0275fac=function(n){return new(n||t)(xt(Ni))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})(),NA=(()=>{class t{constructor(){this._applications=new Map,f0.addToWindow(this)}registerApplication(n,s){this._applications.set(n,s)}unregisterApplication(n){this._applications.delete(n)}unregisterAllApplications(){this._applications.clear()}getTestability(n){return this._applications.get(n)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(n,s=!0){return f0.findTestabilityInTree(this,n,s)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();class VA{addToWindow(e){}findTestabilityInTree(e,n,s){return null}}let f0=new VA,cd=null;const pE=new qe("AllowMultipleToken"),fE=new qe("PlatformOnDestroy");class mE{constructor(e,n){this.name=e,this.token=n}}function gE(t,e,n=[]){const s=`Platform: ${e}`,c=new qe(s);return(f=[])=>{let y=m0();if(!y||y.injector.get(pE,!1)){const E=[...n,...f,{provide:c,useValue:!0}];t?t(E):function GA(t){if(cd&&!cd.get(pE,!1))throw new K(400,"");cd=t;const e=t.get(_E),n=t.get(lE,null);n&&n.forEach(s=>s())}(function qA(t=[],e){return Oi.create({name:e,providers:[{provide:zp,useValue:"platform"},{provide:fE,useValue:()=>cd=null},...t]})}(E,s))}return function HA(t){const e=m0();if(!e)throw new K(401,"");return e}()}}function m0(){var t;return null!==(t=null==cd?void 0:cd.get(_E))&&void 0!==t?t:null}let _E=(()=>{class t{constructor(n){this._injector=n,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(n,s){const E=function ZA(t,e){let n;return n="noop"===t?new BA:("zone.js"===t?void 0:t)||new Ni({enableLongStackTrace:!1,shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),n}(s?s.ngZone:void 0,{ngZoneEventCoalescing:s&&s.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:s&&s.ngZoneRunCoalescing||!1}),S=[{provide:Ni,useValue:E}];return E.run(()=>{const R=Oi.create({providers:S,parent:this.injector,name:n.moduleType.name}),N=n.create(R),$=N.injector.get(bo,null);if(!$)throw new K(402,"");return E.runOutsideAngular(()=>{const oe=E.onError.subscribe({next:ae=>{$.handleError(ae)}});N.onDestroy(()=>{_0(this._modules,N),oe.unsubscribe()})}),function WA(t,e,n){try{const s=n();return Sc(s)?s.catch(c=>{throw e.runOutsideAngular(()=>t.handleError(c)),c}):s}catch(s){throw e.runOutsideAngular(()=>t.handleError(s)),s}}($,E,()=>{const oe=N.injector.get(a0);return oe.runInitializers(),oe.donePromise.then(()=>(function ES(t){Si(t,"Expected localeId to be defined"),"string"==typeof t&&(K1=t.toLowerCase().replace(/_/g,"-"))}(N.injector.get(Ju,hy)||hy),this._moduleDoBootstrap(N),N))})})}bootstrapModule(n,s=[]){const c=yE({},s);return function jA(t,e,n){const s=new Ux(n);return Promise.resolve(s)}(0,0,n).then(f=>this.bootstrapModuleFactory(f,c))}_moduleDoBootstrap(n){const s=n.injector.get(g0);if(n._bootstrapComponents.length>0)n._bootstrapComponents.forEach(c=>s.bootstrap(c));else{if(!n.instance.ngDoBootstrap)throw new K(403,"");n.instance.ngDoBootstrap(s)}this._modules.push(n)}onDestroy(n){this._destroyListeners.push(n)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new K(404,"");this._modules.slice().forEach(s=>s.destroy()),this._destroyListeners.forEach(s=>s());const n=this._injector.get(fE,null);null==n||n(),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(n){return new(n||t)(xt(Oi))},t.\u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"platform"}),t})();function yE(t,e){return Array.isArray(e)?e.reduce(yE,t):Object.assign(Object.assign({},t),e)}let g0=(()=>{class t{constructor(n,s,c,f){this._zone=n,this._injector=s,this._exceptionHandler=c,this._initStatus=f,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const y=new kn(S=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{S.next(this._stable),S.complete()})}),E=new kn(S=>{let R;this._zone.runOutsideAngular(()=>{R=this._zone.onStable.subscribe(()=>{Ni.assertNotInAngularZone(),u0(()=>{!this._stable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks&&(this._stable=!0,S.next(!0))})})});const N=this._zone.onUnstable.subscribe(()=>{Ni.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{S.next(!1)}))});return()=>{R.unsubscribe(),N.unsubscribe()}});this.isStable=function da(...t){let e=Number.POSITIVE_INFINITY,n=null,s=t[t.length-1];return Ko(s)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof s&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof kn?t[0]:Or(e)(Hi(t,n))}(y,E.pipe(function Ms(){return t=>Qa()(function jc(t,e){return function(s){let c;if(c="function"==typeof t?t:function(){return t},"function"==typeof e)return s.lift(new $c(c,e));const f=Object.create(s,Nl);return f.source=s,f.subjectFactory=c,f}}(lh)(t))}()))}bootstrap(n,s){if(!this._initStatus.done)throw new K(405,"");let c;c=n instanceof ww?n:this._injector.get(Xm).resolveComponentFactory(n),this.componentTypes.push(c.componentType);const f=function $A(t){return t.isBoundToModule}(c)?void 0:this._injector.get(Ic),E=c.create(Oi.NULL,[],s||c.selector,f),S=E.location.nativeElement,R=E.injector.get(p0,null),N=R&&E.injector.get(NA);return R&&N&&N.registerApplication(S,R),E.onDestroy(()=>{this.detachView(E.hostView),_0(this.components,E),N&&N.unregisterApplication(S)}),this._loadComponent(E),E}tick(){if(this._runningTick)throw new K(101,"");try{this._runningTick=!0;for(let n of this._views)n.detectChanges()}catch(n){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(n))}finally{this._runningTick=!1}}attachView(n){const s=n;this._views.push(s),s.attachToAppRef(this)}detachView(n){const s=n;_0(this._views,s),s.detachFromAppRef()}_loadComponent(n){this.attachView(n.hostView),this.tick(),this.components.push(n),this._injector.get(cE,[]).concat(this._bootstrapListeners).forEach(c=>c(n))}ngOnDestroy(){this._views.slice().forEach(n=>n.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(n){return new(n||t)(xt(Ni),xt(Oi),xt(bo),xt(a0))},t.\u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function _0(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}let xE=!0,by=(()=>{class t{}return t.__NG_ELEMENT_ID__=KA,t})();function KA(t){return function JA(t,e,n){if(ql(t)&&!n){const s=Hr(t.index,e);return new Km(s,s)}return 47&t.type?new Km(e[16],e):null}(Cr(),$e(),16==(16&t))}class TE{constructor(){}supports(e){return Wu(e)}create(e){return new iI(e)}}const rI=(t,e)=>e;class iI{constructor(e){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=e||rI}forEachItem(e){let n;for(n=this._itHead;null!==n;n=n._next)e(n)}forEachOperation(e){let n=this._itHead,s=this._removalsHead,c=0,f=null;for(;n||s;){const y=!s||n&&n.currentIndex<SE(s,c,f)?n:s,E=SE(y,c,f),S=y.currentIndex;if(y===s)c--,s=s._nextRemoved;else if(n=n._next,null==y.previousIndex)c++;else{f||(f=[]);const R=E-c,N=S-c;if(R!=N){for(let oe=0;oe<R;oe++){const ae=oe<f.length?f[oe]:f[oe]=0,Ee=ae+oe;N<=Ee&&Ee<R&&(f[oe]=ae+1)}f[y.previousIndex]=N-R}}E!==S&&e(y,E,S)}}forEachPreviousItem(e){let n;for(n=this._previousItHead;null!==n;n=n._nextPrevious)e(n)}forEachAddedItem(e){let n;for(n=this._additionsHead;null!==n;n=n._nextAdded)e(n)}forEachMovedItem(e){let n;for(n=this._movesHead;null!==n;n=n._nextMoved)e(n)}forEachRemovedItem(e){let n;for(n=this._removalsHead;null!==n;n=n._nextRemoved)e(n)}forEachIdentityChange(e){let n;for(n=this._identityChangesHead;null!==n;n=n._nextIdentityChange)e(n)}diff(e){if(null==e&&(e=[]),!Wu(e))throw new K(900,"");return this.check(e)?this:null}onDestroy(){}check(e){this._reset();let c,f,y,n=this._itHead,s=!1;if(Array.isArray(e)){this.length=e.length;for(let E=0;E<this.length;E++)f=e[E],y=this._trackByFn(E,f),null!==n&&Object.is(n.trackById,y)?(s&&(n=this._verifyReinsertion(n,f,y,E)),Object.is(n.item,f)||this._addIdentityChange(n,f)):(n=this._mismatch(n,f,y,E),s=!0),n=n._next}else c=0,function Gp(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n]);else{const n=t[qo()]();let s;for(;!(s=n.next()).done;)e(s.value)}}(e,E=>{y=this._trackByFn(c,E),null!==n&&Object.is(n.trackById,y)?(s&&(n=this._verifyReinsertion(n,E,y,c)),Object.is(n.item,E)||this._addIdentityChange(n,E)):(n=this._mismatch(n,E,y,c),s=!0),n=n._next,c++}),this.length=c;return this._truncate(n),this.collection=e,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let e;for(e=this._previousItHead=this._itHead;null!==e;e=e._next)e._nextPrevious=e._next;for(e=this._additionsHead;null!==e;e=e._nextAdded)e.previousIndex=e.currentIndex;for(this._additionsHead=this._additionsTail=null,e=this._movesHead;null!==e;e=e._nextMoved)e.previousIndex=e.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(e,n,s,c){let f;return null===e?f=this._itTail:(f=e._prev,this._remove(e)),null!==(e=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null))?(Object.is(e.item,n)||this._addIdentityChange(e,n),this._reinsertAfter(e,f,c)):null!==(e=null===this._linkedRecords?null:this._linkedRecords.get(s,c))?(Object.is(e.item,n)||this._addIdentityChange(e,n),this._moveAfter(e,f,c)):e=this._addAfter(new oI(n,s),f,c),e}_verifyReinsertion(e,n,s,c){let f=null===this._unlinkedRecords?null:this._unlinkedRecords.get(s,null);return null!==f?e=this._reinsertAfter(f,e._prev,c):e.currentIndex!=c&&(e.currentIndex=c,this._addToMoves(e,c)),e}_truncate(e){for(;null!==e;){const n=e._next;this._addToRemovals(this._unlink(e)),e=n}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(e,n,s){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(e);const c=e._prevRemoved,f=e._nextRemoved;return null===c?this._removalsHead=f:c._nextRemoved=f,null===f?this._removalsTail=c:f._prevRemoved=c,this._insertAfter(e,n,s),this._addToMoves(e,s),e}_moveAfter(e,n,s){return this._unlink(e),this._insertAfter(e,n,s),this._addToMoves(e,s),e}_addAfter(e,n,s){return this._insertAfter(e,n,s),this._additionsTail=null===this._additionsTail?this._additionsHead=e:this._additionsTail._nextAdded=e,e}_insertAfter(e,n,s){const c=null===n?this._itHead:n._next;return e._next=c,e._prev=n,null===c?this._itTail=e:c._prev=e,null===n?this._itHead=e:n._next=e,null===this._linkedRecords&&(this._linkedRecords=new DE),this._linkedRecords.put(e),e.currentIndex=s,e}_remove(e){return this._addToRemovals(this._unlink(e))}_unlink(e){null!==this._linkedRecords&&this._linkedRecords.remove(e);const n=e._prev,s=e._next;return null===n?this._itHead=s:n._next=s,null===s?this._itTail=n:s._prev=n,e}_addToMoves(e,n){return e.previousIndex===n||(this._movesTail=null===this._movesTail?this._movesHead=e:this._movesTail._nextMoved=e),e}_addToRemovals(e){return null===this._unlinkedRecords&&(this._unlinkedRecords=new DE),this._unlinkedRecords.put(e),e.currentIndex=null,e._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=e,e._prevRemoved=null):(e._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=e),e}_addIdentityChange(e,n){return e.item=n,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=e:this._identityChangesTail._nextIdentityChange=e,e}}class oI{constructor(e,n){this.item=e,this.trackById=n,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class sI{constructor(){this._head=null,this._tail=null}add(e){null===this._head?(this._head=this._tail=e,e._nextDup=null,e._prevDup=null):(this._tail._nextDup=e,e._prevDup=this._tail,e._nextDup=null,this._tail=e)}get(e,n){let s;for(s=this._head;null!==s;s=s._nextDup)if((null===n||n<=s.currentIndex)&&Object.is(s.trackById,e))return s;return null}remove(e){const n=e._prevDup,s=e._nextDup;return null===n?this._head=s:n._nextDup=s,null===s?this._tail=n:s._prevDup=n,null===this._head}}class DE{constructor(){this.map=new Map}put(e){const n=e.trackById;let s=this.map.get(n);s||(s=new sI,this.map.set(n,s)),s.add(e)}get(e,n){const c=this.map.get(e);return c?c.get(e,n):null}remove(e){const n=e.trackById;return this.map.get(n).remove(e)&&this.map.delete(n),e}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function SE(t,e,n){const s=t.previousIndex;if(null===s)return s;let c=0;return n&&s<n.length&&(c=n[s]),s+e+c}function AE(){return new Cy([new TE])}let Cy=(()=>{class t{constructor(n){this.factories=n}static create(n,s){if(null!=s){const c=s.factories.slice();n=n.concat(c)}return new t(n)}static extend(n){return{provide:t,useFactory:s=>t.create(n,s||AE()),deps:[[t,new $s,new js]]}}find(n){const s=this.factories.find(c=>c.supports(n));if(null!=s)return s;throw new K(901,"")}}return t.\u0275prov=ke({token:t,providedIn:"root",factory:AE}),t})();const hI=gE(null,"core",[]);let dI=(()=>{class t{constructor(n){}}return t.\u0275fac=function(n){return new(n||t)(xt(g0))},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({}),t})(),Ty=null;function kl(){return Ty}const ws=new qe("DocumentToken");let hd=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=ke({token:t,factory:function(){return function gI(){return xt(PE)}()},providedIn:"platform"}),t})();const _I=new qe("Location Initialized");let PE=(()=>{class t extends hd{constructor(n){super(),this._doc=n,this._init()}_init(){this.location=window.location,this._history=window.history}getBaseHrefFromDOM(){return kl().getBaseHref(this._doc)}onPopState(n){const s=kl().getGlobalEventTarget(this._doc,"window");return s.addEventListener("popstate",n,!1),()=>s.removeEventListener("popstate",n)}onHashChange(n){const s=kl().getGlobalEventTarget(this._doc,"window");return s.addEventListener("hashchange",n,!1),()=>s.removeEventListener("hashchange",n)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(n){this.location.pathname=n}pushState(n,s,c){kE()?this._history.pushState(n,s,c):this.location.hash=c}replaceState(n,s,c){kE()?this._history.replaceState(n,s,c):this.location.hash=c}forward(){this._history.forward()}back(){this._history.back()}historyGo(n=0){this._history.go(n)}getState(){return this._history.state}}return t.\u0275fac=function(n){return new(n||t)(xt(ws))},t.\u0275prov=ke({token:t,factory:function(){return function yI(){return new PE(xt(ws))}()},providedIn:"platform"}),t})();function kE(){return!!window.history.pushState}function w0(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function RE(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function kc(t){return t&&"?"!==t[0]?"?"+t:t}let ef=(()=>{class t{historyGo(n){throw new Error("Not implemented")}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=ke({token:t,factory:function(){return function vI(t){const e=xt(ws).location;return new FE(xt(hd),e&&e.origin||"")}()},providedIn:"root"}),t})();const E0=new qe("appBaseHref");let FE=(()=>{class t extends ef{constructor(n,s){if(super(),this._platformLocation=n,this._removeListenerFns=[],null==s&&(s=this._platformLocation.getBaseHrefFromDOM()),null==s)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=s}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}prepareExternalUrl(n){return w0(this._baseHref,n)}path(n=!1){const s=this._platformLocation.pathname+kc(this._platformLocation.search),c=this._platformLocation.hash;return c&&n?`${s}${c}`:s}pushState(n,s,c,f){const y=this.prepareExternalUrl(c+kc(f));this._platformLocation.pushState(n,s,y)}replaceState(n,s,c,f){const y=this.prepareExternalUrl(c+kc(f));this._platformLocation.replaceState(n,s,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var s,c;null===(c=(s=this._platformLocation).historyGo)||void 0===c||c.call(s,n)}}return t.\u0275fac=function(n){return new(n||t)(xt(hd),xt(E0,8))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})(),xI=(()=>{class t extends ef{constructor(n,s){super(),this._platformLocation=n,this._baseHref="",this._removeListenerFns=[],null!=s&&(this._baseHref=s)}ngOnDestroy(){for(;this._removeListenerFns.length;)this._removeListenerFns.pop()()}onPopState(n){this._removeListenerFns.push(this._platformLocation.onPopState(n),this._platformLocation.onHashChange(n))}getBaseHref(){return this._baseHref}path(n=!1){let s=this._platformLocation.hash;return null==s&&(s="#"),s.length>0?s.substring(1):s}prepareExternalUrl(n){const s=w0(this._baseHref,n);return s.length>0?"#"+s:s}pushState(n,s,c,f){let y=this.prepareExternalUrl(c+kc(f));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.pushState(n,s,y)}replaceState(n,s,c,f){let y=this.prepareExternalUrl(c+kc(f));0==y.length&&(y=this._platformLocation.pathname),this._platformLocation.replaceState(n,s,y)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}historyGo(n=0){var s,c;null===(c=(s=this._platformLocation).historyGo)||void 0===c||c.call(s,n)}}return t.\u0275fac=function(n){return new(n||t)(xt(hd),xt(E0,8))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})(),C0=(()=>{class t{constructor(n,s){this._subject=new Lr,this._urlChangeListeners=[],this._platformStrategy=n;const c=this._platformStrategy.getBaseHref();this._platformLocation=s,this._baseHref=RE(LE(c)),this._platformStrategy.onPopState(f=>{this._subject.emit({url:this.path(!0),pop:!0,state:f.state,type:f.type})})}path(n=!1){return this.normalize(this._platformStrategy.path(n))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(n,s=""){return this.path()==this.normalize(n+kc(s))}normalize(n){return t.stripTrailingSlash(function wI(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,LE(n)))}prepareExternalUrl(n){return n&&"/"!==n[0]&&(n="/"+n),this._platformStrategy.prepareExternalUrl(n)}go(n,s="",c=null){this._platformStrategy.pushState(c,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+kc(s)),c)}replaceState(n,s="",c=null){this._platformStrategy.replaceState(c,"",n,s),this._notifyUrlChangeListeners(this.prepareExternalUrl(n+kc(s)),c)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}historyGo(n=0){var s,c;null===(c=(s=this._platformStrategy).historyGo)||void 0===c||c.call(s,n)}onUrlChange(n){this._urlChangeListeners.push(n),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(s=>{this._notifyUrlChangeListeners(s.url,s.state)}))}_notifyUrlChangeListeners(n="",s){this._urlChangeListeners.forEach(c=>c(n,s))}subscribe(n,s,c){return this._subject.subscribe({next:n,error:s,complete:c})}}return t.normalizeQueryParams=kc,t.joinWithSlash=w0,t.stripTrailingSlash=RE,t.\u0275fac=function(n){return new(n||t)(xt(ef),xt(hd))},t.\u0275prov=ke({token:t,factory:function(){return function bI(){return new C0(xt(ef),xt(hd))}()},providedIn:"root"}),t})();function LE(t){return t.replace(/\/index.html$/,"")}function GE(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const s=n.indexOf("="),[c,f]=-1==s?[n,""]:[n.slice(0,s),n.slice(s+1)];if(c.trim()===e)return decodeURIComponent(f)}return null}class a2{constructor(e,n,s,c){this.$implicit=e,this.ngForOf=n,this.index=s,this.count=c}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let Ly=(()=>{class t{constructor(n,s,c){this._viewContainer=n,this._template=s,this._differs=c,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(n){this._ngForOf=n,this._ngForOfDirty=!0}set ngForTrackBy(n){this._trackByFn=n}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(n){n&&(this._template=n)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;!this._differ&&n&&(this._differ=this._differs.find(n).create(this.ngForTrackBy))}if(this._differ){const n=this._differ.diff(this._ngForOf);n&&this._applyChanges(n)}}_applyChanges(n){const s=this._viewContainer;n.forEachOperation((c,f,y)=>{if(null==c.previousIndex)s.createEmbeddedView(this._template,new a2(c.item,this._ngForOf,-1,-1),null===y?void 0:y);else if(null==y)s.remove(null===f?void 0:f);else if(null!==f){const E=s.get(f);s.move(E,y),HE(E,c)}});for(let c=0,f=s.length;c<f;c++){const E=s.get(c).context;E.index=c,E.count=f,E.ngForOf=this._ngForOf}n.forEachIdentityChange(c=>{HE(s.get(c.currentIndex),c)})}static ngTemplateContextGuard(n,s){return!0}}return t.\u0275fac=function(n){return new(n||t)(ze(ja),ze(Pc),ze(Cy))},t.\u0275dir=St({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),t})();function HE(t,e){t.context.$implicit=e.item}let Oy=(()=>{class t{constructor(n,s){this._viewContainer=n,this._context=new l2,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=s}set ngIf(n){this._context.$implicit=this._context.ngIf=n,this._updateView()}set ngIfThen(n){qE("ngIfThen",n),this._thenTemplateRef=n,this._thenViewRef=null,this._updateView()}set ngIfElse(n){qE("ngIfElse",n),this._elseTemplateRef=n,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(n,s){return!0}}return t.\u0275fac=function(n){return new(n||t)(ze(ja),ze(Pc))},t.\u0275dir=St({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),t})();class l2{constructor(){this.$implicit=null,this.ngIf=null}}function qE(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${mn(e)}'.`)}let L2=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({}),t})();let N2=(()=>{class t{}return t.\u0275prov=ke({token:t,providedIn:"root",factory:()=>new V2(xt(ws),window)}),t})();class V2{constructor(e,n){this.document=e,this.window=n,this.offset=()=>[0,0]}setOffset(e){this.offset=Array.isArray(e)?()=>e:e}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(e){this.supportsScrolling()&&this.window.scrollTo(e[0],e[1])}scrollToAnchor(e){if(!this.supportsScrolling())return;const n=function U2(t,e){const n=t.getElementById(e)||t.getElementsByName(e)[0];if(n)return n;if("function"==typeof t.createTreeWalker&&t.body&&(t.body.createShadowRoot||t.body.attachShadow)){const s=t.createTreeWalker(t.body,NodeFilter.SHOW_ELEMENT);let c=s.currentNode;for(;c;){const f=c.shadowRoot;if(f){const y=f.getElementById(e)||f.querySelector(`[name="${e}"]`);if(y)return y}c=s.nextNode()}}return null}(this.document,e);n&&(this.scrollToElement(n),n.focus())}setHistoryScrollRestoration(e){if(this.supportScrollRestoration()){const n=this.window.history;n&&n.scrollRestoration&&(n.scrollRestoration=e)}}scrollToElement(e){const n=e.getBoundingClientRect(),s=n.left+this.window.pageXOffset,c=n.top+this.window.pageYOffset,f=this.offset();this.window.scrollTo(s-f[0],c-f[1])}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const e=YE(this.window.history)||YE(Object.getPrototypeOf(this.window.history));return!(!e||!e.writable&&!e.set)}catch(e){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(e){return!1}}}function YE(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class KE{}class B0 extends class j2 extends class mI{}{constructor(){super(...arguments),this.supportsDOMEvents=!0}}{static makeCurrent(){!function fI(t){Ty||(Ty=t)}(new B0)}onAndCancel(e,n,s){return e.addEventListener(n,s,!1),()=>{e.removeEventListener(n,s,!1)}}dispatchEvent(e,n){e.dispatchEvent(n)}remove(e){e.parentNode&&e.parentNode.removeChild(e)}createElement(e,n){return(n=n||this.getDefaultDocument()).createElement(e)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(e){return e.nodeType===Node.ELEMENT_NODE}isShadowRoot(e){return e instanceof DocumentFragment}getGlobalEventTarget(e,n){return"window"===n?window:"document"===n?e:"body"===n?e.body:null}getBaseHref(e){const n=function $2(){return og=og||document.querySelector("base"),og?og.getAttribute("href"):null}();return null==n?null:function G2(t){zy=zy||document.createElement("a"),zy.setAttribute("href",t);const e=zy.pathname;return"/"===e.charAt(0)?e:`/${e}`}(n)}resetBaseElement(){og=null}getUserAgent(){return window.navigator.userAgent}getCookie(e){return GE(document.cookie,e)}}let zy,og=null;const JE=new qe("TRANSITION_ID"),q2=[{provide:s0,useFactory:function H2(t,e,n){return()=>{n.get(a0).donePromise.then(()=>{const s=kl(),c=e.querySelectorAll(`style[ng-transition="${t}"]`);for(let f=0;f<c.length;f++)s.remove(c[f])})}},deps:[JE,ws,Oi],multi:!0}];class N0{static init(){!function UA(t){f0=t}(new N0)}addToWindow(e){Tn.getAngularTestability=(s,c=!0)=>{const f=e.findTestabilityInTree(s,c);if(null==f)throw new Error("Could not find testability for element.");return f},Tn.getAllAngularTestabilities=()=>e.getAllTestabilities(),Tn.getAllAngularRootElements=()=>e.getAllRootElements(),Tn.frameworkStabilizers||(Tn.frameworkStabilizers=[]),Tn.frameworkStabilizers.push(s=>{const c=Tn.getAllAngularTestabilities();let f=c.length,y=!1;const E=function(S){y=y||S,f--,0==f&&s(y)};c.forEach(function(S){S.whenStable(E)})})}findTestabilityInTree(e,n,s){if(null==n)return null;const c=e.getTestability(n);return null!=c?c:s?kl().isShadowRoot(n)?this.findTestabilityInTree(e,n.host,!0):this.findTestabilityInTree(e,n.parentElement,!0):null}}let Z2=(()=>{class t{build(){return new XMLHttpRequest}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();const By=new qe("EventManagerPlugins");let Ny=(()=>{class t{constructor(n,s){this._zone=s,this._eventNameToPlugin=new Map,n.forEach(c=>c.manager=this),this._plugins=n.slice().reverse()}addEventListener(n,s,c){return this._findPluginFor(s).addEventListener(n,s,c)}addGlobalEventListener(n,s,c){return this._findPluginFor(s).addGlobalEventListener(n,s,c)}getZone(){return this._zone}_findPluginFor(n){const s=this._eventNameToPlugin.get(n);if(s)return s;const c=this._plugins;for(let f=0;f<c.length;f++){const y=c[f];if(y.supports(n))return this._eventNameToPlugin.set(n,y),y}throw new Error(`No event manager plugin found for event ${n}`)}}return t.\u0275fac=function(n){return new(n||t)(xt(By),xt(Ni))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();class QE{constructor(e){this._doc=e}addGlobalEventListener(e,n,s){const c=kl().getGlobalEventTarget(this._doc,e);if(!c)throw new Error(`Unsupported event target ${c} for event ${n}`);return this.addEventListener(c,n,s)}}let eC=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(n){const s=new Set;n.forEach(c=>{this._stylesSet.has(c)||(this._stylesSet.add(c),s.add(c))}),this.onStylesAdded(s)}onStylesAdded(n){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})(),sg=(()=>{class t extends eC{constructor(n){super(),this._doc=n,this._hostNodes=new Map,this._hostNodes.set(n.head,[])}_addStylesToHost(n,s,c){n.forEach(f=>{const y=this._doc.createElement("style");y.textContent=f,c.push(s.appendChild(y))})}addHost(n){const s=[];this._addStylesToHost(this._stylesSet,n,s),this._hostNodes.set(n,s)}removeHost(n){const s=this._hostNodes.get(n);s&&s.forEach(tC),this._hostNodes.delete(n)}onStylesAdded(n){this._hostNodes.forEach((s,c)=>{this._addStylesToHost(n,c,s)})}ngOnDestroy(){this._hostNodes.forEach(n=>n.forEach(tC))}}return t.\u0275fac=function(n){return new(n||t)(xt(ws))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();function tC(t){kl().remove(t)}const V0={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/",math:"http://www.w3.org/1998/MathML/"},U0=/%COMP%/g;function Vy(t,e,n){for(let s=0;s<e.length;s++){let c=e[s];Array.isArray(c)?Vy(t,c,n):(c=c.replace(U0,t),n.push(c))}return n}function iC(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let j0=(()=>{class t{constructor(n,s,c){this.eventManager=n,this.sharedStylesHost=s,this.appId=c,this.rendererByCompId=new Map,this.defaultRenderer=new $0(n)}createRenderer(n,s){if(!n||!s)return this.defaultRenderer;switch(s.encapsulation){case hr.Emulated:{let c=this.rendererByCompId.get(s.id);return c||(c=new Q2(this.eventManager,this.sharedStylesHost,s,this.appId),this.rendererByCompId.set(s.id,c)),c.applyToHost(n),c}case 1:case hr.ShadowDom:return new eP(this.eventManager,this.sharedStylesHost,n,s);default:if(!this.rendererByCompId.has(s.id)){const c=Vy(s.id,s.styles,[]);this.sharedStylesHost.addStyles(c),this.rendererByCompId.set(s.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(n){return new(n||t)(xt(Ny),xt(sg),xt(tg))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();class $0{constructor(e){this.eventManager=e,this.data=Object.create(null),this.destroyNode=null}destroy(){}createElement(e,n){return n?document.createElementNS(V0[n]||n,e):document.createElement(e)}createComment(e){return document.createComment(e)}createText(e){return document.createTextNode(e)}appendChild(e,n){e.appendChild(n)}insertBefore(e,n,s){e&&e.insertBefore(n,s)}removeChild(e,n){e&&e.removeChild(n)}selectRootElement(e,n){let s="string"==typeof e?document.querySelector(e):e;if(!s)throw new Error(`The selector "${e}" did not match any elements`);return n||(s.textContent=""),s}parentNode(e){return e.parentNode}nextSibling(e){return e.nextSibling}setAttribute(e,n,s,c){if(c){n=c+":"+n;const f=V0[c];f?e.setAttributeNS(f,n,s):e.setAttribute(n,s)}else e.setAttribute(n,s)}removeAttribute(e,n,s){if(s){const c=V0[s];c?e.removeAttributeNS(c,n):e.removeAttribute(`${s}:${n}`)}else e.removeAttribute(n)}addClass(e,n){e.classList.add(n)}removeClass(e,n){e.classList.remove(n)}setStyle(e,n,s,c){c&(wo.DashCase|wo.Important)?e.style.setProperty(n,s,c&wo.Important?"important":""):e.style[n]=s}removeStyle(e,n,s){s&wo.DashCase?e.style.removeProperty(n):e.style[n]=""}setProperty(e,n,s){e[n]=s}setValue(e,n){e.nodeValue=n}listen(e,n,s){return"string"==typeof e?this.eventManager.addGlobalEventListener(e,n,iC(s)):this.eventManager.addEventListener(e,n,iC(s))}}class Q2 extends $0{constructor(e,n,s,c){super(e),this.component=s;const f=Vy(c+"-"+s.id,s.styles,[]);n.addStyles(f),this.contentAttr=function Y2(t){return"_ngcontent-%COMP%".replace(U0,t)}(c+"-"+s.id),this.hostAttr=function K2(t){return"_nghost-%COMP%".replace(U0,t)}(c+"-"+s.id)}applyToHost(e){super.setAttribute(e,this.hostAttr,"")}createElement(e,n){const s=super.createElement(e,n);return super.setAttribute(s,this.contentAttr,""),s}}class eP extends $0{constructor(e,n,s,c){super(e),this.sharedStylesHost=n,this.hostEl=s,this.shadowRoot=s.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const f=Vy(c.id,c.styles,[]);for(let y=0;y<f.length;y++){const E=document.createElement("style");E.textContent=f[y],this.shadowRoot.appendChild(E)}}nodeOrShadowRoot(e){return e===this.hostEl?this.shadowRoot:e}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(e,n){return super.appendChild(this.nodeOrShadowRoot(e),n)}insertBefore(e,n,s){return super.insertBefore(this.nodeOrShadowRoot(e),n,s)}removeChild(e,n){return super.removeChild(this.nodeOrShadowRoot(e),n)}parentNode(e){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(e)))}}let tP=(()=>{class t extends QE{constructor(n){super(n)}supports(n){return!0}addEventListener(n,s,c){return n.addEventListener(s,c,!1),()=>this.removeEventListener(n,s,c)}removeEventListener(n,s,c){return n.removeEventListener(s,c)}}return t.\u0275fac=function(n){return new(n||t)(xt(ws))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();const sC=["alt","control","meta","shift"],rP={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},aC={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},iP={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let oP=(()=>{class t extends QE{constructor(n){super(n)}supports(n){return null!=t.parseEventName(n)}addEventListener(n,s,c){const f=t.parseEventName(s),y=t.eventCallback(f.fullKey,c,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>kl().onAndCancel(n,f.domEventName,y))}static parseEventName(n){const s=n.toLowerCase().split("."),c=s.shift();if(0===s.length||"keydown"!==c&&"keyup"!==c)return null;const f=t._normalizeKey(s.pop());let y="";if(sC.forEach(S=>{const R=s.indexOf(S);R>-1&&(s.splice(R,1),y+=S+".")}),y+=f,0!=s.length||0===f.length)return null;const E={};return E.domEventName=c,E.fullKey=y,E}static getEventFullKey(n){let s="",c=function sP(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&aC.hasOwnProperty(e)&&(e=aC[e]))}return rP[e]||e}(n);return c=c.toLowerCase()," "===c?c="space":"."===c&&(c="dot"),sC.forEach(f=>{f!=c&&iP[f](n)&&(s+=f+".")}),s+=c,s}static eventCallback(n,s,c){return f=>{t.getEventFullKey(f)===n&&c.runGuarded(()=>s(f))}}static _normalizeKey(n){return"esc"===n?"escape":n}}return t.\u0275fac=function(n){return new(n||t)(xt(ws))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();const uP=gE(hI,"browser",[{provide:c0,useValue:"browser"},{provide:lE,useValue:function aP(){B0.makeCurrent(),N0.init()},multi:!0},{provide:ws,useFactory:function cP(){return function _h(t){zs=t}(document),document},deps:[]}]),hP=[{provide:zp,useValue:"root"},{provide:bo,useFactory:function lP(){return new bo},deps:[]},{provide:By,useClass:tP,multi:!0,deps:[ws,Ni,c0]},{provide:By,useClass:oP,multi:!0,deps:[ws]},{provide:j0,useClass:j0,deps:[Ny,sg,tg]},{provide:Cw,useExisting:j0},{provide:eC,useExisting:sg},{provide:sg,useClass:sg,deps:[ws]},{provide:p0,useClass:p0,deps:[Ni]},{provide:Ny,useClass:Ny,deps:[By,Ni]},{provide:KE,useClass:Z2,deps:[]}];let dP=(()=>{class t{constructor(n){if(n)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(n){return{ngModule:t,providers:[{provide:tg,useValue:n.appId},{provide:JE,useExisting:tg},q2]}}}return t.\u0275fac=function(n){return new(n||t)(xt(t,12))},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({providers:hP,imports:[L2,dI]}),t})();function Yt(...t){let e=t[t.length-1];return Ko(e)?(t.pop(),es(t,e)):Hi(t)}"undefined"!=typeof window&&window;class Ha extends Ui{constructor(e){super(),this._value=e}get value(){return this.getValue()}_subscribe(e){const n=super._subscribe(e);return n&&!n.closed&&e.next(this._value),n}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new lo;return this._value}next(e){super.next(this._value=e)}}class EP extends $n{notifyNext(e,n,s,c,f){this.destination.next(n)}notifyError(e,n){this.destination.error(e)}notifyComplete(e){this.destination.complete()}}class CP extends $n{constructor(e,n,s){super(),this.parent=e,this.outerValue=n,this.outerIndex=s,this.index=0}_next(e){this.parent.notifyNext(this.outerValue,e,this.outerIndex,this.index++,this)}_error(e){this.parent.notifyError(e,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}function TP(t,e,n,s,c=new CP(t,n,s)){if(!c.closed)return e instanceof kn?e.subscribe(c):co(e)(c)}const uC={};class SP{constructor(e){this.resultSelector=e}call(e,n){return n.subscribe(new MP(e,this.resultSelector))}}class MP extends EP{constructor(e,n){super(e),this.resultSelector=n,this.active=0,this.values=[],this.observables=[]}_next(e){this.values.push(uC),this.observables.push(e)}_complete(){const e=this.observables,n=e.length;if(0===n)this.destination.complete();else{this.active=n,this.toRespond=n;for(let s=0;s<n;s++)this.add(TP(this,e[s],void 0,s))}}notifyComplete(e){0==(this.active-=1)&&this.destination.complete()}notifyNext(e,n,s){const c=this.values,y=this.toRespond?c[s]===uC?--this.toRespond:this.toRespond:0;c[s]=n,0===y&&(this.resultSelector?this._tryResultSelector(c):this.destination.next(c.slice()))}_tryResultSelector(e){let n;try{n=this.resultSelector.apply(this,e)}catch(s){return void this.destination.error(s)}this.destination.next(n)}}function Uy(t,e){return new kn(e?n=>e.schedule(AP,0,{error:t,subscriber:n}):n=>n.error(t))}function AP({error:t,subscriber:e}){e.error(t)}const jy=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function H0(...t){return function IP(){return Or(1)}()(Yt(...t))}const tf=new kn(t=>t.complete());function q0(t){return t?function PP(t){return new kn(e=>t.schedule(()=>e.complete()))}(t):tf}function hC(t){return new kn(e=>{let n;try{n=t()}catch(c){return void e.error(c)}return(n?zn(n):q0()).subscribe(e)})}function eh(t,e){return"function"==typeof e?n=>n.pipe(eh((s,c)=>zn(t(s,c)).pipe(Vt((f,y)=>e(s,f,c,y))))):n=>n.lift(new kP(t))}class kP{constructor(e){this.project=e}call(e,n){return n.subscribe(new RP(e,this.project))}}class RP extends Ro{constructor(e,n){super(e),this.project=n,this.index=0}_next(e){let n;const s=this.index++;try{n=this.project(e,s)}catch(c){return void this.destination.error(c)}this._innerSub(n)}_innerSub(e){const n=this.innerSubscription;n&&n.unsubscribe();const s=new Ds(this),c=this.destination;c.add(s),this.innerSubscription=uo(e,s),this.innerSubscription!==s&&c.add(this.innerSubscription)}_complete(){const{innerSubscription:e}=this;(!e||e.closed)&&super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(e){this.destination.next(e)}}const dC=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();function Z0(t){return e=>0===t?q0():e.lift(new FP(t))}class FP{constructor(e){if(this.total=e,this.total<0)throw new dC}call(e,n){return n.subscribe(new LP(e,this.total))}}class LP extends $n{constructor(e,n){super(e),this.total=n,this.count=0}_next(e){const n=this.total,s=++this.count;s<=n&&(this.destination.next(e),s===n&&(this.destination.complete(),this.unsubscribe()))}}function pC(t,e){let n=!1;return arguments.length>=2&&(n=!0),function(c){return c.lift(new zP(t,e,n))}}class zP{constructor(e,n,s=!1){this.accumulator=e,this.seed=n,this.hasSeed=s}call(e,n){return n.subscribe(new BP(e,this.accumulator,this.seed,this.hasSeed))}}class BP extends $n{constructor(e,n,s,c){super(e),this.accumulator=n,this._seed=s,this.hasSeed=c,this.index=0}get seed(){return this._seed}set seed(e){this.hasSeed=!0,this._seed=e}_next(e){if(this.hasSeed)return this._tryNext(e);this.seed=e,this.destination.next(e)}_tryNext(e){const n=this.index++;let s;try{s=this.accumulator(this.seed,e,n)}catch(c){this.destination.error(c)}this.seed=s,this.destination.next(s)}}function dd(t,e){return function(s){return s.lift(new NP(t,e))}}class NP{constructor(e,n){this.predicate=e,this.thisArg=n}call(e,n){return n.subscribe(new VP(e,this.predicate,this.thisArg))}}class VP extends $n{constructor(e,n,s){super(e),this.predicate=n,this.thisArg=s,this.count=0}_next(e){let n;try{n=this.predicate.call(this.thisArg,e,this.count++)}catch(s){return void this.destination.error(s)}n&&this.destination.next(e)}}function pd(t){return function(n){const s=new UP(t),c=n.lift(s);return s.caught=c}}class UP{constructor(e){this.selector=e}call(e,n){return n.subscribe(new jP(e,this.selector,this.caught))}}class jP extends Ro{constructor(e,n,s){super(e),this.selector=n,this.caught=s}error(e){if(!this.isStopped){let n;try{n=this.selector(e,this.caught)}catch(f){return void super.error(f)}this._unsubscribeAndRecycle();const s=new Ds(this);this.add(s);const c=uo(n,s);c!==s&&this.add(c)}}}function nf(t,e){return ir(t,e,1)}function W0(t){return function(n){return 0===t?q0():n.lift(new $P(t))}}class $P{constructor(e){if(this.total=e,this.total<0)throw new dC}call(e,n){return n.subscribe(new GP(e,this.total))}}class GP extends $n{constructor(e,n){super(e),this.total=n,this.ring=new Array,this.count=0}_next(e){const n=this.ring,s=this.total,c=this.count++;n.length<s?n.push(e):n[c%s]=e}_complete(){const e=this.destination;let n=this.count;if(n>0){const s=this.count>=this.total?this.total:this.count,c=this.ring;for(let f=0;f<s;f++){const y=n++%s;e.next(c[y])}}e.complete()}}function fC(t=ZP){return e=>e.lift(new HP(t))}class HP{constructor(e){this.errorFactory=e}call(e,n){return n.subscribe(new qP(e,this.errorFactory))}}class qP extends $n{constructor(e,n){super(e),this.errorFactory=n,this.hasValue=!1}_next(e){this.hasValue=!0,this.destination.next(e)}_complete(){if(this.hasValue)return this.destination.complete();{let e;try{e=this.errorFactory()}catch(n){e=n}this.destination.error(e)}}}function ZP(){return new jy}function mC(t=null){return e=>e.lift(new WP(t))}class WP{constructor(e){this.defaultValue=e}call(e,n){return n.subscribe(new XP(e,this.defaultValue))}}class XP extends $n{constructor(e,n){super(e),this.defaultValue=n,this.isEmpty=!0}_next(e){this.isEmpty=!1,this.destination.next(e)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function rf(t,e){const n=arguments.length>=2;return s=>s.pipe(t?dd((c,f)=>t(c,f,s)):Ti,Z0(1),n?mC(e):fC(()=>new jy))}function th(){}function Es(t,e,n){return function(c){return c.lift(new KP(t,e,n))}}class KP{constructor(e,n,s){this.nextOrObserver=e,this.error=n,this.complete=s}call(e,n){return n.subscribe(new JP(e,this.nextOrObserver,this.error,this.complete))}}class JP extends $n{constructor(e,n,s,c){super(e),this._tapNext=th,this._tapError=th,this._tapComplete=th,this._tapError=s||th,this._tapComplete=c||th,qa(n)?(this._context=this,this._tapNext=n):n&&(this._context=n,this._tapNext=n.next||th,this._tapError=n.error||th,this._tapComplete=n.complete||th)}_next(e){try{this._tapNext.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.next(e)}_error(e){try{this._tapError.call(this._context,e)}catch(n){return void this.destination.error(n)}this.destination.error(e)}_complete(){try{this._tapComplete.call(this._context)}catch(e){return void this.destination.error(e)}return this.destination.complete()}}class ek{constructor(e){this.callback=e}call(e,n){return n.subscribe(new tk(e,this.callback))}}class tk extends $n{constructor(e,n){super(e),this.add(new hn(n))}}class Fc{constructor(e,n){this.id=e,this.url=n}}class X0 extends Fc{constructor(e,n,s="imperative",c=null){super(e,n),this.navigationTrigger=s,this.restoredState=c}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class ag extends Fc{constructor(e,n,s){super(e,n),this.urlAfterRedirects=s}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class gC extends Fc{constructor(e,n,s){super(e,n),this.reason=s}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class nk extends Fc{constructor(e,n,s){super(e,n),this.error=s}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class rk extends Fc{constructor(e,n,s,c){super(e,n),this.urlAfterRedirects=s,this.state=c}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ik extends Fc{constructor(e,n,s,c){super(e,n),this.urlAfterRedirects=s,this.state=c}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ok extends Fc{constructor(e,n,s,c,f){super(e,n),this.urlAfterRedirects=s,this.state=c,this.shouldActivate=f}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class sk extends Fc{constructor(e,n,s,c){super(e,n),this.urlAfterRedirects=s,this.state=c}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class ak extends Fc{constructor(e,n,s,c){super(e,n),this.urlAfterRedirects=s,this.state=c}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class _C{constructor(e){this.route=e}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class yC{constructor(e){this.route=e}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class lk{constructor(e){this.snapshot=e}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class ck{constructor(e){this.snapshot=e}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class uk{constructor(e){this.snapshot=e}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class hk{constructor(e){this.snapshot=e}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class vC{constructor(e,n,s){this.routerEvent=e,this.position=n,this.anchor=s}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const un="primary";class dk{constructor(e){this.params=e||{}}has(e){return Object.prototype.hasOwnProperty.call(this.params,e)}get(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n[0]:n}return null}getAll(e){if(this.has(e)){const n=this.params[e];return Array.isArray(n)?n:[n]}return[]}get keys(){return Object.keys(this.params)}}function of(t){return new dk(t)}const xC="ngNavigationCancelingError";function Y0(t){const e=Error("NavigationCancelingError: "+t);return e[xC]=!0,e}function fk(t,e,n){const s=n.path.split("/");if(s.length>t.length||"full"===n.pathMatch&&(e.hasChildren()||s.length<t.length))return null;const c={};for(let f=0;f<s.length;f++){const y=s[f],E=t[f];if(y.startsWith(":"))c[y.substring(1)]=E;else if(y!==E.path)return null}return{consumed:t.slice(0,s.length),posParams:c}}function Rl(t,e){const n=t?Object.keys(t):void 0,s=e?Object.keys(e):void 0;if(!n||!s||n.length!=s.length)return!1;let c;for(let f=0;f<n.length;f++)if(c=n[f],!bC(t[c],e[c]))return!1;return!0}function bC(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),s=[...e].sort();return n.every((c,f)=>s[f]===c)}return t===e}function wC(t){return Array.prototype.concat.apply([],t)}function EC(t){return t.length>0?t[t.length-1]:null}function Vi(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function Fl(t){return ta(t)?t:Sc(t)?zn(Promise.resolve(t)):Yt(t)}const _k={exact:function DC(t,e,n){if(!md(t.segments,e.segments)||!$y(t.segments,e.segments,n)||t.numberOfChildren!==e.numberOfChildren)return!1;for(const s in e.children)if(!t.children[s]||!DC(t.children[s],e.children[s],n))return!1;return!0},subset:SC},CC={exact:function yk(t,e){return Rl(t,e)},subset:function vk(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>bC(t[n],e[n]))},ignored:()=>!0};function TC(t,e,n){return _k[n.paths](t.root,e.root,n.matrixParams)&&CC[n.queryParams](t.queryParams,e.queryParams)&&!("exact"===n.fragment&&t.fragment!==e.fragment)}function SC(t,e,n){return MC(t,e,e.segments,n)}function MC(t,e,n,s){if(t.segments.length>n.length){const c=t.segments.slice(0,n.length);return!(!md(c,n)||e.hasChildren()||!$y(c,n,s))}if(t.segments.length===n.length){if(!md(t.segments,n)||!$y(t.segments,n,s))return!1;for(const c in e.children)if(!t.children[c]||!SC(t.children[c],e.children[c],s))return!1;return!0}{const c=n.slice(0,t.segments.length),f=n.slice(t.segments.length);return!!(md(t.segments,c)&&$y(t.segments,c,s)&&t.children[un])&&MC(t.children[un],e,f,s)}}function $y(t,e,n){return e.every((s,c)=>CC[n](t[c].parameters,s.parameters))}class fd{constructor(e,n,s){this.root=e,this.queryParams=n,this.fragment=s}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=of(this.queryParams)),this._queryParamMap}toString(){return wk.serialize(this)}}class xn{constructor(e,n){this.segments=e,this.children=n,this.parent=null,Vi(n,(s,c)=>s.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return Gy(this)}}class lg{constructor(e,n){this.path=e,this.parameters=n}get parameterMap(){return this._parameterMap||(this._parameterMap=of(this.parameters)),this._parameterMap}toString(){return RC(this)}}function md(t,e){return t.length===e.length&&t.every((n,s)=>n.path===e[s].path)}class AC{}class IC{parse(e){const n=new Pk(e);return new fd(n.parseRootSegment(),n.parseQueryParams(),n.parseFragment())}serialize(e){const n=`/${cg(e.root,!0)}`,s=function Tk(t){const e=Object.keys(t).map(n=>{const s=t[n];return Array.isArray(s)?s.map(c=>`${Hy(n)}=${Hy(c)}`).join("&"):`${Hy(n)}=${Hy(s)}`}).filter(n=>!!n);return e.length?`?${e.join("&")}`:""}(e.queryParams),c="string"==typeof e.fragment?`#${function Ek(t){return encodeURI(t)}(e.fragment)}`:"";return`${n}${s}${c}`}}const wk=new IC;function Gy(t){return t.segments.map(e=>RC(e)).join("/")}function cg(t,e){if(!t.hasChildren())return Gy(t);if(e){const n=t.children[un]?cg(t.children[un],!1):"",s=[];return Vi(t.children,(c,f)=>{f!==un&&s.push(`${f}:${cg(c,!1)}`)}),s.length>0?`${n}(${s.join("//")})`:n}{const n=function bk(t,e){let n=[];return Vi(t.children,(s,c)=>{c===un&&(n=n.concat(e(s,c)))}),Vi(t.children,(s,c)=>{c!==un&&(n=n.concat(e(s,c)))}),n}(t,(s,c)=>c===un?[cg(t.children[un],!1)]:[`${c}:${cg(s,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children[un]?`${Gy(t)}/${n[0]}`:`${Gy(t)}/(${n.join("//")})`}}function PC(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function Hy(t){return PC(t).replace(/%3B/gi,";")}function K0(t){return PC(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function qy(t){return decodeURIComponent(t)}function kC(t){return qy(t.replace(/\+/g,"%20"))}function RC(t){return`${K0(t.path)}${function Ck(t){return Object.keys(t).map(e=>`;${K0(e)}=${K0(t[e])}`).join("")}(t.parameters)}`}const Dk=/^[^\/()?;=#]+/;function Zy(t){const e=t.match(Dk);return e?e[0]:""}const Sk=/^[^=?&#]+/,Ak=/^[^&#]+/;class Pk{constructor(e){this.url=e,this.remaining=e}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new xn([],{}):new xn([],this.parseChildren())}parseQueryParams(){const e={};if(this.consumeOptional("?"))do{this.parseQueryParam(e)}while(this.consumeOptional("&"));return e}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const e=[];for(this.peekStartsWith("(")||e.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),e.push(this.parseSegment());let n={};this.peekStartsWith("/(")&&(this.capture("/"),n=this.parseParens(!0));let s={};return this.peekStartsWith("(")&&(s=this.parseParens(!1)),(e.length>0||Object.keys(n).length>0)&&(s[un]=new xn(e,n)),s}parseSegment(){const e=Zy(this.remaining);if(""===e&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(e),new lg(qy(e),this.parseMatrixParams())}parseMatrixParams(){const e={};for(;this.consumeOptional(";");)this.parseParam(e);return e}parseParam(e){const n=Zy(this.remaining);if(!n)return;this.capture(n);let s="";if(this.consumeOptional("=")){const c=Zy(this.remaining);c&&(s=c,this.capture(s))}e[qy(n)]=qy(s)}parseQueryParam(e){const n=function Mk(t){const e=t.match(Sk);return e?e[0]:""}(this.remaining);if(!n)return;this.capture(n);let s="";if(this.consumeOptional("=")){const y=function Ik(t){const e=t.match(Ak);return e?e[0]:""}(this.remaining);y&&(s=y,this.capture(s))}const c=kC(n),f=kC(s);if(e.hasOwnProperty(c)){let y=e[c];Array.isArray(y)||(y=[y],e[c]=y),y.push(f)}else e[c]=f}parseParens(e){const n={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const s=Zy(this.remaining),c=this.remaining[s.length];if("/"!==c&&")"!==c&&";"!==c)throw new Error(`Cannot parse url '${this.url}'`);let f;s.indexOf(":")>-1?(f=s.substr(0,s.indexOf(":")),this.capture(f),this.capture(":")):e&&(f=un);const y=this.parseChildren();n[f]=1===Object.keys(y).length?y[un]:new xn([],y),this.consumeOptional("//")}return n}peekStartsWith(e){return this.remaining.startsWith(e)}consumeOptional(e){return!!this.peekStartsWith(e)&&(this.remaining=this.remaining.substring(e.length),!0)}capture(e){if(!this.consumeOptional(e))throw new Error(`Expected "${e}".`)}}class FC{constructor(e){this._root=e}get root(){return this._root.value}parent(e){const n=this.pathFromRoot(e);return n.length>1?n[n.length-2]:null}children(e){const n=J0(e,this._root);return n?n.children.map(s=>s.value):[]}firstChild(e){const n=J0(e,this._root);return n&&n.children.length>0?n.children[0].value:null}siblings(e){const n=Q0(e,this._root);return n.length<2?[]:n[n.length-2].children.map(c=>c.value).filter(c=>c!==e)}pathFromRoot(e){return Q0(e,this._root).map(n=>n.value)}}function J0(t,e){if(t===e.value)return e;for(const n of e.children){const s=J0(t,n);if(s)return s}return null}function Q0(t,e){if(t===e.value)return[e];for(const n of e.children){const s=Q0(t,n);if(s.length)return s.unshift(e),s}return[]}class Lc{constructor(e,n){this.value=e,this.children=n}toString(){return`TreeNode(${this.value})`}}function sf(t){const e={};return t&&t.children.forEach(n=>e[n.value.outlet]=n),e}class LC extends FC{constructor(e,n){super(e),this.snapshot=n,eb(this,e)}toString(){return this.snapshot.toString()}}function OC(t,e){const n=function kk(t,e){const y=new Wy([],{},{},"",{},un,e,null,t.root,-1,{});return new BC("",new Lc(y,[]))}(t,e),s=new Ha([new lg("",{})]),c=new Ha({}),f=new Ha({}),y=new Ha({}),E=new Ha(""),S=new af(s,c,y,E,f,un,e,n.root);return S.snapshot=n.root,new LC(new Lc(S,[]),n)}class af{constructor(e,n,s,c,f,y,E,S){this.url=e,this.params=n,this.queryParams=s,this.fragment=c,this.data=f,this.outlet=y,this.component=E,this._futureSnapshot=S}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Vt(e=>of(e)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Vt(e=>of(e)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function zC(t,e="emptyOnly"){const n=t.pathFromRoot;let s=0;if("always"!==e)for(s=n.length-1;s>=1;){const c=n[s],f=n[s-1];if(c.routeConfig&&""===c.routeConfig.path)s--;else{if(f.component)break;s--}}return function Rk(t){return t.reduce((e,n)=>({params:Object.assign(Object.assign({},e.params),n.params),data:Object.assign(Object.assign({},e.data),n.data),resolve:Object.assign(Object.assign({},e.resolve),n._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(s))}class Wy{constructor(e,n,s,c,f,y,E,S,R,N,$){this.url=e,this.params=n,this.queryParams=s,this.fragment=c,this.data=f,this.outlet=y,this.component=E,this.routeConfig=S,this._urlSegment=R,this._lastPathIndex=N,this._resolve=$}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=of(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=of(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(s=>s.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class BC extends FC{constructor(e,n){super(n),this.url=e,eb(this,n)}toString(){return NC(this._root)}}function eb(t,e){e.value._routerState=t,e.children.forEach(n=>eb(t,n))}function NC(t){const e=t.children.length>0?` { ${t.children.map(NC).join(", ")} } `:"";return`${t.value}${e}`}function tb(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Rl(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),Rl(e.params,n.params)||t.params.next(n.params),function mk(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Rl(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),Rl(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function nb(t,e){const n=Rl(t.params,e.params)&&function xk(t,e){return md(t,e)&&t.every((n,s)=>Rl(n.parameters,e[s].parameters))}(t.url,e.url);return n&&!(!t.parent!=!e.parent)&&(!t.parent||nb(t.parent,e.parent))}function ug(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const s=n.value;s._futureSnapshot=e.value;const c=function Lk(t,e,n){return e.children.map(s=>{for(const c of n.children)if(t.shouldReuseRoute(s.value,c.value.snapshot))return ug(t,s,c);return ug(t,s)})}(t,e,n);return new Lc(s,c)}{if(t.shouldAttach(e.value)){const f=t.retrieve(e.value);if(null!==f){const y=f.route;return y.value._futureSnapshot=e.value,y.children=e.children.map(E=>ug(t,E)),y}}const s=function Ok(t){return new af(new Ha(t.url),new Ha(t.params),new Ha(t.queryParams),new Ha(t.fragment),new Ha(t.data),t.outlet,t.component,t)}(e.value),c=e.children.map(f=>ug(t,f));return new Lc(s,c)}}function Xy(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function hg(t){return"object"==typeof t&&null!=t&&t.outlets}function rb(t,e,n,s,c){let f={};if(s&&Vi(s,(E,S)=>{f[S]=Array.isArray(E)?E.map(R=>`${R}`):`${E}`}),t===e)return new fd(n,f,c);const y=VC(t,e,n);return new fd(y,f,c)}function VC(t,e,n){const s={};return Vi(t.children,(c,f)=>{s[f]=c===e?n:VC(c,e,n)}),new xn(t.segments,s)}class UC{constructor(e,n,s){if(this.isAbsolute=e,this.numberOfDoubleDots=n,this.commands=s,e&&s.length>0&&Xy(s[0]))throw new Error("Root segment cannot have matrix parameters");const c=s.find(hg);if(c&&c!==EC(s))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class ib{constructor(e,n,s){this.segmentGroup=e,this.processChildren=n,this.index=s}}function jC(t,e,n){if(t||(t=new xn([],{})),0===t.segments.length&&t.hasChildren())return Yy(t,e,n);const s=function jk(t,e,n){let s=0,c=e;const f={match:!1,pathIndex:0,commandIndex:0};for(;c<t.segments.length;){if(s>=n.length)return f;const y=t.segments[c],E=n[s];if(hg(E))break;const S=`${E}`,R=s<n.length-1?n[s+1]:null;if(c>0&&void 0===S)break;if(S&&R&&"object"==typeof R&&void 0===R.outlets){if(!GC(S,R,y))return f;s+=2}else{if(!GC(S,{},y))return f;s++}c++}return{match:!0,pathIndex:c,commandIndex:s}}(t,e,n),c=n.slice(s.commandIndex);if(s.match&&s.pathIndex<t.segments.length){const f=new xn(t.segments.slice(0,s.pathIndex),{});return f.children[un]=new xn(t.segments.slice(s.pathIndex),t.children),Yy(f,0,c)}return s.match&&0===c.length?new xn(t.segments,{}):s.match&&!t.hasChildren()?ob(t,e,n):s.match?Yy(t,0,c):ob(t,e,n)}function Yy(t,e,n){if(0===n.length)return new xn(t.segments,{});{const s=function Uk(t){return hg(t[0])?t[0].outlets:{[un]:t}}(n),c={};return Vi(s,(f,y)=>{"string"==typeof f&&(f=[f]),null!==f&&(c[y]=jC(t.children[y],e,f))}),Vi(t.children,(f,y)=>{void 0===s[y]&&(c[y]=f)}),new xn(t.segments,c)}}function ob(t,e,n){const s=t.segments.slice(0,e);let c=0;for(;c<n.length;){const f=n[c];if(hg(f)){const S=$k(f.outlets);return new xn(s,S)}if(0===c&&Xy(n[0])){s.push(new lg(t.segments[e].path,$C(n[0]))),c++;continue}const y=hg(f)?f.outlets[un]:`${f}`,E=c<n.length-1?n[c+1]:null;y&&E&&Xy(E)?(s.push(new lg(y,$C(E))),c+=2):(s.push(new lg(y,{})),c++)}return new xn(s,{})}function $k(t){const e={};return Vi(t,(n,s)=>{"string"==typeof n&&(n=[n]),null!==n&&(e[s]=ob(new xn([],{}),0,n))}),e}function $C(t){const e={};return Vi(t,(n,s)=>e[s]=`${n}`),e}function GC(t,e,n){return t==n.path&&Rl(e,n.parameters)}class Hk{constructor(e,n,s,c){this.routeReuseStrategy=e,this.futureState=n,this.currState=s,this.forwardEvent=c}activate(e){const n=this.futureState._root,s=this.currState?this.currState._root:null;this.deactivateChildRoutes(n,s,e),tb(this.futureState.root),this.activateChildRoutes(n,s,e)}deactivateChildRoutes(e,n,s){const c=sf(n);e.children.forEach(f=>{const y=f.value.outlet;this.deactivateRoutes(f,c[y],s),delete c[y]}),Vi(c,(f,y)=>{this.deactivateRouteAndItsChildren(f,s)})}deactivateRoutes(e,n,s){const c=e.value,f=n?n.value:null;if(c===f)if(c.component){const y=s.getContext(c.outlet);y&&this.deactivateChildRoutes(e,n,y.children)}else this.deactivateChildRoutes(e,n,s);else f&&this.deactivateRouteAndItsChildren(n,s)}deactivateRouteAndItsChildren(e,n){e.value.component&&this.routeReuseStrategy.shouldDetach(e.value.snapshot)?this.detachAndStoreRouteSubtree(e,n):this.deactivateRouteAndOutlet(e,n)}detachAndStoreRouteSubtree(e,n){const s=n.getContext(e.value.outlet),c=s&&e.value.component?s.children:n,f=sf(e);for(const y of Object.keys(f))this.deactivateRouteAndItsChildren(f[y],c);if(s&&s.outlet){const y=s.outlet.detach(),E=s.children.onOutletDeactivated();this.routeReuseStrategy.store(e.value.snapshot,{componentRef:y,route:e,contexts:E})}}deactivateRouteAndOutlet(e,n){const s=n.getContext(e.value.outlet),c=s&&e.value.component?s.children:n,f=sf(e);for(const y of Object.keys(f))this.deactivateRouteAndItsChildren(f[y],c);s&&s.outlet&&(s.outlet.deactivate(),s.children.onOutletDeactivated(),s.attachRef=null,s.resolver=null,s.route=null)}activateChildRoutes(e,n,s){const c=sf(n);e.children.forEach(f=>{this.activateRoutes(f,c[f.value.outlet],s),this.forwardEvent(new hk(f.value.snapshot))}),e.children.length&&this.forwardEvent(new ck(e.value.snapshot))}activateRoutes(e,n,s){const c=e.value,f=n?n.value:null;if(tb(c),c===f)if(c.component){const y=s.getOrCreateContext(c.outlet);this.activateChildRoutes(e,n,y.children)}else this.activateChildRoutes(e,n,s);else if(c.component){const y=s.getOrCreateContext(c.outlet);if(this.routeReuseStrategy.shouldAttach(c.snapshot)){const E=this.routeReuseStrategy.retrieve(c.snapshot);this.routeReuseStrategy.store(c.snapshot,null),y.children.onOutletReAttached(E.contexts),y.attachRef=E.componentRef,y.route=E.route.value,y.outlet&&y.outlet.attach(E.componentRef,E.route.value),tb(E.route.value),this.activateChildRoutes(e,null,y.children)}else{const E=function qk(t){for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig;if(n&&n.component)return null}return null}(c.snapshot),S=E?E.module.componentFactoryResolver:null;y.attachRef=null,y.route=c,y.resolver=S,y.outlet&&y.outlet.activateWith(c,S),this.activateChildRoutes(e,null,y.children)}}else this.activateChildRoutes(e,null,s)}}class sb{constructor(e,n){this.routes=e,this.module=n}}function nh(t){return"function"==typeof t}function gd(t){return t instanceof fd}const dg=Symbol("INITIAL_VALUE");function pg(){return eh(t=>function DP(...t){let e,n;return Ko(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Po(t[0])&&(t=t[0]),Hi(t,n).lift(new SP(e))}(t.map(e=>e.pipe(Z0(1),function OP(...t){const e=t[t.length-1];return Ko(e)?(t.pop(),n=>H0(t,n,e)):n=>H0(t,n)}(dg)))).pipe(pC((e,n)=>{let s=!1;return n.reduce((c,f,y)=>c!==dg?c:(f===dg&&(s=!0),s||!1!==f&&y!==n.length-1&&!gd(f)?c:f),e)},dg),dd(e=>e!==dg),Vt(e=>gd(e)?e:!0===e),Z0(1)))}class Jk{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new fg,this.attachRef=null}}class fg{constructor(){this.contexts=new Map}onChildOutletCreated(e,n){const s=this.getOrCreateContext(e);s.outlet=n,this.contexts.set(e,s)}onChildOutletDestroyed(e){const n=this.getContext(e);n&&(n.outlet=null,n.attachRef=null)}onOutletDeactivated(){const e=this.contexts;return this.contexts=new Map,e}onOutletReAttached(e){this.contexts=e}getOrCreateContext(e){let n=this.getContext(e);return n||(n=new Jk,this.contexts.set(e,n)),n}getContext(e){return this.contexts.get(e)||null}}let ab=(()=>{class t{constructor(n,s,c,f,y){this.parentContexts=n,this.location=s,this.resolver=c,this.changeDetector=y,this.activated=null,this._activatedRoute=null,this.activateEvents=new Lr,this.deactivateEvents=new Lr,this.attachEvents=new Lr,this.detachEvents=new Lr,this.name=f||un,n.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const n=this.parentContexts.getContext(this.name);n&&n.route&&(n.attachRef?this.attach(n.attachRef,n.route):this.activateWith(n.route,n.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const n=this.activated;return this.activated=null,this._activatedRoute=null,this.detachEvents.emit(n.instance),n}attach(n,s){this.activated=n,this._activatedRoute=s,this.location.insert(n.hostView),this.attachEvents.emit(n.instance)}deactivate(){if(this.activated){const n=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(n)}}activateWith(n,s){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=n;const y=(s=s||this.resolver).resolveComponentFactory(n._futureSnapshot.routeConfig.component),E=this.parentContexts.getOrCreateContext(this.name).children,S=new Qk(n,E,this.location.injector);this.activated=this.location.createComponent(y,this.location.length,S),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(n){return new(n||t)(ze(fg),ze(ja),ze(Xm),Ie("name"),ze(by))},t.\u0275dir=St({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate",attachEvents:"attach",detachEvents:"detach"},exportAs:["outlet"]}),t})();class Qk{constructor(e,n,s){this.route=e,this.childContexts=n,this.parent=s}get(e,n){return e===af?this.route:e===fg?this.childContexts:this.parent.get(e,n)}}let HC=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ti({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(n,s){1&n&&kr(0,"router-outlet")},directives:[ab],encapsulation:2}),t})();function qC(t,e=""){for(let n=0;n<t.length;n++){const s=t[n];eR(s,tR(e,s))}}function eR(t,e){t.children&&qC(t.children,e)}function tR(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function lb(t){const e=t.children&&t.children.map(lb),n=e?Object.assign(Object.assign({},t),{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==un&&(n.component=HC),n}function oa(t){return t.outlet||un}function ZC(t,e){const n=t.filter(s=>oa(s)===e);return n.push(...t.filter(s=>oa(s)!==e)),n}const WC={matched:!1,consumedSegments:[],remainingSegments:[],parameters:{},positionalParamSegments:{}};function Ky(t,e,n){var s;if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?Object.assign({},WC):{matched:!0,consumedSegments:[],remainingSegments:n,parameters:{},positionalParamSegments:{}};const f=(e.matcher||fk)(n,t,e);if(!f)return Object.assign({},WC);const y={};Vi(f.posParams,(S,R)=>{y[R]=S.path});const E=f.consumed.length>0?Object.assign(Object.assign({},y),f.consumed[f.consumed.length-1].parameters):y;return{matched:!0,consumedSegments:f.consumed,remainingSegments:n.slice(f.consumed.length),parameters:E,positionalParamSegments:null!==(s=f.posParams)&&void 0!==s?s:{}}}function Jy(t,e,n,s,c="corrected"){if(n.length>0&&function iR(t,e,n){return n.some(s=>Qy(t,e,s)&&oa(s)!==un)}(t,n,s)){const y=new xn(e,function rR(t,e,n,s){const c={};c[un]=s,s._sourceSegment=t,s._segmentIndexShift=e.length;for(const f of n)if(""===f.path&&oa(f)!==un){const y=new xn([],{});y._sourceSegment=t,y._segmentIndexShift=e.length,c[oa(f)]=y}return c}(t,e,s,new xn(n,t.children)));return y._sourceSegment=t,y._segmentIndexShift=e.length,{segmentGroup:y,slicedSegments:[]}}if(0===n.length&&function oR(t,e,n){return n.some(s=>Qy(t,e,s))}(t,n,s)){const y=new xn(t.segments,function nR(t,e,n,s,c,f){const y={};for(const E of s)if(Qy(t,n,E)&&!c[oa(E)]){const S=new xn([],{});S._sourceSegment=t,S._segmentIndexShift="legacy"===f?t.segments.length:e.length,y[oa(E)]=S}return Object.assign(Object.assign({},c),y)}(t,e,n,s,t.children,c));return y._sourceSegment=t,y._segmentIndexShift=e.length,{segmentGroup:y,slicedSegments:n}}const f=new xn(t.segments,t.children);return f._sourceSegment=t,f._segmentIndexShift=e.length,{segmentGroup:f,slicedSegments:n}}function Qy(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function XC(t,e,n,s){return!!(oa(t)===s||s!==un&&Qy(e,n,t))&&("**"===t.path||Ky(e,t,n).matched)}function YC(t,e,n){return 0===e.length&&!t.children[n]}class ev{constructor(e){this.segmentGroup=e||null}}class KC{constructor(e){this.urlTree=e}}function mg(t){return Uy(new ev(t))}function JC(t){return Uy(new KC(t))}function sR(t){return Uy(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`))}class cR{constructor(e,n,s,c,f){this.configLoader=n,this.urlSerializer=s,this.urlTree=c,this.config=f,this.allowRedirects=!0,this.ngModule=e.get(Ic)}apply(){const e=Jy(this.urlTree.root,[],[],this.config).segmentGroup,n=new xn(e.segments,e.children);return this.expandSegmentGroup(this.ngModule,this.config,n,un).pipe(Vt(f=>this.createUrlTree(cb(f),this.urlTree.queryParams,this.urlTree.fragment))).pipe(pd(f=>{if(f instanceof KC)return this.allowRedirects=!1,this.match(f.urlTree);throw f instanceof ev?this.noMatchError(f):f}))}match(e){return this.expandSegmentGroup(this.ngModule,this.config,e.root,un).pipe(Vt(c=>this.createUrlTree(cb(c),e.queryParams,e.fragment))).pipe(pd(c=>{throw c instanceof ev?this.noMatchError(c):c}))}noMatchError(e){return new Error(`Cannot match any routes. URL Segment: '${e.segmentGroup}'`)}createUrlTree(e,n,s){const c=e.segments.length>0?new xn([],{[un]:e}):e;return new fd(c,n,s)}expandSegmentGroup(e,n,s,c){return 0===s.segments.length&&s.hasChildren()?this.expandChildren(e,n,s).pipe(Vt(f=>new xn([],f))):this.expandSegment(e,s,n,s.segments,c,!0)}expandChildren(e,n,s){const c=[];for(const f of Object.keys(s.children))"primary"===f?c.unshift(f):c.push(f);return zn(c).pipe(nf(f=>{const y=s.children[f],E=ZC(n,f);return this.expandSegmentGroup(e,E,y,f).pipe(Vt(S=>({segment:S,outlet:f})))}),pC((f,y)=>(f[y.outlet]=y.segment,f),{}),function YP(t,e){const n=arguments.length>=2;return s=>s.pipe(t?dd((c,f)=>t(c,f,s)):Ti,W0(1),n?mC(e):fC(()=>new jy))}())}expandSegment(e,n,s,c,f,y){return zn(s).pipe(nf(E=>this.expandSegmentAgainstRoute(e,n,s,E,c,f,y).pipe(pd(R=>{if(R instanceof ev)return Yt(null);throw R}))),rf(E=>!!E),pd((E,S)=>{if(E instanceof jy||"EmptyError"===E.name)return YC(n,c,f)?Yt(new xn([],{})):mg(n);throw E}))}expandSegmentAgainstRoute(e,n,s,c,f,y,E){return XC(c,n,f,y)?void 0===c.redirectTo?this.matchSegmentAgainstRoute(e,n,c,f,y):E&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(e,n,s,c,f,y):mg(n):mg(n)}expandSegmentAgainstRouteUsingRedirect(e,n,s,c,f,y){return"**"===c.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(e,s,c,y):this.expandRegularSegmentAgainstRouteUsingRedirect(e,n,s,c,f,y)}expandWildCardWithParamsAgainstRouteUsingRedirect(e,n,s,c){const f=this.applyRedirectCommands([],s.redirectTo,{});return s.redirectTo.startsWith("/")?JC(f):this.lineralizeSegments(s,f).pipe(ir(y=>{const E=new xn(y,{});return this.expandSegment(e,E,n,y,c,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(e,n,s,c,f,y){const{matched:E,consumedSegments:S,remainingSegments:R,positionalParamSegments:N}=Ky(n,c,f);if(!E)return mg(n);const $=this.applyRedirectCommands(S,c.redirectTo,N);return c.redirectTo.startsWith("/")?JC($):this.lineralizeSegments(c,$).pipe(ir(oe=>this.expandSegment(e,n,s,oe.concat(R),y,!1)))}matchSegmentAgainstRoute(e,n,s,c,f){if("**"===s.path)return s.loadChildren?(s._loadedConfig?Yt(s._loadedConfig):this.configLoader.load(e.injector,s)).pipe(Vt($=>(s._loadedConfig=$,new xn(c,{})))):Yt(new xn(c,{}));const{matched:y,consumedSegments:E,remainingSegments:S}=Ky(n,s,c);return y?this.getChildConfig(e,s,c).pipe(ir(N=>{const $=N.module,oe=N.routes,{segmentGroup:ae,slicedSegments:Ee}=Jy(n,E,S,oe),je=new xn(ae.segments,ae.children);if(0===Ee.length&&je.hasChildren())return this.expandChildren($,oe,je).pipe(Vt(bt=>new xn(E,bt)));if(0===oe.length&&0===Ee.length)return Yt(new xn(E,{}));const Qe=oa(s)===f;return this.expandSegment($,je,oe,Ee,Qe?un:f,!0).pipe(Vt(Fe=>new xn(E.concat(Fe.segments),Fe.children)))})):mg(n)}getChildConfig(e,n,s){return n.children?Yt(new sb(n.children,e)):n.loadChildren?void 0!==n._loadedConfig?Yt(n._loadedConfig):this.runCanLoadGuards(e.injector,n,s).pipe(ir(c=>c?this.configLoader.load(e.injector,n).pipe(Vt(f=>(n._loadedConfig=f,f))):function aR(t){return Uy(Y0(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`))}(n))):Yt(new sb([],e))}runCanLoadGuards(e,n,s){const c=n.canLoad;if(!c||0===c.length)return Yt(!0);const f=c.map(y=>{const E=e.get(y);let S;if(function Wk(t){return t&&nh(t.canLoad)}(E))S=E.canLoad(n,s);else{if(!nh(E))throw new Error("Invalid CanLoad guard");S=E(n,s)}return Fl(S)});return Yt(f).pipe(pg(),Es(y=>{if(!gd(y))return;const E=Y0(`Redirecting to "${this.urlSerializer.serialize(y)}"`);throw E.url=y,E}),Vt(y=>!0===y))}lineralizeSegments(e,n){let s=[],c=n.root;for(;;){if(s=s.concat(c.segments),0===c.numberOfChildren)return Yt(s);if(c.numberOfChildren>1||!c.children[un])return sR(e.redirectTo);c=c.children[un]}}applyRedirectCommands(e,n,s){return this.applyRedirectCreatreUrlTree(n,this.urlSerializer.parse(n),e,s)}applyRedirectCreatreUrlTree(e,n,s,c){const f=this.createSegmentGroup(e,n.root,s,c);return new fd(f,this.createQueryParams(n.queryParams,this.urlTree.queryParams),n.fragment)}createQueryParams(e,n){const s={};return Vi(e,(c,f)=>{if("string"==typeof c&&c.startsWith(":")){const E=c.substring(1);s[f]=n[E]}else s[f]=c}),s}createSegmentGroup(e,n,s,c){const f=this.createSegments(e,n.segments,s,c);let y={};return Vi(n.children,(E,S)=>{y[S]=this.createSegmentGroup(e,E,s,c)}),new xn(f,y)}createSegments(e,n,s,c){return n.map(f=>f.path.startsWith(":")?this.findPosParam(e,f,c):this.findOrReturn(f,s))}findPosParam(e,n,s){const c=s[n.path.substring(1)];if(!c)throw new Error(`Cannot redirect to '${e}'. Cannot find '${n.path}'.`);return c}findOrReturn(e,n){let s=0;for(const c of n){if(c.path===e.path)return n.splice(s),c;s++}return e}}function cb(t){const e={};for(const s of Object.keys(t.children)){const f=cb(t.children[s]);(f.segments.length>0||f.hasChildren())&&(e[s]=f)}return function uR(t){if(1===t.numberOfChildren&&t.children[un]){const e=t.children[un];return new xn(t.segments.concat(e.segments),e.children)}return t}(new xn(t.segments,e))}class QC{constructor(e){this.path=e,this.route=this.path[this.path.length-1]}}class tv{constructor(e,n){this.component=e,this.route=n}}function dR(t,e,n){const s=t._root;return gg(s,e?e._root:null,n,[s.value])}function nv(t,e,n){const s=function fR(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const n=e.routeConfig;if(n&&n._loadedConfig)return n._loadedConfig}return null}(e);return(s?s.module.injector:n).get(t)}function gg(t,e,n,s,c={canDeactivateChecks:[],canActivateChecks:[]}){const f=sf(e);return t.children.forEach(y=>{(function mR(t,e,n,s,c={canDeactivateChecks:[],canActivateChecks:[]}){const f=t.value,y=e?e.value:null,E=n?n.getContext(t.value.outlet):null;if(y&&f.routeConfig===y.routeConfig){const S=function gR(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!md(t.url,e.url);case"pathParamsOrQueryParamsChange":return!md(t.url,e.url)||!Rl(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!nb(t,e)||!Rl(t.queryParams,e.queryParams);default:return!nb(t,e)}}(y,f,f.routeConfig.runGuardsAndResolvers);S?c.canActivateChecks.push(new QC(s)):(f.data=y.data,f._resolvedData=y._resolvedData),gg(t,e,f.component?E?E.children:null:n,s,c),S&&E&&E.outlet&&E.outlet.isActivated&&c.canDeactivateChecks.push(new tv(E.outlet.component,y))}else y&&_g(e,E,c),c.canActivateChecks.push(new QC(s)),gg(t,null,f.component?E?E.children:null:n,s,c)})(y,f[y.value.outlet],n,s.concat([y.value]),c),delete f[y.value.outlet]}),Vi(f,(y,E)=>_g(y,n.getContext(E),c)),c}function _g(t,e,n){const s=sf(t),c=t.value;Vi(s,(f,y)=>{_g(f,c.component?e?e.children.getContext(y):null:e,n)}),n.canDeactivateChecks.push(new tv(c.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,c))}class TR{}function eT(t){return new kn(e=>e.error(t))}class SR{constructor(e,n,s,c,f,y){this.rootComponentType=e,this.config=n,this.urlTree=s,this.url=c,this.paramsInheritanceStrategy=f,this.relativeLinkResolution=y}recognize(){const e=Jy(this.urlTree.root,[],[],this.config.filter(y=>void 0===y.redirectTo),this.relativeLinkResolution).segmentGroup,n=this.processSegmentGroup(this.config,e,un);if(null===n)return null;const s=new Wy([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},un,this.rootComponentType,null,this.urlTree.root,-1,{}),c=new Lc(s,n),f=new BC(this.url,c);return this.inheritParamsAndData(f._root),f}inheritParamsAndData(e){const n=e.value,s=zC(n,this.paramsInheritanceStrategy);n.params=Object.freeze(s.params),n.data=Object.freeze(s.data),e.children.forEach(c=>this.inheritParamsAndData(c))}processSegmentGroup(e,n,s){return 0===n.segments.length&&n.hasChildren()?this.processChildren(e,n):this.processSegment(e,n,n.segments,s)}processChildren(e,n){const s=[];for(const f of Object.keys(n.children)){const y=n.children[f],E=ZC(e,f),S=this.processSegmentGroup(E,y,f);if(null===S)return null;s.push(...S)}const c=tT(s);return function MR(t){t.sort((e,n)=>e.value.outlet===un?-1:n.value.outlet===un?1:e.value.outlet.localeCompare(n.value.outlet))}(c),c}processSegment(e,n,s,c){for(const f of e){const y=this.processSegmentAgainstRoute(f,n,s,c);if(null!==y)return y}return YC(n,s,c)?[]:null}processSegmentAgainstRoute(e,n,s,c){if(e.redirectTo||!XC(e,n,s,c))return null;let f,y=[],E=[];if("**"===e.path){const ae=s.length>0?EC(s).parameters:{};f=new Wy(s,ae,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,iT(e),oa(e),e.component,e,nT(n),rT(n)+s.length,oT(e))}else{const ae=Ky(n,e,s);if(!ae.matched)return null;y=ae.consumedSegments,E=ae.remainingSegments,f=new Wy(y,ae.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,iT(e),oa(e),e.component,e,nT(n),rT(n)+y.length,oT(e))}const S=function AR(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(e),{segmentGroup:R,slicedSegments:N}=Jy(n,y,E,S.filter(ae=>void 0===ae.redirectTo),this.relativeLinkResolution);if(0===N.length&&R.hasChildren()){const ae=this.processChildren(S,R);return null===ae?null:[new Lc(f,ae)]}if(0===S.length&&0===N.length)return[new Lc(f,[])];const $=oa(e)===c,oe=this.processSegment(S,R,N,$?un:c);return null===oe?null:[new Lc(f,oe)]}}function IR(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function tT(t){const e=[],n=new Set;for(const s of t){if(!IR(s)){e.push(s);continue}const c=e.find(f=>s.value.routeConfig===f.value.routeConfig);void 0!==c?(c.children.push(...s.children),n.add(c)):e.push(s)}for(const s of n){const c=tT(s.children);e.push(new Lc(s.value,c))}return e.filter(s=>!n.has(s))}function nT(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function rT(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function iT(t){return t.data||{}}function oT(t){return t.resolve||{}}function sT(t){return[...Object.keys(t),...Object.getOwnPropertySymbols(t)]}function ub(t){return eh(e=>{const n=t(e);return n?zn(n).pipe(Vt(()=>e)):Yt(e)})}class BR extends class zR{shouldDetach(e){return!1}store(e,n){}shouldAttach(e){return!1}retrieve(e){return null}shouldReuseRoute(e,n){return e.routeConfig===n.routeConfig}}{}const hb=new qe("ROUTES");class aT{constructor(e,n,s,c){this.injector=e,this.compiler=n,this.onLoadStartListener=s,this.onLoadEndListener=c}load(e,n){if(n._loader$)return n._loader$;this.onLoadStartListener&&this.onLoadStartListener(n);const c=this.loadModuleFactory(n.loadChildren).pipe(Vt(f=>{this.onLoadEndListener&&this.onLoadEndListener(n);const y=f.create(e);return new sb(wC(y.injector.get(hb,void 0,Tt.Self|Tt.Optional)).map(lb),y)}),pd(f=>{throw n._loader$=void 0,f}));return n._loader$=new Bl(c,()=>new Ui).pipe(Qa()),n._loader$}loadModuleFactory(e){return Fl(e()).pipe(ir(n=>n instanceof Sw?Yt(n):zn(this.compiler.compileModuleAsync(n))))}}class VR{shouldProcessUrl(e){return!0}extract(e){return e}merge(e,n){return e}}function UR(t){throw t}function jR(t,e,n){return e.parse("/")}function lT(t,e){return Yt(null)}const $R={paths:"exact",fragment:"ignored",matrixParams:"ignored",queryParams:"exact"},GR={paths:"subset",fragment:"ignored",matrixParams:"ignored",queryParams:"subset"};let Cs=(()=>{class t{constructor(n,s,c,f,y,E,S){this.rootComponentType=n,this.urlSerializer=s,this.rootContexts=c,this.location=f,this.config=S,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.disposed=!1,this.navigationId=0,this.currentPageId=0,this.isNgZoneEnabled=!1,this.events=new Ui,this.errorHandler=UR,this.malformedUriErrorHandler=jR,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:lT,afterPreactivation:lT},this.urlHandlingStrategy=new VR,this.routeReuseStrategy=new BR,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.canceledNavigationResolution="replace",this.ngModule=y.get(Ic),this.console=y.get(MA);const $=y.get(Ni);this.isNgZoneEnabled=$ instanceof Ni&&Ni.isInAngularZone(),this.resetConfig(S),this.currentUrlTree=function gk(){return new fd(new xn([],{}),{},null)}(),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new aT(y,E,oe=>this.triggerEvent(new _C(oe)),oe=>this.triggerEvent(new yC(oe))),this.routerState=OC(this.currentUrlTree,this.rootComponentType),this.transitions=new Ha({id:0,targetPageId:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}get browserPageId(){var n;return null===(n=this.location.getState())||void 0===n?void 0:n.\u0275routerPageId}setupNavigations(n){const s=this.events;return n.pipe(dd(c=>0!==c.id),Vt(c=>Object.assign(Object.assign({},c),{extractedUrl:this.urlHandlingStrategy.extract(c.rawUrl)})),eh(c=>{let f=!1,y=!1;return Yt(c).pipe(Es(E=>{this.currentNavigation={id:E.id,initialUrl:E.currentRawUrl,extractedUrl:E.extractedUrl,trigger:E.source,extras:E.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),eh(E=>{const S=this.browserUrlTree.toString(),R=!this.navigated||E.extractedUrl.toString()!==S||S!==this.currentUrlTree.toString();if(("reload"===this.onSameUrlNavigation||R)&&this.urlHandlingStrategy.shouldProcessUrl(E.rawUrl))return cT(E.source)&&(this.browserUrlTree=E.extractedUrl),Yt(E).pipe(eh($=>{const oe=this.transitions.getValue();return s.next(new X0($.id,this.serializeUrl($.extractedUrl),$.source,$.restoredState)),oe!==this.transitions.getValue()?tf:Promise.resolve($)}),function hR(t,e,n,s){return eh(c=>function lR(t,e,n,s,c){return new cR(t,e,n,s,c).apply()}(t,e,n,c.extractedUrl,s).pipe(Vt(f=>Object.assign(Object.assign({},c),{urlAfterRedirects:f}))))}(this.ngModule.injector,this.configLoader,this.urlSerializer,this.config),Es($=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:$.urlAfterRedirects})}),function PR(t,e,n,s,c){return ir(f=>function DR(t,e,n,s,c="emptyOnly",f="legacy"){try{const y=new SR(t,e,n,s,c,f).recognize();return null===y?eT(new TR):Yt(y)}catch(y){return eT(y)}}(t,e,f.urlAfterRedirects,n(f.urlAfterRedirects),s,c).pipe(Vt(y=>Object.assign(Object.assign({},f),{targetSnapshot:y}))))}(this.rootComponentType,this.config,$=>this.serializeUrl($),this.paramsInheritanceStrategy,this.relativeLinkResolution),Es($=>{if("eager"===this.urlUpdateStrategy){if(!$.extras.skipLocationChange){const ae=this.urlHandlingStrategy.merge($.urlAfterRedirects,$.rawUrl);this.setBrowserUrl(ae,$)}this.browserUrlTree=$.urlAfterRedirects}const oe=new rk($.id,this.serializeUrl($.extractedUrl),this.serializeUrl($.urlAfterRedirects),$.targetSnapshot);s.next(oe)}));if(R&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:oe,extractedUrl:ae,source:Ee,restoredState:je,extras:Qe}=E,ot=new X0(oe,this.serializeUrl(ae),Ee,je);s.next(ot);const Fe=OC(ae,this.rootComponentType).snapshot;return Yt(Object.assign(Object.assign({},E),{targetSnapshot:Fe,urlAfterRedirects:ae,extras:Object.assign(Object.assign({},Qe),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=E.rawUrl,E.resolve(null),tf}),ub(E=>{const{targetSnapshot:S,id:R,extractedUrl:N,rawUrl:$,extras:{skipLocationChange:oe,replaceUrl:ae}}=E;return this.hooks.beforePreactivation(S,{navigationId:R,appliedUrlTree:N,rawUrlTree:$,skipLocationChange:!!oe,replaceUrl:!!ae})}),Es(E=>{const S=new ik(E.id,this.serializeUrl(E.extractedUrl),this.serializeUrl(E.urlAfterRedirects),E.targetSnapshot);this.triggerEvent(S)}),Vt(E=>Object.assign(Object.assign({},E),{guards:dR(E.targetSnapshot,E.currentSnapshot,this.rootContexts)})),function _R(t,e){return ir(n=>{const{targetSnapshot:s,currentSnapshot:c,guards:{canActivateChecks:f,canDeactivateChecks:y}}=n;return 0===y.length&&0===f.length?Yt(Object.assign(Object.assign({},n),{guardsResult:!0})):function yR(t,e,n,s){return zn(t).pipe(ir(c=>function CR(t,e,n,s,c){const f=e&&e.routeConfig?e.routeConfig.canDeactivate:null;return f&&0!==f.length?Yt(f.map(E=>{const S=nv(E,e,c);let R;if(function Kk(t){return t&&nh(t.canDeactivate)}(S))R=Fl(S.canDeactivate(t,e,n,s));else{if(!nh(S))throw new Error("Invalid CanDeactivate guard");R=Fl(S(t,e,n,s))}return R.pipe(rf())})).pipe(pg()):Yt(!0)}(c.component,c.route,n,e,s)),rf(c=>!0!==c,!0))}(y,s,c,t).pipe(ir(E=>E&&function Zk(t){return"boolean"==typeof t}(E)?function vR(t,e,n,s){return zn(e).pipe(nf(c=>H0(function bR(t,e){return null!==t&&e&&e(new lk(t)),Yt(!0)}(c.route.parent,s),function xR(t,e){return null!==t&&e&&e(new uk(t)),Yt(!0)}(c.route,s),function ER(t,e,n){const s=e[e.length-1],f=e.slice(0,e.length-1).reverse().map(y=>function pR(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(y)).filter(y=>null!==y).map(y=>hC(()=>Yt(y.guards.map(S=>{const R=nv(S,y.node,n);let N;if(function Yk(t){return t&&nh(t.canActivateChild)}(R))N=Fl(R.canActivateChild(s,t));else{if(!nh(R))throw new Error("Invalid CanActivateChild guard");N=Fl(R(s,t))}return N.pipe(rf())})).pipe(pg())));return Yt(f).pipe(pg())}(t,c.path,n),function wR(t,e,n){const s=e.routeConfig?e.routeConfig.canActivate:null;if(!s||0===s.length)return Yt(!0);const c=s.map(f=>hC(()=>{const y=nv(f,e,n);let E;if(function Xk(t){return t&&nh(t.canActivate)}(y))E=Fl(y.canActivate(e,t));else{if(!nh(y))throw new Error("Invalid CanActivate guard");E=Fl(y(e,t))}return E.pipe(rf())}));return Yt(c).pipe(pg())}(t,c.route,n))),rf(c=>!0!==c,!0))}(s,f,t,e):Yt(E)),Vt(E=>Object.assign(Object.assign({},n),{guardsResult:E})))})}(this.ngModule.injector,E=>this.triggerEvent(E)),Es(E=>{if(gd(E.guardsResult)){const R=Y0(`Redirecting to "${this.serializeUrl(E.guardsResult)}"`);throw R.url=E.guardsResult,R}const S=new ok(E.id,this.serializeUrl(E.extractedUrl),this.serializeUrl(E.urlAfterRedirects),E.targetSnapshot,!!E.guardsResult);this.triggerEvent(S)}),dd(E=>!!E.guardsResult||(this.restoreHistory(E),this.cancelNavigationTransition(E,""),!1)),ub(E=>{if(E.guards.canActivateChecks.length)return Yt(E).pipe(Es(S=>{const R=new sk(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(S.urlAfterRedirects),S.targetSnapshot);this.triggerEvent(R)}),eh(S=>{let R=!1;return Yt(S).pipe(function kR(t,e){return ir(n=>{const{targetSnapshot:s,guards:{canActivateChecks:c}}=n;if(!c.length)return Yt(n);let f=0;return zn(c).pipe(nf(y=>function RR(t,e,n,s){return function FR(t,e,n,s){const c=sT(t);if(0===c.length)return Yt({});const f={};return zn(c).pipe(ir(y=>function LR(t,e,n,s){const c=nv(t,e,s);return Fl(c.resolve?c.resolve(e,n):c(e,n))}(t[y],e,n,s).pipe(Es(E=>{f[y]=E}))),W0(1),ir(()=>sT(f).length===c.length?Yt(f):tf))}(t._resolve,t,e,s).pipe(Vt(f=>(t._resolvedData=f,t.data=Object.assign(Object.assign({},t.data),zC(t,n).resolve),null)))}(y.route,s,t,e)),Es(()=>f++),W0(1),ir(y=>f===c.length?Yt(n):tf))})}(this.paramsInheritanceStrategy,this.ngModule.injector),Es({next:()=>R=!0,complete:()=>{R||(this.restoreHistory(S),this.cancelNavigationTransition(S,"At least one route resolver didn't emit any value."))}}))}),Es(S=>{const R=new ak(S.id,this.serializeUrl(S.extractedUrl),this.serializeUrl(S.urlAfterRedirects),S.targetSnapshot);this.triggerEvent(R)}))}),ub(E=>{const{targetSnapshot:S,id:R,extractedUrl:N,rawUrl:$,extras:{skipLocationChange:oe,replaceUrl:ae}}=E;return this.hooks.afterPreactivation(S,{navigationId:R,appliedUrlTree:N,rawUrlTree:$,skipLocationChange:!!oe,replaceUrl:!!ae})}),Vt(E=>{const S=function Fk(t,e,n){const s=ug(t,e._root,n?n._root:void 0);return new LC(s,e)}(this.routeReuseStrategy,E.targetSnapshot,E.currentRouterState);return Object.assign(Object.assign({},E),{targetRouterState:S})}),Es(E=>{this.currentUrlTree=E.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(E.urlAfterRedirects,E.rawUrl),this.routerState=E.targetRouterState,"deferred"===this.urlUpdateStrategy&&(E.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,E),this.browserUrlTree=E.urlAfterRedirects)}),((t,e,n)=>Vt(s=>(new Hk(e,s.targetRouterState,s.currentRouterState,n).activate(t),s)))(this.rootContexts,this.routeReuseStrategy,E=>this.triggerEvent(E)),Es({next(){f=!0},complete(){f=!0}}),function QP(t){return e=>e.lift(new ek(t))}(()=>{var E;f||y||this.cancelNavigationTransition(c,`Navigation ID ${c.id} is not equal to the current navigation id ${this.navigationId}`),(null===(E=this.currentNavigation)||void 0===E?void 0:E.id)===c.id&&(this.currentNavigation=null)}),pd(E=>{if(y=!0,function pk(t){return t&&t[xC]}(E)){const S=gd(E.url);S||(this.navigated=!0,this.restoreHistory(c,!0));const R=new gC(c.id,this.serializeUrl(c.extractedUrl),E.message);s.next(R),S?setTimeout(()=>{const N=this.urlHandlingStrategy.merge(E.url,this.rawUrlTree),$={skipLocationChange:c.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy||cT(c.source)};this.scheduleNavigation(N,"imperative",null,$,{resolve:c.resolve,reject:c.reject,promise:c.promise})},0):c.resolve(!1)}else{this.restoreHistory(c,!0);const S=new nk(c.id,this.serializeUrl(c.extractedUrl),E);s.next(S);try{c.resolve(this.errorHandler(E))}catch(R){c.reject(R)}}return tf}))}))}resetRootComponentType(n){this.rootComponentType=n,this.routerState.root.component=this.rootComponentType}setTransition(n){this.transitions.next(Object.assign(Object.assign({},this.transitions.value),n))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(n=>{const s="popstate"===n.type?"popstate":"hashchange";"popstate"===s&&setTimeout(()=>{var c;const f={replaceUrl:!0},y=(null===(c=n.state)||void 0===c?void 0:c.navigationId)?n.state:null;if(y){const S=Object.assign({},y);delete S.navigationId,delete S.\u0275routerPageId,0!==Object.keys(S).length&&(f.state=S)}const E=this.parseUrl(n.url);this.scheduleNavigation(E,s,y,f)},0)}))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(n){this.events.next(n)}resetConfig(n){qC(n),this.config=n.map(lb),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.transitions.complete(),this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0),this.disposed=!0}createUrlTree(n,s={}){const{relativeTo:c,queryParams:f,fragment:y,queryParamsHandling:E,preserveFragment:S}=s,R=c||this.routerState.root,N=S?this.currentUrlTree.fragment:y;let $=null;switch(E){case"merge":$=Object.assign(Object.assign({},this.currentUrlTree.queryParams),f);break;case"preserve":$=this.currentUrlTree.queryParams;break;default:$=f||null}return null!==$&&($=this.removeEmptyProps($)),function zk(t,e,n,s,c){if(0===n.length)return rb(e.root,e.root,e.root,s,c);const f=function Bk(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new UC(!0,0,t);let e=0,n=!1;const s=t.reduce((c,f,y)=>{if("object"==typeof f&&null!=f){if(f.outlets){const E={};return Vi(f.outlets,(S,R)=>{E[R]="string"==typeof S?S.split("/"):S}),[...c,{outlets:E}]}if(f.segmentPath)return[...c,f.segmentPath]}return"string"!=typeof f?[...c,f]:0===y?(f.split("/").forEach((E,S)=>{0==S&&"."===E||(0==S&&""===E?n=!0:".."===E?e++:""!=E&&c.push(E))}),c):[...c,f]},[]);return new UC(n,e,s)}(n);if(f.toRoot())return rb(e.root,e.root,new xn([],{}),s,c);const y=function Nk(t,e,n){if(t.isAbsolute)return new ib(e.root,!0,0);if(-1===n.snapshot._lastPathIndex){const f=n.snapshot._urlSegment;return new ib(f,f===e.root,0)}const s=Xy(t.commands[0])?0:1;return function Vk(t,e,n){let s=t,c=e,f=n;for(;f>c;){if(f-=c,s=s.parent,!s)throw new Error("Invalid number of '../'");c=s.segments.length}return new ib(s,!1,c-f)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+s,t.numberOfDoubleDots)}(f,e,t),E=y.processChildren?Yy(y.segmentGroup,y.index,f.commands):jC(y.segmentGroup,y.index,f.commands);return rb(e.root,y.segmentGroup,E,s,c)}(R,this.currentUrlTree,n,$,null!=N?N:null)}navigateByUrl(n,s={skipLocationChange:!1}){const c=gd(n)?n:this.parseUrl(n),f=this.urlHandlingStrategy.merge(c,this.rawUrlTree);return this.scheduleNavigation(f,"imperative",null,s)}navigate(n,s={skipLocationChange:!1}){return function HR(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(n),this.navigateByUrl(this.createUrlTree(n,s),s)}serializeUrl(n){return this.urlSerializer.serialize(n)}parseUrl(n){let s;try{s=this.urlSerializer.parse(n)}catch(c){s=this.malformedUriErrorHandler(c,this.urlSerializer,n)}return s}isActive(n,s){let c;if(c=!0===s?Object.assign({},$R):!1===s?Object.assign({},GR):s,gd(n))return TC(this.currentUrlTree,n,c);const f=this.parseUrl(n);return TC(this.currentUrlTree,f,c)}removeEmptyProps(n){return Object.keys(n).reduce((s,c)=>{const f=n[c];return null!=f&&(s[c]=f),s},{})}processNavigations(){this.navigations.subscribe(n=>{this.navigated=!0,this.lastSuccessfulId=n.id,this.currentPageId=n.targetPageId,this.events.next(new ag(n.id,this.serializeUrl(n.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,n.resolve(!0)},n=>{this.console.warn(`Unhandled Navigation Error: ${n}`)})}scheduleNavigation(n,s,c,f,y){var E,S;if(this.disposed)return Promise.resolve(!1);let R,N,$;y?(R=y.resolve,N=y.reject,$=y.promise):$=new Promise((Ee,je)=>{R=Ee,N=je});const oe=++this.navigationId;let ae;return"computed"===this.canceledNavigationResolution?(0===this.currentPageId&&(c=this.location.getState()),ae=c&&c.\u0275routerPageId?c.\u0275routerPageId:f.replaceUrl||f.skipLocationChange?null!==(E=this.browserPageId)&&void 0!==E?E:0:(null!==(S=this.browserPageId)&&void 0!==S?S:0)+1):ae=0,this.setTransition({id:oe,targetPageId:ae,source:s,restoredState:c,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:n,extras:f,resolve:R,reject:N,promise:$,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),$.catch(Ee=>Promise.reject(Ee))}setBrowserUrl(n,s){const c=this.urlSerializer.serialize(n),f=Object.assign(Object.assign({},s.extras.state),this.generateNgRouterState(s.id,s.targetPageId));this.location.isCurrentPathEqualTo(c)||s.extras.replaceUrl?this.location.replaceState(c,"",f):this.location.go(c,"",f)}restoreHistory(n,s=!1){var c,f;if("computed"===this.canceledNavigationResolution){const y=this.currentPageId-n.targetPageId;"popstate"!==n.source&&"eager"!==this.urlUpdateStrategy&&this.currentUrlTree!==(null===(c=this.currentNavigation)||void 0===c?void 0:c.finalUrl)||0===y?this.currentUrlTree===(null===(f=this.currentNavigation)||void 0===f?void 0:f.finalUrl)&&0===y&&(this.resetState(n),this.browserUrlTree=n.currentUrlTree,this.resetUrlToCurrentUrlTree()):this.location.historyGo(y)}else"replace"===this.canceledNavigationResolution&&(s&&this.resetState(n),this.resetUrlToCurrentUrlTree())}resetState(n){this.routerState=n.currentRouterState,this.currentUrlTree=n.currentUrlTree,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n.rawUrl)}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",this.generateNgRouterState(this.lastSuccessfulId,this.currentPageId))}cancelNavigationTransition(n,s){const c=new gC(n.id,this.serializeUrl(n.extractedUrl),s);this.triggerEvent(c),n.resolve(!1)}generateNgRouterState(n,s){return"computed"===this.canceledNavigationResolution?{navigationId:n,\u0275routerPageId:s}:{navigationId:n}}}return t.\u0275fac=function(n){Mr()},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();function cT(t){return"imperative"!==t}let db=(()=>{class t{constructor(n,s,c,f,y){this.router=n,this.route=s,this.tabIndexAttribute=c,this.renderer=f,this.el=y,this.commands=null,this.onChanges=new Ui,this.setTabIndexIfNotOnNativeEl("0")}setTabIndexIfNotOnNativeEl(n){if(null!=this.tabIndexAttribute)return;const s=this.renderer,c=this.el.nativeElement;null!==n?s.setAttribute(c,"tabindex",n):s.removeAttribute(c,"tabindex")}ngOnChanges(n){this.onChanges.next(this)}set routerLink(n){null!=n?(this.commands=Array.isArray(n)?n:[n],this.setTabIndexIfNotOnNativeEl("0")):(this.commands=null,this.setTabIndexIfNotOnNativeEl(null))}onClick(){if(null===this.urlTree)return!0;const n={skipLocationChange:lf(this.skipLocationChange),replaceUrl:lf(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,n),!0}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:lf(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(ze(Cs),ze(af),Ie("tabindex"),ze(Ac),ze(bs))},t.\u0275dir=St({type:t,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(n,s){1&n&&Rr("click",function(){return s.onClick()})},inputs:{queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[si]}),t})(),rv=(()=>{class t{constructor(n,s,c){this.router=n,this.route=s,this.locationStrategy=c,this.commands=null,this.href=null,this.onChanges=new Ui,this.subscription=n.events.subscribe(f=>{f instanceof ag&&this.updateTargetUrlAndHref()})}set routerLink(n){this.commands=null!=n?Array.isArray(n)?n:[n]:null}ngOnChanges(n){this.updateTargetUrlAndHref(),this.onChanges.next(this)}ngOnDestroy(){this.subscription.unsubscribe()}onClick(n,s,c,f,y){if(0!==n||s||c||f||y||"string"==typeof this.target&&"_self"!=this.target||null===this.urlTree)return!0;const E={skipLocationChange:lf(this.skipLocationChange),replaceUrl:lf(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,E),!1}updateTargetUrlAndHref(){this.href=null!==this.urlTree?this.locationStrategy.prepareExternalUrl(this.router.serializeUrl(this.urlTree)):null}get urlTree(){return null===this.commands?null:this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:lf(this.preserveFragment)})}}return t.\u0275fac=function(n){return new(n||t)(ze(Cs),ze(af),ze(ef))},t.\u0275dir=St({type:t,selectors:[["a","routerLink",""],["area","routerLink",""]],hostVars:2,hostBindings:function(n,s){1&n&&Rr("click",function(f){return s.onClick(f.button,f.ctrlKey,f.shiftKey,f.altKey,f.metaKey)}),2&n&&xs("target",s.target)("href",s.href,Eu)},inputs:{target:"target",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo",routerLink:"routerLink"},features:[si]}),t})();function lf(t){return""===t||!!t}let uT=(()=>{class t{constructor(n,s,c,f,y,E){this.router=n,this.element=s,this.renderer=c,this.cdr=f,this.link=y,this.linkWithHref=E,this.classes=[],this.isActive=!1,this.routerLinkActiveOptions={exact:!1},this.isActiveChange=new Lr,this.routerEventsSubscription=n.events.subscribe(S=>{S instanceof ag&&this.update()})}ngAfterContentInit(){Yt(this.links.changes,this.linksWithHrefs.changes,Yt(null)).pipe(Or()).subscribe(n=>{this.update(),this.subscribeToEachLinkOnChanges()})}subscribeToEachLinkOnChanges(){var n;null===(n=this.linkInputChangesSubscription)||void 0===n||n.unsubscribe();const s=[...this.links.toArray(),...this.linksWithHrefs.toArray(),this.link,this.linkWithHref].filter(c=>!!c).map(c=>c.onChanges);this.linkInputChangesSubscription=zn(s).pipe(Or()).subscribe(c=>{this.isActive!==this.isLinkActive(this.router)(c)&&this.update()})}set routerLinkActive(n){const s=Array.isArray(n)?n:n.split(" ");this.classes=s.filter(c=>!!c)}ngOnChanges(n){this.update()}ngOnDestroy(){var n;this.routerEventsSubscription.unsubscribe(),null===(n=this.linkInputChangesSubscription)||void 0===n||n.unsubscribe()}update(){!this.links||!this.linksWithHrefs||!this.router.navigated||Promise.resolve().then(()=>{const n=this.hasActiveLinks();this.isActive!==n&&(this.isActive=n,this.cdr.markForCheck(),this.classes.forEach(s=>{n?this.renderer.addClass(this.element.nativeElement,s):this.renderer.removeClass(this.element.nativeElement,s)}),this.isActiveChange.emit(n))})}isLinkActive(n){const s=function qR(t){return!!t.paths}(this.routerLinkActiveOptions)?this.routerLinkActiveOptions:this.routerLinkActiveOptions.exact||!1;return c=>!!c.urlTree&&n.isActive(c.urlTree,s)}hasActiveLinks(){const n=this.isLinkActive(this.router);return this.link&&n(this.link)||this.linkWithHref&&n(this.linkWithHref)||this.links.some(n)||this.linksWithHrefs.some(n)}}return t.\u0275fac=function(n){return new(n||t)(ze(Cs),ze(bs),ze(Ac),ze(by),ze(db,8),ze(rv,8))},t.\u0275dir=St({type:t,selectors:[["","routerLinkActive",""]],contentQueries:function(n,s,c){if(1&n&&(Kx(c,db,5),Kx(c,rv,5)),2&n){let f;Yx(f=Jx())&&(s.links=f),Yx(f=Jx())&&(s.linksWithHrefs=f)}},inputs:{routerLinkActiveOptions:"routerLinkActiveOptions",routerLinkActive:"routerLinkActive"},outputs:{isActiveChange:"isActiveChange"},exportAs:["routerLinkActive"],features:[si]}),t})();class hT{}class dT{preload(e,n){return Yt(null)}}let pT=(()=>{class t{constructor(n,s,c,f){this.router=n,this.injector=c,this.preloadingStrategy=f,this.loader=new aT(c,s,S=>n.triggerEvent(new _C(S)),S=>n.triggerEvent(new yC(S)))}setUpPreloading(){this.subscription=this.router.events.pipe(dd(n=>n instanceof ag),nf(()=>this.preload())).subscribe(()=>{})}preload(){const n=this.injector.get(Ic);return this.processRoutes(n,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(n,s){const c=[];for(const f of s)if(f.loadChildren&&!f.canLoad&&f._loadedConfig){const y=f._loadedConfig;c.push(this.processRoutes(y.module,y.routes))}else f.loadChildren&&!f.canLoad?c.push(this.preloadConfig(n,f)):f.children&&c.push(this.processRoutes(n,f.children));return zn(c).pipe(Or(),Vt(f=>{}))}preloadConfig(n,s){return this.preloadingStrategy.preload(s,()=>(s._loadedConfig?Yt(s._loadedConfig):this.loader.load(n.injector,s)).pipe(ir(f=>(s._loadedConfig=f,this.processRoutes(f.module,f.routes)))))}}return t.\u0275fac=function(n){return new(n||t)(xt(Cs),xt(uE),xt(Oi),xt(hT))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})(),pb=(()=>{class t{constructor(n,s,c={}){this.router=n,this.viewportScroller=s,this.options=c,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},c.scrollPositionRestoration=c.scrollPositionRestoration||"disabled",c.anchorScrolling=c.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(n=>{n instanceof X0?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=n.navigationTrigger,this.restoredId=n.restoredState?n.restoredState.navigationId:0):n instanceof ag&&(this.lastId=n.id,this.scheduleScrollEvent(n,this.router.parseUrl(n.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(n=>{n instanceof vC&&(n.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(n.position):n.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(n.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(n,s){this.router.triggerEvent(new vC(n,"popstate"===this.lastSource?this.store[this.restoredId]:null,s))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(n){Mr()},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();const _d=new qe("ROUTER_CONFIGURATION"),fT=new qe("ROUTER_FORROOT_GUARD"),WR=[C0,{provide:AC,useClass:IC},{provide:Cs,useFactory:function eF(t,e,n,s,c,f,y={},E,S){const R=new Cs(null,t,e,n,s,c,wC(f));return E&&(R.urlHandlingStrategy=E),S&&(R.routeReuseStrategy=S),function tF(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy),t.canceledNavigationResolution&&(e.canceledNavigationResolution=t.canceledNavigationResolution)}(y,R),y.enableTracing&&R.events.subscribe(N=>{var $,oe;null===($=console.group)||void 0===$||$.call(console,`Router Event: ${N.constructor.name}`),console.log(N.toString()),console.log(N),null===(oe=console.groupEnd)||void 0===oe||oe.call(console)}),R},deps:[AC,fg,C0,Oi,uE,hb,_d,[class NR{},new js],[class OR{},new js]]},fg,{provide:af,useFactory:function nF(t){return t.routerState.root},deps:[Cs]},pT,dT,class ZR{preload(e,n){return n().pipe(pd(()=>Yt(null)))}},{provide:_d,useValue:{enableTracing:!1}}];function XR(){return new mE("Router",Cs)}let YR=(()=>{class t{constructor(n,s){}static forRoot(n,s){return{ngModule:t,providers:[WR,mT(n),{provide:fT,useFactory:QR,deps:[[Cs,new js,new $s]]},{provide:_d,useValue:s||{}},{provide:ef,useFactory:JR,deps:[hd,[new op(E0),new js],_d]},{provide:pb,useFactory:KR,deps:[Cs,N2,_d]},{provide:hT,useExisting:s&&s.preloadingStrategy?s.preloadingStrategy:dT},{provide:mE,multi:!0,useFactory:XR},[fb,{provide:s0,multi:!0,useFactory:rF,deps:[fb]},{provide:gT,useFactory:iF,deps:[fb]},{provide:cE,multi:!0,useExisting:gT}]]}}static forChild(n){return{ngModule:t,providers:[mT(n)]}}}return t.\u0275fac=function(n){return new(n||t)(xt(fT,8),xt(Cs,8))},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({}),t})();function KR(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new pb(t,e,n)}function JR(t,e,n={}){return n.useHash?new xI(t,e):new FE(t,e)}function QR(t){return"guarded"}function mT(t){return[{provide:Dt,multi:!0,useValue:t},{provide:hb,multi:!0,useValue:t}]}let fb=(()=>{class t{constructor(n){this.injector=n,this.initNavigation=!1,this.destroyed=!1,this.resultOfPreactivationDone=new Ui}appInitializer(){return this.injector.get(_I,Promise.resolve(null)).then(()=>{if(this.destroyed)return Promise.resolve(!0);let s=null;const c=new Promise(E=>s=E),f=this.injector.get(Cs),y=this.injector.get(_d);return"disabled"===y.initialNavigation?(f.setUpLocationChangeListener(),s(!0)):"enabled"===y.initialNavigation||"enabledBlocking"===y.initialNavigation?(f.hooks.afterPreactivation=()=>this.initNavigation?Yt(null):(this.initNavigation=!0,s(!0),this.resultOfPreactivationDone),f.initialNavigation()):s(!0),c})}bootstrapListener(n){const s=this.injector.get(_d),c=this.injector.get(pT),f=this.injector.get(pb),y=this.injector.get(Cs),E=this.injector.get(g0);n===E.components[0]&&(("enabledNonBlocking"===s.initialNavigation||void 0===s.initialNavigation)&&y.initialNavigation(),c.setUpPreloading(),f.init(),y.resetRootComponentType(E.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}ngOnDestroy(){this.destroyed=!0}}return t.\u0275fac=function(n){return new(n||t)(xt(Oi))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();function rF(t){return t.appInitializer.bind(t)}function iF(t){return t.bootstrapListener.bind(t)}const gT=new qe("Router Initializer");class _T{}class yT{}class Oc{constructor(e){this.normalizedNames=new Map,this.lazyUpdate=null,e?this.lazyInit="string"==typeof e?()=>{this.headers=new Map,e.split("\n").forEach(n=>{const s=n.indexOf(":");if(s>0){const c=n.slice(0,s),f=c.toLowerCase(),y=n.slice(s+1).trim();this.maybeSetNormalizedName(c,f),this.headers.has(f)?this.headers.get(f).push(y):this.headers.set(f,[y])}})}:()=>{this.headers=new Map,Object.keys(e).forEach(n=>{let s=e[n];const c=n.toLowerCase();"string"==typeof s&&(s=[s]),s.length>0&&(this.headers.set(c,s),this.maybeSetNormalizedName(n,c))})}:this.headers=new Map}has(e){return this.init(),this.headers.has(e.toLowerCase())}get(e){this.init();const n=this.headers.get(e.toLowerCase());return n&&n.length>0?n[0]:null}keys(){return this.init(),Array.from(this.normalizedNames.values())}getAll(e){return this.init(),this.headers.get(e.toLowerCase())||null}append(e,n){return this.clone({name:e,value:n,op:"a"})}set(e,n){return this.clone({name:e,value:n,op:"s"})}delete(e,n){return this.clone({name:e,value:n,op:"d"})}maybeSetNormalizedName(e,n){this.normalizedNames.has(n)||this.normalizedNames.set(n,e)}init(){this.lazyInit&&(this.lazyInit instanceof Oc?this.copyFrom(this.lazyInit):this.lazyInit(),this.lazyInit=null,this.lazyUpdate&&(this.lazyUpdate.forEach(e=>this.applyUpdate(e)),this.lazyUpdate=null))}copyFrom(e){e.init(),Array.from(e.headers.keys()).forEach(n=>{this.headers.set(n,e.headers.get(n)),this.normalizedNames.set(n,e.normalizedNames.get(n))})}clone(e){const n=new Oc;return n.lazyInit=this.lazyInit&&this.lazyInit instanceof Oc?this.lazyInit:this,n.lazyUpdate=(this.lazyUpdate||[]).concat([e]),n}applyUpdate(e){const n=e.name.toLowerCase();switch(e.op){case"a":case"s":let s=e.value;if("string"==typeof s&&(s=[s]),0===s.length)return;this.maybeSetNormalizedName(e.name,n);const c=("a"===e.op?this.headers.get(n):void 0)||[];c.push(...s),this.headers.set(n,c);break;case"d":const f=e.value;if(f){let y=this.headers.get(n);if(!y)return;y=y.filter(E=>-1===f.indexOf(E)),0===y.length?(this.headers.delete(n),this.normalizedNames.delete(n)):this.headers.set(n,y)}else this.headers.delete(n),this.normalizedNames.delete(n)}}forEach(e){this.init(),Array.from(this.normalizedNames.keys()).forEach(n=>e(this.normalizedNames.get(n),this.headers.get(n)))}}class sF{encodeKey(e){return vT(e)}encodeValue(e){return vT(e)}decodeKey(e){return decodeURIComponent(e)}decodeValue(e){return decodeURIComponent(e)}}const lF=/%(\d[a-f0-9])/gi,cF={40:"@","3A":":",24:"$","2C":",","3B":";","2B":"+","3D":"=","3F":"?","2F":"/"};function vT(t){return encodeURIComponent(t).replace(lF,(e,n)=>{var s;return null!==(s=cF[n])&&void 0!==s?s:e})}function xT(t){return`${t}`}class rh{constructor(e={}){if(this.updates=null,this.cloneFrom=null,this.encoder=e.encoder||new sF,e.fromString){if(e.fromObject)throw new Error("Cannot specify both fromString and fromObject.");this.map=function aF(t,e){const n=new Map;return t.length>0&&t.replace(/^\?/,"").split("&").forEach(c=>{const f=c.indexOf("="),[y,E]=-1==f?[e.decodeKey(c),""]:[e.decodeKey(c.slice(0,f)),e.decodeValue(c.slice(f+1))],S=n.get(y)||[];S.push(E),n.set(y,S)}),n}(e.fromString,this.encoder)}else e.fromObject?(this.map=new Map,Object.keys(e.fromObject).forEach(n=>{const s=e.fromObject[n];this.map.set(n,Array.isArray(s)?s:[s])})):this.map=null}has(e){return this.init(),this.map.has(e)}get(e){this.init();const n=this.map.get(e);return n?n[0]:null}getAll(e){return this.init(),this.map.get(e)||null}keys(){return this.init(),Array.from(this.map.keys())}append(e,n){return this.clone({param:e,value:n,op:"a"})}appendAll(e){const n=[];return Object.keys(e).forEach(s=>{const c=e[s];Array.isArray(c)?c.forEach(f=>{n.push({param:s,value:f,op:"a"})}):n.push({param:s,value:c,op:"a"})}),this.clone(n)}set(e,n){return this.clone({param:e,value:n,op:"s"})}delete(e,n){return this.clone({param:e,value:n,op:"d"})}toString(){return this.init(),this.keys().map(e=>{const n=this.encoder.encodeKey(e);return this.map.get(e).map(s=>n+"="+this.encoder.encodeValue(s)).join("&")}).filter(e=>""!==e).join("&")}clone(e){const n=new rh({encoder:this.encoder});return n.cloneFrom=this.cloneFrom||this,n.updates=(this.updates||[]).concat(e),n}init(){null===this.map&&(this.map=new Map),null!==this.cloneFrom&&(this.cloneFrom.init(),this.cloneFrom.keys().forEach(e=>this.map.set(e,this.cloneFrom.map.get(e))),this.updates.forEach(e=>{switch(e.op){case"a":case"s":const n=("a"===e.op?this.map.get(e.param):void 0)||[];n.push(xT(e.value)),this.map.set(e.param,n);break;case"d":if(void 0===e.value){this.map.delete(e.param);break}{let s=this.map.get(e.param)||[];const c=s.indexOf(xT(e.value));-1!==c&&s.splice(c,1),s.length>0?this.map.set(e.param,s):this.map.delete(e.param)}}}),this.cloneFrom=this.updates=null)}}class uF{constructor(){this.map=new Map}set(e,n){return this.map.set(e,n),this}get(e){return this.map.has(e)||this.map.set(e,e.defaultValue()),this.map.get(e)}delete(e){return this.map.delete(e),this}has(e){return this.map.has(e)}keys(){return this.map.keys()}}function bT(t){return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer}function wT(t){return"undefined"!=typeof Blob&&t instanceof Blob}function ET(t){return"undefined"!=typeof FormData&&t instanceof FormData}class yg{constructor(e,n,s,c){let f;if(this.url=n,this.body=null,this.reportProgress=!1,this.withCredentials=!1,this.responseType="json",this.method=e.toUpperCase(),function hF(t){switch(t){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||c?(this.body=void 0!==s?s:null,f=c):f=s,f&&(this.reportProgress=!!f.reportProgress,this.withCredentials=!!f.withCredentials,f.responseType&&(this.responseType=f.responseType),f.headers&&(this.headers=f.headers),f.context&&(this.context=f.context),f.params&&(this.params=f.params)),this.headers||(this.headers=new Oc),this.context||(this.context=new uF),this.params){const y=this.params.toString();if(0===y.length)this.urlWithParams=n;else{const E=n.indexOf("?");this.urlWithParams=n+(-1===E?"?":E<n.length-1?"&":"")+y}}else this.params=new rh,this.urlWithParams=n}serializeBody(){return null===this.body?null:bT(this.body)||wT(this.body)||ET(this.body)||function dF(t){return"undefined"!=typeof URLSearchParams&&t instanceof URLSearchParams}(this.body)||"string"==typeof this.body?this.body:this.body instanceof rh?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()}detectContentTypeHeader(){return null===this.body||ET(this.body)?null:wT(this.body)?this.body.type||null:bT(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof rh?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||"boolean"==typeof this.body?"application/json":null}clone(e={}){var n;const s=e.method||this.method,c=e.url||this.url,f=e.responseType||this.responseType,y=void 0!==e.body?e.body:this.body,E=void 0!==e.withCredentials?e.withCredentials:this.withCredentials,S=void 0!==e.reportProgress?e.reportProgress:this.reportProgress;let R=e.headers||this.headers,N=e.params||this.params;const $=null!==(n=e.context)&&void 0!==n?n:this.context;return void 0!==e.setHeaders&&(R=Object.keys(e.setHeaders).reduce((oe,ae)=>oe.set(ae,e.setHeaders[ae]),R)),e.setParams&&(N=Object.keys(e.setParams).reduce((oe,ae)=>oe.set(ae,e.setParams[ae]),N)),new yg(s,c,y,{params:N,headers:R,context:$,reportProgress:S,responseType:f,withCredentials:E})}}var Kr=(()=>((Kr=Kr||{})[Kr.Sent=0]="Sent",Kr[Kr.UploadProgress=1]="UploadProgress",Kr[Kr.ResponseHeader=2]="ResponseHeader",Kr[Kr.DownloadProgress=3]="DownloadProgress",Kr[Kr.Response=4]="Response",Kr[Kr.User=5]="User",Kr))();class mb{constructor(e,n=200,s="OK"){this.headers=e.headers||new Oc,this.status=void 0!==e.status?e.status:n,this.statusText=e.statusText||s,this.url=e.url||null,this.ok=this.status>=200&&this.status<300}}class gb extends mb{constructor(e={}){super(e),this.type=Kr.ResponseHeader}clone(e={}){return new gb({headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class iv extends mb{constructor(e={}){super(e),this.type=Kr.Response,this.body=void 0!==e.body?e.body:null}clone(e={}){return new iv({body:void 0!==e.body?e.body:this.body,headers:e.headers||this.headers,status:void 0!==e.status?e.status:this.status,statusText:e.statusText||this.statusText,url:e.url||this.url||void 0})}}class CT extends mb{constructor(e){super(e,0,"Unknown Error"),this.name="HttpErrorResponse",this.ok=!1,this.message=this.status>=200&&this.status<300?`Http failure during parsing for ${e.url||"(unknown url)"}`:`Http failure response for ${e.url||"(unknown url)"}: ${e.status} ${e.statusText}`,this.error=e.error||null}}function _b(t,e){return{body:e,headers:t.headers,context:t.context,observe:t.observe,params:t.params,reportProgress:t.reportProgress,responseType:t.responseType,withCredentials:t.withCredentials}}let ov=(()=>{class t{constructor(n){this.handler=n}request(n,s,c={}){let f;if(n instanceof yg)f=n;else{let S,R;S=c.headers instanceof Oc?c.headers:new Oc(c.headers),c.params&&(R=c.params instanceof rh?c.params:new rh({fromObject:c.params})),f=new yg(n,s,void 0!==c.body?c.body:null,{headers:S,context:c.context,params:R,reportProgress:c.reportProgress,responseType:c.responseType||"json",withCredentials:c.withCredentials})}const y=Yt(f).pipe(nf(S=>this.handler.handle(S)));if(n instanceof yg||"events"===c.observe)return y;const E=y.pipe(dd(S=>S instanceof iv));switch(c.observe||"body"){case"body":switch(f.responseType){case"arraybuffer":return E.pipe(Vt(S=>{if(null!==S.body&&!(S.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return S.body}));case"blob":return E.pipe(Vt(S=>{if(null!==S.body&&!(S.body instanceof Blob))throw new Error("Response is not a Blob.");return S.body}));case"text":return E.pipe(Vt(S=>{if(null!==S.body&&"string"!=typeof S.body)throw new Error("Response is not a string.");return S.body}));default:return E.pipe(Vt(S=>S.body))}case"response":return E;default:throw new Error(`Unreachable: unhandled observe type ${c.observe}}`)}}delete(n,s={}){return this.request("DELETE",n,s)}get(n,s={}){return this.request("GET",n,s)}head(n,s={}){return this.request("HEAD",n,s)}jsonp(n,s){return this.request("JSONP",n,{params:(new rh).append(s,"JSONP_CALLBACK"),observe:"body",responseType:"json"})}options(n,s={}){return this.request("OPTIONS",n,s)}patch(n,s,c={}){return this.request("PATCH",n,_b(c,s))}post(n,s,c={}){return this.request("POST",n,_b(c,s))}put(n,s,c={}){return this.request("PUT",n,_b(c,s))}}return t.\u0275fac=function(n){return new(n||t)(xt(_T))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();class TT{constructor(e,n){this.next=e,this.interceptor=n}handle(e){return this.interceptor.intercept(e,this.next)}}const DT=new qe("HTTP_INTERCEPTORS");let pF=(()=>{class t{intercept(n,s){return s.handle(n)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();const fF=/^\)\]\}',?\n/;let ST=(()=>{class t{constructor(n){this.xhrFactory=n}handle(n){if("JSONP"===n.method)throw new Error("Attempted to construct Jsonp request without HttpClientJsonpModule installed.");return new kn(s=>{const c=this.xhrFactory.build();if(c.open(n.method,n.urlWithParams),n.withCredentials&&(c.withCredentials=!0),n.headers.forEach((ae,Ee)=>c.setRequestHeader(ae,Ee.join(","))),n.headers.has("Accept")||c.setRequestHeader("Accept","application/json, text/plain, */*"),!n.headers.has("Content-Type")){const ae=n.detectContentTypeHeader();null!==ae&&c.setRequestHeader("Content-Type",ae)}if(n.responseType){const ae=n.responseType.toLowerCase();c.responseType="json"!==ae?ae:"text"}const f=n.serializeBody();let y=null;const E=()=>{if(null!==y)return y;const ae=c.statusText||"OK",Ee=new Oc(c.getAllResponseHeaders()),je=function mF(t){return"responseURL"in t&&t.responseURL?t.responseURL:/^X-Request-URL:/m.test(t.getAllResponseHeaders())?t.getResponseHeader("X-Request-URL"):null}(c)||n.url;return y=new gb({headers:Ee,status:c.status,statusText:ae,url:je}),y},S=()=>{let{headers:ae,status:Ee,statusText:je,url:Qe}=E(),ot=null;204!==Ee&&(ot=void 0===c.response?c.responseText:c.response),0===Ee&&(Ee=ot?200:0);let Fe=Ee>=200&&Ee<300;if("json"===n.responseType&&"string"==typeof ot){const bt=ot;ot=ot.replace(fF,"");try{ot=""!==ot?JSON.parse(ot):null}catch(Kt){ot=bt,Fe&&(Fe=!1,ot={error:Kt,text:ot})}}Fe?(s.next(new iv({body:ot,headers:ae,status:Ee,statusText:je,url:Qe||void 0})),s.complete()):s.error(new CT({error:ot,headers:ae,status:Ee,statusText:je,url:Qe||void 0}))},R=ae=>{const{url:Ee}=E(),je=new CT({error:ae,status:c.status||0,statusText:c.statusText||"Unknown Error",url:Ee||void 0});s.error(je)};let N=!1;const $=ae=>{N||(s.next(E()),N=!0);let Ee={type:Kr.DownloadProgress,loaded:ae.loaded};ae.lengthComputable&&(Ee.total=ae.total),"text"===n.responseType&&!!c.responseText&&(Ee.partialText=c.responseText),s.next(Ee)},oe=ae=>{let Ee={type:Kr.UploadProgress,loaded:ae.loaded};ae.lengthComputable&&(Ee.total=ae.total),s.next(Ee)};return c.addEventListener("load",S),c.addEventListener("error",R),c.addEventListener("timeout",R),c.addEventListener("abort",R),n.reportProgress&&(c.addEventListener("progress",$),null!==f&&c.upload&&c.upload.addEventListener("progress",oe)),c.send(f),s.next({type:Kr.Sent}),()=>{c.removeEventListener("error",R),c.removeEventListener("abort",R),c.removeEventListener("load",S),c.removeEventListener("timeout",R),n.reportProgress&&(c.removeEventListener("progress",$),null!==f&&c.upload&&c.upload.removeEventListener("progress",oe)),c.readyState!==c.DONE&&c.abort()}})}}return t.\u0275fac=function(n){return new(n||t)(xt(KE))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})();const yb=new qe("XSRF_COOKIE_NAME"),vb=new qe("XSRF_HEADER_NAME");class MT{}let gF=(()=>{class t{constructor(n,s,c){this.doc=n,this.platform=s,this.cookieName=c,this.lastCookieString="",this.lastToken=null,this.parseCount=0}getToken(){if("server"===this.platform)return null;const n=this.doc.cookie||"";return n!==this.lastCookieString&&(this.parseCount++,this.lastToken=GE(n,this.cookieName),this.lastCookieString=n),this.lastToken}}return t.\u0275fac=function(n){return new(n||t)(xt(ws),xt(c0),xt(yb))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})(),xb=(()=>{class t{constructor(n,s){this.tokenService=n,this.headerName=s}intercept(n,s){const c=n.url.toLowerCase();if("GET"===n.method||"HEAD"===n.method||c.startsWith("http://")||c.startsWith("https://"))return s.handle(n);const f=this.tokenService.getToken();return null!==f&&!n.headers.has(this.headerName)&&(n=n.clone({headers:n.headers.set(this.headerName,f)})),s.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(xt(MT),xt(vb))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})(),_F=(()=>{class t{constructor(n,s){this.backend=n,this.injector=s,this.chain=null}handle(n){if(null===this.chain){const s=this.injector.get(DT,[]);this.chain=s.reduceRight((c,f)=>new TT(c,f),this.backend)}return this.chain.handle(n)}}return t.\u0275fac=function(n){return new(n||t)(xt(yT),xt(Oi))},t.\u0275prov=ke({token:t,factory:t.\u0275fac}),t})(),yF=(()=>{class t{static disable(){return{ngModule:t,providers:[{provide:xb,useClass:pF}]}}static withOptions(n={}){return{ngModule:t,providers:[n.cookieName?{provide:yb,useValue:n.cookieName}:[],n.headerName?{provide:vb,useValue:n.headerName}:[]]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({providers:[xb,{provide:DT,useExisting:xb,multi:!0},{provide:MT,useClass:gF},{provide:yb,useValue:"XSRF-TOKEN"},{provide:vb,useValue:"X-XSRF-TOKEN"}]}),t})(),vF=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({providers:[ov,{provide:_T,useClass:_F},ST,{provide:yT,useExisting:ST}],imports:[[yF.withOptions({cookieName:"XSRF-TOKEN",headerName:"X-XSRF-TOKEN"})]]}),t})();function sv(t,e){return new kn(n=>{const s=t.length;if(0===s)return void n.complete();const c=new Array(s);let f=0,y=0;for(let E=0;E<s;E++){const S=zn(t[E]);let R=!1;n.add(S.subscribe({next:N=>{R||(R=!0,y++),c[E]=N},error:N=>n.error(N),complete:()=>{f++,(f===s||!R)&&(y===s&&n.next(e?e.reduce((N,$,oe)=>(N[$]=c[oe],N),{}):c),n.complete())}}))}})}let AT=(()=>{class t{constructor(n,s){this._renderer=n,this._elementRef=s,this.onChange=c=>{},this.onTouched=()=>{}}setProperty(n,s){this._renderer.setProperty(this._elementRef.nativeElement,n,s)}registerOnTouched(n){this.onTouched=n}registerOnChange(n){this.onChange=n}setDisabledState(n){this.setProperty("disabled",n)}}return t.\u0275fac=function(n){return new(n||t)(ze(Ac),ze(bs))},t.\u0275dir=St({type:t}),t})(),yd=(()=>{class t extends AT{}return t.\u0275fac=function(){let e;return function(s){return(e||(e=ie(t)))(s||t)}}(),t.\u0275dir=St({type:t,features:[Fn]}),t})();const Ll=new qe("NgValueAccessor"),wF={provide:Ll,useExisting:Y(()=>vg),multi:!0},CF=new qe("CompositionEventMode");let vg=(()=>{class t extends AT{constructor(n,s,c){super(n,s),this._compositionMode=c,this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function EF(){const t=kl()?kl().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(n){this.setProperty("value",null==n?"":n)}_handleInput(n){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(n)}_compositionStart(){this._composing=!0}_compositionEnd(n){this._composing=!1,this._compositionMode&&this.onChange(n)}}return t.\u0275fac=function(n){return new(n||t)(ze(Ac),ze(bs),ze(CF,8))},t.\u0275dir=St({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(n,s){1&n&&Rr("input",function(f){return s._handleInput(f.target.value)})("blur",function(){return s.onTouched()})("compositionstart",function(){return s._compositionStart()})("compositionend",function(f){return s._compositionEnd(f.target.value)})},features:[wr([wF]),Fn]}),t})();const so=new qe("NgValidators"),oh=new qe("NgAsyncValidators");function FT(t){return function ih(t){return null==t||0===t.length}(t.value)?{required:!0}:null}function av(t){return null}function VT(t){return null!=t}function UT(t){const e=Sc(t)?zn(t):t;return ta(e),e}function jT(t){let e={};return t.forEach(n=>{e=null!=n?Object.assign(Object.assign({},e),n):e}),0===Object.keys(e).length?null:e}function $T(t,e){return e.map(n=>n(t))}function GT(t){return t.map(e=>function DF(t){return!t.validate}(e)?e:n=>e.validate(n))}function bb(t){return null!=t?function HT(t){if(!t)return null;const e=t.filter(VT);return 0==e.length?null:function(n){return jT($T(n,e))}}(GT(t)):null}function wb(t){return null!=t?function qT(t){if(!t)return null;const e=t.filter(VT);return 0==e.length?null:function(n){return function xF(...t){if(1===t.length){const e=t[0];if(Po(e))return sv(e,null);if(Jr(e)&&Object.getPrototypeOf(e)===Object.prototype){const n=Object.keys(e);return sv(n.map(s=>e[s]),n)}}if("function"==typeof t[t.length-1]){const e=t.pop();return sv(t=1===t.length&&Po(t[0])?t[0]:t,null).pipe(Vt(n=>e(...n)))}return sv(t,null)}($T(n,e).map(UT)).pipe(Vt(jT))}}(GT(t)):null}function ZT(t,e){return null===t?[e]:Array.isArray(t)?[...t,e]:[t,e]}function WT(t){return t._rawValidators}function XT(t){return t._rawAsyncValidators}function Eb(t){return t?Array.isArray(t)?t:[t]:[]}function lv(t,e){return Array.isArray(t)?t.includes(e):t===e}function YT(t,e){const n=Eb(e);return Eb(t).forEach(c=>{lv(n,c)||n.push(c)}),n}function KT(t,e){return Eb(e).filter(n=>!lv(t,n))}class JT{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(e){this._rawValidators=e||[],this._composedValidatorFn=bb(this._rawValidators)}_setAsyncValidators(e){this._rawAsyncValidators=e||[],this._composedAsyncValidatorFn=wb(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(e){this._onDestroyCallbacks.push(e)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(e=>e()),this._onDestroyCallbacks=[]}reset(e){this.control&&this.control.reset(e)}hasError(e,n){return!!this.control&&this.control.hasError(e,n)}getError(e,n){return this.control?this.control.getError(e,n):null}}class sh extends JT{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class Io extends JT{get formDirective(){return null}get path(){return null}}class QT{constructor(e){this._cd=e}is(e){var n,s,c;return"submitted"===e?!!(null===(n=this._cd)||void 0===n?void 0:n.submitted):!!(null===(c=null===(s=this._cd)||void 0===s?void 0:s.control)||void 0===c?void 0:c[e])}}let xg=(()=>{class t extends QT{constructor(n){super(n)}}return t.\u0275fac=function(n){return new(n||t)(ze(sh,2))},t.\u0275dir=St({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(n,s){2&n&&cy("ng-untouched",s.is("untouched"))("ng-touched",s.is("touched"))("ng-pristine",s.is("pristine"))("ng-dirty",s.is("dirty"))("ng-valid",s.is("valid"))("ng-invalid",s.is("invalid"))("ng-pending",s.is("pending"))},features:[Fn]}),t})(),bg=(()=>{class t extends QT{constructor(n){super(n)}}return t.\u0275fac=function(n){return new(n||t)(ze(Io,10))},t.\u0275dir=St({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:16,hostBindings:function(n,s){2&n&&cy("ng-untouched",s.is("untouched"))("ng-touched",s.is("touched"))("ng-pristine",s.is("pristine"))("ng-dirty",s.is("dirty"))("ng-valid",s.is("valid"))("ng-invalid",s.is("invalid"))("ng-pending",s.is("pending"))("ng-submitted",s.is("submitted"))},features:[Fn]}),t})();function uv(t,e){return[...e.path,t]}function wg(t,e){Db(t,e),e.valueAccessor.writeValue(t.value),function FF(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&tD(t,e)})}(t,e),function OF(t,e){const n=(s,c)=>{e.valueAccessor.writeValue(s),c&&e.viewToModelUpdate(s)};t.registerOnChange(n),e._registerOnDestroy(()=>{t._unregisterOnChange(n)})}(t,e),function LF(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&tD(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),function RF(t,e){if(e.valueAccessor.setDisabledState){const n=s=>{e.valueAccessor.setDisabledState(s)};t.registerOnDisabledChange(n),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(n)})}}(t,e)}function hv(t,e,n=!0){const s=()=>{};e.valueAccessor&&(e.valueAccessor.registerOnChange(s),e.valueAccessor.registerOnTouched(s)),pv(t,e),t&&(e._invokeOnDestroyCallbacks(),t._registerOnCollectionChange(()=>{}))}function dv(t,e){t.forEach(n=>{n.registerOnValidatorChange&&n.registerOnValidatorChange(e)})}function Db(t,e){const n=WT(t);null!==e.validator?t.setValidators(ZT(n,e.validator)):"function"==typeof n&&t.setValidators([n]);const s=XT(t);null!==e.asyncValidator?t.setAsyncValidators(ZT(s,e.asyncValidator)):"function"==typeof s&&t.setAsyncValidators([s]);const c=()=>t.updateValueAndValidity();dv(e._rawValidators,c),dv(e._rawAsyncValidators,c)}function pv(t,e){let n=!1;if(null!==t){if(null!==e.validator){const c=WT(t);if(Array.isArray(c)&&c.length>0){const f=c.filter(y=>y!==e.validator);f.length!==c.length&&(n=!0,t.setValidators(f))}}if(null!==e.asyncValidator){const c=XT(t);if(Array.isArray(c)&&c.length>0){const f=c.filter(y=>y!==e.asyncValidator);f.length!==c.length&&(n=!0,t.setAsyncValidators(f))}}}const s=()=>{};return dv(e._rawValidators,s),dv(e._rawAsyncValidators,s),n}function tD(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}function nD(t,e){Db(t,e)}function Sb(t,e){if(!t.hasOwnProperty("model"))return!1;const n=t.model;return!!n.isFirstChange()||!Object.is(e,n.currentValue)}function iD(t,e){t._syncPendingControls(),e.forEach(n=>{const s=n.control;"submit"===s.updateOn&&s._pendingChange&&(n.viewToModelUpdate(s._pendingValue),s._pendingChange=!1)})}function Mb(t,e){if(!e)return null;let n,s,c;return Array.isArray(e),e.forEach(f=>{f.constructor===vg?n=f:function NF(t){return Object.getPrototypeOf(t.constructor)===yd}(f)?s=f:c=f}),c||s||n||null}function Ab(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const Eg="VALID",fv="INVALID",cf="PENDING",Cg="DISABLED";function Pb(t){return(mv(t)?t.validators:t)||null}function oD(t){return Array.isArray(t)?bb(t):t||null}function kb(t,e){return(mv(e)?e.asyncValidators:t)||null}function sD(t){return Array.isArray(t)?wb(t):t||null}function mv(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}const aD=t=>t instanceof gv,Rb=t=>t instanceof Tg;function lD(t){return aD(t)?t.value:t.getRawValue()}function cD(t,e){const n=Rb(t),s=t.controls;if(!(n?Object.keys(s):s).length)throw new K(1e3,"");if(!s[e])throw new K(1001,"")}function uD(t,e){Rb(t),t._forEachChild((s,c)=>{if(void 0===e[c])throw new K(1002,"")})}class Fb{constructor(e,n){this._pendingDirty=!1,this._hasOwnPendingAsyncValidator=!1,this._pendingTouched=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=e,this._rawAsyncValidators=n,this._composedValidatorFn=oD(this._rawValidators),this._composedAsyncValidatorFn=sD(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(e){this._rawValidators=this._composedValidatorFn=e}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(e){this._rawAsyncValidators=this._composedAsyncValidatorFn=e}get parent(){return this._parent}get valid(){return this.status===Eg}get invalid(){return this.status===fv}get pending(){return this.status==cf}get disabled(){return this.status===Cg}get enabled(){return this.status!==Cg}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(e){this._rawValidators=e,this._composedValidatorFn=oD(e)}setAsyncValidators(e){this._rawAsyncValidators=e,this._composedAsyncValidatorFn=sD(e)}addValidators(e){this.setValidators(YT(e,this._rawValidators))}addAsyncValidators(e){this.setAsyncValidators(YT(e,this._rawAsyncValidators))}removeValidators(e){this.setValidators(KT(e,this._rawValidators))}removeAsyncValidators(e){this.setAsyncValidators(KT(e,this._rawAsyncValidators))}hasValidator(e){return lv(this._rawValidators,e)}hasAsyncValidator(e){return lv(this._rawAsyncValidators,e)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(e={}){this.touched=!0,this._parent&&!e.onlySelf&&this._parent.markAsTouched(e)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(e=>e.markAllAsTouched())}markAsUntouched(e={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(n=>{n.markAsUntouched({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}markAsDirty(e={}){this.pristine=!1,this._parent&&!e.onlySelf&&this._parent.markAsDirty(e)}markAsPristine(e={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(n=>{n.markAsPristine({onlySelf:!0})}),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}markAsPending(e={}){this.status=cf,!1!==e.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!e.onlySelf&&this._parent.markAsPending(e)}disable(e={}){const n=this._parentMarkedDirty(e.onlySelf);this.status=Cg,this.errors=null,this._forEachChild(s=>{s.disable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this._updateValue(),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(s=>s(!0))}enable(e={}){const n=this._parentMarkedDirty(e.onlySelf);this.status=Eg,this._forEachChild(s=>{s.enable(Object.assign(Object.assign({},e),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},e),{skipPristineCheck:n})),this._onDisabledChange.forEach(s=>s(!1))}_updateAncestors(e){this._parent&&!e.onlySelf&&(this._parent.updateValueAndValidity(e),e.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(e){this._parent=e}updateValueAndValidity(e={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),(this.status===Eg||this.status===cf)&&this._runAsyncValidator(e.emitEvent)),!1!==e.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!e.onlySelf&&this._parent.updateValueAndValidity(e)}_updateTreeValidity(e={emitEvent:!0}){this._forEachChild(n=>n._updateTreeValidity(e)),this.updateValueAndValidity({onlySelf:!0,emitEvent:e.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?Cg:Eg}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(e){if(this.asyncValidator){this.status=cf,this._hasOwnPendingAsyncValidator=!0;const n=UT(this.asyncValidator(this));this._asyncValidationSubscription=n.subscribe(s=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(s,{emitEvent:e})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(e,n={}){this.errors=e,this._updateControlsErrors(!1!==n.emitEvent)}get(e){return function VF(t,e,n){if(null==e||(Array.isArray(e)||(e=e.split(n)),Array.isArray(e)&&0===e.length))return null;let s=t;return e.forEach(c=>{s=Rb(s)?s.controls.hasOwnProperty(c)?s.controls[c]:null:(t=>t instanceof jF)(s)&&s.at(c)||null}),s}(this,e,".")}getError(e,n){const s=n?this.get(n):this;return s&&s.errors?s.errors[e]:null}hasError(e,n){return!!this.getError(e,n)}get root(){let e=this;for(;e._parent;)e=e._parent;return e}_updateControlsErrors(e){this.status=this._calculateStatus(),e&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(e)}_initObservables(){this.valueChanges=new Lr,this.statusChanges=new Lr}_calculateStatus(){return this._allControlsDisabled()?Cg:this.errors?fv:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(cf)?cf:this._anyControlsHaveStatus(fv)?fv:Eg}_anyControlsHaveStatus(e){return this._anyControls(n=>n.status===e)}_anyControlsDirty(){return this._anyControls(e=>e.dirty)}_anyControlsTouched(){return this._anyControls(e=>e.touched)}_updatePristine(e={}){this.pristine=!this._anyControlsDirty(),this._parent&&!e.onlySelf&&this._parent._updatePristine(e)}_updateTouched(e={}){this.touched=this._anyControlsTouched(),this._parent&&!e.onlySelf&&this._parent._updateTouched(e)}_isBoxedValue(e){return"object"==typeof e&&null!==e&&2===Object.keys(e).length&&"value"in e&&"disabled"in e}_registerOnCollectionChange(e){this._onCollectionChange=e}_setUpdateStrategy(e){mv(e)&&null!=e.updateOn&&(this._updateOn=e.updateOn)}_parentMarkedDirty(e){return!e&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class gv extends Fb{constructor(e=null,n,s){super(Pb(n),kb(s,n)),this.defaultValue=null,this._onChange=[],this._pendingChange=!1,this._applyFormState(e),this._setUpdateStrategy(n),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator}),mv(n)&&n.initialValueIsDefault&&(this.defaultValue=this._isBoxedValue(e)?e.value:e)}setValue(e,n={}){this.value=this._pendingValue=e,this._onChange.length&&!1!==n.emitModelToViewChange&&this._onChange.forEach(s=>s(this.value,!1!==n.emitViewToModelChange)),this.updateValueAndValidity(n)}patchValue(e,n={}){this.setValue(e,n)}reset(e=this.defaultValue,n={}){this._applyFormState(e),this.markAsPristine(n),this.markAsUntouched(n),this.setValue(this.value,n),this._pendingChange=!1}_updateValue(){}_anyControls(e){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(e){this._onChange.push(e)}_unregisterOnChange(e){Ab(this._onChange,e)}registerOnDisabledChange(e){this._onDisabledChange.push(e)}_unregisterOnDisabledChange(e){Ab(this._onDisabledChange,e)}_forEachChild(e){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(e){this._isBoxedValue(e)?(this.value=this._pendingValue=e.value,e.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=e}}class Tg extends Fb{constructor(e,n,s){super(Pb(n),kb(s,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}registerControl(e,n){return this.controls[e]?this.controls[e]:(this.controls[e]=n,n.setParent(this),n._registerOnCollectionChange(this._onCollectionChange),n)}addControl(e,n,s={}){this.registerControl(e,n),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}removeControl(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}setControl(e,n,s={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),delete this.controls[e],n&&this.registerControl(e,n),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}contains(e){return this.controls.hasOwnProperty(e)&&this.controls[e].enabled}setValue(e,n={}){uD(this,e),Object.keys(e).forEach(s=>{cD(this,s),this.controls[s].setValue(e[s],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){null!=e&&(Object.keys(e).forEach(s=>{this.controls[s]&&this.controls[s].patchValue(e[s],{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e={},n={}){this._forEachChild((s,c)=>{s.reset(e[c],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this._reduceChildren({},(e,n,s)=>(e[s]=lD(n),e))}_syncPendingControls(){let e=this._reduceChildren(!1,(n,s)=>!!s._syncPendingControls()||n);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){Object.keys(this.controls).forEach(n=>{const s=this.controls[n];s&&e(s,n)})}_setUpControls(){this._forEachChild(e=>{e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(e){for(const n of Object.keys(this.controls)){const s=this.controls[n];if(this.contains(n)&&e(s))return!0}return!1}_reduceValue(){return this._reduceChildren({},(e,n,s)=>((n.enabled||this.disabled)&&(e[s]=n.value),e))}_reduceChildren(e,n){let s=e;return this._forEachChild((c,f)=>{s=n(s,c,f)}),s}_allControlsDisabled(){for(const e of Object.keys(this.controls))if(this.controls[e].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}}class jF extends Fb{constructor(e,n,s){super(Pb(n),kb(s,n)),this.controls=e,this._initObservables(),this._setUpdateStrategy(n),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!this.asyncValidator})}at(e){return this.controls[e]}push(e,n={}){this.controls.push(e),this._registerControl(e),this.updateValueAndValidity({emitEvent:n.emitEvent}),this._onCollectionChange()}insert(e,n,s={}){this.controls.splice(e,0,n),this._registerControl(n),this.updateValueAndValidity({emitEvent:s.emitEvent})}removeAt(e,n={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),this.updateValueAndValidity({emitEvent:n.emitEvent})}setControl(e,n,s={}){this.controls[e]&&this.controls[e]._registerOnCollectionChange(()=>{}),this.controls.splice(e,1),n&&(this.controls.splice(e,0,n),this._registerControl(n)),this.updateValueAndValidity({emitEvent:s.emitEvent}),this._onCollectionChange()}get length(){return this.controls.length}setValue(e,n={}){uD(this,e),e.forEach((s,c)=>{cD(this,c),this.at(c).setValue(s,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n)}patchValue(e,n={}){null!=e&&(e.forEach((s,c)=>{this.at(c)&&this.at(c).patchValue(s,{onlySelf:!0,emitEvent:n.emitEvent})}),this.updateValueAndValidity(n))}reset(e=[],n={}){this._forEachChild((s,c)=>{s.reset(e[c],{onlySelf:!0,emitEvent:n.emitEvent})}),this._updatePristine(n),this._updateTouched(n),this.updateValueAndValidity(n)}getRawValue(){return this.controls.map(e=>lD(e))}clear(e={}){this.controls.length<1||(this._forEachChild(n=>n._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity({emitEvent:e.emitEvent}))}_syncPendingControls(){let e=this.controls.reduce((n,s)=>!!s._syncPendingControls()||n,!1);return e&&this.updateValueAndValidity({onlySelf:!0}),e}_forEachChild(e){this.controls.forEach((n,s)=>{e(n,s)})}_updateValue(){this.value=this.controls.filter(e=>e.enabled||this.disabled).map(e=>e.value)}_anyControls(e){return this.controls.some(n=>n.enabled&&e(n))}_setUpControls(){this._forEachChild(e=>this._registerControl(e))}_allControlsDisabled(){for(const e of this.controls)if(e.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(e){e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange)}}const $F={provide:Io,useExisting:Y(()=>Sg)},Dg=(()=>Promise.resolve(null))();let Sg=(()=>{class t extends Io{constructor(n,s){super(),this.submitted=!1,this._directives=new Set,this.ngSubmit=new Lr,this.form=new Tg({},bb(n),wb(s))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(n){Dg.then(()=>{const s=this._findContainer(n.path);n.control=s.registerControl(n.name,n.control),wg(n.control,n),n.control.updateValueAndValidity({emitEvent:!1}),this._directives.add(n)})}getControl(n){return this.form.get(n.path)}removeControl(n){Dg.then(()=>{const s=this._findContainer(n.path);s&&s.removeControl(n.name),this._directives.delete(n)})}addFormGroup(n){Dg.then(()=>{const s=this._findContainer(n.path),c=new Tg({});nD(c,n),s.registerControl(n.name,c),c.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(n){Dg.then(()=>{const s=this._findContainer(n.path);s&&s.removeControl(n.name)})}getFormGroup(n){return this.form.get(n.path)}updateModel(n,s){Dg.then(()=>{this.form.get(n.path).setValue(s)})}setValue(n){this.control.setValue(n)}onSubmit(n){return this.submitted=!0,iD(this.form,this._directives),this.ngSubmit.emit(n),!1}onReset(){this.resetForm()}resetForm(n){this.form.reset(n),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(n){return n.pop(),n.length?this.form.get(n):this.form}}return t.\u0275fac=function(n){return new(n||t)(ze(so,10),ze(oh,10))},t.\u0275dir=St({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(n,s){1&n&&Rr("submit",function(f){return s.onSubmit(f)})("reset",function(){return s.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[wr([$F]),Fn]}),t})();const HF={provide:sh,useExisting:Y(()=>_v)},pD=(()=>Promise.resolve(null))();let _v=(()=>{class t extends sh{constructor(n,s,c,f,y){super(),this._changeDetectorRef=y,this.control=new gv,this._registered=!1,this.update=new Lr,this._parent=n,this._setValidators(s),this._setAsyncValidators(c),this.valueAccessor=Mb(0,f)}ngOnChanges(n){if(this._checkForErrors(),!this._registered||"name"in n){if(this._registered&&(this._checkName(),this.formDirective)){const s=n.name.previousValue;this.formDirective.removeControl({name:s,path:this._getPath(s)})}this._setUpControl()}"isDisabled"in n&&this._updateDisabled(n),Sb(n,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._getPath(this.name)}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){wg(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(n){pD.then(()=>{var s;this.control.setValue(n,{emitViewToModelChange:!1}),null===(s=this._changeDetectorRef)||void 0===s||s.markForCheck()})}_updateDisabled(n){const s=n.isDisabled.currentValue,c=""===s||s&&"false"!==s;pD.then(()=>{var f;c&&!this.control.disabled?this.control.disable():!c&&this.control.disabled&&this.control.enable(),null===(f=this._changeDetectorRef)||void 0===f||f.markForCheck()})}_getPath(n){return this._parent?uv(n,this._parent):[n]}}return t.\u0275fac=function(n){return new(n||t)(ze(Io,9),ze(so,10),ze(oh,10),ze(Ll,10),ze(by,8))},t.\u0275dir=St({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[wr([HF]),Fn,si]}),t})(),Mg=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275dir=St({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})(),mD=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({}),t})();const Lb=new qe("NgModelWithFormControlWarning"),KF={provide:Io,useExisting:Y(()=>Ag)};let Ag=(()=>{class t extends Io{constructor(n,s){super(),this.validators=n,this.asyncValidators=s,this.submitted=!1,this._onCollectionChange=()=>this._updateDomValue(),this.directives=[],this.form=null,this.ngSubmit=new Lr,this._setValidators(n),this._setAsyncValidators(s)}ngOnChanges(n){this._checkFormPresent(),n.hasOwnProperty("form")&&(this._updateValidators(),this._updateDomValue(),this._updateRegistrations(),this._oldForm=this.form)}ngOnDestroy(){this.form&&(pv(this.form,this),this.form._onCollectionChange===this._onCollectionChange&&this.form._registerOnCollectionChange(()=>{}))}get formDirective(){return this}get control(){return this.form}get path(){return[]}addControl(n){const s=this.form.get(n.path);return wg(s,n),s.updateValueAndValidity({emitEvent:!1}),this.directives.push(n),s}getControl(n){return this.form.get(n.path)}removeControl(n){hv(n.control||null,n,!1),Ab(this.directives,n)}addFormGroup(n){this._setUpFormContainer(n)}removeFormGroup(n){this._cleanUpFormContainer(n)}getFormGroup(n){return this.form.get(n.path)}addFormArray(n){this._setUpFormContainer(n)}removeFormArray(n){this._cleanUpFormContainer(n)}getFormArray(n){return this.form.get(n.path)}updateModel(n,s){this.form.get(n.path).setValue(s)}onSubmit(n){return this.submitted=!0,iD(this.form,this.directives),this.ngSubmit.emit(n),!1}onReset(){this.resetForm()}resetForm(n){this.form.reset(n),this.submitted=!1}_updateDomValue(){this.directives.forEach(n=>{const s=n.control,c=this.form.get(n.path);s!==c&&(hv(s||null,n),aD(c)&&(wg(c,n),n.control=c))}),this.form._updateTreeValidity({emitEvent:!1})}_setUpFormContainer(n){const s=this.form.get(n.path);nD(s,n),s.updateValueAndValidity({emitEvent:!1})}_cleanUpFormContainer(n){if(this.form){const s=this.form.get(n.path);s&&function zF(t,e){return pv(t,e)}(s,n)&&s.updateValueAndValidity({emitEvent:!1})}}_updateRegistrations(){this.form._registerOnCollectionChange(this._onCollectionChange),this._oldForm&&this._oldForm._registerOnCollectionChange(()=>{})}_updateValidators(){Db(this.form,this),this._oldForm&&pv(this._oldForm,this)}_checkFormPresent(){}}return t.\u0275fac=function(n){return new(n||t)(ze(so,10),ze(oh,10))},t.\u0275dir=St({type:t,selectors:[["","formGroup",""]],hostBindings:function(n,s){1&n&&Rr("submit",function(f){return s.onSubmit(f)})("reset",function(){return s.onReset()})},inputs:{form:["formGroup","form"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[wr([KF]),Fn,si]}),t})();const eL={provide:sh,useExisting:Y(()=>yv)};let yv=(()=>{class t extends sh{constructor(n,s,c,f,y){super(),this._ngModelWarningConfig=y,this._added=!1,this.update=new Lr,this._ngModelWarningSent=!1,this._parent=n,this._setValidators(s),this._setAsyncValidators(c),this.valueAccessor=Mb(0,f)}set isDisabled(n){}ngOnChanges(n){this._added||this._setUpControl(),Sb(n,this.viewModel)&&(this.viewModel=this.model,this.formDirective.updateModel(this,this.model))}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}viewToModelUpdate(n){this.viewModel=n,this.update.emit(n)}get path(){return uv(null==this.name?this.name:this.name.toString(),this._parent)}get formDirective(){return this._parent?this._parent.formDirective:null}_checkParentType(){}_setUpControl(){this._checkParentType(),this.control=this.formDirective.addControl(this),this.control.disabled&&this.valueAccessor.setDisabledState&&this.valueAccessor.setDisabledState(!0),this._added=!0}}return t._ngModelWarningSentOnce=!1,t.\u0275fac=function(n){return new(n||t)(ze(Io,13),ze(so,10),ze(oh,10),ze(Ll,10),ze(Lb,8))},t.\u0275dir=St({type:t,selectors:[["","formControlName",""]],inputs:{name:["formControlName","name"],isDisabled:["disabled","isDisabled"],model:["ngModel","model"]},outputs:{update:"ngModelChange"},features:[wr([eL]),Fn,si]}),t})();const tL={provide:Ll,useExisting:Y(()=>uf),multi:!0};function xD(t,e){return null==t?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}let uf=(()=>{class t extends yd{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){this.value=n;const c=xD(this._getOptionId(n),n);this.setProperty("value",c)}registerOnChange(n){this.onChange=s=>{this.value=this._getOptionValue(s),n(this.value)}}_registerOption(){return(this._idCounter++).toString()}_getOptionId(n){for(const s of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(s),n))return s;return null}_getOptionValue(n){const s=function nL(t){return t.split(":")[0]}(n);return this._optionMap.has(s)?this._optionMap.get(s):n}}return t.\u0275fac=function(){let e;return function(s){return(e||(e=ie(t)))(s||t)}}(),t.\u0275dir=St({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(n,s){1&n&&Rr("change",function(f){return s.onChange(f.target.value)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[wr([tL]),Fn]}),t})(),vv=(()=>{class t{constructor(n,s,c){this._element=n,this._renderer=s,this._select=c,this._select&&(this.id=this._select._registerOption())}set ngValue(n){null!=this._select&&(this._select._optionMap.set(this.id,n),this._setElementValue(xD(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._setElementValue(n),this._select&&this._select.writeValue(this._select.value)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return t.\u0275fac=function(n){return new(n||t)(ze(bs),ze(Ac),ze(uf,9))},t.\u0275dir=St({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})();const rL={provide:Ll,useExisting:Y(()=>Bb),multi:!0};function bD(t,e){return null==t?`${e}`:("string"==typeof e&&(e=`'${e}'`),e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}let Bb=(()=>{class t extends yd{constructor(){super(...arguments),this._optionMap=new Map,this._idCounter=0,this._compareWith=Object.is}set compareWith(n){this._compareWith=n}writeValue(n){let s;if(this.value=n,Array.isArray(n)){const c=n.map(f=>this._getOptionId(f));s=(f,y)=>{f._setSelected(c.indexOf(y.toString())>-1)}}else s=(c,f)=>{c._setSelected(!1)};this._optionMap.forEach(s)}registerOnChange(n){this.onChange=s=>{const c=[],f=s.selectedOptions;if(void 0!==f){const y=f;for(let E=0;E<y.length;E++){const R=this._getOptionValue(y[E].value);c.push(R)}}else{const y=s.options;for(let E=0;E<y.length;E++){const S=y[E];if(S.selected){const R=this._getOptionValue(S.value);c.push(R)}}}this.value=c,n(c)}}_registerOption(n){const s=(this._idCounter++).toString();return this._optionMap.set(s,n),s}_getOptionId(n){for(const s of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(s)._value,n))return s;return null}_getOptionValue(n){const s=function iL(t){return t.split(":")[0]}(n);return this._optionMap.has(s)?this._optionMap.get(s)._value:n}}return t.\u0275fac=function(){let e;return function(s){return(e||(e=ie(t)))(s||t)}}(),t.\u0275dir=St({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(n,s){1&n&&Rr("change",function(f){return s.onChange(f.target)})("blur",function(){return s.onTouched()})},inputs:{compareWith:"compareWith"},features:[wr([rL]),Fn]}),t})(),xv=(()=>{class t{constructor(n,s,c){this._element=n,this._renderer=s,this._select=c,this._select&&(this.id=this._select._registerOption(this))}set ngValue(n){null!=this._select&&(this._value=n,this._setElementValue(bD(this.id,n)),this._select.writeValue(this._select.value))}set value(n){this._select?(this._value=n,this._setElementValue(bD(this.id,n)),this._select.writeValue(this._select.value)):this._setElementValue(n)}_setElementValue(n){this._renderer.setProperty(this._element.nativeElement,"value",n)}_setSelected(n){this._renderer.setProperty(this._element.nativeElement,"selected",n)}ngOnDestroy(){this._select&&(this._select._optionMap.delete(this.id),this._select.writeValue(this._select.value))}}return t.\u0275fac=function(n){return new(n||t)(ze(bs),ze(Ac),ze(Bb,9))},t.\u0275dir=St({type:t,selectors:[["option"]],inputs:{ngValue:"ngValue",value:"value"}}),t})(),vd=(()=>{class t{constructor(){this._validator=av}ngOnChanges(n){if(this.inputName in n){const s=this.normalizeInput(n[this.inputName].currentValue);this._enabled=this.enabled(s),this._validator=this._enabled?this.createValidator(s):av,this._onChange&&this._onChange()}}validate(n){return this._validator(n)}registerOnValidatorChange(n){this._onChange=n}enabled(n){return null!=n}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275dir=St({type:t,features:[si]}),t})();const lL={provide:so,useExisting:Y(()=>xd),multi:!0};let xd=(()=>{class t extends vd{constructor(){super(...arguments),this.inputName="required",this.normalizeInput=n=>function oL(t){return null!=t&&!1!==t&&"false"!=`${t}`}(n),this.createValidator=n=>FT}enabled(n){return n}}return t.\u0275fac=function(){let e;return function(s){return(e||(e=ie(t)))(s||t)}}(),t.\u0275dir=St({type:t,selectors:[["","required","","formControlName","",3,"type","checkbox"],["","required","","formControl","",3,"type","checkbox"],["","required","","ngModel","",3,"type","checkbox"]],hostVars:1,hostBindings:function(n,s){2&n&&xs("required",s._enabled?"":null)},inputs:{required:"required"},features:[wr([lL]),Fn]}),t})(),PD=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({imports:[[mD]]}),t})(),fL=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({imports:[PD]}),t})(),mL=(()=>{class t{static withConfig(n){return{ngModule:t,providers:[{provide:Lb,useValue:n.warnOnNgModelWithFormControl}]}}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=gi({type:t}),t.\u0275inj=wt({imports:[PD]}),t})();const gL=function(){return{exact:!0}};let _L=(()=>{class t{constructor(){this.title="gui-prototype"}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ti({type:t,selectors:[["app-root"]],decls:26,vars:2,consts:[[1,"header"],[1,"container"],[1,"row"],[1,"col-xs-12","col-sm-12","col-md-12","col-lg-12","col-xl-12"],[1,"nav","nav-tabs"],["role","presentation","routerLinkActive","active",3,"routerLinkActiveOptions"],["routerLink","/"],["role","presentation","routerLinkActive","active"],["routerLink","/maps"],["routerLink","/messages"],["routerLink","/uavInput"],["routerLink","/stations"],[1,"container-fluid","p-0"]],template:function(n,s){1&n&&(mt(0,"section",0)(1,"h1"),Xt(2,"PROTOTYPE GUI"),pt()(),mt(3,"div",1)(4,"div",2)(5,"div",3)(6,"ul",4)(7,"li",5)(8,"a",6),Xt(9,"Home"),pt()(),mt(10,"li",7)(11,"a",8),Xt(12,"Maps"),pt()(),mt(13,"li",7)(14,"a",9),Xt(15,"Messages"),pt()(),mt(16,"li",7)(17,"a",10),Xt(18,"UAV-Input"),pt()(),mt(19,"li",7)(20,"a",11),Xt(21,"Stations"),pt()()()()()(),kr(22,"br"),mt(23,"div",12)(24,"div"),kr(25,"router-outlet"),pt()()),2&n&&(In(7),vn("routerLinkActiveOptions",Pw(1,gL)))},directives:[uT,rv,ab],styles:[".header[_ngcontent-%COMP%]{top:0;width:100%;text-align:center;background-color:#28286c;color:#fff}"]}),t})(),Nb=(()=>{class t{constructor(n){this.http=n}createAndStoreUAVPost(n,s,c){this.http.post("https://uav-http-practice-default-rtdb.firebaseio.com/uavs.json",{name:n,batteryPercentage:s,station:c}).subscribe(y=>{console.log(y)})}fetchUAVPosts(){return this.http.get("https://uav-http-practice-default-rtdb.firebaseio.com/uavs.json").pipe(Vt(n=>{const s=[];for(const c in n)n.hasOwnProperty(c)&&s.push(Object.assign(Object.assign({},n[c]),{id:c}));return s}))}}return t.\u0275fac=function(n){return new(n||t)(xt(ov))},t.\u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"}),t})(),bv=(()=>{class t{constructor(n){this.http=n}createAndStoreStation(n,s){this.http.post("https://uav-http-practice-default-rtdb.firebaseio.com/stations.json",{name:n,status:s}).subscribe(f=>{console.log(f)})}fetchStations(){return this.http.get("https://uav-http-practice-default-rtdb.firebaseio.com/stations.json").pipe(Vt(n=>{const s=[];for(const c in n)n.hasOwnProperty(c)&&s.push(Object.assign(Object.assign({},n[c]),{id:c}));return s}))}fetchStationNames(){return this.http.get("https://uav-http-practice-default-rtdb.firebaseio.com/stations.json").pipe(Vt(n=>{const s=[];for(const c in n)n.hasOwnProperty(c)&&(s.push(n[c].name),console.log(n[c].name));return s}))}}return t.\u0275fac=function(n){return new(n||t)(xt(ov))},t.\u0275prov=ke({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();function yL(t,e){if(1&t&&(mt(0,"option",21),Xt(1),pt()),2&t){const n=e.$implicit;ly("value",n),In(1),Wp(n)}}function vL(t,e){if(1&t&&(mt(0,"select",18)(1,"option",19),Xt(2,"Select a Station"),pt(),se(3,yL,2,2,"option",20),pt()),2&t){const n=na();vn("ngModel",n.defaultStation),In(3),vn("ngForOf",n.stationNames)}}function xL(t,e){1&t&&(mt(0,"p"),Xt(1,"No Stations"),pt())}function bL(t,e){1&t&&(mt(0,"p"),Xt(1," No UAVs Stored"),pt())}function wL(t,e){if(1&t&&(mt(0,"li",24)(1,"h1"),Xt(2),pt()()),2&t){const n=e.$implicit;In(2),kx("ID: ",n.name," Battery: ",n.batteryPercentage,"")}}function EL(t,e){if(1&t&&(mt(0,"ul",22),se(1,wL,3,2,"li",23),pt()),2&t){const n=na();In(1),vn("ngForOf",n.loadedUAVs)}}let CL=(()=>{class t{constructor(n,s){this.postService=n,this.stationService=s,this.isFetchingUAVPosts=!1,this.isFetchingStationNames=!1,this.loadedUAVs=[],this.stationNames=[],this.defaultStation="default"}ngOnInit(){this.onFetchUAVPosts(),this.onFetchStationNames()}onCreateUAVPost(n){this.postService.createAndStoreUAVPost(n.name,n.batteryPercentage,n.station)}onFetchUAVPosts(){this.isFetchingUAVPosts=!0,this.postService.fetchUAVPosts().subscribe(n=>{this.isFetchingUAVPosts=!1,this.loadedUAVs=n})}onFetchStationNames(){this.isFetchingStationNames=!0,this.stationService.fetchStationNames().subscribe(n=>{this.isFetchingStationNames=!1,this.stationNames=n})}}return t.\u0275fac=function(n){return new(n||t)(ze(Nb),ze(bv))},t.\u0275cmp=ti({type:t,selectors:[["app-uav-input"]],decls:30,vars:5,consts:[[1,"container"],[1,"row"],[1,"col-xs-12","col-sm-10","col-md-6"],[3,"ngSubmit"],["postForm","ngForm"],[1,"form-group"],["for","Name"],["type","text","id","name","required","","ngModel","","name","name",1,"form-control"],["for","Battery Percentage"],["type","text","id","batteryPercentage","ngModel","","required","","name","batteryPercentage",1,"form-control"],["for","Station"],["id","station","class","form-control","name","station","required","",3,"ngModel",4,"ngIf","ngIfElse"],["noStations",""],["type","submit",1,"btn","btn-primary",3,"disabled"],[1,"col-xs-12","col-md-6"],[1,"btn","btn-primary",3,"click"],[4,"ngIf"],["class","list-group",4,"ngIf"],["id","station","name","station","required","",1,"form-control",3,"ngModel"],["value","default"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"list-group"],["class","list-group-item",4,"ngFor","ngForOf"],[1,"list-group-item"]],template:function(n,s){if(1&n){const c=ea();mt(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3,4),Rr("ngSubmit",function(){ru(c);const y=he(4);return s.onCreateUAVPost(y.value)}),mt(5,"div",5)(6,"label",6),Xt(7,"Name"),pt(),kr(8,"input",7),pt(),mt(9,"div",5)(10,"label",8),Xt(11,"Battery %"),pt(),kr(12,"input",9),pt(),mt(13,"div",5)(14,"label",10),Xt(15," Station "),pt(),se(16,vL,4,2,"select",11),se(17,xL,2,0,"ng-template",null,12,Qx),pt(),mt(19,"button",13),Xt(20," Enter UAV "),pt()()()(),kr(21,"hr"),mt(22,"div",1)(23,"div",14)(24,"button",15),Rr("click",function(){return s.onFetchUAVPosts()}),Xt(25," List UAVs "),pt()()(),mt(26,"div",1)(27,"div",14),se(28,bL,2,0,"p",16),se(29,EL,2,1,"ul",17),pt()()()}if(2&n){const c=he(4),f=he(18);In(16),vn("ngIf",s.stationNames.length>0)("ngIfElse",f),In(3),vn("disabled",!c.valid),In(9),vn("ngIf",s.loadedUAVs.length<1&&!s.isFetchingUAVPosts),In(1),vn("ngIf",s.loadedUAVs.length>0)}},directives:[Mg,bg,Sg,vg,xd,xg,_v,Oy,uf,vv,xv,Ly],styles:[""]}),t})();const wv_mapbox_accessToken="pk.eyJ1IjoiZGNvZmZleSIsImEiOiJjbDUxZDhhNXkwM3A4M2txcTZibWtxd2h2In0.vWxaiqzjSdyUiiobQ3XTdw";var Vb=Bc(898);let TL=(()=>{class t{constructor(){this.style="mapbox://styles/mapbox/streets-v11",this.lat=41.70503,this.lng=-86.241965}ngOnInit(){Vb.accessToken=wv_mapbox_accessToken,this.map=new Vb.Map({container:"map",style:this.style,zoom:15,center:[this.lng,this.lat]}),this.map.addControl(new Vb.NavigationControl)}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ti({type:t,selectors:[["app-maps"]],decls:2,vars:0,consts:[[1,"row","no-gutters","map-row"],["id","map",1,"map"]],template:function(n,s){1&n&&(mt(0,"div",0),kr(1,"div",1),pt())},styles:[".map-row[_ngcontent-%COMP%]{height:100%}"]}),t})(),DL=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ti({type:t,selectors:[["app-messages"]],decls:2,vars:0,template:function(n,s){1&n&&(mt(0,"p"),Xt(1,"messages works!"),pt())},styles:[""]}),t})();function SL(t,e){if(1&t&&(mt(0,"option",12),Xt(1),pt()),2&t){const n=na().$implicit;vn("ngValue",n),In(1),Wp(n.name)}}function ML(t,e){if(1&t&&(Yu(0),se(1,SL,2,2,"option",11),So()),2&t){const n=e.$implicit,s=na();In(1),vn("ngIf",n.station===s.currStation)}}function AL(t,e){if(1&t&&(mt(0,"div",13)(1,"h6"),Xt(2),pt()()),2&t){const n=na();In(2),Gm("Name: ",n.currUav.name,"")}}function IL(t,e){1&t&&(mt(0,"div",13)(1,"h6"),Xt(2,"Name: "),pt()())}function PL(t,e){if(1&t&&(mt(0,"div",13)(1,"h6"),Xt(2),pt()()),2&t){const n=na();In(2),Gm("Battery: ",n.currUav.batteryPercentage,"")}}function kL(t,e){1&t&&(mt(0,"div",13)(1,"h6"),Xt(2,"Battery: "),pt()())}let RL=(()=>{class t{constructor(n,s){this.postService=n,this.stationService=s,this.stationNames=[],this.uavs=[],this.defaultuav="default",this.currStation=""}ngOnInit(){this.fetchUAVs(),this.uavSelectForm=new Tg({UAV:new gv(this.defaultuav)})}fetchUAVs(){this.postService.fetchUAVPosts().subscribe(n=>{this.uavs=n})}setCurrUav(){var n;this.currUav=null===(n=this.uavSelectForm.get("UAV"))||void 0===n?void 0:n.value,console.log(this.currUav)}}return t.\u0275fac=function(n){return new(n||t)(ze(Nb),ze(bv))},t.\u0275cmp=ti({type:t,selectors:[["app-header"]],inputs:{currStation:"currStation"},decls:19,vars:7,consts:[[1,"container"],[1,"row"],[1,"col-xs-2","col-sm-2","col-md-2"],[3,"formGroup"],[1,"form-group"],["for","UAV"],["id","uav-selector","formControlName","UAV","name","uavSelector","required","",1,"form-control",3,"ngModelChange"],["value","default"],[4,"ngFor","ngForOf"],[1,"col-xs-1","col-sm-1","col-md-1"],["class","left",4,"ngIf"],[3,"ngValue",4,"ngIf"],[3,"ngValue"],[1,"left"]],template:function(n,s){1&n&&(mt(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),Xt(6,"UAV"),pt(),mt(7,"select",6),Rr("ngModelChange",function(){return s.setCurrUav()}),mt(8,"option",7),Xt(9,"Select a UAV"),pt(),se(10,ML,2,1,"ng-container",8),pt()()(),mt(11,"p"),Xt(12),pt()(),mt(13,"div",9),se(14,AL,3,1,"div",10),se(15,IL,3,0,"div",10),pt(),mt(16,"div",9),se(17,PL,3,1,"div",10),se(18,kL,3,0,"div",10),pt()()()),2&n&&(In(3),vn("formGroup",s.uavSelectForm),In(7),vn("ngForOf",s.uavs),In(2),Wp(s.currStation),In(2),vn("ngIf",null!=s.currUav),In(1),vn("ngIf",null==s.currUav),In(2),vn("ngIf",null!=s.currUav),In(1),vn("ngIf",null==s.currUav))},directives:[Mg,bg,Ag,uf,xg,yv,xd,vv,xv,Ly,Oy],styles:[".left[_ngcontent-%COMP%]{position:absolute;left:0}"]}),t})(),FL=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ti({type:t,selectors:[["app-video-feed"]],decls:2,vars:0,template:function(n,s){1&n&&(mt(0,"p"),Xt(1,"video-feed works!"),pt())},styles:[""]}),t})(),LL=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ti({type:t,selectors:[["app-uav-controls"]],decls:10,vars:0,consts:[[1,"btn","btn-primary"]],template:function(n,s){1&n&&(mt(0,"button",0),Xt(1,"Land"),pt(),mt(2,"button",0),Xt(3,"Hover"),pt(),mt(4,"button",0),Xt(5,"RTL"),pt(),mt(6,"button",0),Xt(7,"Details"),pt(),mt(8,"button",0),Xt(9,"Mission"),pt())},styles:[""]}),t})(),OL=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ti({type:t,selectors:[["app-video-controls"]],decls:8,vars:0,consts:[[1,"btn","btn-success"],[1,"btn","btn-danger"],[1,"btn","btn-secondary"]],template:function(n,s){1&n&&(mt(0,"button",0),Xt(1,"Start Recording"),pt(),mt(2,"button",1),Xt(3,"Stop Recording"),pt(),mt(4,"button",2),Xt(5,"Pause"),pt(),mt(6,"button",1),Xt(7,"Reset"),pt())},styles:[""]}),t})(),zL=(()=>{class t{constructor(){this.station=""}ngOnInit(){}}return t.\u0275fac=function(n){return new(n||t)},t.\u0275cmp=ti({type:t,selectors:[["app-uav-interface"]],inputs:{station:"station"},decls:15,vars:1,consts:[[1,"container"],[1,"col-xs-4","col-sm-4","col-md-4"],[1,"card"],[1,"card-header"],[3,"currStation"],[1,"card-body"],[1,"row"],[1,"col-xs-1","col-sm-1","col-md-1"],[1,"center"],[1,"col-xs-2","col-sm-2","col-md-2"]],template:function(n,s){1&n&&(mt(0,"div",0)(1,"div",1)(2,"div",2)(3,"div",3),kr(4,"app-header",4),pt(),mt(5,"div",5),kr(6,"app-video-feed"),mt(7,"div",0)(8,"div",6)(9,"div",7)(10,"div",8),kr(11,"app-uav-controls"),pt()(),mt(12,"div",9)(13,"div",8),kr(14,"app-video-controls"),pt()()()()()()()()),2&n&&(In(4),vn("currStation",s.station))},directives:[RL,FL,LL,OL],styles:[""]}),t})();function BL(t,e){if(1&t&&(mt(0,"option",14),Xt(1),pt()),2&t){const n=e.$implicit;ly("value",n),In(1),Wp(n)}}function NL(t,e){if(1&t){const n=ea();mt(0,"select",11),Rr("ngModelChange",function(){return ru(n),na().setStation()}),mt(1,"option",12),Xt(2,"Select a Station"),pt(),se(3,BL,2,2,"option",13),pt()}if(2&t){const n=na();In(3),vn("ngForOf",n.stationNames)}}function VL(t,e){1&t&&(mt(0,"p"),Xt(1,"No Stations"),pt())}const UL=[{path:"",component:(()=>{class t{constructor(n,s){this.stationService=n,this.postService=s,this.stationNames=[],this.defaultStation="default"}ngOnInit(){this.stationForm=new Tg({Station:new gv(this.defaultStation)}),this.selectPageUAVs()}selectPageUAVs(){this.stationService.fetchStationNames().subscribe(n=>{this.stationNames=n})}setStation(){var n,s;console.log(null===(n=this.stationForm.get("Station"))||void 0===n?void 0:n.value),this.currentStation=null===(s=this.stationForm.get("Station"))||void 0===s?void 0:s.value}}return t.\u0275fac=function(n){return new(n||t)(ze(bv),ze(Nb))},t.\u0275cmp=ti({type:t,selectors:[["app-home"]],decls:20,vars:6,consts:[[1,"container"],[1,"row"],[1,"col-xs-8","col-sm-6","col-md-6","col-xs-offset-2","col-sm-offset-3","col-md-offset-3"],[3,"formGroup"],[1,"form-group"],["for","Station"],["id","station","formControlName","Station","class","form-control","name","station","required","",3,"ngModelChange",4,"ngIf","ngIfElse"],["noStations",""],[1,"col-xs-12","col-sm-12","col-md-12"],[1,"col-xs-4","col-sm-4","col-md-4"],[3,"station"],["id","station","formControlName","Station","name","station","required","",1,"form-control",3,"ngModelChange"],["value","default"],[3,"value",4,"ngFor","ngForOf"],[3,"value"]],template:function(n,s){if(1&n&&(mt(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3)(4,"div",4)(5,"label",5),Xt(6,"Station"),pt(),se(7,NL,4,1,"select",6),se(8,VL,2,0,"ng-template",null,7,Qx),pt()()()()(),kr(10,"br"),mt(11,"div",0)(12,"div",8)(13,"div",1)(14,"div",9),kr(15,"app-uav-interface",10),pt(),mt(16,"div",9),kr(17,"app-uav-interface",10),pt(),mt(18,"div",9),kr(19,"app-uav-interface",10),pt()()()()),2&n){const c=he(9);In(3),vn("formGroup",s.stationForm),In(4),vn("ngIf",s.stationNames.length>0)("ngIfElse",c),In(8),vn("station",s.currentStation),In(2),vn("station",s.currentStation),In(2),vn("station",s.currentStation)}},directives:[Mg,bg,Ag,Oy,uf,xg,yv,xd,vv,xv,Ly,zL],styles:[""]}),t})()},{path:"uavInput",component:CL},{path:"maps",component:TL},{path:"messages",component:DL},{path:"stations",component:(()=>{class t{constructor(n,s){this.http=n,this.stationService=s,this.loadedStations=[],this.loadedStationNames=[],this.isFetching=!1}ngOnInit(){}onCreateStation(n){this.stationService.createAndStoreStation(n.name,n.status)}onFetchStations(){this.isFetching=!0,this.stationService.fetchStations().subscribe(n=>{this.isFetching=!1,this.loadedStations=n})}onFetchStationNames(){this.isFetching=!0,this.stationService.fetchStationNames().subscribe(n=>{this.isFetching=!1,this.loadedStationNames=n})}}return t.\u0275fac=function(n){return new(n||t)(ze(ov),ze(bv))},t.\u0275cmp=ti({type:t,selectors:[["app-stations"]],decls:15,vars:1,consts:[[1,"container"],[1,"row"],[1,"col-xs-12","col-sm-10","col-md-8"],[3,"ngSubmit"],["stationForm","ngForm"],[1,"form-group"],["for","Name"],["type","text","id","name","required","","ngModel","","name","name",1,"form-control"],["for","status"],["type","text","id","status","required","","ngModel","","name","status",1,"form-control"],["type","submit",1,"btn","btn-primary",3,"disabled"]],template:function(n,s){if(1&n){const c=ea();mt(0,"div",0)(1,"div",1)(2,"div",2)(3,"form",3,4),Rr("ngSubmit",function(){ru(c);const y=he(4);return s.onCreateStation(y.value)}),mt(5,"div",5)(6,"label",6),Xt(7,"Name"),pt(),kr(8,"input",7),pt(),mt(9,"div",5)(10,"label",8),Xt(11,"Status"),pt(),kr(12,"input",9),pt(),mt(13,"button",10),Xt(14," Add New Station "),pt()()()()()}if(2&n){const c=he(4);In(13),vn("disabled",!c.valid)}},directives:[Mg,bg,Sg,vg,xd,xg,_v],styles:[""]}),t})()}];let jL=(()=>{class t{}return t.\u0275fac=function(n){return new(n||t)},t.\u0275mod=gi({type:t,bootstrap:[_L]}),t.\u0275inj=wt({providers:[],imports:[[dP,vF,fL,YR.forRoot(UL),mL]]}),t})();(function YA(){xE=!1})(),uP().bootstrapModule(jL).catch(t=>console.error(t))},898:function(hf){hf.exports=function(){"use strict";var zc,Bc,qa;function ah(d,Ge){if(zc)if(Bc){var Po="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+zc+")(sharedChunk); ("+Bc+")(sharedChunk); self.onerror = null;",Jr={};zc(Jr),qa=Ge(Jr),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(qa.workerUrl=window.URL.createObjectURL(new Blob([Po],{type:"text/javascript"})))}else Bc=Ge;else zc=Ge}return ah(0,function(d){var Ge="undefined"!=typeof self?self:{},Po=Jr;function Jr(o,r,a,l){this.cx=3*o,this.bx=3*(a-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*r,this.by=3*(l-r)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=l,this.p2x=a,this.p2y=l}Jr.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},Jr.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},Jr.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},Jr.prototype.solveCurveX=function(o,r){var a,l,h,m,_;for(void 0===r&&(r=1e-6),h=o,_=0;_<8;_++){if(m=this.sampleCurveX(h)-o,Math.abs(m)<r)return h;var x=this.sampleCurveDerivativeX(h);if(Math.abs(x)<1e-6)break;h-=m/x}if((h=o)<(a=0))return a;if(h>(l=1))return l;for(;a<l;){if(m=this.sampleCurveX(h),Math.abs(m-o)<r)return h;o>m?a=h:l=h,h=.5*(l-a)+a}return h},Jr.prototype.solve=function(o,r){return this.sampleCurveY(this.solveCurveX(o,r))};var Ye=Lt;function Lt(o,r){this.x=o,this.y=r}Lt.prototype={clone:function(){return new Lt(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,r){return this.clone()._rotateAround(o,r)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var r=o.x-this.x,a=o.y-this.y;return r*r+a*a},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,r){return Math.atan2(this.x*r-this.y*o,this.x*o+this.y*r)},_matMult:function(o){var r=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=r,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var r=Math.cos(o),a=Math.sin(o),l=a*this.x+r*this.y;return this.x=r*this.x-a*this.y,this.y=l,this},_rotateAround:function(o,r){var a=Math.cos(o),l=Math.sin(o),h=r.y+l*(this.x-r.x)+a*(this.y-r.y);return this.x=r.x+a*(this.x-r.x)-l*(this.y-r.y),this.y=h,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Lt.convert=function(o){return o instanceof Lt?o:Array.isArray(o)?new Lt(o[0],o[1]):o};const hn=Math.PI/180,ao=180/Math.PI;function Ft(o){return o*hn}function Qr(o){return o*ao}const $n=[[0,0],[1,0],[1,1],[0,1]];function Za(o){if(o<=0)return 0;if(o>=1)return 1;const r=o*o,a=r*o;return 4*(o<.5?a:3*(o-r)+a-.75)}function sa(o,r,a,l){const h=new Po(o,r,a,l);return function(m){return h.solve(m)}}const Wa=sa(.25,.1,.25,1);function Et(o,r,a){return Math.min(a,Math.max(r,o))}function Ti(o,r,a){return(a=Et((a-o)/(r-o),0,1))*a*(3-2*a)}function aa(o,r,a){const l=a-r,h=((o-r)%l+l)%l+r;return h===r?a:h}function Xo(o,r,a){if(!o.length)return a(null,[]);let l=o.length;const h=new Array(o.length);let m=null;o.forEach((_,x)=>{r(_,(w,C)=>{w&&(m=w),h[x]=C,0==--l&&a(m,h)})})}function kn(o){const r=[];for(const a in o)r.push(o[a]);return r}function _r(o,...r){for(const a of r)for(const l in a)o[l]=a[l];return o}let wd=1;function lo(){return wd++}function Xa(){return function o(r){return r?(r^Math.random()*(16>>r/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Ol(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))}function Ui(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function Yo(o,r){o.forEach(a=>{r[a]&&(r[a]=r[a].bind(r))})}function Ko(o,r){return-1!==o.indexOf(r,o.length-r.length)}function Vt(o,r,a){const l={};for(const h in o)l[h]=r.call(a||this,o[h],h,o);return l}function la(o,r,a){const l={};for(const h in o)r.call(a||this,o[h],h,o)&&(l[h]=o[h]);return l}function ji(o){return Array.isArray(o)?o.map(ji):"object"==typeof o&&o?Vt(o,ji):o}const Ya={};function rr(o){Ya[o]||("undefined"!=typeof console&&console.warn(o),Ya[o]=!0)}function Ur(o,r,a){return(a.y-o.y)*(r.x-o.x)>(r.y-o.y)*(a.x-o.x)}function $i(o){let r=0;for(let a,l,h=0,m=o.length,_=m-1;h<m;_=h++)a=o[h],l=o[_],r+=(l.x-a.x)*(a.y+l.y);return r}function Gi(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function Jo(o){const r={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(a,l,h,m)=>{const _=h||m;return r[l]=!_||_.toLowerCase(),""}),r["max-age"]){const a=parseInt(r["max-age"],10);isNaN(a)?delete r["max-age"]:r["max-age"]=a}return r}let Qo=null;function ca(o){if(null==Qo){const r=o.navigator?o.navigator.userAgent:null;Qo=!!o.safari||!(!r||!(/\b(iPad|iPhone|iPod)\b/.test(r)||r.match("Safari")&&!r.match("Chrome")))}return Qo}function Ka(o){try{const r=Ge[o];return r.setItem("_mapbox_test_",1),r.removeItem("_mapbox_test_"),!0}catch(r){return!1}}function co(o,r){return[o[4*r],o[4*r+1],o[4*r+2],o[4*r+3]]}const Nc=Ge.performance;function ua(o){const r=o?o.url.toString():void 0;return Nc.getEntriesByName(r)}let en,ts,ha,ko;const zn={now:()=>void 0!==ha?ha:Ge.performance.now(),setNow(o){ha=o},restoreNow(){ha=void 0},frame(o){const r=Ge.requestAnimationFrame(o);return{cancel:()=>Ge.cancelAnimationFrame(r)}},getImageData(o,r=0){const{width:a,height:l}=o;ko||(ko=Ge.document.createElement("canvas"));const h=ko.getContext("2d");if(!h)throw new Error("failed to create canvas 2d context");return(a>ko.width||l>ko.height)&&(ko.width=a,ko.height=l),h.clearRect(-r,-r,a+2*r,l+2*r),h.drawImage(o,0,0,a,l),h.getImageData(-r,-r,a+2*r,l+2*r)},resolveURL:o=>(en||(en=Ge.document.createElement("a")),en.href=o,en.href),get devicePixelRatio(){return Ge.devicePixelRatio},get prefersReducedMotion(){return!!Ge.matchMedia&&(null==ts&&(ts=Ge.matchMedia("(prefers-reduced-motion: reduce)")),ts.matches)}};let Ds;const tn={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==Ds){const o=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{Ds=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):o}catch(r){Ds=o}}return Ds},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Ro={supported:!1,testSupport:function(o){!ir&&uo&&(Ja?zl(o):Ss=o)}};let Ss,uo,ir=!1,Ja=!1;function zl(o){const r=o.createTexture();o.bindTexture(o.TEXTURE_2D,r);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,uo),o.isContextLost())return;Ro.supported=!0}catch(a){}o.deleteTexture(r),ir=!0}Ge.document&&(uo=Ge.document.createElement("img"),uo.onload=function(){Ss&&zl(Ss),Ss=null,Ja=!0},uo.onerror=function(){ir=!0,Ss=null},uo.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Vc="01",Or="NO_ACCESS_TOKEN";function Hi(o){return 0===o.indexOf("mapbox:")}function da(o){return tn.API_URL_REGEX.test(o)}const Qa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Di(o){const r=o.match(Qa);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function ns(o){const r=o.params.length?`?${o.params.join("&")}`:"";return`${o.protocol}://${o.authority}${o.path}${r}`}function Bl(o){if(!o)return null;const r=o.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(decodeURIComponent(Ge.atob(r[1]).split("").map(a=>"%"+("00"+a.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(a){return null}}class Nl{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const a=Bl(tn.ACCESS_TOKEN);let l="";return l=a&&a.u?Ge.btoa(encodeURIComponent(a.u).replace(/%([0-9A-F]{2})/g,(h,m)=>String.fromCharCode(Number("0x"+m)))):tn.ACCESS_TOKEN||"",r?`mapbox.eventData.${r}:${l}`:`mapbox.eventData:${l}`}fetchEventData(){const r=Ka("localStorage"),a=this.getStorageKey(),l=this.getStorageKey("uuid");if(r)try{const h=Ge.localStorage.getItem(a);h&&(this.eventData=JSON.parse(h));const m=Ge.localStorage.getItem(l);m&&(this.anonId=m)}catch(h){rr("Unable to read from LocalStorage")}}saveEventData(){const r=Ka("localStorage"),a=this.getStorageKey(),l=this.getStorageKey("uuid");if(r)try{Ge.localStorage.setItem(l,this.anonId),Object.keys(this.eventData).length>=1&&Ge.localStorage.setItem(a,JSON.stringify(this.eventData))}catch(h){rr("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,a,l,h){if(!tn.EVENTS_URL)return;const m=Di(tn.EVENTS_URL);m.params.push(`access_token=${h||tn.ACCESS_TOKEN||""}`);const _={event:this.type,created:new Date(r).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"2.9.1",skuId:Vc,userId:this.anonId},x=a?_r(_,a):_,w={url:ns(m),headers:{"Content-Type":"text/plain"},body:JSON.stringify([x])};this.pendingRequest=we(w,C=>{this.pendingRequest=null,l(C),this.saveEventData(),this.processRequests(h)})}queueRequest(r,a){this.queue.push(r),this.processRequests(a)}}const Vl=new class extends Nl{constructor(o){super("appUserTurnstile"),this._customAccessToken=o}postTurnstileEvent(o,r){tn.EVENTS_URL&&tn.ACCESS_TOKEN&&Array.isArray(o)&&o.some(a=>Hi(a)||da(a))&&this.queueRequest(Date.now(),r)}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Bl(tn.ACCESS_TOKEN),a=r?r.u:tn.ACCESS_TOKEN;let l=a!==this.eventData.tokenU;Ui(this.anonId)||(this.anonId=Xa(),l=!0);const h=this.queue.shift();if(this.eventData.lastSuccess){const m=new Date(this.eventData.lastSuccess),_=new Date(h),x=(h-this.eventData.lastSuccess)/864e5;l=l||x>=1||x<-1||m.getDate()!==_.getDate()}else l=!0;l?this.postEvent(h,{"enabled.telemetry":!1},m=>{m||(this.eventData.lastSuccess=h,this.eventData.tokenU=a)},o):this.processRequests()}},Uc=Vl.postTurnstileEvent.bind(Vl),Ul=new class extends Nl{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(o,r,a,l){this.skuToken=r,this.errorCb=l,tn.EVENTS_URL&&(a||tn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Or)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),Ui(this.anonId)||(this.anonId=Xa()),this.postEvent(a,{skuToken:this.skuToken},l=>{l?this.errorCb(l):r&&(this.success[r]=!0)},o))}},jc=Ul.postMapLoadEvent.bind(Ul),$c=new class extends Nl{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(o,r,a,l){if(!tn.API_URL||!tn.SESSION_PATH)return;const h=Di(tn.API_URL+tn.SESSION_PATH);h.params.push(`sku=${r||""}`),h.params.push(`access_token=${l||tn.ACCESS_TOKEN||""}`);const m={url:ns(h),headers:{"Content-Type":"text/plain"}};this.pendingRequest=Le(m,_=>{this.pendingRequest=null,a(_),this.saveEventData(),this.processRequests(l)})}getSessionAPI(o,r,a,l){this.skuToken=r,this.errorCb=l,tn.SESSION_PATH&&tn.API_URL&&(a||tn.ACCESS_TOKEN?this.queueRequest({id:o,timestamp:Date.now()},a):this.errorCb(new Error(Or)))}processRequests(o){if(this.pendingRequest||0===this.queue.length)return;const{id:r,timestamp:a}=this.queue.shift();r&&this.success[r]||this.getSession(a,this.skuToken,l=>{l?this.errorCb(l):r&&(this.success[r]=!0)},o)}},lh=$c.getSessionAPI.bind($c),Ms=new Set;let sn,As=500,mn=50,jr={};function jl(o){const r=O(o);let a,l;r&&r.forEach(m=>{const _=m.split("=");"language"===_[0]?a=_[1]:"worldview"===_[0]&&(l=_[1])});let h="mapbox-tiles";return a&&(h+=`-${a}`),l&&(h+=`-${l}`),h}function Y(o){Ge.caches&&!jr[o]&&(jr[o]=Ge.caches.open(o))}function O(o){const r=o.indexOf("?");return r>0?o.slice(r+1).split("&"):[]}function V(o){const r=o.indexOf("?");if(r<0)return o;const a=O(o).filter(l=>{const h=l.split("=");return"language"===h[0]||"worldview"===h[0]});return a.length?`${o.slice(0,r)}?${a.join("&")}`:o.slice(0,r)}let J=1/0;const K={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(K);class fe extends Error{constructor(r,a,l){401===a&&da(l)&&(r+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(r),this.status=a,this.url=l}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const de=Gi()?()=>self.worker&&self.worker.referrer:()=>("blob:"===Ge.location.protocol?Ge.parent:Ge).location.href,ge=function(o,r){if(!(/^file:/.test(a=o.url)||/^file:/.test(de())&&!/^\w+:/.test(a))){if(Ge.fetch&&Ge.Request&&Ge.AbortController&&Ge.Request.prototype.hasOwnProperty("signal"))return function(l,h){const m=new Ge.AbortController,_=new Ge.Request(l.url,{method:l.method||"GET",body:l.body,credentials:l.credentials,headers:l.headers,referrer:de(),signal:m.signal});let x=!1,w=!1;const C=(M=_.url).indexOf("sku=")>0&&da(M);var M;"json"===l.type&&_.headers.set("Accept","application/json");const I=(F,z,U)=>{if(w)return;if(F&&"SecurityError"!==F.message&&rr(F),z&&U)return P(z);const X=Date.now();Ge.fetch(_).then(ee=>{if(ee.ok){const ce=C?ee.clone():null;return P(ee,ce,X)}return h(new fe(ee.statusText,ee.status,l.url))}).catch(ee=>{20!==ee.code&&h(new Error(ee.message))})},P=(F,z,U)=>{("arrayBuffer"===l.type?F.arrayBuffer():"json"===l.type?F.json():F.text()).then(X=>{w||(z&&U&&function(ee,ce,se){const pe=jl(ee.url);if(Y(pe),!jr[pe])return;const he={status:ce.status,statusText:ce.statusText,headers:new Ge.Headers};ce.headers.forEach((De,Pe)=>he.headers.set(Pe,De));const _e=Jo(ce.headers.get("Cache-Control")||"");if(_e["no-store"])return;_e["max-age"]&&he.headers.set("Expires",new Date(se+1e3*_e["max-age"]).toUTCString());const Te=he.headers.get("Expires");Te&&(new Date(Te).getTime()-se<42e4||function(De,Pe){if(void 0===sn)try{new Response(new ReadableStream),sn=!0}catch(Be){sn=!1}sn?Pe(De.body):De.blob().then(Pe)}(ce,De=>{const Pe=new Ge.Response(De,he);Y(pe),jr[pe]&&jr[pe].then(Be=>Be.put(V(ee.url),Pe)).catch(Be=>rr(Be.message))}))}(_,z,U),x=!0,h(null,X,F.headers.get("Cache-Control"),F.headers.get("Expires")))}).catch(X=>{w||h(new Error(X.message))})};return C?function(F,z){const U=jl(F.url);if(Y(U),!jr[U])return z(null);const X=V(F.url);jr[U].then(ee=>{ee.match(X).then(ce=>{const se=function(pe){if(!pe)return!1;const he=new Date(pe.headers.get("Expires")||0),_e=Jo(pe.headers.get("Cache-Control")||"");return he>Date.now()&&!_e["no-cache"]}(ce);ee.delete(X),se&&ee.put(X,ce.clone()),z(null,ce,se)}).catch(z)}).catch(z)}(_,I):I(null,null),{cancel:()=>{w=!0,x||m.abort()}}}(o,r);if(Gi()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,r,void 0,!0)}var a;return function(l,h){const m=new Ge.XMLHttpRequest;m.open(l.method||"GET",l.url,!0),"arrayBuffer"===l.type&&(m.responseType="arraybuffer");for(const _ in l.headers)m.setRequestHeader(_,l.headers[_]);return"json"===l.type&&(m.responseType="text",m.setRequestHeader("Accept","application/json")),m.withCredentials="include"===l.credentials,m.onerror=()=>{h(new Error(m.statusText))},m.onload=()=>{if((m.status>=200&&m.status<300||0===m.status)&&null!==m.response){let _=m.response;if("json"===l.type)try{_=JSON.parse(m.response)}catch(x){return h(x)}h(null,_,m.getResponseHeader("Cache-Control"),m.getResponseHeader("Expires"))}else h(new fe(m.statusText,m.status,l.url))},m.send(l.body),{cancel:()=>m.abort()}}(o,r)},me=function(o,r){return ge(_r(o,{type:"arrayBuffer"}),r)},we=function(o,r){return ge(_r(o,{method:"POST"}),r)},Le=function(o,r){return ge(_r(o,{method:"GET"}),r)};function et(o){const r=Ge.document.createElement("a");return r.href=o,r.protocol===Ge.document.location.protocol&&r.host===Ge.document.location.host}const Re="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let gt,yt;gt=[],yt=0;const _t=function(o,r){if(Ro.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),yt>=tn.MAX_PARALLEL_IMAGE_REQUESTS){const m={requestParameters:o,callback:r,cancelled:!1,cancel(){this.cancelled=!0}};return gt.push(m),m}yt++;let a=!1;const l=()=>{if(!a)for(a=!0,yt--;gt.length&&yt<tn.MAX_PARALLEL_IMAGE_REQUESTS;){const m=gt.shift(),{requestParameters:_,callback:x,cancelled:w}=m;w||(m.cancel=_t(_,x).cancel)}},h=me(o,(m,_,x,w)=>{l(),m?r(m):_&&(Ge.createImageBitmap?function(C,M){const I=new Ge.Blob([new Uint8Array(C)],{type:"image/png"});Ge.createImageBitmap(I).then(P=>{M(null,P)}).catch(P=>{M(new Error(`Could not load image because of ${P.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(_,(C,M)=>r(C,M,x,w)):function(C,M){const I=new Ge.Image,P=Ge.URL;I.onload=()=>{M(null,I),P.revokeObjectURL(I.src),I.onload=null,Ge.requestAnimationFrame(()=>{I.src=Re})},I.onerror=()=>M(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Ge.Blob([new Uint8Array(C)],{type:"image/png"});I.src=C.byteLength?P.createObjectURL(F):Re}(_,(C,M)=>r(C,M,x,w)))});return{cancel:()=>{h.cancel(),l()}}};function dt(o,r,a){a[o]&&-1!==a[o].indexOf(r)||(a[o]=a[o]||[],a[o].push(r))}function zt(o,r,a){if(a&&a[o]){const l=a[o].indexOf(r);-1!==l&&a[o].splice(l,1)}}class an{constructor(r,a={}){_r(this,a),this.type=r}}class Bn extends an{constructor(r,a={}){super("error",_r({error:r},a))}}class gn{on(r,a){return this._listeners=this._listeners||{},dt(r,a,this._listeners),this}off(r,a){return zt(r,a,this._listeners),zt(r,a,this._oneTimeListeners),this}once(r,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},dt(r,a,this._oneTimeListeners),this):new Promise(l=>this.once(r,l))}fire(r,a){"string"==typeof r&&(r=new an(r,a||{}));const l=r.type;if(this.listens(l)){r.target=this;const h=this._listeners&&this._listeners[l]?this._listeners[l].slice():[];for(const x of h)x.call(this,r);const m=this._oneTimeListeners&&this._oneTimeListeners[l]?this._oneTimeListeners[l].slice():[];for(const x of m)zt(l,x,this._oneTimeListeners),x.call(this,r);const _=this._eventedParent;_&&(_r(r,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),_.fire(r))}else r instanceof Bn&&console.error(r.error);return this}listens(r){return!!(this._listeners&&this._listeners[r]&&this._listeners[r].length>0||this._oneTimeListeners&&this._oneTimeListeners[r]&&this._oneTimeListeners[r].length>0||this._eventedParent&&this._eventedParent.listens(r))}setEventedParent(r,a){return this._eventedParent=r,this._eventedParentData=a,this}}var ye=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"high-color":{"type":"color","property-type":"data-constant","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"space-color":{"type":"color","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"star-intensity":{"type":"number","property-type":"data-constant","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{},"globe":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-180,-90],"maximum":[180,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","minimum":[-90,-90],"maximum":[90,90],"transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true,"requires":["source"]}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"transition":false,"requires":[{"source":"geojson","has":{"lineMetrics":true}}],"property-type":"constant"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function qi(o,...r){for(const a of r)for(const l in a)o[l]=a[l];return o}function Zn(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function ho(o){if(Array.isArray(o))return o.map(ho);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){const r={};for(const a in o)r[a]=ho(o[a]);return r}return Zn(o)}class Si extends Error{constructor(r,a){super(a),this.message=a,this.key=r}}var qt=Si;class ch{constructor(r,a=[]){this.parent=r,this.bindings={};for(const[l,h]of a)this.bindings[l]=h}concat(r){return new ch(this,r)}get(r){if(this.bindings[r])return this.bindings[r];if(this.parent)return this.parent.get(r);throw new Error(`${r} not found in scope.`)}has(r){return!!this.bindings[r]||!!this.parent&&this.parent.has(r)}}var df=ch;const Gc={kind:"null"},ke={kind:"number"},Jt={kind:"string"},wt={kind:"boolean"},Mi={kind:"color"},Is={kind:"object"},It={kind:"value"},rs={kind:"collator"},pa={kind:"formatted"},Ps={kind:"resolvedImage"};function mi(o,r){return{kind:"array",itemType:o,N:r}}function Gn(o){if("array"===o.kind){const r=Gn(o.itemType);return"number"==typeof o.N?`array<${r}, ${o.N}>`:"value"===o.itemType.kind?"array":`array<${r}>`}return o.kind}const Ed=[Gc,ke,Jt,wt,Mi,pa,Is,mi(It),Ps];function Tt(o,r){if("error"===r.kind)return null;if("array"===o.kind){if("array"===r.kind&&(0===r.N&&"value"===r.itemType.kind||!Tt(o.itemType,r.itemType))&&("number"!=typeof o.N||o.N===r.N))return null}else{if(o.kind===r.kind)return null;if("value"===o.kind)for(const a of Ed)if(!Tt(a,r))return null}return`Expected ${Gn(o)} but found ${Gn(r)} instead.`}function el(o,r){return r.some(a=>a.kind===o.kind)}function tl(o,r){return r.some(a=>"null"===a?null===o:"array"===a?Array.isArray(o):"object"===a?o&&!Array.isArray(o)&&"object"==typeof o:a===typeof o)}function Ai(o){var r={exports:{}};return o(r,r.exports),r.exports}var uh=Ai(function(o,r){var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function l(x){return(x=Math.round(x))<0?0:x>255?255:x}function h(x){return l("%"===x[x.length-1]?parseFloat(x)/100*255:parseInt(x))}function m(x){return(w="%"===x[x.length-1]?parseFloat(x)/100:parseFloat(x))<0?0:w>1?1:w;var w}function _(x,w,C){return C<0?C+=1:C>1&&(C-=1),6*C<1?x+(w-x)*C*6:2*C<1?w:3*C<2?x+(w-x)*(2/3-C)*6:x}try{r.parseCSSColor=function(x){var w,C=x.replace(/ /g,"").toLowerCase();if(C in a)return a[C].slice();if("#"===C[0])return 4===C.length?(w=parseInt(C.substr(1),16))>=0&&w<=4095?[(3840&w)>>4|(3840&w)>>8,240&w|(240&w)>>4,15&w|(15&w)<<4,1]:null:7===C.length&&(w=parseInt(C.substr(1),16))>=0&&w<=16777215?[(16711680&w)>>16,(65280&w)>>8,255&w,1]:null;var M=C.indexOf("("),I=C.indexOf(")");if(-1!==M&&I+1===C.length){var P=C.substr(0,M),F=C.substr(M+1,I-(M+1)).split(","),z=1;switch(P){case"rgba":if(4!==F.length)return null;z=m(F.pop());case"rgb":return 3!==F.length?null:[h(F[0]),h(F[1]),h(F[2]),z];case"hsla":if(4!==F.length)return null;z=m(F.pop());case"hsl":if(3!==F.length)return null;var U=(parseFloat(F[0])%360+360)%360/360,X=m(F[1]),ee=m(F[2]),ce=ee<=.5?ee*(X+1):ee+X-ee*X,se=2*ee-ce;return[l(255*_(se,ce,U+1/3)),l(255*_(se,ce,U)),l(255*_(se,ce,U-1/3)),z];default:return null}}return null}}catch(x){}});class Er{constructor(r,a,l,h=1){this.r=r,this.g=a,this.b=l,this.a=h}static parse(r){if(!r)return;if(r instanceof Er)return r;if("string"!=typeof r)return;const a=uh.parseCSSColor(r);return a?new Er(a[0]/255*a[3],a[1]/255*a[3],a[2]/255*a[3],a[3]):void 0}toString(){const[r,a,l,h]=this.toArray();return`rgba(${Math.round(r)},${Math.round(a)},${Math.round(l)},${h})`}toArray(){const{r,g:a,b:l,a:h}=this;return 0===h?[0,0,0,0]:[255*r/h,255*a/h,255*l/h,h]}toArray01(){const{r,g:a,b:l,a:h}=this;return 0===h?[0,0,0,0]:[r/h,a/h,l/h,h]}toArray01PremultipliedAlpha(){const{r,g:a,b:l,a:h}=this;return[r,a,l,h]}}Er.black=new Er(0,0,0,1),Er.white=new Er(1,1,1,1),Er.transparent=new Er(0,0,0,0),Er.red=new Er(1,0,0,1),Er.blue=new Er(0,0,1,1);var Cn=Er;class lr{constructor(r,a,l){this.sensitivity=r?a?"variant":"case":a?"accent":"base",this.locale=l,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(r,a){return this.collator.compare(r,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Cd{constructor(r,a,l,h,m){this.text=r.normalize?r.normalize():r,this.image=a,this.scale=l,this.fontStack=h,this.textColor=m}}class ei{constructor(r){this.sections=r}static fromString(r){return new ei([new Cd(r,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(r=>0!==r.text.length||r.image&&0!==r.image.name.length)}static factory(r){return r instanceof ei?r:ei.fromString(r)}toString(){return 0===this.sections.length?"":this.sections.map(r=>r.text).join("")}serialize(){const r=["format"];for(const a of this.sections){if(a.image){r.push(["image",a.image.name]);continue}r.push(a.text);const l={};a.fontStack&&(l["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(l["font-scale"]=a.scale),a.textColor&&(l["text-color"]=["rgba"].concat(a.textColor.toArray())),r.push(l)}return r}}class hr{constructor(r){this.name=r.name,this.available=r.available}toString(){return this.name}static fromString(r){return r?new hr({name:r,available:!1}):null}serialize(){return["image",this.name]}}function Hc(o,r,a,l){return"number"==typeof o&&o>=0&&o<=255&&"number"==typeof r&&r>=0&&r<=255&&"number"==typeof a&&a>=0&&a<=255?void 0===l||"number"==typeof l&&l>=0&&l<=1?null:`Invalid rgba value [${[o,r,a,l].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof l?[o,r,a,l]:[o,r,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function $l(o){if(null===o||"string"==typeof o||"boolean"==typeof o||"number"==typeof o||o instanceof Cn||o instanceof lr||o instanceof ei||o instanceof hr)return!0;if(Array.isArray(o)){for(const r of o)if(!$l(r))return!1;return!0}if("object"==typeof o){for(const r in o)if(!$l(o[r]))return!1;return!0}return!1}function Qn(o){if(null===o)return Gc;if("string"==typeof o)return Jt;if("boolean"==typeof o)return wt;if("number"==typeof o)return ke;if(o instanceof Cn)return Mi;if(o instanceof lr)return rs;if(o instanceof ei)return pa;if(o instanceof hr)return Ps;if(Array.isArray(o)){const r=o.length;let a;for(const l of o){const h=Qn(l);if(a){if(a===h)continue;a=It;break}a=h}return mi(a||It,r)}return Is}function nl(o){const r=typeof o;return null===o?"":"string"===r||"number"===r||"boolean"===r?String(o):o instanceof Cn||o instanceof ei||o instanceof hr?o.toString():JSON.stringify(o)}class Tn{constructor(r,a){this.type=r,this.value=a}static parse(r,a){if(2!==r.length)return a.error(`'literal' expression requires exactly one argument, but found ${r.length-1} instead.`);if(!$l(r[1]))return a.error("invalid value");const l=r[1];let h=Qn(l);const m=a.expectedType;return"array"!==h.kind||0!==h.N||!m||"array"!==m.kind||"number"==typeof m.N&&0!==m.N||(h=m),new Tn(h,l)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof Cn?["rgba"].concat(this.value.toArray()):this.value instanceof ei?this.value.serialize():this.value}}var qc=Tn,$r=class{constructor(o){this.name="ExpressionEvaluationError",this.message=o}toJSON(){return this.message}};const is={string:Jt,number:ke,boolean:wt,object:Is};class bn{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");let l,h=1;const m=r[0];if("array"===m){let x,w;if(r.length>2){const C=r[1];if("string"!=typeof C||!(C in is)||"object"===C)return a.error('The item type argument of "array" must be one of string, number, boolean',1);x=is[C],h++}else x=It;if(r.length>3){if(null!==r[2]&&("number"!=typeof r[2]||r[2]<0||r[2]!==Math.floor(r[2])))return a.error('The length argument to "array" must be a positive integer literal',2);w=r[2],h++}l=mi(x,w)}else l=is[m];const _=[];for(;h<r.length;h++){const x=a.parse(r[h],h,It);if(!x)return null;_.push(x)}return new bn(l,_)}evaluate(r){for(let a=0;a<this.args.length;a++){const l=this.args[a].evaluate(r);if(!Tt(this.type,Qn(l)))return l;if(a===this.args.length-1)throw new $r(`Expected value to be of type ${Gn(this.type)}, but found ${Gn(Qn(l))} instead.`)}return null}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=this.type,a=[r.kind];if("array"===r.kind){const l=r.itemType;if("string"===l.kind||"number"===l.kind||"boolean"===l.kind){a.push(l.kind);const h=r.N;("number"==typeof h||this.args.length>1)&&a.push(h)}}return a.concat(this.args.map(l=>l.serialize()))}}var Zi=bn;class Fo{constructor(r){this.type=pa,this.sections=r}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const l=r[1];if(!Array.isArray(l)&&"object"==typeof l)return a.error("First argument must be an image or text section.");const h=[];let m=!1;for(let _=1;_<=r.length-1;++_){const x=r[_];if(m&&"object"==typeof x&&!Array.isArray(x)){m=!1;let w=null;if(x["font-scale"]&&(w=a.parse(x["font-scale"],1,ke),!w))return null;let C=null;if(x["text-font"]&&(C=a.parse(x["text-font"],1,mi(Jt)),!C))return null;let M=null;if(x["text-color"]&&(M=a.parse(x["text-color"],1,Mi),!M))return null;const I=h[h.length-1];I.scale=w,I.font=C,I.textColor=M}else{const w=a.parse(r[_],1,It);if(!w)return null;const C=w.type.kind;if("string"!==C&&"value"!==C&&"null"!==C&&"resolvedImage"!==C)return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");m=!0,h.push({content:w,scale:null,font:null,textColor:null})}}return new Fo(h)}evaluate(r){return new ei(this.sections.map(a=>{const l=a.content.evaluate(r);return Qn(l)===Ps?new Cd("",l,null,null,null):new Cd(nl(l),null,a.scale?a.scale.evaluate(r):null,a.font?a.font.evaluate(r).join(","):null,a.textColor?a.textColor.evaluate(r):null)}))}eachChild(r){for(const a of this.sections)r(a.content),a.scale&&r(a.scale),a.font&&r(a.font),a.textColor&&r(a.textColor)}outputDefined(){return!1}serialize(){const r=["format"];for(const a of this.sections){r.push(a.content.serialize());const l={};a.scale&&(l["font-scale"]=a.scale.serialize()),a.font&&(l["text-font"]=a.font.serialize()),a.textColor&&(l["text-color"]=a.textColor.serialize()),r.push(l)}return r}}class rl{constructor(r){this.type=Ps,this.input=r}static parse(r,a){if(2!==r.length)return a.error("Expected two arguments.");const l=a.parse(r[1],1,Jt);return l?new rl(l):a.error("No image name provided.")}evaluate(r){const a=this.input.evaluate(r),l=hr.fromString(a);return l&&r.availableImages&&(l.available=r.availableImages.indexOf(a)>-1),l}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Td={"to-boolean":wt,"to-color":Mi,"to-number":ke,"to-string":Jt};class po{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expected at least one argument.");const l=r[0];if(("to-boolean"===l||"to-string"===l)&&2!==r.length)return a.error("Expected one argument.");const h=Td[l],m=[];for(let _=1;_<r.length;_++){const x=a.parse(r[_],_,It);if(!x)return null;m.push(x)}return new po(h,m)}evaluate(r){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(r));if("color"===this.type.kind){let a,l;for(const h of this.args){if(a=h.evaluate(r),l=null,a instanceof Cn)return a;if("string"==typeof a){const m=r.parseColor(a);if(m)return m}else if(Array.isArray(a)&&(l=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:Hc(a[0],a[1],a[2],a[3]),!l))return new Cn(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new $r(l||`Could not parse color from value '${"string"==typeof a?a:String(JSON.stringify(a))}'`)}if("number"===this.type.kind){let a=null;for(const l of this.args){if(a=l.evaluate(r),null===a)return 0;const h=Number(a);if(!isNaN(h))return h}throw new $r(`Could not convert ${JSON.stringify(a)} to number.`)}return"formatted"===this.type.kind?ei.fromString(nl(this.args[0].evaluate(r))):"resolvedImage"===this.type.kind?hr.fromString(nl(this.args[0].evaluate(r))):nl(this.args[0].evaluate(r))}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Fo([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new rl(this.args[0]).serialize();const r=[`to-${this.type.kind}`];return this.eachChild(a=>{r.push(a.serialize())}),r}}var Lo=po;const pf=["Unknown","Point","LineString","Polygon"];var ti=class{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?pf[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const o=this.featureDistanceData.center,r=this.featureDistanceData.scale,{x:a,y:l}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(a*r-o[0])+this.featureDistanceData.bearing[1]*(l*r-o[1])}return 0}parseColor(o){let r=this._parseColorCache[o];return r||(r=this._parseColorCache[o]=Cn.parse(o)),r}};class il{constructor(r,a,l,h){this.name=r,this.type=a,this._evaluate=l,this.args=h}evaluate(r){return this._evaluate(r,this.args)}eachChild(r){this.args.forEach(r)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(r=>r.serialize()))}static parse(r,a){const l=r[0],h=il.definitions[l];if(!h)return a.error(`Unknown expression "${l}". If you wanted a literal array, use ["literal", [...]].`,0);const m=Array.isArray(h)?h[0]:h.type,_=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,x=_.filter(([C])=>!Array.isArray(C)||C.length===r.length-1);let w=null;for(const[C,M]of x){w=new Fs(a.registry,a.path,null,a.scope);const I=[];let P=!1;for(let F=1;F<r.length;F++){const z=r[F],U=Array.isArray(C)?C[F-1]:C.type,X=w.parse(z,1+I.length,U);if(!X){P=!0;break}I.push(X)}if(!P)if(Array.isArray(C)&&C.length!==I.length)w.error(`Expected ${C.length} arguments, but found ${I.length} instead.`);else{for(let F=0;F<I.length;F++){const z=Array.isArray(C)?C[F]:C.type,U=I[F];w.concat(F+1).checkSubtype(z,U.type)}if(0===w.errors.length)return new il(l,m,M,I)}}if(1===x.length)a.errors.push(...w.errors);else{const C=(x.length?x:_).map(([I])=>{return P=I,Array.isArray(P)?`(${P.map(Gn).join(", ")})`:`(${Gn(P.type)}...)`;var P}).join(" | "),M=[];for(let I=1;I<r.length;I++){const P=a.parse(r[I],1+M.length);if(!P)return null;M.push(Gn(P.type))}a.error(`Expected arguments of type ${C}, but found (${M.join(", ")}) instead.`)}return null}static register(r,a){il.definitions=a;for(const l in a)r[l]=il}}var Oo=il;class ks{constructor(r,a,l){this.type=rs,this.locale=l,this.caseSensitive=r,this.diacriticSensitive=a}static parse(r,a){if(2!==r.length)return a.error("Expected one argument.");const l=r[1];if("object"!=typeof l||Array.isArray(l))return a.error("Collator options argument must be an object.");const h=a.parse(void 0!==l["case-sensitive"]&&l["case-sensitive"],1,wt);if(!h)return null;const m=a.parse(void 0!==l["diacritic-sensitive"]&&l["diacritic-sensitive"],1,wt);if(!m)return null;let _=null;return l.locale&&(_=a.parse(l.locale,1,Jt),!_)?null:new ks(h,m,_)}evaluate(r){return new lr(this.caseSensitive.evaluate(r),this.diacriticSensitive.evaluate(r),this.locale?this.locale.evaluate(r):null)}eachChild(r){r(this.caseSensitive),r(this.diacriticSensitive),this.locale&&r(this.locale)}outputDefined(){return!1}serialize(){const r={};return r["case-sensitive"]=this.caseSensitive.serialize(),r["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(r.locale=this.locale.serialize()),["collator",r]}}const os=8192;function gi(o,r){o[0]=Math.min(o[0],r[0]),o[1]=Math.min(o[1],r[1]),o[2]=Math.max(o[2],r[0]),o[3]=Math.max(o[3],r[1])}function Zc(o,r){return!(o[0]<=r[0]||o[2]>=r[2]||o[1]<=r[1]||o[3]>=r[3])}function Dd(o,r){const a=(180+o[0])/360,l=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,h=Math.pow(2,r.z);return[Math.round(a*h*os),Math.round(l*h*os)]}function St(o,r,a){const l=o[0]-r[0],h=o[1]-r[1],m=o[0]-a[0],_=o[1]-a[1];return l*_-m*h==0&&l*m<=0&&h*_<=0}function Gr(o,r){let a=!1;for(let _=0,x=r.length;_<x;_++){const w=r[_];for(let C=0,M=w.length;C<M-1;C++){if(St(o,w[C],w[C+1]))return!1;(h=w[C])[1]>(l=o)[1]!=(m=w[C+1])[1]>l[1]&&l[0]<(m[0]-h[0])*(l[1]-h[1])/(m[1]-h[1])+h[0]&&(a=!a)}}var l,h,m;return a}function zr(o,r){for(let a=0;a<r.length;a++)if(Gr(o,r[a]))return!0;return!1}function Wi(o,r,a,l){const h=l[0]-a[0],m=l[1]-a[1],_=(o[0]-a[0])*m-h*(o[1]-a[1]),x=(r[0]-a[0])*m-h*(r[1]-a[1]);return _>0&&x<0||_<0&&x>0}function fa(o,r,a){for(const C of a)for(let M=0;M<C.length-1;++M)if((x=[(_=C[M+1])[0]-(m=C[M])[0],_[1]-m[1]])[0]*(w=[(h=r)[0]-(l=o)[0],h[1]-l[1]])[1]-x[1]*w[0]!=0&&Wi(l,h,m,_)&&Wi(m,_,l,h))return!0;var l,h,m,_,x,w;return!1}function Ii(o,r){for(let a=0;a<o.length;++a)if(!Gr(o[a],r))return!1;for(let a=0;a<o.length-1;++a)if(fa(o[a],o[a+1],r))return!1;return!0}function Wc(o,r){for(let a=0;a<r.length;a++)if(Ii(o,r[a]))return!0;return!1}function Gl(o,r,a){const l=[];for(let h=0;h<o.length;h++){const m=[];for(let _=0;_<o[h].length;_++){const x=Dd(o[h][_],a);gi(r,x),m.push(x)}l.push(m)}return l}function ni(o,r,a){const l=[];for(let h=0;h<o.length;h++){const m=Gl(o[h],r,a);l.push(m)}return l}function ol(o,r,a,l){if(o[0]<a[0]||o[0]>a[2]){const h=.5*l;let m=o[0]-a[0]>h?-l:a[0]-o[0]>h?l:0;0===m&&(m=o[0]-a[2]>h?-l:a[2]-o[0]>h?l:0),o[0]+=m}gi(r,o)}function ss(o,r,a,l){const h=Math.pow(2,l.z)*os,m=[l.x*os,l.y*os],_=[];if(!o)return _;for(const x of o)for(const w of x){const C=[w.x+m[0],w.y+m[1]];ol(C,r,a,h),_.push(C)}return _}function yr(o,r,a,l){const h=Math.pow(2,l.z)*os,m=[l.x*os,l.y*os],_=[];if(!o)return _;for(const w of o){const C=[];for(const M of w){const I=[M.x+m[0],M.y+m[1]];gi(r,I),C.push(I)}_.push(C)}if(r[2]-r[0]<=h/2){(x=r)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(const w of _)for(const C of w)ol(C,r,a,h)}var x;return _}class as{constructor(r,a){this.type=wt,this.geojson=r,this.geometries=a}static parse(r,a){if(2!==r.length)return a.error(`'within' expression requires exactly one argument, but found ${r.length-1} instead.`);if($l(r[1])){const l=r[1];if("FeatureCollection"===l.type)for(let h=0;h<l.features.length;++h){const m=l.features[h].geometry.type;if("Polygon"===m||"MultiPolygon"===m)return new as(l,l.features[h].geometry)}else if("Feature"===l.type){const h=l.geometry.type;if("Polygon"===h||"MultiPolygon"===h)return new as(l,l.geometry)}else if("Polygon"===l.type||"MultiPolygon"===l.type)return new as(l,l)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(r){if(null!=r.geometry()&&null!=r.canonicalID()){if("Point"===r.geometryType())return function(a,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===l.type){const x=Gl(l.coordinates,m,_),w=ss(a.geometry(),h,m,_);if(!Zc(h,m))return!1;for(const C of w)if(!Gr(C,x))return!1}if("MultiPolygon"===l.type){const x=ni(l.coordinates,m,_),w=ss(a.geometry(),h,m,_);if(!Zc(h,m))return!1;for(const C of w)if(!zr(C,x))return!1}return!0}(r,this.geometries);if("LineString"===r.geometryType())return function(a,l){const h=[1/0,1/0,-1/0,-1/0],m=[1/0,1/0,-1/0,-1/0],_=a.canonicalID();if(!_)return!1;if("Polygon"===l.type){const x=Gl(l.coordinates,m,_),w=yr(a.geometry(),h,m,_);if(!Zc(h,m))return!1;for(const C of w)if(!Ii(C,x))return!1}if("MultiPolygon"===l.type){const x=ni(l.coordinates,m,_),w=yr(a.geometry(),h,m,_);if(!Zc(h,m))return!1;for(const C of w)if(!Wc(C,x))return!1}return!0}(r,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}var ri=as;function lt(o){if(o instanceof Oo&&("get"===o.name&&1===o.args.length||"feature-state"===o.name||"has"===o.name&&1===o.args.length||"properties"===o.name||"geometry-type"===o.name||"id"===o.name||/^filter-/.test(o.name))||o instanceof ri)return!1;let r=!0;return o.eachChild(a=>{r&&!lt(a)&&(r=!1)}),r}function Ut(o){if(o instanceof Oo&&"feature-state"===o.name)return!1;let r=!0;return o.eachChild(a=>{r&&!Ut(a)&&(r=!1)}),r}function Nn(o,r){if(o instanceof Oo&&r.indexOf(o.name)>=0)return!1;let a=!0;return o.eachChild(l=>{a&&!Nn(l,r)&&(a=!1)}),a}class Pt{constructor(r,a){this.type=a.type,this.name=r,this.boundExpression=a}static parse(r,a){if(2!==r.length||"string"!=typeof r[1])return a.error("'var' expression requires exactly one string literal argument.");const l=r[1];return a.scope.has(l)?new Pt(l,a.scope.get(l)):a.error(`Unknown variable "${l}". Make sure "${l}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(r){return this.boundExpression.evaluate(r)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}var Rs=Pt;class vr{constructor(r,a=[],l,h=new df,m=[]){this.registry=r,this.path=a,this.key=a.map(_=>`[${_}]`).join(""),this.scope=h,this.errors=m,this.expectedType=l}parse(r,a,l,h,m={}){return a?this.concat(a,l,h)._parse(r,m):this._parse(r,m)}_parse(r,a){function l(h,m,_){return"assert"===_?new Zi(m,[h]):"coerce"===_?new Lo(m,[h]):h}if(null!==r&&"string"!=typeof r&&"boolean"!=typeof r&&"number"!=typeof r||(r=["literal",r]),Array.isArray(r)){if(0===r.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=r[0];if("string"!=typeof h)return this.error(`Expression name must be a string, but found ${typeof h} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const m=this.registry[h];if(m){let _=m.parse(r,this);if(!_)return null;if(this.expectedType){const x=this.expectedType,w=_.type;if("string"!==x.kind&&"number"!==x.kind&&"boolean"!==x.kind&&"object"!==x.kind&&"array"!==x.kind||"value"!==w.kind)if("color"!==x.kind&&"formatted"!==x.kind&&"resolvedImage"!==x.kind||"value"!==w.kind&&"string"!==w.kind){if(this.checkSubtype(x,w))return null}else _=l(_,x,a.typeAnnotation||"coerce");else _=l(_,x,a.typeAnnotation||"assert")}if(!(_ instanceof qc)&&"resolvedImage"!==_.type.kind&&er(_)){const x=new ti;try{_=new qc(_.type,_.evaluate(x))}catch(w){return this.error(w.message),null}}return _}return this.error(`Unknown expression "${h}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===r?"'undefined' value invalid. Use null instead.":"object"==typeof r?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof r} instead.`)}concat(r,a,l){const h="number"==typeof r?this.path.concat(r):this.path,m=l?this.scope.concat(l):this.scope;return new vr(this.registry,h,a||null,m,this.errors)}error(r,...a){const l=`${this.key}${a.map(h=>`[${h}]`).join("")}`;this.errors.push(new qt(l,r))}checkSubtype(r,a){const l=Tt(r,a);return l&&this.error(l),l}}var Fs=vr;function er(o){if(o instanceof Rs)return er(o.boundExpression);if(o instanceof Oo&&"error"===o.name||o instanceof ks||o instanceof ri)return!1;const r=o instanceof Lo||o instanceof Zi;let a=!0;return o.eachChild(l=>{a=r?a&&er(l):a&&l instanceof qc}),!!a&&lt(o)&&Nn(o,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function Ls(o,r){const a=o.length-1;let l,h,m=0,_=a,x=0;for(;m<=_;)if(x=Math.floor((m+_)/2),l=o[x],h=o[x+1],l<=r){if(x===a||r<h)return x;m=x+1}else{if(!(l>r))throw new $r("Input is not a number.");_=x-1}return 0}class ls{constructor(r,a,l){this.type=r,this.input=a,this.labels=[],this.outputs=[];for(const[h,m]of l)this.labels.push(h),this.outputs.push(m)}static parse(r,a){if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");const l=a.parse(r[1],1,ke);if(!l)return null;const h=[];let m=null;a.expectedType&&"value"!==a.expectedType.kind&&(m=a.expectedType);for(let _=1;_<r.length;_+=2){const x=1===_?-1/0:r[_],w=r[_+1],C=_,M=_+1;if("number"!=typeof x)return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',C);if(h.length&&h[h.length-1][0]>=x)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',C);const I=a.parse(w,M,m);if(!I)return null;m=m||I.type,h.push([x,I])}return new ls(m,l,h)}evaluate(r){const a=this.labels,l=this.outputs;if(1===a.length)return l[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return l[0].evaluate(r);const m=a.length;return h>=a[m-1]?l[m-1].evaluate(r):l[Ls(a,h)].evaluate(r)}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){const r=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&r.push(this.labels[a]),r.push(this.outputs[a].serialize());return r}}var Bt=ls;function Ht(o,r,a){return o*(1-a)+r*a}var zo=Object.freeze({__proto__:null,number:Ht,color:function(o,r,a){return new Cn(Ht(o.r,r.r,a),Ht(o.g,r.g,a),Ht(o.b,r.b,a),Ht(o.a,r.a,a))},array:function(o,r,a){return o.map((l,h)=>Ht(l,r[h],a))}});const ii=4/29,us=6/29,Os=3*us*us,fo=Math.PI/180,Hn=180/Math.PI;function Xc(o){return o>.008856451679035631?Math.pow(o,1/3):o/Os+ii}function hh(o){return o>us?o*o*o:Os*(o-ii)}function Pi(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function _i(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function Hl(o){const r=_i(o.r),a=_i(o.g),l=_i(o.b),h=Xc((.4124564*r+.3575761*a+.1804375*l)/.95047),m=Xc((.2126729*r+.7151522*a+.072175*l)/1);return{l:116*m-16,a:500*(h-m),b:200*(m-Xc((.0193339*r+.119192*a+.9503041*l)/1.08883)),alpha:o.a}}function ql(o){let r=(o.l+16)/116,a=isNaN(o.a)?r:r+o.a/500,l=isNaN(o.b)?r:r-o.b/200;return r=1*hh(r),a=.95047*hh(a),l=1.08883*hh(l),new Cn(Pi(3.2404542*a-1.5371385*r-.4985314*l),Pi(-.969266*a+1.8760108*r+.041556*l),Pi(.0556434*a-.2040259*r+1.0572252*l),o.alpha)}function Zl(o,r,a){const l=r-o;return o+a*(l>180||l<-180?l-360*Math.round(l/360):l)}const oi={forward:Hl,reverse:ql,interpolate:function(o,r,a){return{l:Ht(o.l,r.l,a),a:Ht(o.a,r.a,a),b:Ht(o.b,r.b,a),alpha:Ht(o.alpha,r.alpha,a)}}},sl={forward:function(o){const{l:r,a,b:l}=Hl(o),h=Math.atan2(l,a)*Hn;return{h:h<0?h+360:h,c:Math.sqrt(a*a+l*l),l:r,alpha:o.a}},reverse:function(o){const r=o.h*fo,a=o.c;return ql({l:o.l,a:Math.cos(r)*a,b:Math.sin(r)*a,alpha:o.alpha})},interpolate:function(o,r,a){return{h:Zl(o.h,r.h,a),c:Ht(o.c,r.c,a),l:Ht(o.l,r.l,a),alpha:Ht(o.alpha,r.alpha,a)}}};var Sd=Object.freeze({__proto__:null,lab:oi,hcl:sl});class Yc{constructor(r,a,l,h,m){this.type=r,this.operator=a,this.interpolation=l,this.input=h,this.labels=[],this.outputs=[];for(const[_,x]of m)this.labels.push(_),this.outputs.push(x)}static interpolationFactor(r,a,l,h){let m=0;if("exponential"===r.name)m=dh(a,r.base,l,h);else if("linear"===r.name)m=dh(a,1,l,h);else if("cubic-bezier"===r.name){const _=r.controlPoints;m=new Po(_[0],_[1],_[2],_[3]).solve(dh(a,1,l,h))}return m}static parse(r,a){let[l,h,m,..._]=r;if(!Array.isArray(h)||0===h.length)return a.error("Expected an interpolation type expression.",1);if("linear"===h[0])h={name:"linear"};else if("exponential"===h[0]){const C=h[1];if("number"!=typeof C)return a.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:C}}else{if("cubic-bezier"!==h[0])return a.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const C=h.slice(1);if(4!==C.length||C.some(M=>"number"!=typeof M||M<0||M>1))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:C}}}if(r.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if((r.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(m=a.parse(m,2,ke),!m)return null;const x=[];let w=null;"interpolate-hcl"===l||"interpolate-lab"===l?w=Mi:a.expectedType&&"value"!==a.expectedType.kind&&(w=a.expectedType);for(let C=0;C<_.length;C+=2){const M=_[C],I=_[C+1],P=C+3,F=C+4;if("number"!=typeof M)return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',P);if(x.length&&x[x.length-1][0]>=M)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',P);const z=a.parse(I,F,w);if(!z)return null;w=w||z.type,x.push([M,z])}return"number"===w.kind||"color"===w.kind||"array"===w.kind&&"number"===w.itemType.kind&&"number"==typeof w.N?new Yc(w,l,h,m,x):a.error(`Type ${Gn(w)} is not interpolatable.`)}evaluate(r){const a=this.labels,l=this.outputs;if(1===a.length)return l[0].evaluate(r);const h=this.input.evaluate(r);if(h<=a[0])return l[0].evaluate(r);const m=a.length;if(h>=a[m-1])return l[m-1].evaluate(r);const _=Ls(a,h),x=Yc.interpolationFactor(this.interpolation,h,a[_],a[_+1]),w=l[_].evaluate(r),C=l[_+1].evaluate(r);return"interpolate"===this.operator?zo[this.type.kind.toLowerCase()](w,C,x):"interpolate-hcl"===this.operator?sl.reverse(sl.interpolate(sl.forward(w),sl.forward(C),x)):oi.reverse(oi.interpolate(oi.forward(w),oi.forward(C),x))}eachChild(r){r(this.input);for(const a of this.outputs)r(a)}outputDefined(){return this.outputs.every(r=>r.outputDefined())}serialize(){let r;r="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const a=[this.operator,r,this.input.serialize()];for(let l=0;l<this.labels.length;l++)a.push(this.labels[l],this.outputs[l].serialize());return a}}function dh(o,r,a,l){const h=l-a,m=o-a;return 0===h?0:1===r?m/h:(Math.pow(r,m)-1)/(Math.pow(r,h)-1)}var hs=Yc;class Md{constructor(r,a){this.type=r,this.args=a}static parse(r,a){if(r.length<2)return a.error("Expectected at least one argument.");let l=null;const h=a.expectedType;h&&"value"!==h.kind&&(l=h);const m=[];for(const x of r.slice(1)){const w=a.parse(x,1+m.length,l,void 0,{typeAnnotation:"omit"});if(!w)return null;l=l||w.type,m.push(w)}const _=h&&m.some(x=>Tt(h,x.type));return new Md(_?It:l,m)}evaluate(r){let a,l=null,h=0;for(const m of this.args){if(h++,l=m.evaluate(r),l&&l instanceof hr&&!l.available&&(a||(a=l),l=null,h===this.args.length))return a;if(null!==l)break}return l}eachChild(r){this.args.forEach(r)}outputDefined(){return this.args.every(r=>r.outputDefined())}serialize(){const r=["coalesce"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var ff=Md;class Ad{constructor(r,a){this.type=a.type,this.bindings=[].concat(r),this.result=a}evaluate(r){return this.result.evaluate(r)}eachChild(r){for(const a of this.bindings)r(a[1]);r(this.result)}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found ${r.length-1} instead.`);const l=[];for(let m=1;m<r.length-1;m+=2){const _=r[m];if("string"!=typeof _)return a.error(`Expected string, but found ${typeof _} instead.`,m);if(/[^a-zA-Z0-9_]/.test(_))return a.error("Variable names must contain only alphanumeric characters or '_'.",m);const x=a.parse(r[m+1],m+1);if(!x)return null;l.push([_,x])}const h=a.parse(r[r.length-1],r.length-1,a.expectedType,l);return h?new Ad(l,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const r=["let"];for(const[a,l]of this.bindings)r.push(a,l.serialize());return r.push(this.result.serialize()),r}}var Id=Ad;class Pd{constructor(r,a,l){this.type=r,this.index=a,this.input=l}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const l=a.parse(r[1],1,ke),h=a.parse(r[2],2,mi(a.expectedType||It));return l&&h?new Pd(h.type.itemType,l,h):null}evaluate(r){const a=this.index.evaluate(r),l=this.input.evaluate(r);if(a<0)throw new $r(`Array index out of bounds: ${a} < 0.`);if(a>=l.length)throw new $r(`Array index out of bounds: ${a} > ${l.length-1}.`);if(a!==Math.floor(a))throw new $r(`Array index must be an integer, but found ${a} instead.`);return l[a]}eachChild(r){r(this.index),r(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}var Ig=Pd;class kd{constructor(r,a){this.type=wt,this.needle=r,this.haystack=a}static parse(r,a){if(3!==r.length)return a.error(`Expected 2 arguments, but found ${r.length-1} instead.`);const l=a.parse(r[1],1,It),h=a.parse(r[2],2,It);return l&&h?el(l.type,[wt,Jt,ke,Gc,It])?new kd(l,h):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gn(l.type)} instead`):null}evaluate(r){const a=this.needle.evaluate(r),l=this.haystack.evaluate(r);if(null==l)return!1;if(!tl(a,["boolean","string","number","null"]))throw new $r(`Expected first argument to be of type boolean, string, number or null, but found ${Gn(Qn(a))} instead.`);if(!tl(l,["string","array"]))throw new $r(`Expected second argument to be of type array or string, but found ${Gn(Qn(l))} instead.`);return l.indexOf(a)>=0}eachChild(r){r(this.needle),r(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}var Pg=kd;class Kc{constructor(r,a,l){this.type=ke,this.needle=r,this.haystack=a,this.fromIndex=l}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const l=a.parse(r[1],1,It),h=a.parse(r[2],2,It);if(!l||!h)return null;if(!el(l.type,[wt,Jt,ke,Gc,It]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gn(l.type)} instead`);if(4===r.length){const m=a.parse(r[3],3,ke);return m?new Kc(l,h,m):null}return new Kc(l,h)}evaluate(r){const a=this.needle.evaluate(r),l=this.haystack.evaluate(r);if(!tl(a,["boolean","string","number","null"]))throw new $r(`Expected first argument to be of type boolean, string, number or null, but found ${Gn(Qn(a))} instead.`);if(!tl(l,["string","array"]))throw new $r(`Expected second argument to be of type array or string, but found ${Gn(Qn(l))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(r);return l.indexOf(a,h)}return l.indexOf(a)}eachChild(r){r(this.needle),r(this.haystack),this.fromIndex&&r(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const r=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),r]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}var mf=Kc;class ph{constructor(r,a,l,h,m,_){this.inputType=r,this.type=a,this.input=l,this.cases=h,this.outputs=m,this.otherwise=_}static parse(r,a){if(r.length<5)return a.error(`Expected at least 4 arguments, but found only ${r.length-1}.`);if(r.length%2!=1)return a.error("Expected an even number of arguments.");let l,h;a.expectedType&&"value"!==a.expectedType.kind&&(h=a.expectedType);const m={},_=[];for(let C=2;C<r.length-1;C+=2){let M=r[C];const I=r[C+1];Array.isArray(M)||(M=[M]);const P=a.concat(C);if(0===M.length)return P.error("Expected at least one branch label.");for(const z of M){if("number"!=typeof z&&"string"!=typeof z)return P.error("Branch labels must be numbers or strings.");if("number"==typeof z&&Math.abs(z)>Number.MAX_SAFE_INTEGER)return P.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof z&&Math.floor(z)!==z)return P.error("Numeric branch labels must be integer values.");if(l){if(P.checkSubtype(l,Qn(z)))return null}else l=Qn(z);if(void 0!==m[String(z)])return P.error("Branch labels must be unique.");m[String(z)]=_.length}const F=a.parse(I,C,h);if(!F)return null;h=h||F.type,_.push(F)}const x=a.parse(r[1],1,It);if(!x)return null;const w=a.parse(r[r.length-1],r.length-1,h);return w?"value"!==x.type.kind&&a.concat(1).checkSubtype(l,x.type)?null:new ph(l,h,x,m,_,w):null}evaluate(r){const a=this.input.evaluate(r);return(Qn(a)===this.inputType&&this.outputs[this.cases[a]]||this.otherwise).evaluate(r)}eachChild(r){r(this.input),this.outputs.forEach(r),r(this.otherwise)}outputDefined(){return this.outputs.every(r=>r.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),l=[],h={};for(const _ of a){const x=h[this.cases[_]];void 0===x?(h[this.cases[_]]=l.length,l.push([this.cases[_],[_]])):l[x][1].push(_)}const m=_=>"number"===this.inputType.kind?Number(_):_;for(const[_,x]of l)r.push(1===x.length?m(x[0]):x.map(m)),r.push(this.outputs[_].serialize());return r.push(this.otherwise.serialize()),r}}var kg=ph;class Rd{constructor(r,a,l){this.type=r,this.branches=a,this.otherwise=l}static parse(r,a){if(r.length<4)return a.error(`Expected at least 3 arguments, but found only ${r.length-1}.`);if(r.length%2!=0)return a.error("Expected an odd number of arguments.");let l;a.expectedType&&"value"!==a.expectedType.kind&&(l=a.expectedType);const h=[];for(let _=1;_<r.length-1;_+=2){const x=a.parse(r[_],_,wt);if(!x)return null;const w=a.parse(r[_+1],_+1,l);if(!w)return null;h.push([x,w]),l=l||w.type}const m=a.parse(r[r.length-1],r.length-1,l);return m?new Rd(l,h,m):null}evaluate(r){for(const[a,l]of this.branches)if(a.evaluate(r))return l.evaluate(r);return this.otherwise.evaluate(r)}eachChild(r){for(const[a,l]of this.branches)r(a),r(l);r(this.otherwise)}outputDefined(){return this.branches.every(([r,a])=>a.outputDefined())&&this.otherwise.outputDefined()}serialize(){const r=["case"];return this.eachChild(a=>{r.push(a.serialize())}),r}}var fh=Rd;class ma{constructor(r,a,l,h){this.type=r,this.input=a,this.beginIndex=l,this.endIndex=h}static parse(r,a){if(r.length<=2||r.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${r.length-1} instead.`);const l=a.parse(r[1],1,It),h=a.parse(r[2],2,ke);if(!l||!h)return null;if(!el(l.type,[mi(It),Jt,It]))return a.error(`Expected first argument to be of type array or string, but found ${Gn(l.type)} instead`);if(4===r.length){const m=a.parse(r[3],3,ke);return m?new ma(l.type,l,h,m):null}return new ma(l.type,l,h)}evaluate(r){const a=this.input.evaluate(r),l=this.beginIndex.evaluate(r);if(!tl(a,["string","array"]))throw new $r(`Expected first argument to be of type array or string, but found ${Gn(Qn(a))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(r);return a.slice(l,h)}return a.slice(l)}eachChild(r){r(this.input),r(this.beginIndex),this.endIndex&&r(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const r=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),r]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}var gf=ma;function _f(o,r){return"=="===o||"!="===o?"boolean"===r.kind||"string"===r.kind||"number"===r.kind||"null"===r.kind||"value"===r.kind:"string"===r.kind||"number"===r.kind||"value"===r.kind}function yf(o,r,a,l){return 0===l.compare(r,a)}function Xi(o,r,a){const l="=="!==o&&"!="!==o;return class kD{constructor(m,_,x){this.type=wt,this.lhs=m,this.rhs=_,this.collator=x,this.hasUntypedArgument="value"===m.type.kind||"value"===_.type.kind}static parse(m,_){if(3!==m.length&&4!==m.length)return _.error("Expected two or three arguments.");const x=m[0];let w=_.parse(m[1],1,It);if(!w)return null;if(!_f(x,w.type))return _.concat(1).error(`"${x}" comparisons are not supported for type '${Gn(w.type)}'.`);let C=_.parse(m[2],2,It);if(!C)return null;if(!_f(x,C.type))return _.concat(2).error(`"${x}" comparisons are not supported for type '${Gn(C.type)}'.`);if(w.type.kind!==C.type.kind&&"value"!==w.type.kind&&"value"!==C.type.kind)return _.error(`Cannot compare types '${Gn(w.type)}' and '${Gn(C.type)}'.`);l&&("value"===w.type.kind&&"value"!==C.type.kind?w=new Zi(C.type,[w]):"value"!==w.type.kind&&"value"===C.type.kind&&(C=new Zi(w.type,[C])));let M=null;if(4===m.length){if("string"!==w.type.kind&&"string"!==C.type.kind&&"value"!==w.type.kind&&"value"!==C.type.kind)return _.error("Cannot use collator to compare non-string types.");if(M=_.parse(m[3],3,rs),!M)return null}return new kD(w,C,M)}evaluate(m){const _=this.lhs.evaluate(m),x=this.rhs.evaluate(m);if(l&&this.hasUntypedArgument){const w=Qn(_),C=Qn(x);if(w.kind!==C.kind||"string"!==w.kind&&"number"!==w.kind)throw new $r(`Expected arguments for "${o}" to be (string, string) or (number, number), but found (${w.kind}, ${C.kind}) instead.`)}if(this.collator&&!l&&this.hasUntypedArgument){const w=Qn(_),C=Qn(x);if("string"!==w.kind||"string"!==C.kind)return r(m,_,x)}return this.collator?a(m,_,x,this.collator.evaluate(m)):r(m,_,x)}eachChild(m){m(this.lhs),m(this.rhs),this.collator&&m(this.collator)}outputDefined(){return!0}serialize(){const m=[o];return this.eachChild(_=>{m.push(_.serialize())}),m}}}const vf=Xi("==",function(o,r,a){return r===a},yf),si=Xi("!=",function(o,r,a){return r!==a},function(o,r,a,l){return!yf(0,r,a,l)}),mh=Xi("<",function(o,r,a){return r<a},function(o,r,a,l){return l.compare(r,a)<0}),Fd=Xi(">",function(o,r,a){return r>a},function(o,r,a,l){return l.compare(r,a)>0}),xf=Xi("<=",function(o,r,a){return r<=a},function(o,r,a,l){return l.compare(r,a)<=0}),Ld=Xi(">=",function(o,r,a){return r>=a},function(o,r,a,l){return l.compare(r,a)>=0});class Jc{constructor(r,a,l,h,m){this.type=Jt,this.number=r,this.locale=a,this.currency=l,this.minFractionDigits=h,this.maxFractionDigits=m}static parse(r,a){if(3!==r.length)return a.error("Expected two arguments.");const l=a.parse(r[1],1,ke);if(!l)return null;const h=r[2];if("object"!=typeof h||Array.isArray(h))return a.error("NumberFormat options argument must be an object.");let m=null;if(h.locale&&(m=a.parse(h.locale,1,Jt),!m))return null;let _=null;if(h.currency&&(_=a.parse(h.currency,1,Jt),!_))return null;let x=null;if(h["min-fraction-digits"]&&(x=a.parse(h["min-fraction-digits"],1,ke),!x))return null;let w=null;return h["max-fraction-digits"]&&(w=a.parse(h["max-fraction-digits"],1,ke),!w)?null:new Jc(l,m,_,x,w)}evaluate(r){return new Intl.NumberFormat(this.locale?this.locale.evaluate(r):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(r):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(r):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(r):void 0}).format(this.number.evaluate(r))}eachChild(r){r(this.number),this.locale&&r(this.locale),this.currency&&r(this.currency),this.minFractionDigits&&r(this.minFractionDigits),this.maxFractionDigits&&r(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const r={};return this.locale&&(r.locale=this.locale.serialize()),this.currency&&(r.currency=this.currency.serialize()),this.minFractionDigits&&(r["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(r["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),r]}}class Qc{constructor(r){this.type=ke,this.input=r}static parse(r,a){if(2!==r.length)return a.error(`Expected 1 argument, but found ${r.length-1} instead.`);const l=a.parse(r[1],1);return l?"array"!==l.type.kind&&"string"!==l.type.kind&&"value"!==l.type.kind?a.error(`Expected argument of type string or array, but found ${Gn(l.type)} instead.`):new Qc(l):null}evaluate(r){const a=this.input.evaluate(r);if("string"==typeof a||Array.isArray(a))return a.length;throw new $r(`Expected value to be of type string or array, but found ${Gn(Qn(a))} instead.`)}eachChild(r){r(this.input)}outputDefined(){return!1}serialize(){const r=["length"];return this.eachChild(a=>{r.push(a.serialize())}),r}}const Wl={"==":vf,"!=":si,">":Fd,"<":mh,">=":Ld,"<=":xf,array:Zi,at:Ig,boolean:Zi,case:fh,coalesce:ff,collator:ks,format:Fo,image:rl,in:Pg,"index-of":mf,interpolate:hs,"interpolate-hcl":hs,"interpolate-lab":hs,length:Qc,let:Id,literal:qc,match:kg,number:Zi,"number-format":Jc,object:Zi,slice:gf,step:Bt,string:Zi,"to-boolean":Lo,"to-color":Lo,"to-number":Lo,"to-string":Lo,var:Rs,within:ri};function gh(o,[r,a,l,h]){r=r.evaluate(o),a=a.evaluate(o),l=l.evaluate(o);const m=h?h.evaluate(o):1,_=Hc(r,a,l,m);if(_)throw new $r(_);return new Cn(r/255*m,a/255*m,l/255*m,m)}function ai(o,r){return o in r}function Xl(o,r){const a=r[o];return void 0===a?null:a}function ga(o){return{type:o}}Oo.register(Wl,{error:[{kind:"error"},[Jt],(o,[r])=>{throw new $r(r.evaluate(o))}],typeof:[Jt,[It],(o,[r])=>Gn(Qn(r.evaluate(o)))],"to-rgba":[mi(ke,4),[Mi],(o,[r])=>r.evaluate(o).toArray()],rgb:[Mi,[ke,ke,ke],gh],rgba:[Mi,[ke,ke,ke,ke],gh],has:{type:wt,overloads:[[[Jt],(o,[r])=>ai(r.evaluate(o),o.properties())],[[Jt,Is],(o,[r,a])=>ai(r.evaluate(o),a.evaluate(o))]]},get:{type:It,overloads:[[[Jt],(o,[r])=>Xl(r.evaluate(o),o.properties())],[[Jt,Is],(o,[r,a])=>Xl(r.evaluate(o),a.evaluate(o))]]},"feature-state":[It,[Jt],(o,[r])=>Xl(r.evaluate(o),o.featureState||{})],properties:[Is,[],o=>o.properties()],"geometry-type":[Jt,[],o=>o.geometryType()],id:[It,[],o=>o.id()],zoom:[ke,[],o=>o.globals.zoom],pitch:[ke,[],o=>o.globals.pitch||0],"distance-from-center":[ke,[],o=>o.distanceFromCenter()],"heatmap-density":[ke,[],o=>o.globals.heatmapDensity||0],"line-progress":[ke,[],o=>o.globals.lineProgress||0],"sky-radial-progress":[ke,[],o=>o.globals.skyRadialProgress||0],accumulated:[It,[],o=>void 0===o.globals.accumulated?null:o.globals.accumulated],"+":[ke,ga(ke),(o,r)=>{let a=0;for(const l of r)a+=l.evaluate(o);return a}],"*":[ke,ga(ke),(o,r)=>{let a=1;for(const l of r)a*=l.evaluate(o);return a}],"-":{type:ke,overloads:[[[ke,ke],(o,[r,a])=>r.evaluate(o)-a.evaluate(o)],[[ke],(o,[r])=>-r.evaluate(o)]]},"/":[ke,[ke,ke],(o,[r,a])=>r.evaluate(o)/a.evaluate(o)],"%":[ke,[ke,ke],(o,[r,a])=>r.evaluate(o)%a.evaluate(o)],ln2:[ke,[],()=>Math.LN2],pi:[ke,[],()=>Math.PI],e:[ke,[],()=>Math.E],"^":[ke,[ke,ke],(o,[r,a])=>Math.pow(r.evaluate(o),a.evaluate(o))],sqrt:[ke,[ke],(o,[r])=>Math.sqrt(r.evaluate(o))],log10:[ke,[ke],(o,[r])=>Math.log(r.evaluate(o))/Math.LN10],ln:[ke,[ke],(o,[r])=>Math.log(r.evaluate(o))],log2:[ke,[ke],(o,[r])=>Math.log(r.evaluate(o))/Math.LN2],sin:[ke,[ke],(o,[r])=>Math.sin(r.evaluate(o))],cos:[ke,[ke],(o,[r])=>Math.cos(r.evaluate(o))],tan:[ke,[ke],(o,[r])=>Math.tan(r.evaluate(o))],asin:[ke,[ke],(o,[r])=>Math.asin(r.evaluate(o))],acos:[ke,[ke],(o,[r])=>Math.acos(r.evaluate(o))],atan:[ke,[ke],(o,[r])=>Math.atan(r.evaluate(o))],min:[ke,ga(ke),(o,r)=>Math.min(...r.map(a=>a.evaluate(o)))],max:[ke,ga(ke),(o,r)=>Math.max(...r.map(a=>a.evaluate(o)))],abs:[ke,[ke],(o,[r])=>Math.abs(r.evaluate(o))],round:[ke,[ke],(o,[r])=>{const a=r.evaluate(o);return a<0?-Math.round(-a):Math.round(a)}],floor:[ke,[ke],(o,[r])=>Math.floor(r.evaluate(o))],ceil:[ke,[ke],(o,[r])=>Math.ceil(r.evaluate(o))],"filter-==":[wt,[Jt,It],(o,[r,a])=>o.properties()[r.value]===a.value],"filter-id-==":[wt,[It],(o,[r])=>o.id()===r.value],"filter-type-==":[wt,[Jt],(o,[r])=>o.geometryType()===r.value],"filter-<":[wt,[Jt,It],(o,[r,a])=>{const l=o.properties()[r.value],h=a.value;return typeof l==typeof h&&l<h}],"filter-id-<":[wt,[It],(o,[r])=>{const a=o.id(),l=r.value;return typeof a==typeof l&&a<l}],"filter->":[wt,[Jt,It],(o,[r,a])=>{const l=o.properties()[r.value],h=a.value;return typeof l==typeof h&&l>h}],"filter-id->":[wt,[It],(o,[r])=>{const a=o.id(),l=r.value;return typeof a==typeof l&&a>l}],"filter-<=":[wt,[Jt,It],(o,[r,a])=>{const l=o.properties()[r.value],h=a.value;return typeof l==typeof h&&l<=h}],"filter-id-<=":[wt,[It],(o,[r])=>{const a=o.id(),l=r.value;return typeof a==typeof l&&a<=l}],"filter->=":[wt,[Jt,It],(o,[r,a])=>{const l=o.properties()[r.value],h=a.value;return typeof l==typeof h&&l>=h}],"filter-id->=":[wt,[It],(o,[r])=>{const a=o.id(),l=r.value;return typeof a==typeof l&&a>=l}],"filter-has":[wt,[It],(o,[r])=>r.value in o.properties()],"filter-has-id":[wt,[],o=>null!==o.id()&&void 0!==o.id()],"filter-type-in":[wt,[mi(Jt)],(o,[r])=>r.value.indexOf(o.geometryType())>=0],"filter-id-in":[wt,[mi(It)],(o,[r])=>r.value.indexOf(o.id())>=0],"filter-in-small":[wt,[Jt,mi(It)],(o,[r,a])=>a.value.indexOf(o.properties()[r.value])>=0],"filter-in-large":[wt,[Jt,mi(It)],(o,[r,a])=>function(l,h,m,_){for(;m<=_;){const x=m+_>>1;if(h[x]===l)return!0;h[x]>l?_=x-1:m=x+1}return!1}(o.properties()[r.value],a.value,0,a.value.length-1)],all:{type:wt,overloads:[[[wt,wt],(o,[r,a])=>r.evaluate(o)&&a.evaluate(o)],[ga(wt),(o,r)=>{for(const a of r)if(!a.evaluate(o))return!1;return!0}]]},any:{type:wt,overloads:[[[wt,wt],(o,[r,a])=>r.evaluate(o)||a.evaluate(o)],[ga(wt),(o,r)=>{for(const a of r)if(a.evaluate(o))return!0;return!1}]]},"!":[wt,[wt],(o,[r])=>!r.evaluate(o)],"is-supported-script":[wt,[Jt],(o,[r])=>{const a=o.globals&&o.globals.isSupportedScript;return!a||a(r.evaluate(o))}],upcase:[Jt,[Jt],(o,[r])=>r.evaluate(o).toUpperCase()],downcase:[Jt,[Jt],(o,[r])=>r.evaluate(o).toLowerCase()],concat:[Jt,ga(It),(o,r)=>r.map(a=>nl(a.evaluate(o))).join("")],"resolved-locale":[Jt,[rs],(o,[r])=>r.evaluate(o).resolvedLocale()]});var _a=Wl;function Od(o){return{result:"success",value:o}}function al(o){return{result:"error",value:o}}function zs(o){return"data-driven"===o["property-type"]||"cross-faded-data-driven"===o["property-type"]}function _h(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function ll(o){return!!o.expression&&o.expression.interpolated}function on(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":null===o?"null":typeof o}function Wn(o){return"object"==typeof o&&null!==o&&!Array.isArray(o)}function zd(o){return o}function Bd(o,r){const a="color"===r.type,l=o.stops&&"object"==typeof o.stops[0][0],h=l||!(l||void 0!==o.property),m=o.type||(ll(r)?"exponential":"interval");if(a&&((o=qi({},o)).stops&&(o.stops=o.stops.map(C=>[C[0],Cn.parse(C[1])])),o.default=Cn.parse(o.default?o.default:r.default)),o.colorSpace&&"rgb"!==o.colorSpace&&!Sd[o.colorSpace])throw new Error(`Unknown color space: ${o.colorSpace}`);let _,x,w;if("exponential"===m)_=Kl;else if("interval"===m)_=Yl;else if("categorical"===m){_=Nd,x=Object.create(null);for(const C of o.stops)x[C[0]]=C[1];w=typeof o.stops[0][0]}else{if("identity"!==m)throw new Error(`Unknown function type "${m}"`);_=Yi}if(l){const C={},M=[];for(let F=0;F<o.stops.length;F++){const z=o.stops[F],U=z[0].zoom;void 0===C[U]&&(C[U]={zoom:U,type:o.type,property:o.property,default:o.default,stops:[]},M.push(U)),C[U].stops.push([z[0].value,z[1]])}const I=[];for(const F of M)I.push([C[F].zoom,Bd(C[F],r)]);const P={name:"linear"};return{kind:"composite",interpolationType:P,interpolationFactor:hs.interpolationFactor.bind(void 0,P),zoomStops:I.map(F=>F[0]),evaluate:({zoom:F},z)=>Kl({stops:I,base:o.base},r,F).evaluate(F,z)}}if(h){const C="exponential"===m?{name:"exponential",base:void 0!==o.base?o.base:1}:null;return{kind:"camera",interpolationType:C,interpolationFactor:hs.interpolationFactor.bind(void 0,C),zoomStops:o.stops.map(M=>M[0]),evaluate:({zoom:M})=>_(o,r,M,x,w)}}return{kind:"source",evaluate(C,M){const I=M&&M.properties?M.properties[o.property]:void 0;return void 0===I?wn(o.default,r.default):_(o,r,I,x,w)}}}function wn(o,r,a){return void 0!==o?o:void 0!==r?r:void 0!==a?a:void 0}function Nd(o,r,a,l,h){return wn(typeof a===h?l[a]:void 0,o.default,r.default)}function Yl(o,r,a){if("number"!==on(a))return wn(o.default,r.default);const l=o.stops.length;if(1===l||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[l-1][0])return o.stops[l-1][1];const h=Ls(o.stops.map(m=>m[0]),a);return o.stops[h][1]}function Kl(o,r,a){const l=void 0!==o.base?o.base:1;if("number"!==on(a))return wn(o.default,r.default);const h=o.stops.length;if(1===h||a<=o.stops[0][0])return o.stops[0][1];if(a>=o.stops[h-1][0])return o.stops[h-1][1];const m=Ls(o.stops.map(M=>M[0]),a),_=function(M,I,P,F){const z=F-P,U=M-P;return 0===z?0:1===I?U/z:(Math.pow(I,U)-1)/(Math.pow(I,z)-1)}(a,l,o.stops[m][0],o.stops[m+1][0]),x=o.stops[m][1],w=o.stops[m+1][1];let C=zo[r.type]||zd;if(o.colorSpace&&"rgb"!==o.colorSpace){const M=Sd[o.colorSpace];C=(I,P)=>M.reverse(M.interpolate(M.forward(I),M.forward(P),_))}return"function"==typeof x.evaluate?{evaluate(...M){const I=x.evaluate.apply(void 0,M),P=w.evaluate.apply(void 0,M);if(void 0!==I&&void 0!==P)return C(I,P,_)}}:C(x,w,_)}function Yi(o,r,a){return"color"===r.type?a=Cn.parse(a):"formatted"===r.type?a=ei.fromString(a.toString()):"resolvedImage"===r.type?a=hr.fromString(a.toString()):on(a)===r.type||"enum"===r.type&&r.values[a]||(a=void 0),wn(a,o.default,r.default)}class eu{constructor(r,a){var l;this.expression=r,this._warningHistory={},this._evaluator=new ti,this._defaultValue=a?"color"===(l=a).type&&(Wn(l.default)||Array.isArray(l.default))?new Cn(0,0,0,0):"color"===l.type?Cn.parse(l.default)||null:void 0===l.default?null:l.default:null,this._enumValues=a&&"enum"===a.type?a.values:null}evaluateWithoutErrorHandling(r,a,l,h,m,_,x,w){return this._evaluator.globals=r,this._evaluator.feature=a,this._evaluator.featureState=l,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null,this.expression.evaluate(this._evaluator)}evaluate(r,a,l,h,m,_,x,w){this._evaluator.globals=r,this._evaluator.feature=a||null,this._evaluator.featureState=l||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=m||null,this._evaluator.formattedSection=_||null,this._evaluator.featureTileCoord=x||null,this._evaluator.featureDistanceData=w||null;try{const C=this.expression.evaluate(this._evaluator);if(null==C||"number"==typeof C&&C!=C)return this._defaultValue;if(this._enumValues&&!(C in this._enumValues))throw new $r(`Expected value to be one of ${Object.keys(this._enumValues).map(M=>JSON.stringify(M)).join(", ")}, but found ${JSON.stringify(C)} instead.`);return C}catch(C){return this._warningHistory[C.message]||(this._warningHistory[C.message]=!0,"undefined"!=typeof console&&console.warn(C.message)),this._defaultValue}}}function cl(o){return Array.isArray(o)&&o.length>0&&"string"==typeof o[0]&&o[0]in _a}function Ki(o,r){const a=new Fs(_a,[],r?function(h){const m={color:Mi,string:Jt,number:ke,enum:Jt,boolean:wt,formatted:pa,resolvedImage:Ps};return"array"===h.type?mi(m[h.value]||It,h.length):m[h.type]}(r):void 0),l=a.parse(o,void 0,void 0,void 0,r&&"string"===r.type?{typeAnnotation:"coerce"}:void 0);return l?Od(new eu(l,r)):al(a.errors)}class Hr{constructor(r,a){this.kind=r,this._styleExpression=a,this.isStateDependent="constant"!==r&&!Ut(a.expression)}evaluateWithoutErrorHandling(r,a,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,l,h,m,_)}evaluate(r,a,l,h,m,_){return this._styleExpression.evaluate(r,a,l,h,m,_)}}class ul{constructor(r,a,l,h){this.kind=r,this.zoomStops=l,this._styleExpression=a,this.isStateDependent="camera"!==r&&!Ut(a.expression),this.interpolationType=h}evaluateWithoutErrorHandling(r,a,l,h,m,_){return this._styleExpression.evaluateWithoutErrorHandling(r,a,l,h,m,_)}evaluate(r,a,l,h,m,_){return this._styleExpression.evaluate(r,a,l,h,m,_)}interpolationFactor(r,a,l){return this.interpolationType?hs.interpolationFactor(this.interpolationType,r,a,l):0}}function hl(o,r){if("error"===(o=Ki(o,r)).result)return o;const a=o.value.expression,l=lt(a);if(!l&&!zs(r))return al([new qt("","data expressions not supported")]);const h=Nn(a,["zoom","pitch","distance-from-center"]);if(!h&&!_h(r))return al([new qt("","zoom expressions not supported")]);const m=ki(a);return m||h?m instanceof qt?al([m]):m instanceof hs&&!ll(r)?al([new qt("",'"interpolate" expressions cannot be used with this property')]):Od(m?new ul(l?"camera":"composite",o.value,m.labels,m instanceof hs?m.interpolation:void 0):new Hr(l?"constant":"source",o.value)):al([new qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class Jl{constructor(r,a){this._parameters=r,this._specification=a,qi(this,Bd(this._parameters,this._specification))}static deserialize(r){return new Jl(r._parameters,r._specification)}static serialize(r){return{_parameters:r._parameters,_specification:r._specification}}}function ki(o){let r=null;if(o instanceof Id)r=ki(o.result);else if(o instanceof ff){for(const a of o.args)if(r=ki(a),r)break}else(o instanceof Bt||o instanceof hs)&&o.input instanceof Oo&&"zoom"===o.input.name&&(r=o);return r instanceof qt||o.eachChild(a=>{const l=ki(a);l instanceof qt?r=l:!r&&l?r=new qt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):r&&l&&r!==l&&(r=new qt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),r}class nt{constructor(r,a,l,h){this.message=(r?`${r}: `:"")+l,h&&(this.identifier=h),null!=a&&a.__line__&&(this.line=a.__line__)}}function yi(o){const r=o.key,a=o.value,l=o.valueSpec||{},h=o.objectElementValidators||{},m=o.style,_=o.styleSpec;let x=[];const w=on(a);if("object"!==w)return[new nt(r,a,`object expected, ${w} found`)];for(const C in a){const M=C.split(".")[0],I=l[M]||l["*"];let P;h[M]?P=h[M]:l[M]?P=dr:h["*"]?P=h["*"]:l["*"]&&(P=dr),P?x=x.concat(P({key:(r&&`${r}.`)+C,value:a[C],valueSpec:I,style:m,styleSpec:_,object:a,objectKey:C},a)):x.push(new nt(r,a[C],`unknown property "${C}"`))}for(const C in l)h[C]||l[C].required&&void 0===l[C].default&&void 0===a[C]&&x.push(new nt(r,a,`missing required property "${C}"`));return x}function Mt(o){const r=o.value,a=o.valueSpec,l=o.style,h=o.styleSpec,m=o.key,_=o.arrayElementValidator||dr;if("array"!==on(r))return[new nt(m,r,`array expected, ${on(r)} found`)];if(a.length&&r.length!==a.length)return[new nt(m,r,`array length ${a.length} expected, length ${r.length} found`)];if(a["min-length"]&&r.length<a["min-length"])return[new nt(m,r,`array length at least ${a["min-length"]} expected, length ${r.length} found`)];let x={type:a.value,values:a.values,minimum:a.minimum,maximum:a.maximum,function:void 0};h.$version<7&&(x.function=a.function),"object"===on(a.value)&&(x=a.value);let w=[];for(let C=0;C<r.length;C++)w=w.concat(_({array:r,arrayIndex:C,value:r[C],valueSpec:x,style:l,styleSpec:h,key:`${m}[${C}]`}));return w}function Bs(o){const r=o.key,a=o.value,l=o.valueSpec;let h=on(a);if("number"===h&&a!=a&&(h="NaN"),"number"!==h)return[new nt(r,a,`number expected, ${h} found`)];if("minimum"in l){let m=l.minimum;if("array"===on(l.minimum)&&(m=l.minimum[o.arrayIndex]),a<m)return[new nt(r,a,`${a} is less than the minimum value ${m}`)]}if("maximum"in l){let m=l.maximum;if("array"===on(l.maximum)&&(m=l.maximum[o.arrayIndex]),a>m)return[new nt(r,a,`${a} is greater than the maximum value ${m}`)]}return[]}function Vd(o){const r=o.valueSpec,a=Zn(o.value.type);let l,h,m,_={};const x="categorical"!==a&&void 0===o.value.property,w=!x,C="array"===on(o.value.stops)&&"array"===on(o.value.stops[0])&&"object"===on(o.value.stops[0][0]),M=yi({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(F){if("identity"===a)return[new nt(F.key,F.value,'identity function may not have a "stops" property')];let z=[];const U=F.value;return z=z.concat(Mt({key:F.key,value:U,valueSpec:F.valueSpec,style:F.style,styleSpec:F.styleSpec,arrayElementValidator:I})),"array"===on(U)&&0===U.length&&z.push(new nt(F.key,U,"array must have at least one stop")),z},default:function(F){return dr({key:F.key,value:F.value,valueSpec:r,style:F.style,styleSpec:F.styleSpec})}}});return"identity"===a&&x&&M.push(new nt(o.key,o.value,'missing required property "property"')),"identity"===a||o.value.stops||M.push(new nt(o.key,o.value,'missing required property "stops"')),"exponential"===a&&o.valueSpec.expression&&!ll(o.valueSpec)&&M.push(new nt(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(w&&!zs(o.valueSpec)?M.push(new nt(o.key,o.value,"property functions not supported")):x&&!_h(o.valueSpec)&&M.push(new nt(o.key,o.value,"zoom functions not supported"))),"categorical"!==a&&!C||void 0!==o.value.property||M.push(new nt(o.key,o.value,'"property" property is required')),M;function I(F){let z=[];const U=F.value,X=F.key;if("array"!==on(U))return[new nt(X,U,`array expected, ${on(U)} found`)];if(2!==U.length)return[new nt(X,U,`array length 2 expected, length ${U.length} found`)];if(C){if("object"!==on(U[0]))return[new nt(X,U,`object expected, ${on(U[0])} found`)];if(void 0===U[0].zoom)return[new nt(X,U,"object stop key must have zoom")];if(void 0===U[0].value)return[new nt(X,U,"object stop key must have value")];const ee=Zn(U[0].zoom);if("number"!=typeof ee)return[new nt(X,U[0].zoom,"stop zoom values must be numbers")];if(m&&m>ee)return[new nt(X,U[0].zoom,"stop zoom values must appear in ascending order")];ee!==m&&(m=ee,h=void 0,_={}),z=z.concat(yi({key:`${X}[0]`,value:U[0],valueSpec:{zoom:{}},style:F.style,styleSpec:F.styleSpec,objectElementValidators:{zoom:Bs,value:P}}))}else z=z.concat(P({key:`${X}[0]`,value:U[0],valueSpec:{},style:F.style,styleSpec:F.styleSpec},U));return cl(ho(U[1]))?z.concat([new nt(`${X}[1]`,U[1],"expressions are not allowed in function stops.")]):z.concat(dr({key:`${X}[1]`,value:U[1],valueSpec:r,style:F.style,styleSpec:F.styleSpec}))}function P(F,z){const U=on(F.value),X=Zn(F.value),ee=null!==F.value?F.value:z;if(l){if(U!==l)return[new nt(F.key,ee,`${U} stop domain type must match previous stop domain type ${l}`)]}else l=U;if("number"!==U&&"string"!==U&&"boolean"!==U&&"number"!=typeof X&&"string"!=typeof X&&"boolean"!=typeof X)return[new nt(F.key,ee,"stop domain value must be a number, string, or boolean")];if("number"!==U&&"categorical"!==a){let ce=`number expected, ${U} found`;return zs(r)&&void 0===a&&(ce+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new nt(F.key,ee,ce)]}return"categorical"!==a||"number"!==U||"number"==typeof X&&isFinite(X)&&Math.floor(X)===X?"categorical"!==a&&"number"===U&&"number"==typeof X&&"number"==typeof h&&void 0!==h&&X<h?[new nt(F.key,ee,"stop domain values must appear in ascending order")]:(h=X,"categorical"===a&&X in _?[new nt(F.key,ee,"stop domain values must be unique")]:(_[X]=!0,[])):[new nt(F.key,ee,`integer expected, found ${String(X)}`)]}}function ya(o){const r=("property"===o.expressionContext?hl:Ki)(ho(o.value),o.valueSpec);if("error"===r.result)return r.value.map(l=>new nt(`${o.key}${l.key}`,o.value,l.message));const a=r.value.expression||r.value._styleExpression.expression;if("property"===o.expressionContext&&"text-font"===o.propertyKey&&!a.outputDefined())return[new nt(o.key,o.value,`Invalid data expression for "${o.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===o.expressionContext&&"layout"===o.propertyType&&!Ut(a))return[new nt(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===o.expressionContext)return tu(a,o);if(o.expressionContext&&0===o.expressionContext.indexOf("cluster")){if(!Nn(a,["zoom","feature-state"]))return[new nt(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===o.expressionContext&&!lt(a))return[new nt(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function tu(o,r){const a=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const h of r.valueSpec.expression.parameters)a.delete(h);if(0===a.size)return[];const l=[];return o instanceof Oo&&a.has(o.name)?[new nt(r.key,r.value,`["${o.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(o.eachChild(h=>{l.push(...tu(h,r))}),l)}function Ql(o){const r=o.key,a=o.value,l=o.valueSpec,h=[];return Array.isArray(l.values)?-1===l.values.indexOf(Zn(a))&&h.push(new nt(r,a,`expected one of [${l.values.join(", ")}], ${JSON.stringify(a)} found`)):-1===Object.keys(l.values).indexOf(Zn(a))&&h.push(new nt(r,a,`expected one of [${Object.keys(l.values).join(", ")}], ${JSON.stringify(a)} found`)),h}function nu(o){if(!0===o||!1===o)return!0;if(!Array.isArray(o)||0===o.length)return!1;switch(o[0]){case"has":return o.length>=2&&"$id"!==o[1]&&"$type"!==o[1];case"in":return o.length>=3&&("string"!=typeof o[1]||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==o.length||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(const r of o.slice(1))if(!nu(r)&&"boolean"!=typeof r)return!1;return!0;default:return!0}}function va(o,r="fill"){if(null==o)return{filter:()=>!0,needGeometry:!1,needFeature:!1};nu(o)||(o=mo(o));const a=o;let l=!0;try{l=function(C){if(!Zt(C))return C;let M=ho(C);return $e(M),M=Ud(M),M}(a)}catch(C){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(a,null,2)}\n        `)}const h=ye[`filter_${r}`],m=Ki(l,h);let _=null;if("error"===m.result)throw new Error(m.value.map(C=>`${C.key}: ${C.message}`).join(", "));_=(C,M,I)=>m.value.evaluate(C,M,{},I);let x=null,w=null;if(l!==a){const C=Ki(a,h);if("error"===C.result)throw new Error(C.value.map(M=>`${M.key}: ${M.message}`).join(", "));x=(M,I,P,F,z)=>C.value.evaluate(M,I,{},P,void 0,void 0,F,z),w=!lt(C.value.expression)}return _=_,{filter:_,dynamicFilter:x||void 0,needGeometry:dl(l),needFeature:!!w}}function Ud(o){if(!Array.isArray(o))return o;const r=function(a){if(ru.has(a[0]))for(let l=1;l<a.length;l++)if(Zt(a[l]))return!0;return a}(o);return!0===r?r:r.map(a=>Ud(a))}function $e(o){let r=!1;const a=[];if("case"===o[0]){for(let l=1;l<o.length-1;l+=2)r=r||Zt(o[l]),a.push(o[l+1]);a.push(o[o.length-1])}else if("match"===o[0]){r=r||Zt(o[1]);for(let l=2;l<o.length-1;l+=2)a.push(o[l+1]);a.push(o[o.length-1])}else if("step"===o[0]){r=r||Zt(o[1]);for(let l=1;l<o.length-1;l+=2)a.push(o[l+1])}r&&(o.length=0,o.push("any",...a));for(let l=1;l<o.length;l++)$e(o[l])}function Zt(o){if(!Array.isArray(o))return!1;if("pitch"===(r=o[0])||"distance-from-center"===r)return!0;var r;for(let a=1;a<o.length;a++)if(Zt(o[a]))return!0;return!1}const ru=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Cr(o,r){return o<r?-1:o>r?1:0}function dl(o){if(!Array.isArray(o))return!1;if("within"===o[0])return!0;for(let r=1;r<o.length;r++)if(dl(o[r]))return!0;return!1}function mo(o){if(!o)return!0;const r=o[0];return o.length<=1?"any"!==r:"=="===r?tr(o[1],o[2],"=="):"!="===r?yh(tr(o[1],o[2],"==")):"<"===r||">"===r||"<="===r||">="===r?tr(o[1],o[2],r):"any"===r?(a=o.slice(1),["any"].concat(a.map(mo))):"all"===r?["all"].concat(o.slice(1).map(mo)):"none"===r?["all"].concat(o.slice(1).map(mo).map(yh)):"in"===r?xa(o[1],o.slice(2)):"!in"===r?yh(xa(o[1],o.slice(2))):"has"===r?iu(o[1]):"!has"===r?yh(iu(o[1])):"within"!==r||o;var a}function tr(o,r,a){switch(o){case"$type":return[`filter-type-${a}`,r];case"$id":return[`filter-id-${a}`,r];default:return[`filter-${a}`,o,r]}}function xa(o,r){if(0===r.length)return!1;switch(o){case"$type":return["filter-type-in",["literal",r]];case"$id":return["filter-id-in",["literal",r]];default:return r.length>200&&!r.some(a=>typeof a!=typeof r[0])?["filter-in-large",o,["literal",r.sort(Cr)]]:["filter-in-small",o,["literal",r]]}}function iu(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function yh(o){return["!",o]}function vh(o){return nu(ho(o.value))?ya(qi({},o,{expressionContext:"filter",valueSpec:o.styleSpec[`filter_${o.layerType||"fill"}`]})):bf(o)}function bf(o){const r=o.value,a=o.key;if("array"!==on(r))return[new nt(a,r,`array expected, ${on(r)} found`)];const l=o.styleSpec;let h,m=[];if(r.length<1)return[new nt(a,r,"filter array must have at least 1 element")];switch(m=m.concat(Ql({key:`${a}[0]`,value:r[0],valueSpec:l.filter_operator,style:o.style,styleSpec:o.styleSpec})),Zn(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===Zn(r[1])&&m.push(new nt(a,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":3!==r.length&&m.push(new nt(a,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(h=on(r[1]),"string"!==h&&m.push(new nt(`${a}[1]`,r[1],`string expected, ${h} found`)));for(let _=2;_<r.length;_++)h=on(r[_]),"$type"===Zn(r[1])?m=m.concat(Ql({key:`${a}[${_}]`,value:r[_],valueSpec:l.geometry_type,style:o.style,styleSpec:o.styleSpec})):"string"!==h&&"number"!==h&&"boolean"!==h&&m.push(new nt(`${a}[${_}]`,r[_],`string, number, or boolean expected, ${h} found`));break;case"any":case"all":case"none":for(let _=1;_<r.length;_++)m=m.concat(bf({key:`${a}[${_}]`,value:r[_],style:o.style,styleSpec:o.styleSpec}));break;case"has":case"!has":h=on(r[1]),2!==r.length?m.push(new nt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"string"!==h&&m.push(new nt(`${a}[1]`,r[1],`string expected, ${h} found`));break;case"within":h=on(r[1]),2!==r.length?m.push(new nt(a,r,`filter array for "${r[0]}" operator must have 2 elements`)):"object"!==h&&m.push(new nt(`${a}[1]`,r[1],`object expected, ${h} found`))}return m}function ba(o,r){const a=o.key,l=o.style,h=o.styleSpec,m=o.value,_=o.objectKey,x=h[`${r}_${o.layerType}`];if(!x)return[];const w=_.match(/^(.*)-transition$/);if("paint"===r&&w&&x[w[1]]&&x[w[1]].transition)return dr({key:a,value:m,valueSpec:h.transition,style:l,styleSpec:h});const C=o.valueSpec||x[_];if(!C)return[new nt(a,m,`unknown property "${_}"`)];let M;if("string"===on(m)&&zs(C)&&!C.tokens&&(M=/^{([^}]+)}$/.exec(m)))return[new nt(a,m,`"${_}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(M[1])} }\`.`)];const I=[];return"symbol"===o.layerType&&("text-field"===_&&l&&!l.glyphs&&I.push(new nt(a,m,'use of "text-field" requires a style "glyphs" property')),"text-font"===_&&Wn(ho(m))&&"identity"===Zn(m.type)&&I.push(new nt(a,m,'"text-font" does not support identity functions'))),I.concat(dr({key:o.key,value:m,valueSpec:C,style:l,styleSpec:h,expressionContext:"property",propertyType:r,propertyKey:_}))}function qr(o){return ba(o,"paint")}function Ji(o){return ba(o,"layout")}function xh(o){let r=[];const a=o.value,l=o.key,h=o.style,m=o.styleSpec;a.type||a.ref||r.push(new nt(l,a,'either "type" or "ref" is required'));let _=Zn(a.type);const x=Zn(a.ref);if(a.id){const w=Zn(a.id);for(let C=0;C<o.arrayIndex;C++){const M=h.layers[C];Zn(M.id)===w&&r.push(new nt(l,a.id,`duplicate layer id "${a.id}", previously used at line ${M.id.__line__}`))}}if("ref"in a){let w;["type","source","source-layer","filter","layout"].forEach(C=>{C in a&&r.push(new nt(l,a[C],`"${C}" is prohibited for ref layers`))}),h.layers.forEach(C=>{Zn(C.id)===x&&(w=C)}),w?w.ref?r.push(new nt(l,a.ref,"ref cannot reference another ref layer")):_=Zn(w.type):"string"==typeof x&&r.push(new nt(l,a.ref,`ref layer "${x}" not found`))}else if("background"!==_&&"sky"!==_)if(a.source){const w=h.sources&&h.sources[a.source],C=w&&Zn(w.type);w?"vector"===C&&"raster"===_?r.push(new nt(l,a.source,`layer "${a.id}" requires a raster source`)):"raster"===C&&"raster"!==_?r.push(new nt(l,a.source,`layer "${a.id}" requires a vector source`)):"vector"!==C||a["source-layer"]?"raster-dem"===C&&"hillshade"!==_?r.push(new nt(l,a.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==_||!a.paint||!a.paint["line-gradient"]&&!a.paint["line-trim-offset"]||"geojson"===C&&w.lineMetrics||r.push(new nt(l,a,`layer "${a.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):r.push(new nt(l,a,`layer "${a.id}" must specify a "source-layer"`)):r.push(new nt(l,a.source,`source "${a.source}" not found`))}else r.push(new nt(l,a,'missing required property "source"'));return r=r.concat(yi({key:l,value:a,valueSpec:m.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":()=>[],type:()=>dr({key:`${l}.type`,value:a.type,valueSpec:m.layer.type,style:o.style,styleSpec:o.styleSpec,object:a,objectKey:"type"}),filter:w=>vh(qi({layerType:_},w)),layout:w=>yi({layer:a,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":C=>Ji(qi({layerType:_},C))}}),paint:w=>yi({layer:a,key:w.key,value:w.value,valueSpec:{},style:w.style,styleSpec:w.styleSpec,objectElementValidators:{"*":C=>qr(qi({layerType:_},C))}})}})),r}function go(o){const r=o.value,a=o.key,l=on(r);return"string"!==l?[new nt(a,r,`string expected, ${l} found`)]:[]}const Qi={promoteId:function({key:o,value:r}){if("string"===on(r))return go({key:o,value:r});{const a=[];for(const l in r)a.push(...go({key:`${o}.${l}`,value:r[l]}));return a}}};function jd(o){const r=o.value,a=o.key,l=o.styleSpec,h=o.style;if(!r.type)return[new nt(a,r,'"type" is required')];const m=Zn(r.type);let _;switch(m){case"vector":case"raster":case"raster-dem":return _=yi({key:a,value:r,valueSpec:l[`source_${m.replace("-","_")}`],style:o.style,styleSpec:l,objectElementValidators:Qi}),_;case"geojson":if(_=yi({key:a,value:r,valueSpec:l.source_geojson,style:h,styleSpec:l,objectElementValidators:Qi}),r.cluster)for(const x in r.clusterProperties){const[w,C]=r.clusterProperties[x],M="string"==typeof w?[w,["accumulated"],["get",x]]:w;_.push(...ya({key:`${a}.${x}.map`,value:C,expressionContext:"cluster-map"})),_.push(...ya({key:`${a}.${x}.reduce`,value:M,expressionContext:"cluster-reduce"}))}return _;case"video":return yi({key:a,value:r,valueSpec:l.source_video,style:h,styleSpec:l});case"image":return yi({key:a,value:r,valueSpec:l.source_image,style:h,styleSpec:l});case"canvas":return[new nt(a,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Ql({key:`${a}.type`,value:r.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:h,styleSpec:l})}}function ou(o){const r=o.value,a=o.styleSpec,l=a.light,h=o.style;let m=[];const _=on(r);if(void 0===r)return m;if("object"!==_)return m=m.concat([new nt("light",r,`object expected, ${_} found`)]),m;for(const x in r){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&l[w[1]]&&l[w[1]].transition?dr({key:x,value:r[x],valueSpec:a.transition,style:h,styleSpec:a}):l[x]?dr({key:x,value:r[x],valueSpec:l[x],style:h,styleSpec:a}):[new nt(x,r[x],`unknown property "${x}"`)])}return m}function bh(o){const r=o.value,a=o.key,l=o.style,h=o.styleSpec,m=h.terrain;let _=[];const x=on(r);if(void 0===r)return _;if("object"!==x)return _=_.concat([new nt("terrain",r,`object expected, ${x} found`)]),_;for(const w in r){const C=w.match(/^(.*)-transition$/);_=_.concat(C&&m[C[1]]&&m[C[1]].transition?dr({key:w,value:r[w],valueSpec:h.transition,style:l,styleSpec:h}):m[w]?dr({key:w,value:r[w],valueSpec:m[w],style:l,styleSpec:h}):[new nt(w,r[w],`unknown property "${w}"`)])}if(r.source){const w=l.sources&&l.sources[r.source],C=w&&Zn(w.type);w?"raster-dem"!==C&&_.push(new nt(a,r.source,`terrain cannot be used with a source of type ${String(C)}, it only be used with a "raster-dem" source type`)):_.push(new nt(a,r.source,`source "${r.source}" not found`))}else _.push(new nt(a,r,'terrain is missing required property "source"'));return _}function $d(o){const r=o.value,a=o.style,l=o.styleSpec,h=l.fog;let m=[];const _=on(r);if(void 0===r)return m;if("object"!==_)return m=m.concat([new nt("fog",r,`object expected, ${_} found`)]),m;for(const x in r){const w=x.match(/^(.*)-transition$/);m=m.concat(w&&h[w[1]]&&h[w[1]].transition?dr({key:x,value:r[x],valueSpec:l.transition,style:a,styleSpec:l}):h[x]?dr({key:x,value:r[x],valueSpec:h[x],style:a,styleSpec:l}):[new nt(x,r[x],`unknown property "${x}"`)])}return m}const pl={"*":()=>[],array:Mt,boolean:function(o){const r=o.value,a=o.key,l=on(r);return"boolean"!==l?[new nt(a,r,`boolean expected, ${l} found`)]:[]},number:Bs,color:function(o){const r=o.key,a=o.value,l=on(a);return"string"!==l?[new nt(r,a,`color expected, ${l} found`)]:null===uh.parseCSSColor(a)?[new nt(r,a,`color expected, "${a}" found`)]:[]},enum:Ql,filter:vh,function:Vd,layer:xh,object:yi,source:jd,light:ou,terrain:bh,fog:$d,string:go,formatted:function(o){return 0===go(o).length?[]:ya(o)},resolvedImage:function(o){return 0===go(o).length?[]:ya(o)},projection:function(o){const r=o.value,a=o.styleSpec,l=a.projection,h=o.style;let m=[];const _=on(r);if("object"===_)for(const x in r)m=m.concat(dr({key:x,value:r[x],valueSpec:l[x],style:h,styleSpec:a}));else"string"!==_&&(m=m.concat([new nt("projection",r,`object or string expected, ${_} found`)]));return m}};function dr(o){const r=o.value,a=o.valueSpec,l=o.styleSpec;return a.expression&&Wn(Zn(r))?Vd(o):a.expression&&cl(ho(r))?ya(o):a.type&&pl[a.type]?pl[a.type](o):yi(qi({},o,{valueSpec:a.type?l[a.type]:a}))}function wh(o){const r=o.value,a=o.key,l=go(o);return l.length||(-1===r.indexOf("{fontstack}")&&l.push(new nt(a,r,'"glyphs" url must include a "{fontstack}" token')),-1===r.indexOf("{range}")&&l.push(new nt(a,r,'"glyphs" url must include a "{range}" token'))),l}function su(o,r=ye){return vi(dr({key:"",value:o,valueSpec:r.$root,styleSpec:r,style:o,objectElementValidators:{glyphs:wh,"*":()=>[]}}))}const Gd=o=>vi(qr(o)),Hd=o=>vi(Ji(o));function vi(o){return o.slice().sort((r,a)=>r.line&&a.line?r.line-a.line:0)}function Eh(o,r){let a=!1;if(r&&r.length)for(const l of r)o.fire(new Bn(new Error(l.message))),a=!0;return a}var wa=_o;function _o(o,r,a){var l=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var h=new Int32Array(this.arrayBuffer);o=h[0],this.d=(r=h[1])+2*(a=h[2]);for(var m=0;m<this.d*this.d;m++){var _=h[3+m],x=h[3+m+1];l.push(_===x?null:h.subarray(_,x))}var w=h[3+l.length+1];this.keys=h.subarray(h[3+l.length],w),this.bboxes=h.subarray(w),this.insert=this._insertReadonly}else{this.d=r+2*a;for(var C=0;C<this.d*this.d;C++)l.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=o,this.padding=a,this.scale=r/o,this.uid=0;var M=a/r*o;this.min=-M,this.max=o+M}_o.prototype.insert=function(o,r,a,l,h){this._forEachCell(r,a,l,h,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(r),this.bboxes.push(a),this.bboxes.push(l),this.bboxes.push(h)},_o.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},_o.prototype._insertCell=function(o,r,a,l,h,m){this.cells[h].push(m)},_o.prototype.query=function(o,r,a,l,h){var m=this.min,_=this.max;if(o<=m&&r<=m&&_<=a&&_<=l&&!h)return Array.prototype.slice.call(this.keys);var x=[];return this._forEachCell(o,r,a,l,this._queryCell,x,{},h),x},_o.prototype._queryCell=function(o,r,a,l,h,m,_,x){var w=this.cells[h];if(null!==w)for(var C=this.keys,M=this.bboxes,I=0;I<w.length;I++){var P=w[I];if(void 0===_[P]){var F=4*P;(x?x(M[F+0],M[F+1],M[F+2],M[F+3]):o<=M[F+2]&&r<=M[F+3]&&a>=M[F+0]&&l>=M[F+1])?(_[P]=!0,m.push(C[P])):_[P]=!1}}},_o.prototype._forEachCell=function(o,r,a,l,h,m,_,x){for(var w=this._convertToCellCoord(o),C=this._convertToCellCoord(r),M=this._convertToCellCoord(a),I=this._convertToCellCoord(l),P=w;P<=M;P++)for(var F=C;F<=I;F++){var z=this.d*F+P;if((!x||x(this._convertFromCellCoord(P),this._convertFromCellCoord(F),this._convertFromCellCoord(P+1),this._convertFromCellCoord(F+1)))&&h.call(this,o,r,a,l,z,m,_,x))return}},_o.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},_o.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},_o.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,r=3+this.cells.length+1+1,a=0,l=0;l<this.cells.length;l++)a+=this.cells[l].length;var h=new Int32Array(r+a+this.keys.length+this.bboxes.length);h[0]=this.extent,h[1]=this.n,h[2]=this.padding;for(var m=r,_=0;_<o.length;_++){var x=o[_];h[3+_]=m,h.set(x,m),m+=x.length}return h[3+o.length]=m,h.set(this.keys,m),h[3+o.length+1]=m+=this.keys.length,h.set(this.bboxes,m),m+=this.bboxes.length,h.buffer};const ec={};function tt(o,r,a={}){Object.defineProperty(o,"_classRegistryKey",{value:r,writeable:!1}),ec[r]={klass:o,omit:a.omit||[]}}tt(Object,"Object"),wa.serialize=function(o,r){const a=o.toArrayBuffer();return r&&r.push(a),{buffer:a}},wa.deserialize=function(o){return new wa(o.buffer)},Object.defineProperty(wa,"name",{value:"Grid"}),tt(wa,"Grid"),tt(Cn,"Color"),tt(Error,"Error"),tt(fe,"AJAXError"),tt(hr,"ResolvedImage"),tt(Jl,"StylePropertyFunction"),tt(eu,"StyleExpression",{omit:["_evaluator"]}),tt(ul,"ZoomDependentExpression"),tt(Hr,"ZoomConstantExpression"),tt(Oo,"CompoundExpression",{omit:["_evaluate"]});for(const o in _a)ec[_a[o]._classRegistryKey]||tt(_a[o],`Expression${o}`);function qd(o){return o&&"undefined"!=typeof ArrayBuffer&&(o instanceof ArrayBuffer||o.constructor&&"ArrayBuffer"===o.constructor.name)}function Zd(o){return Ge.ImageBitmap&&o instanceof Ge.ImageBitmap}function Tr(o,r){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(qd(o)||Zd(o))return r&&r.push(o),o;if(ArrayBuffer.isView(o)){const a=o;return r&&r.push(a.buffer),a}if(o instanceof Ge.ImageData)return r&&r.push(o.data.buffer),o;if(Array.isArray(o)){const a=[];for(const l of o)a.push(Tr(l,r));return a}if("object"==typeof o){const a=o.constructor,l=a._classRegistryKey;if(!l)throw new Error(`can't serialize object of unregistered class ${l}`);const h=a.serialize?a.serialize(o,r):{};if(!a.serialize){for(const m in o)o.hasOwnProperty(m)&&(ec[l].omit.indexOf(m)>=0||(h[m]=Tr(o[m],r)));o instanceof Error&&(h.message=o.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==l&&(h.$name=l),h}throw new Error("can't serialize object of type "+typeof o)}function eo(o){if(null==o||"boolean"==typeof o||"number"==typeof o||"string"==typeof o||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||qd(o)||Zd(o)||ArrayBuffer.isView(o)||o instanceof Ge.ImageData)return o;if(Array.isArray(o))return o.map(eo);if("object"==typeof o){const r=o.$name||"Object",{klass:a}=ec[r];if(!a)throw new Error(`can't deserialize unregistered class ${r}`);if(a.deserialize)return a.deserialize(o);const l=Object.create(a.prototype);for(const h of Object.keys(o))"$name"!==h&&(l[h]=eo(o[h]));return l}throw new Error("can't deserialize object of type "+typeof o)}class or{constructor(){this.first=!0}update(r,a){const l=Math.floor(r);return this.first?(this.first=!1,this.lastIntegerZoom=l,this.lastIntegerZoomTime=0,this.lastZoom=r,this.lastFloorZoom=l,!0):(this.lastFloorZoom>l?(this.lastIntegerZoom=l+1,this.lastIntegerZoomTime=a):this.lastFloorZoom<l&&(this.lastIntegerZoom=l,this.lastIntegerZoomTime=a),r!==this.lastZoom&&(this.lastZoom=r,this.lastFloorZoom=l,!0))}}const Wd=o=>o>=1536&&o<=1791,Xd=o=>o>=1872&&o<=1919,tc=o=>o>=2208&&o<=2303,Yd=o=>o>=11904&&o<=12031,Kd=o=>o>=12032&&o<=12255,nc=o=>o>=12272&&o<=12287,Ea=o=>o>=12288&&o<=12351,Ca=o=>o>=12352&&o<=12447,Ta=o=>o>=12448&&o<=12543,rc=o=>o>=12544&&o<=12591,au=o=>o>=12704&&o<=12735,Ch=o=>o>=12736&&o<=12783,No=o=>o>=12784&&o<=12799,Ns=o=>o>=12800&&o<=13055,lu=o=>o>=13056&&o<=13311,Jd=o=>o>=13312&&o<=19903,Da=o=>o>=19968&&o<=40959,cu=o=>o>=40960&&o<=42127,uu=o=>o>=42128&&o<=42191,Qd=o=>o>=44032&&o<=55215,wf=o=>o>=63744&&o<=64255,ep=o=>o>=64336&&o<=65023,ic=o=>o>=65040&&o<=65055,Vs=o=>o>=65072&&o<=65103,hu=o=>o>=65104&&o<=65135,fl=o=>o>=65136&&o<=65279,oc=o=>o>=65280&&o<=65519;function Sa(o){for(const r of o)if(u(r.charCodeAt(0)))return!0;return!1}function p(o){for(const r of o)if(!i(r.charCodeAt(0)))return!1;return!0}function i(o){return!(Wd(o)||Xd(o)||tc(o)||ep(o)||fl(o))}function u(o){return!(746!==o&&747!==o&&(o<4352||!(au(o)||rc(o)||Vs(o)&&!(o>=65097&&o<=65103)||wf(o)||lu(o)||Yd(o)||Ch(o)||!(!Ea(o)||o>=12296&&o<=12305||o>=12308&&o<=12319||12336===o)||Jd(o)||Da(o)||Ns(o)||(r=o,r>=12592&&r<=12687)||(r=>r>=43360&&r<=43391)(o)||(r=>r>=55216&&r<=55295)(o)||(r=>r>=4352&&r<=4607)(o)||Qd(o)||Ca(o)||nc(o)||(r=>r>=12688&&r<=12703)(o)||Kd(o)||No(o)||Ta(o)&&12540!==o||!(!oc(o)||65288===o||65289===o||65293===o||o>=65306&&o<=65310||65339===o||65341===o||65343===o||o>=65371&&o<=65503||65507===o||o>=65512&&o<=65519)||!(!hu(o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||(r=>r>=5120&&r<=5759)(o)||(r=>r>=6320&&r<=6399)(o)||ic(o)||(r=>r>=19904&&r<=19967)(o)||cu(o)||uu(o))));var r}function g(o){return!(u(o)||(r=o,(a=r)>=128&&a<=255&&(167===r||169===r||174===r||177===r||188===r||189===r||190===r||215===r||247===r)||(a=>a>=8192&&a<=8303)(r)&&(8214===r||8224===r||8225===r||8240===r||8241===r||8251===r||8252===r||8258===r||8263===r||8264===r||8265===r||8273===r)||(a=>a>=8448&&a<=8527)(r)||(a=>a>=8528&&a<=8591)(r)||(a=>a>=8960&&a<=9215)(r)&&(r>=8960&&r<=8967||r>=8972&&r<=8991||r>=8996&&r<=9e3||9003===r||r>=9085&&r<=9114||r>=9150&&r<=9165||9167===r||r>=9169&&r<=9179||r>=9186&&r<=9215)||(a=>a>=9216&&a<=9279)(r)&&9251!==r||(a=>a>=9280&&a<=9311)(r)||(a=>a>=9312&&a<=9471)(r)||(a=>a>=9632&&a<=9727)(r)||(a=>a>=9728&&a<=9983)(r)&&!(r>=9754&&r<=9759)||(a=>a>=11008&&a<=11263)(r)&&(r>=11026&&r<=11055||r>=11088&&r<=11097||r>=11192&&r<=11243)||Ea(r)||Ta(r)||(a=>a>=57344&&a<=63743)(r)||Vs(r)||hu(r)||oc(r)||8734===r||8756===r||8757===r||r>=9984&&r<=10087||r>=10102&&r<=10131||65532===r||65533===r));var r,a}function v(o){return o>=1424&&o<=2303||ep(o)||fl(o)}function b(o,r){return!(!r&&v(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||(a=o,a>=6016&&a<=6143));var a}function T(o){for(const r of o)if(v(r.charCodeAt(0)))return!0;return!1}const D="deferred",A="loading",k="loaded";let L=null,B="unavailable",j=null;const H=function(o){o&&"string"==typeof o&&o.indexOf("NetworkError")>-1&&(B="error"),L&&L(o)};function Z(){G.fire(new an("pluginStateChange",{pluginStatus:B,pluginURL:j}))}const G=new gn,ne=function(){return B},W=function(){if(B!==D||!j)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");B=A,Z(),j&&me({url:j},o=>{o?H(o):(B=k,Z())})},Q={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>B===k||null!=Q.applyArabicShaping,isLoading:()=>B===A,setState(o){B=o.pluginStatus,j=o.pluginURL},isParsed:()=>null!=Q.applyArabicShaping&&null!=Q.processBidirectionalText&&null!=Q.processStyledBidirectionalText,getPluginURL:()=>j};class q{constructor(r,a){this.zoom=r,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.zoomHistory=a.zoomHistory,this.transition=a.transition,this.pitch=a.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new or,this.transition={},this.pitch=0)}isSupportedScript(r){return function(a,l){for(const h of a)if(!b(h.charCodeAt(0),l))return!1;return!0}(r,Q.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const r=this.zoom,a=r-Math.floor(r),l=this.crossFadingFactor();return r>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:a+(1-a)*l}:{fromScale:.5,toScale:1,t:1-(1-l)*a}}}class le{constructor(r,a){this.property=r,this.value=a,this.expression=function(l,h){if(Wn(l))return new Jl(l,h);if(cl(l)){const m=hl(l,h);if("error"===m.result)throw new Error(m.value.map(_=>`${_.key}: ${_.message}`).join(", "));return m.value}{let m=l;return"string"==typeof l&&"color"===h.type&&(m=Cn.parse(l)),{kind:"constant",evaluate:()=>m}}}(void 0===a?r.specification.default:a,r.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(r,a,l){return this.property.possiblyEvaluate(this,r,a,l)}}class te{constructor(r){this.property=r,this.value=new le(r,void 0)}transitioned(r,a){return new ue(this.property,this.value,a,_r({},r.transition,this.transition),r.now)}untransitioned(){return new ue(this.property,this.value,null,{},0)}}class re{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitionablePropertyValues)}getValue(r){return ji(this._values[r].value.value)}setValue(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].value=new le(this._values[r].property,null===a?void 0:ji(a))}getTransition(r){return ji(this._values[r].transition)}setTransition(r,a){this._values.hasOwnProperty(r)||(this._values[r]=new te(this._values[r].property)),this._values[r].transition=ji(a)||void 0}serialize(){const r={};for(const a of Object.keys(this._values)){const l=this.getValue(a);void 0!==l&&(r[a]=l);const h=this.getTransition(a);void 0!==h&&(r[`${a}-transition`]=h)}return r}transitioned(r,a){const l=new Ce(this._properties);for(const h of Object.keys(this._values))l._values[h]=this._values[h].transitioned(r,a._values[h]);return l}untransitioned(){const r=new Ce(this._properties);for(const a of Object.keys(this._values))r._values[a]=this._values[a].untransitioned();return r}}class ue{constructor(r,a,l,h,m){const _=h.delay||0,x=h.duration||0;m=m||0,this.property=r,this.value=a,this.begin=m+_,this.end=this.begin+x,r.specification.transition&&(h.delay||h.duration)&&(this.prior=l)}possiblyEvaluate(r,a,l){const h=r.now||0,m=this.value.possiblyEvaluate(r,a,l),_=this.prior;if(_){if(h>this.end)return this.prior=null,m;if(this.value.isDataDriven())return this.prior=null,m;if(h<this.begin)return _.possiblyEvaluate(r,a,l);{const x=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(_.possiblyEvaluate(r,a,l),m,Za(x))}}return m}}class Ce{constructor(r){this._properties=r,this._values=Object.create(r.defaultTransitioningPropertyValues)}possiblyEvaluate(r,a,l){const h=new Ve(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,a,l);return h}hasTransition(){for(const r of Object.keys(this._values))if(this._values[r].prior)return!0;return!1}}class Se{constructor(r){this._properties=r,this._values=Object.create(r.defaultPropertyValues)}getValue(r){return ji(this._values[r].value)}setValue(r,a){this._values[r]=new le(this._values[r].property,null===a?void 0:ji(a))}serialize(){const r={};for(const a of Object.keys(this._values)){const l=this.getValue(a);void 0!==l&&(r[a]=l)}return r}possiblyEvaluate(r,a,l){const h=new Ve(this._properties);for(const m of Object.keys(this._values))h._values[m]=this._values[m].possiblyEvaluate(r,a,l);return h}}class be{constructor(r,a,l){this.property=r,this.value=a,this.parameters=l}isConstant(){return"constant"===this.value.kind}constantOr(r){return"constant"===this.value.kind?this.value.value:r}evaluate(r,a,l,h){return this.property.evaluate(this.value,this.parameters,r,a,l,h)}}class Ve{constructor(r){this._properties=r,this._values=Object.create(r.defaultPossiblyEvaluatedValues)}get(r){return this._values[r]}}class ie{constructor(r){this.specification=r}possiblyEvaluate(r,a){return r.expression.evaluate(a)}interpolate(r,a,l){const h=zo[this.specification.type];return h?h(r,a,l):r}}class ve{constructor(r,a){this.specification=r,this.overrides=a}possiblyEvaluate(r,a,l,h){return new be(this,"constant"===r.expression.kind||"camera"===r.expression.kind?{kind:"constant",value:r.expression.evaluate(a,null,{},l,h)}:r.expression,a)}interpolate(r,a,l){if("constant"!==r.value.kind||"constant"!==a.value.kind)return r;if(void 0===r.value.value||void 0===a.value.value)return new be(this,{kind:"constant",value:void 0},r.parameters);const h=zo[this.specification.type];return h?new be(this,{kind:"constant",value:h(r.value.value,a.value.value,l)},r.parameters):r}evaluate(r,a,l,h,m,_){return"constant"===r.kind?r.value:r.evaluate(a,l,h,m,_)}}class Ie extends ve{possiblyEvaluate(r,a,l,h){if(void 0===r.value)return new be(this,{kind:"constant",value:void 0},a);if("constant"===r.expression.kind){const m=r.expression.evaluate(a,null,{},l,h),_="resolvedImage"===r.property.specification.type&&"string"!=typeof m?m.name:m,x=this._calculate(_,_,_,a);return new be(this,{kind:"constant",value:x},a)}if("camera"===r.expression.kind){const m=this._calculate(r.expression.evaluate({zoom:a.zoom-1}),r.expression.evaluate({zoom:a.zoom}),r.expression.evaluate({zoom:a.zoom+1}),a);return new be(this,{kind:"constant",value:m},a)}return new be(this,r.expression,a)}evaluate(r,a,l,h,m,_){if("source"===r.kind){const x=r.evaluate(a,l,h,m,_);return this._calculate(x,x,x,a)}return"composite"===r.kind?this._calculate(r.evaluate({zoom:Math.floor(a.zoom)-1},l,h),r.evaluate({zoom:Math.floor(a.zoom)},l,h),r.evaluate({zoom:Math.floor(a.zoom)+1},l,h),a):r.value}_calculate(r,a,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:a,other:l}:{from:l,to:a,other:r}}interpolate(r){return r}}class Ze{constructor(r){this.specification=r}possiblyEvaluate(r,a,l,h){if(void 0!==r.value){if("constant"===r.expression.kind){const m=r.expression.evaluate(a,null,{},l,h);return this._calculate(m,m,m,a)}return this._calculate(r.expression.evaluate(new q(Math.floor(a.zoom-1),a)),r.expression.evaluate(new q(Math.floor(a.zoom),a)),r.expression.evaluate(new q(Math.floor(a.zoom+1),a)),a)}}_calculate(r,a,l,h){return h.zoom>h.zoomHistory.lastIntegerZoom?{from:r,to:a}:{from:l,to:a}}interpolate(r){return r}}class Me{constructor(r){this.specification=r}possiblyEvaluate(r,a,l,h){return!!r.expression.evaluate(a,null,{},l,h)}interpolate(){return!1}}class it{constructor(r){this.properties=r,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new q(0,{});for(const l in r){const h=r[l];h.specification.overridable&&this.overridableProperties.push(l);const m=this.defaultPropertyValues[l]=new le(h,void 0),_=this.defaultTransitionablePropertyValues[l]=new te(h);this.defaultTransitioningPropertyValues[l]=_.untransitioned(),this.defaultPossiblyEvaluatedValues[l]=m.possiblyEvaluate(a)}}}function He(o,r){return 256*(o=Et(Math.floor(o),0,255))+Et(Math.floor(r),0,255)}tt(ve,"DataDrivenProperty"),tt(ie,"DataConstantProperty"),tt(Ie,"CrossFadedDataDrivenProperty"),tt(Ze,"CrossFadedProperty"),tt(Me,"ColorRampProperty");const Ke={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class We{constructor(r,a){this._structArray=r,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Xe{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(r,a){return r._trim(),a&&(r.isTransferred=!0,a.push(r.arrayBuffer)),{length:r.length,arrayBuffer:r.arrayBuffer}}static deserialize(r){const a=Object.create(this.prototype);return a.arrayBuffer=r.arrayBuffer,a.length=r.length,a.capacity=r.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(r){this.reserve(r),this.length=r}reserve(r){if(r>this.capacity){this.capacity=Math.max(r,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function st(o,r=1){let a=0,l=0;return{members:o.map(h=>{const m=Ke[h.type].BYTES_PER_ELEMENT,_=a=qe(a,Math.max(r,m)),x=h.components||1;return l=Math.max(l,m),a+=m*x,{name:h.name,type:h.type,components:x,offset:_}}),size:qe(a,Math.max(l,r)),alignment:r}}function qe(o,r){return Math.ceil(o/r)*r}class Dt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a){const l=this.length;return this.resize(l+1),this.emplace(l,r,a)}emplace(r,a,l){const h=2*r;return this.int16[h+0]=a,this.int16[h+1]=l,r}}Dt.prototype.bytesPerElement=4,tt(Dt,"StructArrayLayout2i4");class ht extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,l)}emplace(r,a,l,h){const m=3*r;return this.int16[m+0]=a,this.int16[m+1]=l,this.int16[m+2]=h,r}}ht.prototype.bytesPerElement=6,tt(ht,"StructArrayLayout3i6");class Ct extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,l,h)}emplace(r,a,l,h,m){const _=4*r;return this.int16[_+0]=a,this.int16[_+1]=l,this.int16[_+2]=h,this.int16[_+3]=m,r}}Ct.prototype.bytesPerElement=8,tt(Ct,"StructArrayLayout4i8");class _n extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,a,l,h,m,_,x)}emplace(r,a,l,h,m,_,x,w){const C=6*r,M=12*r,I=3*r;return this.int16[C+0]=a,this.int16[C+1]=l,this.uint8[M+4]=h,this.uint8[M+5]=m,this.uint8[M+6]=_,this.uint8[M+7]=x,this.float32[I+2]=w,r}}_n.prototype.bytesPerElement=12,tt(_n,"StructArrayLayout2i4ub1f12");class Rn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,l,h)}emplace(r,a,l,h,m){const _=4*r;return this.float32[_+0]=a,this.float32[_+1]=l,this.float32[_+2]=h,this.float32[_+3]=m,r}}Rn.prototype.bytesPerElement=16,tt(Rn,"StructArrayLayout4f16");class Xn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x,w,C,M){const I=this.length;return this.resize(I+1),this.emplace(I,r,a,l,h,m,_,x,w,C,M)}emplace(r,a,l,h,m,_,x,w,C,M,I){const P=10*r;return this.uint16[P+0]=a,this.uint16[P+1]=l,this.uint16[P+2]=h,this.uint16[P+3]=m,this.uint16[P+4]=_,this.uint16[P+5]=x,this.uint16[P+6]=w,this.uint16[P+7]=C,this.uint16[P+8]=M,this.uint16[P+9]=I,r}}Xn.prototype.bytesPerElement=20,tt(Xn,"StructArrayLayout10ui20");class Sn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x,w){const C=this.length;return this.resize(C+1),this.emplace(C,r,a,l,h,m,_,x,w)}emplace(r,a,l,h,m,_,x,w,C){const M=8*r;return this.uint16[M+0]=a,this.uint16[M+1]=l,this.uint16[M+2]=h,this.uint16[M+3]=m,this.uint16[M+4]=_,this.uint16[M+5]=x,this.uint16[M+6]=w,this.uint16[M+7]=C,r}}Sn.prototype.bytesPerElement=16,tt(Sn,"StructArrayLayout8ui16");class Ir extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,l,h,m,_)}emplace(r,a,l,h,m,_,x){const w=6*r;return this.int16[w+0]=a,this.int16[w+1]=l,this.int16[w+2]=h,this.int16[w+3]=m,this.int16[w+4]=_,this.int16[w+5]=x,r}}Ir.prototype.bytesPerElement=12,tt(Ir,"StructArrayLayout6i12");class ds extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x,w,C,M,I,P){const F=this.length;return this.resize(F+1),this.emplace(F,r,a,l,h,m,_,x,w,C,M,I,P)}emplace(r,a,l,h,m,_,x,w,C,M,I,P,F){const z=12*r;return this.int16[z+0]=a,this.int16[z+1]=l,this.int16[z+2]=h,this.int16[z+3]=m,this.uint16[z+4]=_,this.uint16[z+5]=x,this.uint16[z+6]=w,this.uint16[z+7]=C,this.int16[z+8]=M,this.int16[z+9]=I,this.int16[z+10]=P,this.int16[z+11]=F,r}}ds.prototype.bytesPerElement=24,tt(ds,"StructArrayLayout4i4ui4i24");class Vn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_){const x=this.length;return this.resize(x+1),this.emplace(x,r,a,l,h,m,_)}emplace(r,a,l,h,m,_,x){const w=10*r,C=5*r;return this.int16[w+0]=a,this.int16[w+1]=l,this.int16[w+2]=h,this.float32[C+2]=m,this.float32[C+3]=_,this.float32[C+4]=x,r}}Vn.prototype.bytesPerElement=20,tt(Vn,"StructArrayLayout3i3f20");class Mn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint32[1*r+0]=a,r}}Mn.prototype.bytesPerElement=4,tt(Mn,"StructArrayLayout1ul4");class An extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x,w,C,M,I,P,F){const z=this.length;return this.resize(z+1),this.emplace(z,r,a,l,h,m,_,x,w,C,M,I,P,F)}emplace(r,a,l,h,m,_,x,w,C,M,I,P,F,z){const U=20*r,X=10*r;return this.int16[U+0]=a,this.int16[U+1]=l,this.int16[U+2]=h,this.int16[U+3]=m,this.int16[U+4]=_,this.float32[X+3]=x,this.float32[X+4]=w,this.float32[X+5]=C,this.float32[X+6]=M,this.int16[U+14]=I,this.uint32[X+8]=P,this.uint16[U+18]=F,this.uint16[U+19]=z,r}}An.prototype.bytesPerElement=40,tt(An,"StructArrayLayout5i4f1i1ul2ui40");class ln extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,a,l,h,m,_,x)}emplace(r,a,l,h,m,_,x,w){const C=8*r;return this.int16[C+0]=a,this.int16[C+1]=l,this.int16[C+2]=h,this.int16[C+4]=m,this.int16[C+5]=_,this.int16[C+6]=x,this.int16[C+7]=w,r}}ln.prototype.bytesPerElement=16,tt(ln,"StructArrayLayout3i2i2i16");class pr extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,l,h,m)}emplace(r,a,l,h,m,_){const x=4*r,w=8*r;return this.float32[x+0]=a,this.float32[x+1]=l,this.float32[x+2]=h,this.int16[w+6]=m,this.int16[w+7]=_,r}}pr.prototype.bytesPerElement=16,tt(pr,"StructArrayLayout2f1f2i16");class Un extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,l,h)}emplace(r,a,l,h,m){const _=12*r,x=3*r;return this.uint8[_+0]=a,this.uint8[_+1]=l,this.float32[x+1]=h,this.float32[x+2]=m,r}}Un.prototype.bytesPerElement=12,tt(Un,"StructArrayLayout2ub2f12");class Qt extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,l)}emplace(r,a,l,h){const m=3*r;return this.float32[m+0]=a,this.float32[m+1]=l,this.float32[m+2]=h,r}}Qt.prototype.bytesPerElement=12,tt(Qt,"StructArrayLayout3f12");class Yn extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,l){const h=this.length;return this.resize(h+1),this.emplace(h,r,a,l)}emplace(r,a,l,h){const m=3*r;return this.uint16[m+0]=a,this.uint16[m+1]=l,this.uint16[m+2]=h,r}}Yn.prototype.bytesPerElement=6,tt(Yn,"StructArrayLayout3ui6");class Vo extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x,w,C,M,I,P,F,z,U,X,ee,ce,se,pe,he){const _e=this.length;return this.resize(_e+1),this.emplace(_e,r,a,l,h,m,_,x,w,C,M,I,P,F,z,U,X,ee,ce,se,pe,he)}emplace(r,a,l,h,m,_,x,w,C,M,I,P,F,z,U,X,ee,ce,se,pe,he,_e){const Te=30*r,De=15*r,Pe=60*r;return this.int16[Te+0]=a,this.int16[Te+1]=l,this.int16[Te+2]=h,this.float32[De+2]=m,this.float32[De+3]=_,this.uint16[Te+8]=x,this.uint16[Te+9]=w,this.uint32[De+5]=C,this.uint32[De+6]=M,this.uint32[De+7]=I,this.uint16[Te+16]=P,this.uint16[Te+17]=F,this.uint16[Te+18]=z,this.float32[De+10]=U,this.float32[De+11]=X,this.uint8[Pe+48]=ee,this.uint8[Pe+49]=ce,this.uint8[Pe+50]=se,this.uint32[De+13]=pe,this.int16[Te+28]=he,this.uint8[Pe+58]=_e,r}}Vo.prototype.bytesPerElement=60,tt(Vo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class xi extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x,w,C,M,I,P,F,z,U,X,ee,ce,se,pe,he,_e,Te,De,Pe,Be,xe,Ae,Ne,Ue){const rt=this.length;return this.resize(rt+1),this.emplace(rt,r,a,l,h,m,_,x,w,C,M,I,P,F,z,U,X,ee,ce,se,pe,he,_e,Te,De,Pe,Be,xe,Ae,Ne,Ue)}emplace(r,a,l,h,m,_,x,w,C,M,I,P,F,z,U,X,ee,ce,se,pe,he,_e,Te,De,Pe,Be,xe,Ae,Ne,Ue,rt){const Oe=38*r,Je=19*r;return this.int16[Oe+0]=a,this.int16[Oe+1]=l,this.int16[Oe+2]=h,this.float32[Je+2]=m,this.float32[Je+3]=_,this.int16[Oe+8]=x,this.int16[Oe+9]=w,this.int16[Oe+10]=C,this.int16[Oe+11]=M,this.int16[Oe+12]=I,this.int16[Oe+13]=P,this.uint16[Oe+14]=F,this.uint16[Oe+15]=z,this.uint16[Oe+16]=U,this.uint16[Oe+17]=X,this.uint16[Oe+18]=ee,this.uint16[Oe+19]=ce,this.uint16[Oe+20]=se,this.uint16[Oe+21]=pe,this.uint16[Oe+22]=he,this.uint16[Oe+23]=_e,this.uint16[Oe+24]=Te,this.uint16[Oe+25]=De,this.uint16[Oe+26]=Pe,this.uint16[Oe+27]=Be,this.uint16[Oe+28]=xe,this.uint32[Je+15]=Ae,this.float32[Je+16]=Ne,this.float32[Je+17]=Ue,this.float32[Je+18]=rt,r}}xi.prototype.bytesPerElement=76,tt(xi,"StructArrayLayout3i2f6i15ui1ul3f76");class Ma extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.float32[1*r+0]=a,r}}Ma.prototype.bytesPerElement=4,tt(Ma,"StructArrayLayout1f4");class Aa extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m,_,x){const w=this.length;return this.resize(w+1),this.emplace(w,r,a,l,h,m,_,x)}emplace(r,a,l,h,m,_,x,w){const C=7*r;return this.float32[C+0]=a,this.float32[C+1]=l,this.float32[C+2]=h,this.float32[C+3]=m,this.float32[C+4]=_,this.float32[C+5]=x,this.float32[C+6]=w,r}}Aa.prototype.bytesPerElement=28,tt(Aa,"StructArrayLayout7f28");class Us extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a,l,h,m){const _=this.length;return this.resize(_+1),this.emplace(_,r,a,l,h,m)}emplace(r,a,l,h,m,_){const x=5*r;return this.float32[x+0]=a,this.float32[x+1]=l,this.float32[x+2]=h,this.float32[x+3]=m,this.float32[x+4]=_,r}}Us.prototype.bytesPerElement=20,tt(Us,"StructArrayLayout5f20");class li extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a,l,h){const m=this.length;return this.resize(m+1),this.emplace(m,r,a,l,h)}emplace(r,a,l,h,m){const _=6*r;return this.uint32[3*r+0]=a,this.uint16[_+2]=l,this.uint16[_+3]=h,this.uint16[_+4]=m,r}}li.prototype.bytesPerElement=12,tt(li,"StructArrayLayout1ul3ui12");class to extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r,a){const l=this.length;return this.resize(l+1),this.emplace(l,r,a)}emplace(r,a,l){const h=2*r;return this.uint16[h+0]=a,this.uint16[h+1]=l,r}}to.prototype.bytesPerElement=4,tt(to,"StructArrayLayout2ui4");class yo extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(r){const a=this.length;return this.resize(a+1),this.emplace(a,r)}emplace(r,a){return this.uint16[1*r+0]=a,r}}yo.prototype.bytesPerElement=2,tt(yo,"StructArrayLayout1ui2");class Dr extends Xe{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(r,a){const l=this.length;return this.resize(l+1),this.emplace(l,r,a)}emplace(r,a,l){const h=2*r;return this.float32[h+0]=a,this.float32[h+1]=l,r}}Dr.prototype.bytesPerElement=8,tt(Dr,"StructArrayLayout2f8");class tp extends We{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}tp.prototype.size=12;class sc extends Ir{get(r){return new tp(this,r)}}tt(sc,"FillExtrusionExtArray");class Ev extends We{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ev.prototype.size=40;class np extends An{get(r){return new Ev(this,r)}}tt(np,"CollisionBoxArray");class Rg extends We{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(r){this._structArray.uint8[this._pos1+49]=r}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(r){this._structArray.uint8[this._pos1+50]=r}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(r){this._structArray.uint32[this._pos4+13]=r}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(r){this._structArray.uint8[this._pos1+58]=r}}Rg.prototype.size=60;class Fg extends Vo{get(r){return new Rg(this,r)}}tt(Fg,"PlacedSymbolArray");class Lg extends We{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(r){this._structArray.uint32[this._pos4+15]=r}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}Lg.prototype.size=76;class Og extends xi{get(r){return new Lg(this,r)}}tt(Og,"SymbolInstanceArray");class zg extends Ma{getoffsetX(r){return this.float32[1*r+0]}}tt(zg,"GlyphOffsetArray");class Ef extends ht{getx(r){return this.int16[3*r+0]}gety(r){return this.int16[3*r+1]}gettileUnitDistanceFromAnchor(r){return this.int16[3*r+2]}}tt(Ef,"SymbolLineVertexArray");class rp extends We{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}rp.prototype.size=12;class Th extends li{get(r){return new rp(this,r)}}tt(Th,"FeatureIndexArray");class Cv extends We{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}Cv.prototype.size=4;class du extends to{get(r){return new Cv(this,r)}}tt(du,"FillExtrusionCentroidArray");class ip extends We{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}ip.prototype.size=12;class Dh extends Ir{get(r){return new ip(this,r)}}tt(Dh,"CircleGlobeExtArray");const Tv=st([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),Dv=st([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var Bg=Ai(function(o){o.exports=function(r,a){var l,h,m,_,x,w,C,M;for(h=r.length-(l=3&r.length),m=a,x=3432918353,w=461845907,M=0;M<h;)C=255&r.charCodeAt(M)|(255&r.charCodeAt(++M))<<8|(255&r.charCodeAt(++M))<<16|(255&r.charCodeAt(++M))<<24,++M,m=27492+(65535&(_=5*(65535&(m=(m^=C=(65535&(C=(C=(65535&C)*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*w+(((C>>>16)*w&65535)<<16)&4294967295)<<13|m>>>19))+((5*(m>>>16)&65535)<<16)&4294967295))+((58964+(_>>>16)&65535)<<16);switch(C=0,l){case 3:C^=(255&r.charCodeAt(M+2))<<16;case 2:C^=(255&r.charCodeAt(M+1))<<8;case 1:m^=C=(65535&(C=(C=(65535&(C^=255&r.charCodeAt(M)))*x+(((C>>>16)*x&65535)<<16)&4294967295)<<15|C>>>17))*w+(((C>>>16)*w&65535)<<16)&4294967295}return m^=r.length,m=2246822507*(65535&(m^=m>>>16))+((2246822507*(m>>>16)&65535)<<16)&4294967295,m=3266489909*(65535&(m^=m>>>13))+((3266489909*(m>>>16)&65535)<<16)&4294967295,(m^=m>>>16)>>>0}}),Ng=Ai(function(o){o.exports=function(r,a){for(var l,h=r.length,m=a^h,_=0;h>=4;)l=1540483477*(65535&(l=255&r.charCodeAt(_)|(255&r.charCodeAt(++_))<<8|(255&r.charCodeAt(++_))<<16|(255&r.charCodeAt(++_))<<24))+((1540483477*(l>>>16)&65535)<<16),m=1540483477*(65535&m)+((1540483477*(m>>>16)&65535)<<16)^(l=1540483477*(65535&(l^=l>>>24))+((1540483477*(l>>>16)&65535)<<16)),h-=4,++_;switch(h){case 3:m^=(255&r.charCodeAt(_+2))<<16;case 2:m^=(255&r.charCodeAt(_+1))<<8;case 1:m=1540483477*(65535&(m^=255&r.charCodeAt(_)))+((1540483477*(m>>>16)&65535)<<16)}return m=1540483477*(65535&(m^=m>>>13))+((1540483477*(m>>>16)&65535)<<16),(m^=m>>>15)>>>0}}),Sh=Bg,Mh=Ng;Sh.murmur3=Bg,Sh.murmur2=Mh;class Ah{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(r,a,l,h){this.ids.push(Vg(r)),this.positions.push(a,l,h)}getPositions(r){const a=Vg(r);let l=0,h=this.ids.length-1;for(;l<h;){const _=l+h>>1;this.ids[_]>=a?h=_:l=_+1}const m=[];for(;this.ids[l]===a;)m.push({index:this.positions[3*l],start:this.positions[3*l+1],end:this.positions[3*l+2]}),l++;return m}static serialize(r,a){const l=new Float64Array(r.ids),h=new Uint32Array(r.positions);return xt(l,h,0,l.length-1),a&&a.push(l.buffer,h.buffer),{ids:l,positions:h}}static deserialize(r){const a=new Ah;return a.ids=r.ids,a.positions=r.positions,a.indexed=!0,a}}function Vg(o){const r=+o;return!isNaN(r)&&Number.MIN_SAFE_INTEGER<=r&&r<=Number.MAX_SAFE_INTEGER?r:Sh(String(o))}function xt(o,r,a,l){for(;a<l;){const h=o[a+l>>1];let m=a-1,_=l+1;for(;;){do{m++}while(o[m]<h);do{_--}while(o[_]>h);if(m>=_)break;Ih(o,m,_),Ih(r,3*m,3*_),Ih(r,3*m+1,3*_+1),Ih(r,3*m+2,3*_+2)}_-a<l-_?(xt(o,r,a,_),a=_+1):(xt(o,r,_+1,l),l=_)}}function Ih(o,r,a){const l=o[r];o[r]=o[a],o[a]=l}tt(Ah,"FeaturePositionMap");class Ia{constructor(r,a){this.gl=r.gl,this.location=a}}class pu extends Ia{constructor(r,a){super(r,a),this.current=0}set(r){this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class fu extends Ia{constructor(r,a){super(r,a),this.current=[0,0,0,0]}set(r){r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3]))}}class Ug extends Ia{constructor(r,a){super(r,a),this.current=Cn.transparent}set(r){r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a))}}const Sv=new Float32Array(16),Mv=new Float32Array(9),op=new Float32Array(4);function js(o){return[He(255*o.r,255*o.g),He(255*o.b,255*o.a)]}class mu{constructor(r,a,l){this.value=r,this.uniformNames=a.map(h=>`u_${h}`),this.type=l}setUniform(r,a,l){r.set(l.constantOr(this.value))}getBinding(r,a,l){return"color"===this.type?new Ug(r,a):new pu(r,a)}}class $s{constructor(r,a){this.uniformNames=a.map(l=>`u_${l}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(r,a){this.pixelRatioFrom=a.pixelRatio||1,this.pixelRatioTo=r.pixelRatio||1,this.patternFrom=a.tl.concat(a.br),this.patternTo=r.tl.concat(r.br)}setUniform(r,a,l,h){const m="u_pattern_to"===h||"u_dash_to"===h?this.patternTo:"u_pattern_from"===h||"u_dash_from"===h?this.patternFrom:"u_pixel_ratio_to"===h?this.pixelRatioTo:"u_pixel_ratio_from"===h?this.pixelRatioFrom:null;m&&r.set(m)}getBinding(r,a,l){return"u_pattern_from"===l||"u_pattern_to"===l||"u_dash_from"===l||"u_dash_to"===l?new fu(r,a):new pu(r,a)}}class Pa{constructor(r,a,l,h){this.expression=r,this.type=l,this.maxValue=0,this.paintVertexAttributes=a.map(m=>({name:`a_${m}`,type:"Float32",components:"color"===l?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(r,a,l,h,m,_){const x=this.paintVertexArray.length,w=this.expression.evaluate(new q(0),a,{},m,h,_);this.paintVertexArray.resize(r),this._setPaintValue(x,r,w)}updatePaintArray(r,a,l,h,m){const _=this.expression.evaluate({zoom:0},l,h,void 0,m);this._setPaintValue(r,a,_)}_setPaintValue(r,a,l){if("color"===this.type){const h=js(l);for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,h[0],h[1])}else{for(let h=r;h<a;h++)this.paintVertexArray.emplace(h,l);this.maxValue=Math.max(this.maxValue,Math.abs(l))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Uo{constructor(r,a,l,h,m,_){this.expression=r,this.uniformNames=a.map(x=>`u_${x}_t`),this.type=l,this.useIntegerZoom=h,this.zoom=m,this.maxValue=0,this.paintVertexAttributes=a.map(x=>({name:`a_${x}`,type:"Float32",components:"color"===l?4:2,offset:0})),this.paintVertexArray=new _}populatePaintArray(r,a,l,h,m,_){const x=this.expression.evaluate(new q(this.zoom),a,{},m,h,_),w=this.expression.evaluate(new q(this.zoom+1),a,{},m,h,_),C=this.paintVertexArray.length;this.paintVertexArray.resize(r),this._setPaintValue(C,r,x,w)}updatePaintArray(r,a,l,h,m){const _=this.expression.evaluate({zoom:this.zoom},l,h,void 0,m),x=this.expression.evaluate({zoom:this.zoom+1},l,h,void 0,m);this._setPaintValue(r,a,_,x)}_setPaintValue(r,a,l,h){if("color"===this.type){const m=js(l),_=js(h);for(let x=r;x<a;x++)this.paintVertexArray.emplace(x,m[0],m[1],_[0],_[1])}else{for(let m=r;m<a;m++)this.paintVertexArray.emplace(m,l,h);this.maxValue=Math.max(this.maxValue,Math.abs(l),Math.abs(h))}}upload(r){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=r.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(r,a){const l=this.useIntegerZoom?Math.floor(a.zoom):a.zoom,h=Et(this.expression.interpolationFactor(l,this.zoom,this.zoom+1),0,1);r.set(h)}getBinding(r,a,l){return new pu(r,a)}}class Gs{constructor(r,a,l,h,m,_,x){this.expression=r,this.type=l,this.useIntegerZoom=h,this.zoom=m,this.layerId=x,this.paintVertexAttributes=("array"===l?Dv:Tv).members;for(let w=0;w<a.length;++w);this.zoomInPaintVertexArray=new _,this.zoomOutPaintVertexArray=new _}populatePaintArray(r,a,l){const h=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(r),this.zoomOutPaintVertexArray.resize(r),this._setPaintValues(h,r,a.patterns&&a.patterns[this.layerId],l)}updatePaintArray(r,a,l,h,m,_){this._setPaintValues(r,a,l.patterns&&l.patterns[this.layerId],_)}_setPaintValues(r,a,l,h){if(!h||!l)return;const{min:m,mid:_,max:x}=l,w=h[m],C=h[_],M=h[x];if(w&&C&&M)for(let I=r;I<a;I++)this._setPaintValue(this.zoomInPaintVertexArray,I,C,w),this._setPaintValue(this.zoomOutPaintVertexArray,I,C,M)}_setPaintValue(r,a,l,h){r.emplace(a,l.tl[0],l.tl[1],l.br[0],l.br[1],h.tl[0],h.tl[1],h.br[0],h.br[1],l.pixelRatio,h.pixelRatio)}upload(r){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=r.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=r.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class ps{constructor(r,a,l=(()=>!0)){this.binders={},this._buffers=[];const h=[];for(const m in r.paint._values){if(!l(m))continue;const _=r.paint.get(m);if(!(_ instanceof be&&zs(_.property.specification)))continue;const x=Iv(m,r.type),w=_.value,C=_.property.specification.type,M=_.property.useIntegerZoom,I=_.property.specification["property-type"],P="cross-faded"===I||"cross-faded-data-driven"===I,F="line-dasharray"===String(m)&&"constant"!==r.layout.get("line-cap").value.kind;if("constant"!==w.kind||F)if("source"===w.kind||F||P){const z=jg(m,C,"source");this.binders[m]=P?new Gs(w,x,C,M,a,z,r.id):new Pa(w,x,C,z),h.push(`/a_${m}`)}else{const z=jg(m,C,"composite");this.binders[m]=new Uo(w,x,C,M,a,z),h.push(`/z_${m}`)}else this.binders[m]=P?new $s(w.value,x):new mu(w.value,x,C),h.push(`/u_${m}`)}this.cacheKey=h.sort().join("")}getMaxValue(r){const a=this.binders[r];return a instanceof Pa||a instanceof Uo?a.maxValue:0}populatePaintArrays(r,a,l,h,m,_){for(const x in this.binders){const w=this.binders[x];(w instanceof Pa||w instanceof Uo||w instanceof Gs)&&w.populatePaintArray(r,a,l,h,m,_)}}setConstantPatternPositions(r,a){for(const l in this.binders){const h=this.binders[l];h instanceof $s&&h.setConstantPatternPositions(r,a)}}updatePaintArrays(r,a,l,h,m,_){let x=!1;for(const w in r){const C=a.getPositions(w);for(const M of C){const I=l.feature(M.index);for(const P in this.binders){const F=this.binders[P];if((F instanceof Pa||F instanceof Uo||F instanceof Gs)&&!0===F.expression.isStateDependent){const z=h.paint.get(P);F.expression=z.value,F.updatePaintArray(M.start,M.end,I,r[w],m,_),x=!0}}}}return x}defines(){const r=[];for(const a in this.binders){const l=this.binders[a];(l instanceof mu||l instanceof $s)&&r.push(...l.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return r}getBinderAttributes(){const r=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof Pa||l instanceof Uo||l instanceof Gs)for(let h=0;h<l.paintVertexAttributes.length;h++)r.push(l.paintVertexAttributes[h].name)}return r}getBinderUniforms(){const r=[];for(const a in this.binders){const l=this.binders[a];if(l instanceof mu||l instanceof $s||l instanceof Uo)for(const h of l.uniformNames)r.push(h)}return r}getPaintVertexBuffers(){return this._buffers}getUniforms(r,a){const l=[];for(const h in this.binders){const m=this.binders[h];if(m instanceof mu||m instanceof $s||m instanceof Uo)for(const _ of m.uniformNames)if(a[_]){const x=m.getBinding(r,a[_],_);l.push({name:_,property:h,binding:x})}}return l}setUniforms(r,a,l,h){for(const{name:m,property:_,binding:x}of a)this.binders[_].setUniform(x,h,l.get(_),m)}updatePaintBuffers(r){this._buffers=[];for(const a in this.binders){const l=this.binders[a];if(r&&l instanceof Gs){const h=2===r.fromScale?l.zoomInPaintVertexBuffer:l.zoomOutPaintVertexBuffer;h&&this._buffers.push(h)}else(l instanceof Pa||l instanceof Uo)&&l.paintVertexBuffer&&this._buffers.push(l.paintVertexBuffer)}}upload(r){for(const a in this.binders){const l=this.binders[a];(l instanceof Pa||l instanceof Uo||l instanceof Gs)&&l.upload(r)}this.updatePaintBuffers()}destroy(){for(const r in this.binders){const a=this.binders[r];(a instanceof Pa||a instanceof Uo||a instanceof Gs)&&a.destroy()}}}class ml{constructor(r,a,l=(()=>!0)){this.programConfigurations={};for(const h of r)this.programConfigurations[h.id]=new ps(h,a,l);this.needsUpload=!1,this._featureMap=new Ah,this._bufferOffset=0}populatePaintArrays(r,a,l,h,m,_,x){for(const w in this.programConfigurations)this.programConfigurations[w].populatePaintArrays(r,a,h,m,_,x);void 0!==a.id&&this._featureMap.add(a.id,l,this._bufferOffset,r),this._bufferOffset=r,this.needsUpload=!0}updatePaintArrays(r,a,l,h,m){for(const _ of l)this.needsUpload=this.programConfigurations[_.id].updatePaintArrays(r,this._featureMap,a,_,h,m)||this.needsUpload}get(r){return this.programConfigurations[r]}upload(r){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(r);this.needsUpload=!1}}destroy(){for(const r in this.programConfigurations)this.programConfigurations[r].destroy()}}const Av={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Iv(o,r){return Av[o]||[o.replace(`${r}-`,"").replace(/-/g,"_")]}const gu={"line-pattern":{source:Xn,composite:Xn},"fill-pattern":{source:Xn,composite:Xn},"fill-extrusion-pattern":{source:Xn,composite:Xn},"line-dasharray":{source:Sn,composite:Sn}},Ph={color:{source:Dr,composite:Rn},number:{source:Ma,composite:Dr}};function jg(o,r,a){const l=gu[o];return l&&l[a]||Ph[r][a]}tt(mu,"ConstantBinder"),tt($s,"CrossFadedConstantBinder"),tt(Pa,"SourceExpressionBinder"),tt(Gs,"CrossFadedCompositeBinder"),tt(Uo,"CompositeExpressionBinder"),tt(ps,"ProgramConfiguration",{omit:["_buffers"]}),tt(ml,"ProgramConfigurationSet");const Cf="-transition";class jo extends gn{constructor(r,a){if(super(),this.id=r.id,this.type=r.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==r.type&&(this.metadata=(r=r).metadata,this.minzoom=r.minzoom,this.maxzoom=r.maxzoom,"background"!==r.type&&"sky"!==r.type&&(this.source=r.source,this.sourceLayer=r["source-layer"],this.filter=r.filter),a.layout&&(this._unevaluatedLayout=new Se(a.layout)),a.paint)){this._transitionablePaint=new re(a.paint);for(const l in r.paint)this.setPaintProperty(l,r.paint[l],{validate:!1});for(const l in r.layout)this.setLayoutProperty(l,r.layout[l],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Ve(a.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(r){return"visibility"===r?this.visibility:this._unevaluatedLayout.getValue(r)}setLayoutProperty(r,a,l={}){null!=a&&this._validate(Hd,`layers.${this.id}.layout.${r}`,r,a,l)||("visibility"!==r?this._unevaluatedLayout.setValue(r,a):this.visibility=a)}getPaintProperty(r){return Ko(r,Cf)?this._transitionablePaint.getTransition(r.slice(0,-Cf.length)):this._transitionablePaint.getValue(r)}setPaintProperty(r,a,l={}){if(null!=a&&this._validate(Gd,`layers.${this.id}.paint.${r}`,r,a,l))return!1;if(Ko(r,Cf))return this._transitionablePaint.setTransition(r.slice(0,-Cf.length),a||void 0),!1;{const h=this._transitionablePaint._values[r],m="cross-faded-data-driven"===h.property.specification["property-type"],_=h.value.isDataDriven(),x=h.value;this._transitionablePaint.setValue(r,a),this._handleSpecialPaintPropertyUpdate(r);const w=this._transitionablePaint._values[r].value;return w.isDataDriven()||_||m||this._handleOverridablePaintPropertyUpdate(r,x,w)}}_handleSpecialPaintPropertyUpdate(r){}getProgramIds(){return null}getProgramConfiguration(r){return null}_handleOverridablePaintPropertyUpdate(r,a,l){return!1}isHidden(r){return!!(this.minzoom&&r<this.minzoom)||!!(this.maxzoom&&r>=this.maxzoom)||"none"===this.visibility}updateTransitions(r){this._transitioningPaint=this._transitionablePaint.transitioned(r,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(r,a){r.getCrossfadeParameters&&(this._crossfadeParameters=r.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(r,void 0,a)),this.paint=this._transitioningPaint.possiblyEvaluate(r,void 0,a)}serialize(){const r={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(r.layout=r.layout||{},r.layout.visibility=this.visibility),la(r,(a,l)=>!(void 0===a||"layout"===l&&!Object.keys(a).length||"paint"===l&&!Object.keys(a).length))}_validate(r,a,l,h,m={}){return(!m||!1!==m.validate)&&Eh(this,r.call(su,{key:a,layerType:this.type,objectKey:l,value:h,styleSpec:ye,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const r in this.paint._values){const a=this.paint.get(r);if(a instanceof be&&zs(a.property.specification)&&("source"===a.value.kind||"composite"===a.value.kind)&&a.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=va(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Pv=st([{name:"a_pos",components:2,type:"Int16"}],4),Yb=st([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class cr{constructor(r=[]){this.segments=r}prepareSegment(r,a,l,h){let m=this.segments[this.segments.length-1];return r>cr.MAX_VERTEX_ARRAY_LENGTH&&rr(`Max vertices per segment is ${cr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${r}`),(!m||m.vertexLength+r>cr.MAX_VERTEX_ARRAY_LENGTH||m.sortKey!==h)&&(m={vertexOffset:a.length,primitiveOffset:l.length,vertexLength:0,primitiveLength:0},void 0!==h&&(m.sortKey=h),this.segments.push(m)),m}get(){return this.segments}destroy(){for(const r of this.segments)for(const a in r.vaos)r.vaos[a].destroy()}static simpleSegment(r,a,l,h){return new cr([{vertexOffset:r,primitiveOffset:a,vertexLength:l,primitiveLength:h,vaos:{},sortKey:0}])}}cr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,tt(cr,"SegmentVector");var vt=8192;class gl{constructor(r,a){r&&(a?this.setSouthWest(r).setNorthEast(a):4===r.length?this.setSouthWest([r[0],r[1]]).setNorthEast([r[2],r[3]]):this.setSouthWest(r[0]).setNorthEast(r[1]))}setNorthEast(r){return this._ne=r instanceof dn?new dn(r.lng,r.lat):dn.convert(r),this}setSouthWest(r){return this._sw=r instanceof dn?new dn(r.lng,r.lat):dn.convert(r),this}extend(r){const a=this._sw,l=this._ne;let h,m;if(r instanceof dn)h=r,m=r;else{if(!(r instanceof gl))return Array.isArray(r)?4===r.length||r.every(Array.isArray)?this.extend(gl.convert(r)):this.extend(dn.convert(r)):this;if(h=r._sw,m=r._ne,!h||!m)return this}return a||l?(a.lng=Math.min(h.lng,a.lng),a.lat=Math.min(h.lat,a.lat),l.lng=Math.max(m.lng,l.lng),l.lat=Math.max(m.lat,l.lat)):(this._sw=new dn(h.lng,h.lat),this._ne=new dn(m.lng,m.lat)),this}getCenter(){return new dn((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new dn(this.getWest(),this.getNorth())}getSouthEast(){return new dn(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(r){const{lng:a,lat:l}=dn.convert(r);let h=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=l&&l<=this._ne.lat&&h}static convert(r){return!r||r instanceof gl?r:new gl(r)}}const _u=6371008.8;class dn{constructor(r,a){if(isNaN(r)||isNaN(a))throw new Error(`Invalid LngLat object: (${r}, ${a})`);if(this.lng=+r,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new dn(aa(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(r){const a=Math.PI/180,l=this.lat*a,h=r.lat*a,m=Math.sin(l)*Math.sin(h)+Math.cos(l)*Math.cos(h)*Math.cos((r.lng-this.lng)*a);return _u*Math.acos(Math.min(m,1))}toBounds(r=0){const a=360*r/40075017,l=a/Math.cos(Math.PI/180*this.lat);return new gl(new dn(this.lng-l,this.lat-a),new dn(this.lng+l,this.lat+a))}static convert(r){if(r instanceof dn)return r;if(Array.isArray(r)&&(2===r.length||3===r.length))return new dn(Number(r[0]),Number(r[1]));if(!Array.isArray(r)&&"object"==typeof r&&null!==r)return new dn(Number("lng"in r?r.lng:r.lon),Number(r.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ac=2*Math.PI*_u;function Tf(o){return ac*Math.cos(o*Math.PI/180)}function lc(o){return(180+o)/360}function yu(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Ri(o,r){return o/Tf(r)}function Zr(o){return 360*o-180}function fr(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}function Df(o,r){return o*Tf(fr(r))}const fs=85.051129;class cc{constructor(r,a,l=0){this.x=+r,this.y=+a,this.z=+l}static fromLngLat(r,a=0){const l=dn.convert(r);return new cc(lc(l.lng),yu(l.lat),Ri(a,l.lat))}toLngLat(){return new dn(Zr(this.x),fr(this.y))}toAltitude(){return Df(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ac*(r=fr(this.y),1/Math.cos(r*Math.PI/180));var r}}function Sf(o,r,a,l,h,m,_,x,w){const C=(r+l)/2,M=(a+h)/2,I=new Ye(C,M);x(I),function(P,F,z,U,X,ee){const ce=z-X,se=U-ee;return Math.abs((U-F)*ce-(z-P)*se)/Math.hypot(ce,se)}(I.x,I.y,m.x,m.y,_.x,_.y)>=w?(Sf(o,r,a,C,M,m,I,x,w),Sf(o,C,M,l,h,I,_,x,w)):o.push(_)}function $g(o,r,a){let l=o[0],h=l.x,m=l.y;r(l);const _=[l];for(let x=1;x<o.length;x++){const w=o[x],{x:C,y:M}=w;r(w),Sf(_,h,m,C,M,l,w,r,a),h=C,m=M,l=w}return _}function Mf(o,r,a,l,h){if(h(r,a)){const m=r.add(a).mult(.5);l(m),Mf(o,r,m,l,h),Mf(o,m,a,l,h)}else o.push(a)}function kv(o,r,a){let l=o[0];r(l);const h=[l];for(let m=1;m<o.length;m++){const _=o[m];r(_),Mf(h,l,_,r,a),l=_}return h}const Af=Math.pow(2,14)-1,ka=-Af-1;function kh(o,r){const a=Math.round(o.x*r),l=Math.round(o.y*r);return o.x=Et(a,ka,Af),o.y=Et(l,ka,Af),(a<o.x||a>o.x+1||l<o.y||l>o.y+1)&&rr("Geometry exceeds allowed extent, reduce your vector tile buffer size"),o}function Ra(o,r,a){const l=o.loadGeometry(),h=o.extent,m=vt/h;if(r&&a&&a.projection.isReprojectedInTileSpace){const _=1<<r.z,{scale:x,x:w,y:C,projection:M}=a,I=P=>{const F=Zr((r.x+P.x/h)/_),z=fr((r.y+P.y/h)/_),U=M.project(F,z);P.x=(U.x*x-w)*h,P.y=(U.y*x-C)*h};for(let P=0;P<l.length;P++)if(1!==o.type)l[P]=$g(l[P],I,1);else{const F=[];for(const z of l[P])z.x<0||z.x>=h||z.y<0||z.y>=h||(I(z),F.push(z));l[P]=F}}for(const _ of l)for(const x of _)kh(x,m);return l}function vu(o,r){return{type:o.type,id:o.id,properties:o.properties,geometry:r?Ra(o):[]}}function If(o,r,a,l,h){o.emplaceBack(2*r+(l+1)/2,2*a+(h+1)/2)}function Pf(o,r,a){o.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class Gg{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Dt,this.indexArray=new Yn,this.segments=new cr,this.programConfigurations=new ml(r.layers,r.zoom),this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,l,h){const m=this.layers[0],_=[];let x=null;"circle"===m.type&&(x=m.layout.get("circle-sort-key"));for(const{feature:C,id:M,index:I,sourceLayerIndex:P}of r){const F=this.layers[0]._featureFilter.needGeometry,z=vu(C,F);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),z,l))continue;const U=x?x.evaluate(z,{},l):void 0,X={id:M,properties:C.properties,type:C.type,sourceLayerIndex:P,index:I,geometry:F?z.geometry:Ra(C,l,h),patterns:{},sortKey:U};_.push(X)}x&&_.sort((C,M)=>C.sortKey-M.sortKey);let w=null;"globe"===h.projection.name&&(this.globeExtVertexArray=new Dh,w=h.projection);for(const C of _){const{geometry:M,index:I,sourceLayerIndex:P}=C,F=r[I].feature;this.addFeature(C,M,I,a.availableImages,l,w),a.featureIndex.insert(F,M,I,P,this.index)}}update(r,a,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Pv.members),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,Yb.members))),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(r,a,l,h,m,_){for(const x of a)for(const w of x){const C=w.x,M=w.y;if(C<0||C>=vt||M<0||M>=vt)continue;if(_){const F=_.projectTilePoint(C,M,m),z=_.upVector(m,C,M),U=this.globeExtVertexArray;Pf(U,F,z),Pf(U,F,z),Pf(U,F,z),Pf(U,F,z)}const I=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,r.sortKey),P=I.vertexLength;If(this.layoutVertexArray,C,M,-1,-1),If(this.layoutVertexArray,C,M,1,-1),If(this.layoutVertexArray,C,M,1,1),If(this.layoutVertexArray,C,M,-1,1),this.indexArray.emplaceBack(P,P+1,P+2),this.indexArray.emplaceBack(P,P+2,P+3),I.vertexLength+=4,I.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,{},h,m)}}function Rv(o,r){for(let a=0;a<o.length;a++)if(_l(r,o[a]))return!0;for(let a=0;a<r.length;a++)if(_l(o,r[a]))return!0;return!!kf(o,r)}function Hg(o,r,a){return!!_l(o,r)||!!Zg(r,o,a)}function qg(o,r){if(1===o.length)return Rh(r,o[0]);for(let a=0;a<r.length;a++){const l=r[a];for(let h=0;h<l.length;h++)if(_l(o,l[h]))return!0}for(let a=0;a<o.length;a++)if(Rh(r,o[a]))return!0;for(let a=0;a<r.length;a++)if(kf(o,r[a]))return!0;return!1}function Fv(o,r,a){if(o.length>1){if(kf(o,r))return!0;for(let l=0;l<r.length;l++)if(Zg(r[l],o,a))return!0}for(let l=0;l<o.length;l++)if(Zg(o[l],r,a))return!0;return!1}function kf(o,r){if(0===o.length||0===r.length)return!1;for(let a=0;a<o.length-1;a++){const l=o[a],h=o[a+1];for(let m=0;m<r.length-1;m++)if(Lv(l,h,r[m],r[m+1]))return!0}return!1}function Lv(o,r,a,l){return Ur(o,a,l)!==Ur(r,a,l)&&Ur(o,r,a)!==Ur(o,r,l)}function Zg(o,r,a){const l=a*a;if(1===r.length)return o.distSqr(r[0])<l;for(let h=1;h<r.length;h++)if(Wg(o,r[h-1],r[h])<l)return!0;return!1}function Wg(o,r,a){const l=r.distSqr(a);if(0===l)return o.distSqr(r);const h=((o.x-r.x)*(a.x-r.x)+(o.y-r.y)*(a.y-r.y))/l;return o.distSqr(h<0?r:h>1?a:a.sub(r)._mult(h)._add(r))}function Rh(o,r){let a,l,h,m=!1;for(let _=0;_<o.length;_++){a=o[_];for(let x=0,w=a.length-1;x<a.length;w=x++)l=a[x],h=a[w],l.y>r.y!=h.y>r.y&&r.x<(h.x-l.x)*(r.y-l.y)/(h.y-l.y)+l.x&&(m=!m)}return m}function _l(o,r){let a=!1;for(let l=0,h=o.length-1;l<o.length;h=l++){const m=o[l],_=o[h];m.y>r.y!=_.y>r.y&&r.x<(_.x-m.x)*(r.y-m.y)/(_.y-m.y)+m.x&&(a=!a)}return a}function ms(o,r,a,l,h){for(const _ of o)if(r<=_.x&&a<=_.y&&l>=_.x&&h>=_.y)return!0;const m=[new Ye(r,a),new Ye(r,h),new Ye(l,h),new Ye(l,a)];if(o.length>2)for(const _ of m)if(_l(o,_))return!0;for(let _=0;_<o.length-1;_++)if(Fh(o[_],o[_+1],m))return!0;return!1}function Fh(o,r,a){const l=a[0],h=a[2];if(o.x<l.x&&r.x<l.x||o.x>h.x&&r.x>h.x||o.y<l.y&&r.y<l.y||o.y>h.y&&r.y>h.y)return!1;const m=Ur(o,r,a[0]);return m!==Ur(o,r,a[1])||m!==Ur(o,r,a[2])||m!==Ur(o,r,a[3])}function uc(o,r,a){const l=r.paint.get(o).value;return"constant"===l.kind?l.value:a.programConfigurations.get(r.id).getMaxValue(o)}function Lh(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Rf(o,r,a,l,h){if(!r[0]&&!r[1])return o;const m=Ye.convert(r)._mult(h);"viewport"===a&&m._rotate(-l);const _=[];for(let x=0;x<o.length;x++)_.push(o[x].sub(m));return _}function Ov(o,r,a,l){const h=Ye.convert(o)._mult(l);return"viewport"===r&&h._rotate(-a),h}tt(Gg,"CircleBucket",{omit:["layers"]});const Kb=new it({"circle-sort-key":new ve(ye.layout_circle["circle-sort-key"])});var Jb={paint:new it({"circle-radius":new ve(ye.paint_circle["circle-radius"]),"circle-color":new ve(ye.paint_circle["circle-color"]),"circle-blur":new ve(ye.paint_circle["circle-blur"]),"circle-opacity":new ve(ye.paint_circle["circle-opacity"]),"circle-translate":new ie(ye.paint_circle["circle-translate"]),"circle-translate-anchor":new ie(ye.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new ie(ye.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new ie(ye.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new ve(ye.paint_circle["circle-stroke-width"]),"circle-stroke-color":new ve(ye.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new ve(ye.paint_circle["circle-stroke-opacity"])}),layout:Kb},xu=1e-6,bi="undefined"!=typeof Float32Array?Float32Array:Array;function sp(){var o=new bi(9);return bi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o}function vo(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function hc(o,r,a){var l=r[0],h=r[1],m=r[2],_=r[3],x=r[4],w=r[5],C=r[6],M=r[7],I=r[8],P=r[9],F=r[10],z=r[11],U=r[12],X=r[13],ee=r[14],ce=r[15],se=a[0],pe=a[1],he=a[2],_e=a[3];return o[0]=se*l+pe*x+he*I+_e*U,o[1]=se*h+pe*w+he*P+_e*X,o[2]=se*m+pe*C+he*F+_e*ee,o[3]=se*_+pe*M+he*z+_e*ce,o[4]=(se=a[4])*l+(pe=a[5])*x+(he=a[6])*I+(_e=a[7])*U,o[5]=se*h+pe*w+he*P+_e*X,o[6]=se*m+pe*C+he*F+_e*ee,o[7]=se*_+pe*M+he*z+_e*ce,o[8]=(se=a[8])*l+(pe=a[9])*x+(he=a[10])*I+(_e=a[11])*U,o[9]=se*h+pe*w+he*P+_e*X,o[10]=se*m+pe*C+he*F+_e*ee,o[11]=se*_+pe*M+he*z+_e*ce,o[12]=(se=a[12])*l+(pe=a[13])*x+(he=a[14])*I+(_e=a[15])*U,o[13]=se*h+pe*w+he*P+_e*X,o[14]=se*m+pe*C+he*F+_e*ee,o[15]=se*_+pe*M+he*z+_e*ce,o}function yl(o,r,a){var l,h,m,_,x,w,C,M,I,P,F,z,U=a[0],X=a[1],ee=a[2];return r===o?(o[12]=r[0]*U+r[4]*X+r[8]*ee+r[12],o[13]=r[1]*U+r[5]*X+r[9]*ee+r[13],o[14]=r[2]*U+r[6]*X+r[10]*ee+r[14],o[15]=r[3]*U+r[7]*X+r[11]*ee+r[15]):(h=r[1],m=r[2],_=r[3],x=r[4],w=r[5],C=r[6],M=r[7],I=r[8],P=r[9],F=r[10],z=r[11],o[0]=l=r[0],o[1]=h,o[2]=m,o[3]=_,o[4]=x,o[5]=w,o[6]=C,o[7]=M,o[8]=I,o[9]=P,o[10]=F,o[11]=z,o[12]=l*U+x*X+I*ee+r[12],o[13]=h*U+w*X+P*ee+r[13],o[14]=m*U+C*X+F*ee+r[14],o[15]=_*U+M*X+z*ee+r[15]),o}function Hs(o,r,a){var l=a[0],h=a[1],m=a[2];return o[0]=r[0]*l,o[1]=r[1]*l,o[2]=r[2]*l,o[3]=r[3]*l,o[4]=r[4]*h,o[5]=r[5]*h,o[6]=r[6]*h,o[7]=r[7]*h,o[8]=r[8]*m,o[9]=r[9]*m,o[10]=r[10]*m,o[11]=r[11]*m,o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15],o}function ap(o,r,a){var l=Math.sin(a),h=Math.cos(a),m=r[4],_=r[5],x=r[6],w=r[7],C=r[8],M=r[9],I=r[10],P=r[11];return r!==o&&(o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[3],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[4]=m*h+C*l,o[5]=_*h+M*l,o[6]=x*h+I*l,o[7]=w*h+P*l,o[8]=C*h-m*l,o[9]=M*h-_*l,o[10]=I*h-x*l,o[11]=P*h-w*l,o}function lp(o,r,a){var l=Math.sin(a),h=Math.cos(a),m=r[0],_=r[1],x=r[2],w=r[3],C=r[8],M=r[9],I=r[10],P=r[11];return r!==o&&(o[4]=r[4],o[5]=r[5],o[6]=r[6],o[7]=r[7],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=m*h-C*l,o[1]=_*h-M*l,o[2]=x*h-I*l,o[3]=w*h-P*l,o[8]=m*l+C*h,o[9]=_*l+M*h,o[10]=x*l+I*h,o[11]=w*l+P*h,o}function Xg(o,r,a){var l,h,m,_=a[0],x=a[1],w=a[2],C=Math.hypot(_,x,w);return C<xu?null:(_*=C=1/C,x*=C,w*=C,l=Math.sin(r),h=Math.cos(r),o[0]=_*_*(m=1-h)+h,o[1]=x*_*m+w*l,o[2]=w*_*m-x*l,o[3]=0,o[4]=_*x*m-w*l,o[5]=x*x*m+h,o[6]=w*x*m+_*l,o[7]=0,o[8]=_*w*m+x*l,o[9]=x*w*m-_*l,o[10]=w*w*m+h,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o)}Math.hypot||(Math.hypot=function(){for(var o=0,r=arguments.length;r--;)o+=arguments[r]*arguments[r];return Math.sqrt(o)});var Yg=hc;function bu(){var o=new bi(3);return bi!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o}function Kg(o){var r=new bi(3);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r}function dc(o){return Math.hypot(o[0],o[1],o[2])}function wu(o,r,a){var l=new bi(3);return l[0]=o,l[1]=r,l[2]=a,l}function Kn(o,r,a){return o[0]=r[0]+a[0],o[1]=r[1]+a[1],o[2]=r[2]+a[2],o}function Ff(o,r,a){return o[0]=r[0]-a[0],o[1]=r[1]-a[1],o[2]=r[2]-a[2],o}function Jg(o,r,a){return o[0]=r[0]*a[0],o[1]=r[1]*a[1],o[2]=r[2]*a[2],o}function Eu(o,r,a){return o[0]=Math.min(r[0],a[0]),o[1]=Math.min(r[1],a[1]),o[2]=Math.min(r[2],a[2]),o}function Oh(o,r,a){return o[0]=Math.max(r[0],a[0]),o[1]=Math.max(r[1],a[1]),o[2]=Math.max(r[2],a[2]),o}function qs(o,r,a){return o[0]=r[0]*a,o[1]=r[1]*a,o[2]=r[2]*a,o}function cp(o,r,a,l){return o[0]=r[0]+a[0]*l,o[1]=r[1]+a[1]*l,o[2]=r[2]+a[2]*l,o}function wi(o,r){var a=r[0],l=r[1],h=r[2],m=a*a+l*l+h*h;return m>0&&(m=1/Math.sqrt(m)),o[0]=r[0]*m,o[1]=r[1]*m,o[2]=r[2]*m,o}function $o(o,r){return o[0]*r[0]+o[1]*r[1]+o[2]*r[2]}function Lf(o,r,a){var l=r[0],h=r[1],m=r[2],_=a[0],x=a[1],w=a[2];return o[0]=h*w-m*x,o[1]=m*_-l*w,o[2]=l*x-h*_,o}function ci(o,r,a){var l=r[0],h=r[1],m=r[2],_=a[3]*l+a[7]*h+a[11]*m+a[15];return o[0]=(a[0]*l+a[4]*h+a[8]*m+a[12])/(_=_||1),o[1]=(a[1]*l+a[5]*h+a[9]*m+a[13])/_,o[2]=(a[2]*l+a[6]*h+a[10]*m+a[14])/_,o}function zv(o,r,a){var l=a[0],h=a[1],m=a[2],_=r[0],x=r[1],w=r[2],C=h*w-m*x,M=m*_-l*w,I=l*x-h*_,P=h*I-m*M,F=m*C-l*I,z=l*M-h*C,U=2*a[3];return M*=U,I*=U,F*=2,z*=2,o[0]=_+(C*=U)+(P*=2),o[1]=x+M+F,o[2]=w+I+z,o}var Fa,nr=Ff,Of=Jg,Qg=dc;function zf(o,r,a){return o[0]=r[0]*a,o[1]=r[1]*a,o[2]=r[2]*a,o[3]=r[3]*a,o}function xr(o,r,a){var l=r[0],h=r[1],m=r[2],_=r[3];return o[0]=a[0]*l+a[4]*h+a[8]*m+a[12]*_,o[1]=a[1]*l+a[5]*h+a[9]*m+a[13]*_,o[2]=a[2]*l+a[6]*h+a[10]*m+a[14]*_,o[3]=a[3]*l+a[7]*h+a[11]*m+a[15]*_,o}function Cu(){var o=new bi(4);return bi!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0),o[3]=1,o}function up(o){return o[0]=0,o[1]=0,o[2]=0,o[3]=1,o}function e_(o,r,a){a*=.5;var l=r[0],h=r[1],m=r[2],_=r[3],x=Math.sin(a),w=Math.cos(a);return o[0]=l*w+_*x,o[1]=h*w+m*x,o[2]=m*w-h*x,o[3]=_*w-l*x,o}function t_(o,r,a){a*=.5;var l=r[0],h=r[1],m=r[2],_=r[3],x=Math.sin(a),w=Math.cos(a);return o[0]=l*w-m*x,o[1]=h*w+_*x,o[2]=m*w+l*x,o[3]=_*w-h*x,o}bu(),Fa=new bi(4),bi!=Float32Array&&(Fa[0]=0,Fa[1]=0,Fa[2]=0,Fa[3]=0),bu(),wu(1,0,0),wu(0,1,0),Cu(),Cu(),sp();class hp{constructor(r,a){this.pos=r,this.dir=a}intersectsPlane(r,a,l){const h=$o(a,this.dir);if(Math.abs(h)<1e-6)return!1;const m=((r[0]-this.pos[0])*a[0]+(r[1]-this.pos[1])*a[1]+(r[2]-this.pos[2])*a[2])/h;return l[0]=this.pos[0]+this.dir[0]*m,l[1]=this.pos[1]+this.dir[1]*m,l[2]=this.pos[2]+this.dir[2]*m,!0}closestPointOnSphere(r,a,l){if(U=(F=this.pos)[0],X=F[1],ee=F[2],ce=(z=r)[0],se=z[1],pe=z[2],Math.abs(U-ce)<=xu*Math.max(1,Math.abs(U),Math.abs(ce))&&Math.abs(X-se)<=xu*Math.max(1,Math.abs(X),Math.abs(se))&&Math.abs(ee-pe)<=xu*Math.max(1,Math.abs(ee),Math.abs(pe))||0===a)return l[0]=l[1]=l[2]=0,!1;var F,z,U,X,ee,ce,se,pe;const[h,m,_]=this.dir,x=this.pos[0]-r[0],w=this.pos[1]-r[1],C=this.pos[2]-r[2],M=h*h+m*m+_*_,I=2*(x*h+w*m+C*_),P=I*I-4*M*(x*x+w*w+C*C-a*a);if(P<0){const F=Math.max(-I/2,0),z=x+h*F,U=w+m*F,X=C+_*F,ee=Math.hypot(z,U,X);return l[0]=z*a/ee,l[1]=U*a/ee,l[2]=X*a/ee,!1}{const F=(-I-Math.sqrt(P))/(2*M);if(F<0){const z=Math.hypot(x,w,C);return l[0]=x*a/z,l[1]=w*a/z,l[2]=C*a/z,!1}return l[0]=x+h*F,l[1]=w+m*F,l[2]=C+_*F,!0}}}class Bf{constructor(r,a,l,h,m){this.TL=r,this.TR=a,this.BR=l,this.BL=h,this.horizon=m}static fromInvProjectionMatrix(r,a,l){const h=[-1,1,1],m=[1,1,1],_=[1,-1,1],x=[-1,-1,1],w=ci(h,h,r),C=ci(m,m,r),M=ci(_,_,r),I=ci(x,x,r);return new Bf(w,C,M,I,a/l)}}class dp{constructor(r,a){this.points=r,this.planes=a}static fromInvProjectionMatrix(r,a,l,h){const m=Math.pow(2,l),_=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(w=>{const C=xr([],w,r),M=1/C[3]/a*m;return(I=C)[0]=(P=C)[0]*(F=[M,M,h?1/C[3]:M,M])[0],I[1]=P[1]*F[1],I[2]=P[2]*F[2],I[3]=P[3]*F[3],I;var I,P,F}),x=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(w=>{const C=wi([],Lf([],nr([],_[w[0]],_[w[1]]),nr([],_[w[2]],_[w[1]]))),M=-$o(C,_[w[1]]);return C.concat(M)});return new dp(_,x)}}class xo{constructor(r,a){this.min=r,this.max=a,this.center=qs([],Kn([],this.min,this.max),.5)}quadrant(r){const a=[r%2==0,r<2],l=Kg(this.min),h=Kg(this.max);for(let m=0;m<a.length;m++)l[m]=a[m]?this.min[m]:this.center[m],h[m]=a[m]?this.center[m]:this.max[m];return h[2]=this.max[2],new xo(l,h)}distanceX(r){return Math.max(Math.min(this.max[0],r[0]),this.min[0])-r[0]}distanceY(r){return Math.max(Math.min(this.max[1],r[1]),this.min[1])-r[1]}distanceZ(r){return Math.max(Math.min(this.max[2],r[2]),this.min[2])-r[2]}getCorners(){const r=this.min,a=this.max;return[[r[0],r[1],r[2]],[a[0],r[1],r[2]],[a[0],a[1],r[2]],[r[0],a[1],r[2]],[r[0],r[1],a[2]],[a[0],r[1],a[2]],[a[0],a[1],a[2]],[r[0],a[1],a[2]]]}intersects(r){const a=this.getCorners();let l=!0;for(let h=0;h<r.planes.length;h++){const m=r.planes[h];let _=0;for(let x=0;x<a.length;x++)_+=$o(m,a[x])+m[3]>=0;if(0===_)return 0;_!==a.length&&(l=!1)}if(l)return 2;for(let h=0;h<3;h++){let m=Number.MAX_VALUE,_=-Number.MAX_VALUE;for(let x=0;x<r.points.length;x++){const w=r.points[x][h]-this.min[h];m=Math.min(m,w),_=Math.max(_,w)}if(_<0||m>this.max[h]-this.min[h])return 0}return 1}}function Nf(o,r,a,l,h,m,_,x,w){if(m&&o.queryGeometry.isAboveHorizon)return!1;m&&(w*=o.pixelToTileUnitsFactor);const C=o.tileID.canonical,M=a.projection.upVectorScale(C,a.center.lat,a.worldSize).metersToTile;for(const I of r)for(const P of I){const F=P.add(x),z=h&&a.elevation?a.elevation.exaggeration()*h.getElevationAt(F.x,F.y,!0):0,U=a.projection.projectTilePoint(F.x,F.y,C);if(z>0){const se=a.projection.upVector(C,F.x,F.y);U.x+=se[0]*M*z,U.y+=se[1]*M*z,U.z+=se[2]*M*z}const X=m?F:Bv(U.x,U.y,U.z,l),ee=m?o.tilespaceRays.map(se=>Nv(se,z)):o.queryGeometry.screenGeometry,ce=xr([],[U.x,U.y,U.z,1],l);if(!_&&m?w*=ce[3]/a.cameraToCenterDistance:_&&!m&&(w*=a.cameraToCenterDistance/ce[3]),m){const se=fr((P.y/vt+C.y)/(1<<C.z));w/=a.projection.pixelsPerMeter(se,1)/Ri(1,se)}if(Hg(ee,X,w))return!0}return!1}function Bv(o,r,a,l){const h=xr([],[o,r,a,1],l);return new Ye(h[0]/h[3],h[1]/h[3])}const n_=wu(0,0,0),Vf=wu(0,0,1);function Nv(o,r){const a=bu();return n_[2]=r,o.intersectsPlane(n_,Vf,a),new Ye(a[0],a[1])}class r_ extends Gg{}function pp(o,{width:r,height:a},l,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==r*a*l)throw new RangeError("mismatched image size")}else h=new Uint8Array(r*a*l);return o.width=r,o.height=a,o.data=h,o}function i_(o,r,a){const{width:l,height:h}=r;l===o.width&&h===o.height||(Uf(o,r,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,l),height:Math.min(o.height,h)},a),o.width=l,o.height=h,o.data=r.data)}function Uf(o,r,a,l,h,m){if(0===h.width||0===h.height)return r;if(h.width>o.width||h.height>o.height||a.x>o.width-h.width||a.y>o.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>r.width||h.height>r.height||l.x>r.width-h.width||l.y>r.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const _=o.data,x=r.data;for(let w=0;w<h.height;w++){const C=((a.y+w)*o.width+a.x)*m,M=((l.y+w)*r.width+l.x)*m;for(let I=0;I<h.width*m;I++)x[M+I]=_[C+I]}return r}tt(r_,"HeatmapBucket",{omit:["layers"]});class bo{constructor(r,a){pp(this,r,1,a)}resize(r){i_(this,new bo(r),1)}clone(){return new bo({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,l,h,m){Uf(r,a,l,h,m,1)}}class no{constructor(r,a){pp(this,r,4,a)}resize(r){i_(this,new no(r),4)}replace(r,a){a?this.data.set(r):this.data=r instanceof Uint8ClampedArray?new Uint8Array(r.buffer):r}clone(){return new no({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(r,a,l,h,m){Uf(r,a,l,h,m,4)}}tt(bo,"AlphaImage"),tt(no,"RGBAImage");var Vv={paint:new it({"heatmap-radius":new ve(ye.paint_heatmap["heatmap-radius"]),"heatmap-weight":new ve(ye.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new ie(ye.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Me(ye.paint_heatmap["heatmap-color"]),"heatmap-opacity":new ie(ye.paint_heatmap["heatmap-opacity"])})};function jf(o){const r={},a=o.resolution||256,l=o.clips?o.clips.length:1,h=o.image||new no({width:a,height:l}),m=(_,x,w)=>{r[o.evaluationKey]=w;const C=o.expression.evaluate(r);h.data[_+x+0]=Math.floor(255*C.r/C.a),h.data[_+x+1]=Math.floor(255*C.g/C.a),h.data[_+x+2]=Math.floor(255*C.b/C.a),h.data[_+x+3]=Math.floor(255*C.a)};if(o.clips)for(let _=0,x=0;_<l;++_,x+=4*a)for(let w=0,C=0;w<a;w++,C+=4){const M=w/(a-1),{start:I,end:P}=o.clips[_];m(x,C,I*(1-M)+P*M)}else for(let _=0,x=0;_<a;_++,x+=4)m(0,x,_/(a-1));return h}var Uv={paint:new it({"hillshade-illumination-direction":new ie(ye.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new ie(ye.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new ie(ye.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new ie(ye.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new ie(ye.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new ie(ye.paint_hillshade["hillshade-accent-color"])})};const jv=st([{name:"a_pos",components:2,type:"Int16"}],4),{members:o_}=jv;var fp=mp,$v=mp;function mp(o,r,a){a=a||2;var l,h,m,_,x,w,C,M=r&&r.length,I=M?r[0]*a:o.length,P=s_(o,0,I,a,!0),F=[];if(!P||P.next===P.prev)return F;if(M&&(P=function(U,X,ee,ce){var se,pe,he,_e=[];for(se=0,pe=X.length;se<pe;se++)(he=s_(U,X[se]*ce,se<pe-1?X[se+1]*ce:U.length,ce,!1))===he.next&&(he.steiner=!0),_e.push(wo(he));for(_e.sort(Qb),se=0;se<_e.length;se++)ee=vl(ee=e1(_e[se],ee),ee.next);return ee}(o,r,P,a)),o.length>80*a){l=m=o[0],h=_=o[1];for(var z=a;z<I;z+=a)(x=o[z])<l&&(l=x),(w=o[z+1])<h&&(h=w),x>m&&(m=x),w>_&&(_=w);C=0!==(C=Math.max(m-l,_-h))?1/C:0}return zh(P,F,a,l,h,C),F}function s_(o,r,a,l,h){var m,_;if(h===Uh(o,r,a,l)>0)for(m=r;m<a;m+=l)_=Gf(m,o[m],o[m+1],_);else for(m=a-l;m>=r;m-=l)_=Gf(m,o[m],o[m+1],_);return _&&Bh(_,_.next)&&(_p(_),_=_.next),_}function vl(o,r){if(!o)return o;r||(r=o);var a,l=o;do{if(a=!1,l.steiner||!Bh(l,l.next)&&0!==mr(l.prev,l,l.next))l=l.next;else{if(_p(l),(l=r=l.prev)===l.next)break;a=!0}}while(a||l!==r);return r}function zh(o,r,a,l,h,m,_){if(o){!_&&m&&function(M,I,P,F){var z=M;do{null===z.z&&(z.z=l_(z.x,z.y,I,P,F)),z.prevZ=z.prev,z.nextZ=z.next,z=z.next}while(z!==M);z.prevZ.nextZ=null,z.prevZ=null,function(U){var X,ee,ce,se,pe,he,_e,Te,De=1;do{for(ee=U,U=null,pe=null,he=0;ee;){for(he++,ce=ee,_e=0,X=0;X<De&&(_e++,ce=ce.nextZ);X++);for(Te=De;_e>0||Te>0&&ce;)0!==_e&&(0===Te||!ce||ee.z<=ce.z)?(se=ee,ee=ee.nextZ,_e--):(se=ce,ce=ce.nextZ,Te--),pe?pe.nextZ=se:U=se,se.prevZ=pe,pe=se;ee=ce}pe.nextZ=null,De*=2}while(he>1)}(z)}(o,l,h,m);for(var x,w,C=o;o.prev!==o.next;)if(x=o.prev,w=o.next,m?Hv(o,l,h,m):Gv(o))r.push(x.i/a),r.push(o.i/a),r.push(w.i/a),_p(o),o=w.next,C=w.next;else if((o=w)===C){_?1===_?zh(o=Tu(vl(o),r,a),r,a,l,h,m,2):2===_&&Zs(o,r,a,l,h,m):zh(vl(o),r,a,l,h,m,1);break}}}function Gv(o){var r=o.prev,a=o,l=o.next;if(mr(r,a,l)>=0)return!1;for(var h=o.next.next;h!==o.prev;){if(xl(r.x,r.y,a.x,a.y,l.x,l.y,h.x,h.y)&&mr(h.prev,h,h.next)>=0)return!1;h=h.next}return!0}function Hv(o,r,a,l){var h=o.prev,m=o,_=o.next;if(mr(h,m,_)>=0)return!1;for(var x=h.x>m.x?h.x>_.x?h.x:_.x:m.x>_.x?m.x:_.x,w=h.y>m.y?h.y>_.y?h.y:_.y:m.y>_.y?m.y:_.y,C=l_(h.x<m.x?h.x<_.x?h.x:_.x:m.x<_.x?m.x:_.x,h.y<m.y?h.y<_.y?h.y:_.y:m.y<_.y?m.y:_.y,r,a,l),M=l_(x,w,r,a,l),I=o.prevZ,P=o.nextZ;I&&I.z>=C&&P&&P.z<=M;){if(I!==o.prev&&I!==o.next&&xl(h.x,h.y,m.x,m.y,_.x,_.y,I.x,I.y)&&mr(I.prev,I,I.next)>=0||(I=I.prevZ,P!==o.prev&&P!==o.next&&xl(h.x,h.y,m.x,m.y,_.x,_.y,P.x,P.y)&&mr(P.prev,P,P.next)>=0))return!1;P=P.nextZ}for(;I&&I.z>=C;){if(I!==o.prev&&I!==o.next&&xl(h.x,h.y,m.x,m.y,_.x,_.y,I.x,I.y)&&mr(I.prev,I,I.next)>=0)return!1;I=I.prevZ}for(;P&&P.z<=M;){if(P!==o.prev&&P!==o.next&&xl(h.x,h.y,m.x,m.y,_.x,_.y,P.x,P.y)&&mr(P.prev,P,P.next)>=0)return!1;P=P.nextZ}return!0}function Tu(o,r,a){var l=o;do{var h=l.prev,m=l.next.next;!Bh(h,m)&&Du(h,l,l.next,m)&&pc(h,m)&&pc(m,h)&&(r.push(h.i/a),r.push(l.i/a),r.push(m.i/a),_p(l),_p(l.next),l=o=m),l=l.next}while(l!==o);return vl(l)}function Zs(o,r,a,l,h,m){var _=o;do{for(var x=_.next.next;x!==_.prev;){if(_.i!==x.i&&$f(_,x)){var w=gp(_,x);return _=vl(_,_.next),w=vl(w,w.next),zh(_,r,a,l,h,m),void zh(w,r,a,l,h,m)}x=x.next}_=_.next}while(_!==o)}function Qb(o,r){return o.x-r.x}function e1(o,r){var a=function(m,_){var x,w=_,C=m.x,M=m.y,I=-1/0;do{if(M<=w.y&&M>=w.next.y&&w.next.y!==w.y){var P=w.x+(M-w.y)*(w.next.x-w.x)/(w.next.y-w.y);if(P<=C&&P>I){if(I=P,P===C){if(M===w.y)return w;if(M===w.next.y)return w.next}x=w.x<w.next.x?w:w.next}}w=w.next}while(w!==_);if(!x)return null;if(C===I)return x;var F,z=x,U=x.x,X=x.y,ee=1/0;w=x;do{C>=w.x&&w.x>=U&&C!==w.x&&xl(M<X?C:I,M,U,X,M<X?I:C,M,w.x,w.y)&&(F=Math.abs(M-w.y)/(C-w.x),pc(w,m)&&(F<ee||F===ee&&(w.x>x.x||w.x===x.x&&a_(x,w)))&&(x=w,ee=F)),w=w.next}while(w!==z);return x}(o,r);if(!a)return r;var l=gp(a,o),h=vl(a,a.next);return vl(l,l.next),r===a?h:r}function a_(o,r){return mr(o.prev,o,r.prev)<0&&mr(r.next,o,o.next)<0}function l_(o,r,a,l,h){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-a)*h)|o<<8))|o<<4))|o<<2))|o<<1))|(r=1431655765&((r=858993459&((r=252645135&((r=16711935&((r=32767*(r-l)*h)|r<<8))|r<<4))|r<<2))|r<<1))<<1}function wo(o){var r=o,a=o;do{(r.x<a.x||r.x===a.x&&r.y<a.y)&&(a=r),r=r.next}while(r!==o);return a}function xl(o,r,a,l,h,m,_,x){return(h-_)*(r-x)-(o-_)*(m-x)>=0&&(o-_)*(l-x)-(a-_)*(r-x)>=0&&(a-_)*(m-x)-(h-_)*(l-x)>=0}function $f(o,r){return o.next.i!==r.i&&o.prev.i!==r.i&&!function(a,l){var h=a;do{if(h.i!==a.i&&h.next.i!==a.i&&h.i!==l.i&&h.next.i!==l.i&&Du(h,h.next,a,l))return!0;h=h.next}while(h!==a);return!1}(o,r)&&(pc(o,r)&&pc(r,o)&&function(a,l){var h=a,m=!1,_=(a.x+l.x)/2,x=(a.y+l.y)/2;do{h.y>x!=h.next.y>x&&h.next.y!==h.y&&_<(h.next.x-h.x)*(x-h.y)/(h.next.y-h.y)+h.x&&(m=!m),h=h.next}while(h!==a);return m}(o,r)&&(mr(o.prev,o,r.prev)||mr(o,r.prev,r))||Bh(o,r)&&mr(o.prev,o,o.next)>0&&mr(r.prev,r,r.next)>0)}function mr(o,r,a){return(r.y-o.y)*(a.x-r.x)-(r.x-o.x)*(a.y-r.y)}function Bh(o,r){return o.x===r.x&&o.y===r.y}function Du(o,r,a,l){var h=Vh(mr(o,r,a)),m=Vh(mr(o,r,l)),_=Vh(mr(a,l,o)),x=Vh(mr(a,l,r));return h!==m&&_!==x||!(0!==h||!Nh(o,a,r))||!(0!==m||!Nh(o,l,r))||!(0!==_||!Nh(a,o,l))||!(0!==x||!Nh(a,r,l))}function Nh(o,r,a){return r.x<=Math.max(o.x,a.x)&&r.x>=Math.min(o.x,a.x)&&r.y<=Math.max(o.y,a.y)&&r.y>=Math.min(o.y,a.y)}function Vh(o){return o>0?1:o<0?-1:0}function pc(o,r){return mr(o.prev,o,o.next)<0?mr(o,r,o.next)>=0&&mr(o,o.prev,r)>=0:mr(o,r,o.prev)<0||mr(o,o.next,r)<0}function gp(o,r){var a=new bl(o.i,o.x,o.y),l=new bl(r.i,r.x,r.y),h=o.next,m=r.prev;return o.next=r,r.prev=o,a.next=h,h.prev=a,l.next=a,a.prev=l,m.next=l,l.prev=m,l}function Gf(o,r,a,l){var h=new bl(o,r,a);return l?(h.next=l.next,h.prev=l,l.next.prev=h,l.next=h):(h.prev=h,h.next=h),h}function _p(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function bl(o,r,a){this.i=o,this.x=r,this.y=a,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Uh(o,r,a,l){for(var h=0,m=r,_=a-l;m<a;m+=l)h+=(o[_]-o[m])*(o[m+1]+o[_+1]),_=m;return h}function c_(o,r,a,l,h){u_(o,r,a||0,l||o.length-1,h||qv)}function u_(o,r,a,l,h){for(;l>a;){if(l-a>600){var m=l-a+1,_=r-a+1,x=Math.log(m),w=.5*Math.exp(2*x/3),C=.5*Math.sqrt(x*w*(m-w)/m)*(_-m/2<0?-1:1);u_(o,r,Math.max(a,Math.floor(r-_*w/m+C)),Math.min(l,Math.floor(r+(m-_)*w/m+C)),h)}var M=o[r],I=a,P=l;for(fc(o,a,r),h(o[l],M)>0&&fc(o,a,l);I<P;){for(fc(o,I,P),I++,P--;h(o[I],M)<0;)I++;for(;h(o[P],M)>0;)P--}0===h(o[a],M)?fc(o,a,P):fc(o,++P,l),P<=r&&(a=P+1),r<=P&&(l=P-1)}}function fc(o,r,a){var l=o[r];o[r]=o[a],o[a]=l}function qv(o,r){return o<r?-1:o>r?1:0}function Hf(o,r){const a=o.length;if(a<=1)return[o];const l=[];let h,m;for(let _=0;_<a;_++){const x=$i(o[_]);0!==x&&(o[_].area=Math.abs(x),void 0===m&&(m=x<0),m===x<0?(h&&l.push(h),h=[o[_]]):h.push(o[_]))}if(h&&l.push(h),r>1)for(let _=0;_<l.length;_++)l[_].length<=r||(c_(l[_],r,1,l[_].length-1,Zv),l[_]=l[_].slice(0,r));return l}function Zv(o,r){return r.area-o.area}function qf(o,r,a){const l=a.patternDependencies;let h=!1;for(const m of r){const _=m.paint.get(`${o}-pattern`);_.isConstant()||(h=!0);const x=_.constantOr(null);x&&(h=!0,l[x.to]=!0,l[x.from]=!0)}return h}function Zf(o,r,a,l,h){const m=h.patternDependencies;for(const _ of r){const x=_.paint.get(`${o}-pattern`).value;if("constant"!==x.kind){let w=x.evaluate({zoom:l-1},a,{},h.availableImages),C=x.evaluate({zoom:l},a,{},h.availableImages),M=x.evaluate({zoom:l+1},a,{},h.availableImages);w=w&&w.name?w.name:w,C=C&&C.name?C.name:C,M=M&&M.name?M.name:M,m[w]=!0,m[C]=!0,m[M]=!0,a.patterns[_.id]={min:w,mid:C,max:M}}}return a}mp.deviation=function(o,r,a,l){var h=r&&r.length,m=Math.abs(Uh(o,0,h?r[0]*a:o.length,a));if(h)for(var _=0,x=r.length;_<x;_++)m-=Math.abs(Uh(o,r[_]*a,_<x-1?r[_+1]*a:o.length,a));var w=0;for(_=0;_<l.length;_+=3){var C=l[_]*a,M=l[_+1]*a,I=l[_+2]*a;w+=Math.abs((o[C]-o[I])*(o[M+1]-o[C+1])-(o[C]-o[M])*(o[I+1]-o[C+1]))}return 0===m&&0===w?0:Math.abs((w-m)/m)},mp.flatten=function(o){for(var r=o[0][0].length,a={vertices:[],holes:[],dimensions:r},l=0,h=0;h<o.length;h++){for(var m=0;m<o[h].length;m++)for(var _=0;_<r;_++)a.vertices.push(o[h][m][_]);h>0&&a.holes.push(l+=o[h-1].length)}return a},fp.default=$v;class yp{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Dt,this.indexArray=new Yn,this.indexArray2=new to,this.programConfigurations=new ml(r.layers,r.zoom),this.segments=new cr,this.segments2=new cr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.projection=r.projection}populate(r,a,l,h){this.hasPattern=qf("fill",this.layers,a);const m=this.layers[0].layout.get("fill-sort-key"),_=[];for(const{feature:x,id:w,index:C,sourceLayerIndex:M}of r){const I=this.layers[0]._featureFilter.needGeometry,P=vu(x,I);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),P,l))continue;const F=m?m.evaluate(P,{},l,a.availableImages):void 0,z={id:w,properties:x.properties,type:x.type,sourceLayerIndex:M,index:C,geometry:I?P.geometry:Ra(x,l,h),patterns:{},sortKey:F};_.push(z)}m&&_.sort((x,w)=>x.sortKey-w.sortKey);for(const x of _){const{geometry:w,index:C,sourceLayerIndex:M}=x;if(this.hasPattern){const I=Zf("fill",this.layers,x,this.zoom,a);this.patternFeatures.push(I)}else this.addFeature(x,w,C,l,{},a.availableImages);a.featureIndex.insert(r[C].feature,w,C,M,this.index)}}update(r,a,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,l,h)}addFeatures(r,a,l,h,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,a,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,o_),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.indexBuffer2=r.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(r,a,l,h,m,_=[]){for(const x of Hf(a,500)){let w=0;for(const z of x)w+=z.length;const C=this.segments.prepareSegment(w,this.layoutVertexArray,this.indexArray),M=C.vertexLength,I=[],P=[];for(const z of x){if(0===z.length)continue;z!==x[0]&&P.push(I.length/2);const U=this.segments2.prepareSegment(z.length,this.layoutVertexArray,this.indexArray2),X=U.vertexLength;this.layoutVertexArray.emplaceBack(z[0].x,z[0].y),this.indexArray2.emplaceBack(X+z.length-1,X),I.push(z[0].x),I.push(z[0].y);for(let ee=1;ee<z.length;ee++)this.layoutVertexArray.emplaceBack(z[ee].x,z[ee].y),this.indexArray2.emplaceBack(X+ee-1,X+ee),I.push(z[ee].x),I.push(z[ee].y);U.vertexLength+=z.length,U.primitiveLength+=z.length}const F=fp(I,P);for(let z=0;z<F.length;z+=3)this.indexArray.emplaceBack(M+F[z],M+F[z+1],M+F[z+2]);C.vertexLength+=w,C.primitiveLength+=F.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,m,_,h)}}tt(yp,"FillBucket",{omit:["layers","patternFeatures"]});const h_=new it({"fill-sort-key":new ve(ye.layout_fill["fill-sort-key"])});var Wf={paint:new it({"fill-antialias":new ie(ye.paint_fill["fill-antialias"]),"fill-opacity":new ve(ye.paint_fill["fill-opacity"]),"fill-color":new ve(ye.paint_fill["fill-color"]),"fill-outline-color":new ve(ye.paint_fill["fill-outline-color"]),"fill-translate":new ie(ye.paint_fill["fill-translate"]),"fill-translate-anchor":new ie(ye.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ie(ye.paint_fill["fill-pattern"])}),layout:h_};const d_=st([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Xf=st([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Wv=st([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Xv}=d_;var Yf=mc;function mc(o,r,a,l,h){this.properties={},this.extent=a,this.type=0,this._pbf=o,this._geometry=-1,this._keys=l,this._values=h,o.readFields(gc,this,r)}function gc(o,r,a){1==o?r.id=a.readVarint():2==o?function(l,h){for(var m=l.readVarint()+l.pos;l.pos<m;){var _=h._keys[l.readVarint()],x=h._values[l.readVarint()];h.properties[_]=x}}(a,r):3==o?r.type=a.readVarint():4==o&&(r._geometry=a.pos)}function p_(o){for(var r,a,l=0,h=0,m=o.length,_=m-1;h<m;_=h++)l+=((a=o[_]).x-(r=o[h]).x)*(r.y+a.y);return l}mc.types=["Unknown","Point","LineString","Polygon"],mc.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var r,a=o.readVarint()+o.pos,l=1,h=0,m=0,_=0,x=[];o.pos<a;){if(h<=0){var w=o.readVarint();l=7&w,h=w>>3}if(h--,1===l||2===l)m+=o.readSVarint(),_+=o.readSVarint(),1===l&&(r&&x.push(r),r=[]),r.push(new Ye(m,_));else{if(7!==l)throw new Error("unknown command "+l);r&&r.push(r[0].clone())}}return r&&x.push(r),x},mc.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var r=o.readVarint()+o.pos,a=1,l=0,h=0,m=0,_=1/0,x=-1/0,w=1/0,C=-1/0;o.pos<r;){if(l<=0){var M=o.readVarint();a=7&M,l=M>>3}if(l--,1===a||2===a)(h+=o.readSVarint())<_&&(_=h),h>x&&(x=h),(m+=o.readSVarint())<w&&(w=m),m>C&&(C=m);else if(7!==a)throw new Error("unknown command "+a)}return[_,w,x,C]},mc.prototype.toGeoJSON=function(o,r,a){var l,h,m=this.extent*Math.pow(2,a),_=this.extent*o,x=this.extent*r,w=this.loadGeometry(),C=mc.types[this.type];function M(F){for(var z=0;z<F.length;z++){var U=F[z];F[z]=[360*(U.x+_)/m-180,360/Math.PI*Math.atan(Math.exp((180-360*(U.y+x)/m)*Math.PI/180))-90]}}switch(this.type){case 1:var I=[];for(l=0;l<w.length;l++)I[l]=w[l][0];M(w=I);break;case 2:for(l=0;l<w.length;l++)M(w[l]);break;case 3:for(w=function(F){var z=F.length;if(z<=1)return[F];for(var U,X,ee=[],ce=0;ce<z;ce++){var se=p_(F[ce]);0!==se&&(void 0===X&&(X=se<0),X===se<0?(U&&ee.push(U),U=[F[ce]]):U.push(F[ce]))}return U&&ee.push(U),ee}(w),l=0;l<w.length;l++)for(h=0;h<w[l].length;h++)M(w[l][h])}1===w.length?w=w[0]:C="Multi"+C;var P={type:"Feature",geometry:{type:C,coordinates:w},properties:this.properties};return"id"in this&&(P.id=this.id),P};var Kf=f_;function f_(o,r){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(vp,this,r),this.length=this._features.length}function vp(o,r,a){15===o?r.version=a.readVarint():1===o?r.name=a.readString():5===o?r.extent=a.readVarint():2===o?r._features.push(a.pos):3===o?r._keys.push(a.readString()):4===o&&r._values.push(function(l){for(var h=null,m=l.readVarint()+l.pos;l.pos<m;){var _=l.readVarint()>>3;h=1===_?l.readString():2===_?l.readFloat():3===_?l.readDouble():4===_?l.readVarint64():5===_?l.readVarint():6===_?l.readSVarint():7===_?l.readBoolean():null}return h}(a))}function Yv(o,r,a){if(3===o){var l=new Kf(a,a.readVarint()+a.pos);l.length&&(r[l.name]=l)}}f_.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var r=this._pbf.readVarint()+this._pbf.pos;return new Yf(this._pbf,r,this.extent,this._keys,this._values)};var wl={VectorTile:function(o,r){this.layers=o.readFields(Yv,{},r)},VectorTileFeature:Yf,VectorTileLayer:Kf};function jh(o,r,a,l){const h=[],m=0===l?(_,x,w,C,M,I)=>{_.push(new Ye(I,w+(I-x)/(C-x)*(M-w)))}:(_,x,w,C,M,I)=>{_.push(new Ye(x+(I-w)/(M-w)*(C-x),I))};for(const _ of o){const x=[];for(const w of _){if(w.length<=2)continue;const C=[];for(let P=0;P<w.length-1;P++){const F=w[P].x,z=w[P].y,U=w[P+1].x,X=w[P+1].y,ee=0===l?F:z,ce=0===l?U:X;ee<r?ce>r&&m(C,F,z,U,X,r):ee>a?ce<a&&m(C,F,z,U,X,a):C.push(w[P]),ce<r&&ee>=r&&m(C,F,z,U,X,r),ce>a&&ee<=a&&m(C,F,z,U,X,a)}let M=w[w.length-1];const I=0===l?M.x:M.y;I>=r&&I<=a&&C.push(M),C.length&&(M=C[C.length-1],C[0].x===M.x&&C[0].y===M.y||C.push(C[0]),x.push(C))}x.length&&h.push(x)}return h}const m_=wl.VectorTileFeature.types,Jf=Math.pow(2,13);function Su(o,r,a,l,h,m,_,x){o.emplaceBack((r<<1)+_,(a<<1)+m,(Math.floor(l*Jf)<<1)+h,Math.round(x))}function El(o,r,a){o.emplaceBack(r.x,r.y,r.z,16384*a[0],16384*a[1],16384*a[2])}class $h{constructor(){this.acc=new Ye(0,0),this.polyCount=[]}startRing(r){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new Ye(r.x,r.y),this.max=new Ye(r.x,r.y))}append(r,a){this.currentPolyCount.edges++,this.acc._add(r);const l=this.min,h=this.max;r.x<l.x?l.x=r.x:r.x>h.x&&(h.x=r.x),r.y<l.y?l.y=r.y:r.y>h.y&&(h.y=r.y),((0===r.x||r.x===vt)&&r.x===a.x)!=((0===r.y||r.y===vt)&&r.y===a.y)&&this.processBorderOverlap(r,a),a.x<0!=r.x<0&&this.addBorderIntersection(0,Ht(a.y,r.y,(0-a.x)/(r.x-a.x))),a.x>vt!=r.x>vt&&this.addBorderIntersection(1,Ht(a.y,r.y,(vt-a.x)/(r.x-a.x))),a.y<0!=r.y<0&&this.addBorderIntersection(2,Ht(a.x,r.x,(0-a.y)/(r.y-a.y))),a.y>vt!=r.y>vt&&this.addBorderIntersection(3,Ht(a.x,r.x,(vt-a.y)/(r.y-a.y)))}addBorderIntersection(r,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const l=this.borders[r];a<l[0]&&(l[0]=a),a>l[1]&&(l[1]=a)}processBorderOverlap(r,a){if(r.x===a.x){if(r.y===a.y)return;const l=0===r.x?0:1;this.addBorderIntersection(l,a.y),this.addBorderIntersection(l,r.y)}else{const l=0===r.y?2:3;this.addBorderIntersection(l,a.x),this.addBorderIntersection(l,r.x)}}centroid(){const r=this.polyCount.reduce((a,l)=>a+l.edges,0);return 0!==r?this.acc.div(r)._round():new Ye(0,0)}span(){return new Ye(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((r,a)=>r+ +(a[0]!==Number.MAX_VALUE),0)}}class Mu{constructor(r){this.zoom=r.zoom,this.canonical=r.canonical,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.hasPattern=!1,this.projection=r.projection,this.layoutVertexArray=new Ct,this.centroidVertexArray=new du,this.indexArray=new Yn,this.programConfigurations=new ml(r.layers,r.zoom),this.segments=new cr,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id),this.enableTerrain=r.enableTerrain}populate(r,a,l,h){this.features=[],this.hasPattern=qf("fill-extrusion",this.layers,a),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(m){const _=Math.exp(Math.PI*(1-m.y/(1<<m.z)*2));return 80150034*_/(_*_+1)/vt/(1<<m.z)}(l);for(const{feature:m,id:_,index:x,sourceLayerIndex:w}of r){const C=this.layers[0]._featureFilter.needGeometry,M=vu(m,C);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),M,l))continue;const I={id:_,sourceLayerIndex:w,index:x,geometry:C?M.geometry:Ra(m,l,h),properties:m.properties,type:m.type,patterns:{}},P=this.layoutVertexArray.length;this.hasPattern?this.features.push(Zf("fill-extrusion",this.layers,I,this.zoom,a)):this.addFeature(I,I.geometry,x,l,{},a.availableImages,h),a.featureIndex.insert(m,I.geometry,x,w,this.index,P)}this.sortBorders()}addFeatures(r,a,l,h,m){for(const _ of this.features){const{geometry:x}=_;this.addFeature(_,x,_.index,a,l,h,m)}this.sortBorders()}update(r,a,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,Xv),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=r.createVertexBuffer(this.layoutVertexExtArray,Wv.members,!0))),this.programConfigurations.upload(r),this.uploaded=!0}uploadCentroid(r){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=r.createVertexBuffer(this.centroidVertexArray,Xf.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(r,a,l,h,m,_,x){const w=[new Ye(0,0),new Ye(vt,vt)],C=x.projection,M="globe"===C.name,I=this.enableTerrain&&!M?new $h:null;M&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new sc);const P=Hf(a,500);for(let U=P.length-1;U>=0;U--){const X=P[U];(0===X.length||(F=X[0]).every(ee=>ee.x<=0)||F.every(ee=>ee.x>=vt)||F.every(ee=>ee.y<=0)||F.every(ee=>ee.y>=vt))&&P.splice(U,1)}var F;let z;if(M)z=xp(P,w,h);else{z=[];for(const U of P)z.push({polygon:U,bounds:w})}for(const U of z){const X=U.polygon;let ee=0,ce=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let Te=0;Te<X.length;Te++){const De=X[Te];if(0===De.length)continue;ee+=De.length;let Pe=0;I&&I.startRing(De[0]);for(let Be=0;Be<De.length;Be++){const xe=De[Be];if(Be>=1){const Ae=De[Be-1];if(!Qf(xe,Ae,U.bounds)){I&&I.append(xe,Ae),ce.vertexLength+4>cr.MAX_VERTEX_ARRAY_LENGTH&&(ce=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const Ne=xe.sub(Ae)._perp(),Ue=Ne.x/(Math.abs(Ne.x)+Math.abs(Ne.y)),rt=Ne.y>0?1:0,Oe=Ae.dist(xe);Pe+Oe>32768&&(Pe=0),Su(this.layoutVertexArray,xe.x,xe.y,Ue,rt,0,0,Pe),Su(this.layoutVertexArray,xe.x,xe.y,Ue,rt,0,1,Pe),Pe+=Oe,Su(this.layoutVertexArray,Ae.x,Ae.y,Ue,rt,0,0,Pe),Su(this.layoutVertexArray,Ae.x,Ae.y,Ue,rt,0,1,Pe);const Je=ce.vertexLength;if(this.indexArray.emplaceBack(Je,Je+2,Je+1),this.indexArray.emplaceBack(Je+1,Je+2,Je+3),ce.vertexLength+=4,ce.primitiveLength+=2,M){const At=this.layoutVertexExtArray,Nt=C.projectTilePoint(xe.x,xe.y,h),ft=C.projectTilePoint(Ae.x,Ae.y,h),at=C.upVector(h,xe.x,xe.y),Gt=C.upVector(h,Ae.x,Ae.y);El(At,Nt,at),El(At,Nt,at),El(At,ft,Gt),El(At,ft,Gt)}}}}}if(ce.vertexLength+ee>cr.MAX_VERTEX_ARRAY_LENGTH&&(ce=this.segments.prepareSegment(ee,this.layoutVertexArray,this.indexArray)),"Polygon"!==m_[r.type])continue;const se=[],pe=[],he=ce.vertexLength;for(let Te=0;Te<X.length;Te++){const De=X[Te];if(0!==De.length){De!==X[0]&&pe.push(se.length/2);for(let Pe=0;Pe<De.length;Pe++){const Be=De[Pe];Su(this.layoutVertexArray,Be.x,Be.y,0,0,1,1,0),se.push(Be.x),se.push(Be.y),I&&I.currentPolyCount.top++,M&&El(this.layoutVertexExtArray,C.projectTilePoint(Be.x,Be.y,h),C.upVector(h,Be.x,Be.y))}}}const _e=fp(se,pe);for(let Te=0;Te<_e.length;Te+=3)this.indexArray.emplaceBack(he+_e[Te],he+_e[Te+2],he+_e[Te+1]);ce.primitiveLength+=_e.length/3,ce.vertexLength+=ee}if(I&&I.polyCount.length>0){if(I.borders){I.vertexArrayOffset=this.centroidVertexArray.length;const U=I.borders,X=this.featuresOnBorder.push(I)-1;for(let ee=0;ee<4;ee++)U[ee][0]!==Number.MAX_VALUE&&this.borders[ee].push(X)}this.encodeCentroid(I.borders?void 0:I.centroid(),I)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,m,_,h)}sortBorders(){for(let r=0;r<4;r++)this.borders[r].sort((a,l)=>this.featuresOnBorder[a].borders[r][0]-this.featuresOnBorder[l].borders[r][0])}encodeCentroid(r,a,l=!0){let h,m;if(r)if(0!==r.y){const x=a.span()._mult(this.tileToMeter);h=(Math.max(r.x,1)<<3)+Math.min(7,Math.round(x.x/10)),m=(Math.max(r.y,1)<<3)+Math.min(7,Math.round(x.y/10))}else h=Math.ceil(7*(r.x+450)),m=0;else h=0,m=+l;let _=l?this.centroidVertexArray.length:a.vertexArrayOffset;for(const x of a.polyCount){l&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*x.edges+x.top);for(let w=0;w<2*x.edges;w++)this.centroidVertexArray.emplace(_++,0,m),this.centroidVertexArray.emplace(_++,h,m);for(let w=0;w<x.top;w++)this.centroidVertexArray.emplace(_++,h,m)}}}function Qf(o,r,a){return o.x===r.x&&(o.x<a[0].x||o.x>a[1].x)||o.y===r.y&&(o.y<a[0].y||o.y>a[1].y)}function em(){const o=Math.PI/32,r=Math.tan(o),a=_u;return a*Math.sqrt(1+2*r*r)-a}function xp(o,r,a){const l=1<<a.z,h=Zr(a.x/l),m=Zr((a.x+1)/l),_=fr(a.y/l),x=fr((a.y+1)/l);return function(w,C,M,I,P=0,F){const z=[];if(!w.length||!M||!I)return z;const U=(_e,Te)=>{for(const De of _e)z.push({polygon:De,bounds:Te})},X=Math.ceil(Math.log2(M)),ee=Math.ceil(Math.log2(I)),ce=X-ee,se=[];for(let _e=0;_e<Math.abs(ce);_e++)se.push(ce>0?0:1);for(let _e=0;_e<Math.min(X,ee);_e++)se.push(0),se.push(1);let pe=w;if(pe=jh(pe,C[0].y-P,C[1].y+P,1),pe=jh(pe,C[0].x-P,C[1].x+P,0),!pe.length)return z;const he=[];for(se.length?he.push({polygons:pe,bounds:C,depth:0}):U(pe,C);he.length;){const _e=he.pop(),Te=_e.depth,De=se[Te],Pe=_e.bounds[0],Be=_e.bounds[1],xe=0===De?Pe.x:Pe.y,Ae=0===De?Be.x:Be.y,Ne=F?F(De,xe,Ae):.5*(xe+Ae),Ue=jh(_e.polygons,xe-P,Ne+P,De),rt=jh(_e.polygons,Ne-P,Ae+P,De);if(Ue.length){const Oe=[Pe,new Ye(0===De?Ne:Be.x,1===De?Ne:Be.y)];se.length>Te+1?he.push({polygons:Ue,bounds:Oe,depth:Te+1}):U(Ue,Oe)}if(rt.length){const Oe=[new Ye(0===De?Ne:Pe.x,1===De?Ne:Pe.y),Be];se.length>Te+1?he.push({polygons:rt,bounds:Oe,depth:Te+1}):U(rt,Oe)}}return z}(o,r,Math.ceil((m-h)/11.25),Math.ceil((_-x)/11.25),1,(w,C,M)=>{if(0===w)return.5*(C+M);{const I=fr((a.y+C/vt)/l);return(yu(.5*(fr((a.y+M/vt)/l)+I))*l-a.y)*vt}})}tt(Mu,"FillExtrusionBucket",{omit:["layers","features"]}),tt($h,"PartMetadata");var Gh={paint:new it({"fill-extrusion-opacity":new ie(ye["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new ve(ye["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new ie(ye["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new ie(ye["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ie(ye["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new ve(ye["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new ve(ye["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new ie(ye["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function g_(o,r,a){var l=2*Math.PI*6378137/256/Math.pow(2,a);return[o*l-2*Math.PI*6378137/2,r*l-2*Math.PI*6378137/2]}class Hh{constructor(r,a,l){this.z=r,this.x=a,this.y=l,this.key=Au(0,r,r,a,l)}equals(r){return this.z===r.z&&this.x===r.x&&this.y===r.y}url(r,a){const l=(_=this.y,x=this.z,w=g_(256*(m=this.x),256*(_=Math.pow(2,x)-_-1),x),C=g_(256*(m+1),256*(_+1),x),w[0]+","+w[1]+","+C[0]+","+C[1]),h=function(m,_,x){let w,C="";for(let M=m;M>0;M--)w=1<<M-1,C+=(_&w?1:0)+(x&w?2:0);return C}(this.z,this.x,this.y);var m,_,x,w,C;return r[(this.x+this.y)%r.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===a?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",l)}toString(){return`${this.z}/${this.x}/${this.y}`}}class __{constructor(r,a){this.wrap=r,this.canonical=a,this.key=Au(r,a.z,a.z,a.x,a.y)}}class Ei{constructor(r,a,l,h,m){this.overscaledZ=r,this.wrap=a,this.canonical=new Hh(l,+h,+m),this.key=0===a&&r===l?this.canonical.key:Au(a,r,l,h,m)}equals(r){return this.overscaledZ===r.overscaledZ&&this.wrap===r.wrap&&this.canonical.equals(r.canonical)}scaledTo(r){const a=this.canonical.z-r;return r>this.canonical.z?new Ei(r,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Ei(r,this.wrap,r,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(r,a=!0){if(this.overscaledZ===r&&a)return this.key;if(r>this.canonical.z)return Au(this.wrap*+a,r,this.canonical.z,this.canonical.x,this.canonical.y);{const l=this.canonical.z-r;return Au(this.wrap*+a,r,r,this.canonical.x>>l,this.canonical.y>>l)}}isChildOf(r){if(r.wrap!==this.wrap)return!1;const a=this.canonical.z-r.canonical.z;return 0===r.overscaledZ||r.overscaledZ<this.overscaledZ&&r.canonical.x===this.canonical.x>>a&&r.canonical.y===this.canonical.y>>a}children(r){if(this.overscaledZ>=r)return[new Ei(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,l=2*this.canonical.x,h=2*this.canonical.y;return[new Ei(a,this.wrap,a,l,h),new Ei(a,this.wrap,a,l+1,h),new Ei(a,this.wrap,a,l,h+1),new Ei(a,this.wrap,a,l+1,h+1)]}isLessThan(r){return this.wrap<r.wrap||!(this.wrap>r.wrap)&&(this.overscaledZ<r.overscaledZ||!(this.overscaledZ>r.overscaledZ)&&(this.canonical.x<r.canonical.x||!(this.canonical.x>r.canonical.x)&&this.canonical.y<r.canonical.y))}wrapped(){return new Ei(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(r){return new Ei(this.overscaledZ,r,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new __(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Au(o,r,a,l,h){const m=1<<Math.min(a,22);let _=m*(h%m)+l%m;return o&&a<22&&(_+=m*m*((o<0?-2*o-1:2*o)%(1<<2*(22-a)))),16*(32*_+a)+(r-a)}function _c(o,r){return o.x*r.x+o.y*r.y}function tm(o,r){if(1===o.length){let a=0;const l=r[a++];let h;for(;!h||l.equals(h);)if(h=r[a++],!h)return 1/0;for(;a<r.length;a++){const m=r[a],_=o[0],x=h.sub(l),w=m.sub(l),C=_.sub(l),M=_c(x,x),I=_c(x,w),P=_c(w,w),F=_c(C,x),z=_c(C,w),U=M*P-I*I,X=(P*F-I*z)/U,ee=(M*z-I*F)/U,ce=l.z*(1-X-ee)+h.z*X+m.z*ee;if(isFinite(ce))return ce}return 1/0}{let a=1/0;for(const l of r)a=Math.min(a,l.z);return a}}function nm(o){const r=new Ye(o[0],o[1]);return r.z=o[2],r}function rm(o,r,a,l,h,m,_,x){const w=_*h.getElevationAt(o,r,!0,!0),C=0!==m[0],M=C?0===m[1]?_*(m[0]/7-450):_*function(I,P,F){const z=Math.floor(P[0]/8),U=Math.floor(P[1]/8),X=10*(P[0]-8*z),ee=10*(P[1]-8*U),ce=I.getElevationAt(z,U,!0,!0),se=I.getMeterToDEM(F),pe=Math.floor(.5*(X*se-1)),he=Math.floor(.5*(ee*se-1)),_e=I.tileCoordToPixel(z,U),Te=2*pe+1,De=2*he+1,Pe=(At=Te,Nt=De,[(rt=I).getElevationAtPixel(Oe=_e.x-pe,Je=_e.y-he,!0),rt.getElevationAtPixel(Oe+Nt,Je,!0),rt.getElevationAtPixel(Oe,Je+Nt,!0),rt.getElevationAtPixel(Oe+At,Je+Nt,!0)]),Be=Math.abs(Pe[0]-Pe[1]),xe=Math.abs(Pe[2]-Pe[3]),Ae=Math.abs(Pe[0]-Pe[2])+Math.abs(Pe[1]-Pe[3]),Ne=Math.min(.25,.5*se*(Be+xe)/Te),Ue=Math.min(.25,.5*se*Ae/De);var rt,Oe,Je,At,Nt;return ce+Math.max(Ne*X,Ue*ee)}(h,m,x):w;return{base:w+(0===a)?-1:a,top:C?Math.max(M+l,w+a+2):w+l}}tt(Hh,"CanonicalTileID"),tt(Ei,"OverscaledTileID",{omit:["projMatrix"]});const Kv=st([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:y_}=Kv,Jv=st([{name:"a_packed",components:4,type:"Float32"}]),{members:Qv}=Jv,gs=wl.VectorTileFeature.types,ex=Math.cos(Math.PI/180*37.5);class qh{constructor(r){this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(a=>a.id),this.index=r.index,this.projection=r.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(a=>{this.gradients[a.id]={}}),this.layoutVertexArray=new _n,this.layoutVertexArray2=new Rn,this.indexArray=new Yn,this.programConfigurations=new ml(r.layers,r.zoom),this.segments=new cr,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(a=>a.isStateDependent()).map(a=>a.id)}populate(r,a,l,h){this.hasPattern=qf("line",this.layers,a);const m=this.layers[0].layout.get("line-sort-key"),_=[];for(const{feature:M,id:I,index:P,sourceLayerIndex:F}of r){const z=this.layers[0]._featureFilter.needGeometry,U=vu(M,z);if(!this.layers[0]._featureFilter.filter(new q(this.zoom),U,l))continue;const X=m?m.evaluate(U,{},l):void 0,ee={id:I,properties:M.properties,type:M.type,sourceLayerIndex:F,index:P,geometry:z?U.geometry:Ra(M,l,h),patterns:{},sortKey:X};_.push(ee)}m&&_.sort((M,I)=>M.sortKey-I.sortKey);const{lineAtlas:x,featureIndex:w}=a,C=this.addConstantDashes(x);for(const M of _){const{geometry:I,index:P,sourceLayerIndex:F}=M;if(C&&this.addFeatureDashes(M,x),this.hasPattern){const z=Zf("line",this.layers,M,this.zoom,a);this.patternFeatures.push(z)}else this.addFeature(M,I,P,l,x.positions,a.availableImages);w.insert(r[P].feature,I,P,F,this.index)}}addConstantDashes(r){let a=!1;for(const l of this.layers){const h=l.paint.get("line-dasharray").value,m=l.layout.get("line-cap").value;if("constant"!==h.kind||"constant"!==m.kind)a=!0;else{const _=m.value,x=h.value;if(!x)continue;r.addDash(x.from,_),r.addDash(x.to,_),x.other&&r.addDash(x.other,_)}}return a}addFeatureDashes(r,a){const l=this.zoom;for(const h of this.layers){const m=h.paint.get("line-dasharray").value,_=h.layout.get("line-cap").value;if("constant"===m.kind&&"constant"===_.kind)continue;let x,w,C,M,I,P;if("constant"===m.kind){const X=m.value;if(!X)continue;x=X.other||X.to,w=X.to,C=X.from}else x=m.evaluate({zoom:l-1},r),w=m.evaluate({zoom:l},r),C=m.evaluate({zoom:l+1},r);"constant"===_.kind?M=I=P=_.value:(M=_.evaluate({zoom:l-1},r),I=_.evaluate({zoom:l},r),P=_.evaluate({zoom:l+1},r)),a.addDash(x,M),a.addDash(w,I),a.addDash(C,P);const F=a.getKey(x,M),z=a.getKey(w,I),U=a.getKey(C,P);r.patterns[h.id]={min:F,mid:z,max:U}}}update(r,a,l,h){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(r,a,this.stateDependentLayers,l,h)}addFeatures(r,a,l,h,m){for(const _ of this.patternFeatures)this.addFeature(_,_.geometry,_.index,a,l,h)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(r){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=r.createVertexBuffer(this.layoutVertexArray2,Qv)),this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,y_),this.indexBuffer=r.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(r),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(r){if(r.properties&&r.properties.hasOwnProperty("mapbox_clip_start")&&r.properties.hasOwnProperty("mapbox_clip_end"))return{start:+r.properties.mapbox_clip_start,end:+r.properties.mapbox_clip_end}}addFeature(r,a,l,h,m,_){const x=this.layers[0].layout,w=x.get("line-join").evaluate(r,{}),C=x.get("line-cap").evaluate(r,{}),M=x.get("line-miter-limit"),I=x.get("line-round-limit");this.lineClips=this.lineFeatureClips(r);for(const P of a)this.addLine(P,r,w,C,M,I);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,r,l,m,_,h)}addLine(r,a,l,h,m,_){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let ee=0;ee<r.length-1;ee++)this.totalDistance+=r[ee].dist(r[ee+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const x="Polygon"===gs[a.type];let w=r.length;for(;w>=2&&r[w-1].equals(r[w-2]);)w--;let C=0;for(;C<w-1&&r[C].equals(r[C+1]);)C++;if(w<(x?3:2))return;"bevel"===l&&(m=1.05);const M=this.overscaling<=16?122880/(512*this.overscaling):0,I=this.segments.prepareSegment(10*w,this.layoutVertexArray,this.indexArray);let P,F,z,U,X;this.e1=this.e2=-1,x&&(P=r[w-2],X=r[C].sub(P)._unit()._perp());for(let ee=C;ee<w;ee++){if(z=ee===w-1?x?r[C+1]:void 0:r[ee+1],z&&r[ee].equals(z))continue;X&&(U=X),P&&(F=P),P=r[ee],X=z?z.sub(P)._unit()._perp():U,U=U||X;let ce=U.add(X);0===ce.x&&0===ce.y||ce._unit();const se=U.x*X.x+U.y*X.y,pe=ce.x*X.x+ce.y*X.y,he=0!==pe?1/pe:1/0,_e=2*Math.sqrt(2-2*pe),Te=pe<ex&&F&&z,De=U.x*X.y-U.y*X.x>0;if(Te&&ee>C){const xe=P.dist(F);if(xe>2*M){const Ae=P.sub(P.sub(F)._mult(M/xe)._round());this.updateDistance(F,Ae),this.addCurrentVertex(Ae,U,0,0,I),F=Ae}}const Pe=F&&z;let Be=Pe?l:x?"butt":h;if(Pe&&"round"===Be&&(he<_?Be="miter":he<=2&&(Be="fakeround")),"miter"===Be&&he>m&&(Be="bevel"),"bevel"===Be&&(he>2&&(Be="flipbevel"),he<m&&(Be="miter")),F&&this.updateDistance(F,P),"miter"===Be)ce._mult(he),this.addCurrentVertex(P,ce,0,0,I);else if("flipbevel"===Be){if(he>100)ce=X.mult(-1);else{const xe=he*U.add(X).mag()/U.sub(X).mag();ce._perp()._mult(xe*(De?-1:1))}this.addCurrentVertex(P,ce,0,0,I),this.addCurrentVertex(P,ce.mult(-1),0,0,I)}else if("bevel"===Be||"fakeround"===Be){const xe=-Math.sqrt(he*he-1),Ae=De?xe:0,Ne=De?0:xe;if(F&&this.addCurrentVertex(P,U,Ae,Ne,I),"fakeround"===Be){const Ue=Math.round(180*_e/Math.PI/20);for(let rt=1;rt<Ue;rt++){let Oe=rt/Ue;if(.5!==Oe){const At=Oe-.5;Oe+=Oe*At*(Oe-1)*((1.0904+se*(se*(3.55645-1.43519*se)-3.2452))*At*At+(.848013+se*(.215638*se-1.06021)))}const Je=X.sub(U)._mult(Oe)._add(U)._unit()._mult(De?-1:1);this.addHalfVertex(P,Je.x,Je.y,!1,De,0,I)}}z&&this.addCurrentVertex(P,X,-Ae,-Ne,I)}else if("butt"===Be)this.addCurrentVertex(P,ce,0,0,I);else if("square"===Be){const xe=F?1:-1;F||this.addCurrentVertex(P,ce,xe,xe,I),this.addCurrentVertex(P,ce,0,0,I),F&&this.addCurrentVertex(P,ce,xe,xe,I)}else"round"===Be&&(F&&(this.addCurrentVertex(P,U,0,0,I),this.addCurrentVertex(P,U,1,1,I,!0)),z&&(this.addCurrentVertex(P,X,-1,-1,I,!0),this.addCurrentVertex(P,X,0,0,I)));if(Te&&ee<w-1){const xe=P.dist(z);if(xe>2*M){const Ae=P.add(z.sub(P)._mult(M/xe)._round());this.updateDistance(P,Ae),this.addCurrentVertex(Ae,X,0,0,I),P=Ae}}}}addCurrentVertex(r,a,l,h,m,_=!1){const x=a.y*h-a.x,w=-a.y-a.x*h;this.addHalfVertex(r,a.x+a.y*l,a.y-a.x*l,_,!1,l,m),this.addHalfVertex(r,x,w,_,!0,-h,m)}addHalfVertex({x:r,y:a},l,h,m,_,x,w){this.layoutVertexArray.emplaceBack((r<<1)+(m?1:0),(a<<1)+(_?1:0),Math.round(63*l)+128,Math.round(63*h)+128,1+(0===x?0:x<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineClips.start,this.lineClips.end);const C=w.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,C),w.primitiveLength++),_?this.e2=C:this.e1=C}updateScaledDistance(){if(this.lineClips){const r=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=r*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(r,a){this.distance+=r.dist(a),this.updateScaledDistance()}}tt(qh,"LineBucket",{omit:["layers","patternFeatures"]});const tx=new it({"line-cap":new ve(ye.layout_line["line-cap"]),"line-join":new ve(ye.layout_line["line-join"]),"line-miter-limit":new ie(ye.layout_line["line-miter-limit"]),"line-round-limit":new ie(ye.layout_line["line-round-limit"]),"line-sort-key":new ve(ye.layout_line["line-sort-key"])});var v_={paint:new it({"line-opacity":new ve(ye.paint_line["line-opacity"]),"line-color":new ve(ye.paint_line["line-color"]),"line-translate":new ie(ye.paint_line["line-translate"]),"line-translate-anchor":new ie(ye.paint_line["line-translate-anchor"]),"line-width":new ve(ye.paint_line["line-width"]),"line-gap-width":new ve(ye.paint_line["line-gap-width"]),"line-offset":new ve(ye.paint_line["line-offset"]),"line-blur":new ve(ye.paint_line["line-blur"]),"line-dasharray":new Ie(ye.paint_line["line-dasharray"]),"line-pattern":new Ie(ye.paint_line["line-pattern"]),"line-gradient":new Me(ye.paint_line["line-gradient"]),"line-trim-offset":new ie(ye.paint_line["line-trim-offset"])}),layout:tx};const x_=new class extends ve{possiblyEvaluate(o,r){return r=new q(Math.floor(r.zoom),{now:r.now,fadeDuration:r.fadeDuration,zoomHistory:r.zoomHistory,transition:r.transition}),super.possiblyEvaluate(o,r)}evaluate(o,r,a,l){return r=_r({},r,{zoom:Math.floor(r.zoom)}),super.evaluate(o,r,a,l)}}(v_.paint.properties["line-width"].specification);function b_(o,r){return r>0?r+2*o:o}x_.useIntegerZoom=!0;const w_=st([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),nx=st([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),rx=st([{name:"a_projected_pos",components:4,type:"Float32"}],4);st([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const ix=st([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),$t=st([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const In=st([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),E_=st([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);st([{name:"triangle",components:3,type:"Uint16"}]),st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),st([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),st([{type:"Float32",name:"offsetX"}]),st([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);const Eo=128;function Co(o,r){const{expression:a}=r;if("constant"===a.kind)return{kind:"constant",layoutSize:a.evaluate(new q(o+1))};if("source"===a.kind)return{kind:"source"};{const{zoomStops:l,interpolationType:h}=a;let m=0;for(;m<l.length&&l[m]<=o;)m++;m=Math.max(0,m-1);let _=m;for(;_<l.length&&l[_]<o+1;)_++;_=Math.min(l.length-1,_);const x=l[m],w=l[_];return"composite"===a.kind?{kind:"composite",minZoom:x,maxZoom:w,interpolationType:h}:{kind:"camera",minZoom:x,maxZoom:w,minSize:a.evaluate(new q(x)),maxSize:a.evaluate(new q(w)),interpolationType:h}}}function Zh(o,{uSize:r,uSizeT:a},{lowerSize:l,upperSize:h}){return"source"===o.kind?l/Eo:"composite"===o.kind?Ht(l/Eo,h/Eo,a):r}function Iu(o,r){let a=0,l=0;if("constant"===o.kind)l=o.layoutSize;else if("source"!==o.kind){const{interpolationType:h,minZoom:m,maxZoom:_}=o,x=h?Et(hs.interpolationFactor(h,r,m,_),0,1):0;"camera"===o.kind?l=Ht(o.minSize,o.maxSize,x):a=x}return{uSizeT:a,uSize:l}}var im=Object.freeze({__proto__:null,getSizeData:Co,evaluateSizeForFeature:Zh,evaluateSizeForZoom:Iu,SIZE_PACK_FACTOR:Eo});function La(o,r,a){return o.sections.forEach(l=>{l.text=function(h,m,_){const x=m.layout.get("text-transform").evaluate(_,{});return"uppercase"===x?h=h.toLocaleUpperCase():"lowercase"===x&&(h=h.toLocaleLowerCase()),Q.applyArabicShaping&&(h=Q.applyArabicShaping(h)),h}(l.text,r,a)}),o}const yc={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function C_(o){return"\ufe36"===o||"\ufe48"===o||"\ufe38"===o||"\ufe44"===o||"\ufe42"===o||"\ufe3e"===o||"\ufe3c"===o||"\ufe3a"===o||"\ufe18"===o||"\ufe40"===o||"\ufe10"===o||"\ufe13"===o||"\ufe14"===o||"\uff40"===o||"\uffe3"===o||"\ufe11"===o||"\ufe12"===o}function om(o){return"\ufe35"===o||"\ufe47"===o||"\ufe37"===o||"\ufe43"===o||"\ufe41"===o||"\ufe3d"===o||"\ufe3b"===o||"\ufe39"===o||"\ufe17"===o||"\ufe3f"===o}var ox=function(o,r,a,l,h){var m,_,x=8*h-l-1,w=(1<<x)-1,C=w>>1,M=-7,I=a?h-1:0,P=a?-1:1,F=o[r+I];for(I+=P,m=F&(1<<-M)-1,F>>=-M,M+=x;M>0;m=256*m+o[r+I],I+=P,M-=8);for(_=m&(1<<-M)-1,m>>=-M,M+=l;M>0;_=256*_+o[r+I],I+=P,M-=8);if(0===m)m=1-C;else{if(m===w)return _?NaN:1/0*(F?-1:1);_+=Math.pow(2,l),m-=C}return(F?-1:1)*_*Math.pow(2,m-l)},sm=function(o,r,a,l,h,m){var _,x,w,C=8*m-h-1,M=(1<<C)-1,I=M>>1,P=23===h?Math.pow(2,-24)-Math.pow(2,-77):0,F=l?0:m-1,z=l?1:-1,U=r<0||0===r&&1/r<0?1:0;for(r=Math.abs(r),isNaN(r)||r===1/0?(x=isNaN(r)?1:0,_=M):(_=Math.floor(Math.log(r)/Math.LN2),r*(w=Math.pow(2,-_))<1&&(_--,w*=2),(r+=_+I>=1?P/w:P*Math.pow(2,1-I))*w>=2&&(_++,w/=2),_+I>=M?(x=0,_=M):_+I>=1?(x=(r*w-1)*Math.pow(2,h),_+=I):(x=r*Math.pow(2,I-1)*Math.pow(2,h),_=0));h>=8;o[a+F]=255&x,F+=z,x/=256,h-=8);for(_=_<<h|x,C+=h;C>0;o[a+F]=255&_,F+=z,_/=256,C-=8);o[a+F-z]|=128*U},bp=yn;function yn(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}yn.Varint=0,yn.Fixed64=1,yn.Bytes=2,yn.Fixed32=5;var Pu=4294967296,wp=1/Pu,Ep="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function _s(o){return o.type===yn.Bytes?o.readVarint()+o.pos:o.pos+1}function T_(o,r,a){var l=r<=16383?1:r<=2097151?2:r<=268435455?3:Math.floor(Math.log(r)/(7*Math.LN2));a.realloc(l);for(var h=a.pos-1;h>=o;h--)a.buf[h+l]=a.buf[h]}function sx(o,r){for(var a=0;a<o.length;a++)r.writeVarint(o[a])}function ax(o,r){for(var a=0;a<o.length;a++)r.writeSVarint(o[a])}function lx(o,r){for(var a=0;a<o.length;a++)r.writeFloat(o[a])}function D_(o,r){for(var a=0;a<o.length;a++)r.writeDouble(o[a])}function t1(o,r){for(var a=0;a<o.length;a++)r.writeBoolean(o[a])}function cx(o,r){for(var a=0;a<o.length;a++)r.writeFixed32(o[a])}function n1(o,r){for(var a=0;a<o.length;a++)r.writeSFixed32(o[a])}function S_(o,r){for(var a=0;a<o.length;a++)r.writeFixed64(o[a])}function M_(o,r){for(var a=0;a<o.length;a++)r.writeSFixed64(o[a])}function Cp(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+16777216*o[r+3]}function Cl(o,r,a){o[a]=r,o[a+1]=r>>>8,o[a+2]=r>>>16,o[a+3]=r>>>24}function ux(o,r){return(o[r]|o[r+1]<<8|o[r+2]<<16)+(o[r+3]<<24)}function r1(o,r,a){r.glyphs=[],1===o&&a.readMessage(i1,r)}function i1(o,r,a){if(3===o){const{id:l,bitmap:h,width:m,height:_,left:x,top:w,advance:C}=a.readMessage(o1,{});r.glyphs.push({id:l,bitmap:new bo({width:m+6,height:_+6},h),metrics:{width:m,height:_,left:x,top:w,advance:C}})}else 4===o?r.ascender=a.readSVarint():5===o&&(r.descender=a.readSVarint())}function o1(o,r,a){1===o?r.id=a.readVarint():2===o?r.bitmap=a.readBytes():3===o?r.width=a.readVarint():4===o?r.height=a.readVarint():5===o?r.left=a.readSVarint():6===o?r.top=a.readSVarint():7===o&&(r.advance=a.readVarint())}function A_(o){let r=0,a=0;for(const _ of o)r+=_.w*_.h,a=Math.max(a,_.w);o.sort((_,x)=>x.h-_.h);const l=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(r/.95)),a),h:1/0}];let h=0,m=0;for(const _ of o)for(let x=l.length-1;x>=0;x--){const w=l[x];if(!(_.w>w.w||_.h>w.h)){if(_.x=w.x,_.y=w.y,m=Math.max(m,_.y+_.h),h=Math.max(h,_.x+_.w),_.w===w.w&&_.h===w.h){const C=l.pop();x<l.length&&(l[x]=C)}else _.h===w.h?(w.x+=_.w,w.w-=_.w):_.w===w.w?(w.y+=_.h,w.h-=_.h):(l.push({x:w.x+_.w,y:w.y,w:w.w-_.w,h:_.h}),w.y+=_.h,w.h-=_.h);break}}return{w:h,h:m,fill:r/(h*m)||0}}yn.prototype={destroy:function(){this.buf=null},readFields:function(o,r,a){for(a=a||this.length;this.pos<a;){var l=this.readVarint(),h=l>>3,m=this.pos;this.type=7&l,o(h,r,this),this.pos===m&&this.skip(l)}return r},readMessage:function(o,r){return this.readFields(o,r,this.readVarint()+this.pos)},readFixed32:function(){var o=Cp(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=ux(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=Cp(this.buf,this.pos)+Cp(this.buf,this.pos+4)*Pu;return this.pos+=8,o},readSFixed64:function(){var o=Cp(this.buf,this.pos)+ux(this.buf,this.pos+4)*Pu;return this.pos+=8,o},readFloat:function(){var o=ox(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=ox(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var r,a,l=this.buf;return r=127&(a=l[this.pos++]),a<128?r:(r|=(127&(a=l[this.pos++]))<<7,a<128?r:(r|=(127&(a=l[this.pos++]))<<14,a<128?r:(r|=(127&(a=l[this.pos++]))<<21,a<128?r:function(h,m,_){var x,w,C=_.buf;if(x=(112&(w=C[_.pos++]))>>4,w<128||(x|=(127&(w=C[_.pos++]))<<3,w<128)||(x|=(127&(w=C[_.pos++]))<<10,w<128)||(x|=(127&(w=C[_.pos++]))<<17,w<128)||(x|=(127&(w=C[_.pos++]))<<24,w<128)||(x|=(1&(w=C[_.pos++]))<<31,w<128))return function Wh(o,r,a){return a?4294967296*r+(o>>>0):4294967296*(r>>>0)+(o>>>0)}(h,x,m);throw new Error("Expected varint not more than 10 bytes")}(r|=(15&(a=l[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var o=this.readVarint()+this.pos,r=this.pos;return this.pos=o,o-r>=12&&Ep?Ep.decode(this.buf.subarray(r,o)):function(a,l,h){for(var m="",_=l;_<h;){var x,w,C,M=a[_],I=null,P=M>239?4:M>223?3:M>191?2:1;if(_+P>h)break;1===P?M<128&&(I=M):2===P?128==(192&(x=a[_+1]))&&(I=(31&M)<<6|63&x)<=127&&(I=null):3===P?(w=a[_+2],128==(192&(x=a[_+1]))&&128==(192&w)&&((I=(15&M)<<12|(63&x)<<6|63&w)<=2047||I>=55296&&I<=57343)&&(I=null)):4===P&&(w=a[_+2],C=a[_+3],128==(192&(x=a[_+1]))&&128==(192&w)&&128==(192&C)&&((I=(15&M)<<18|(63&x)<<12|(63&w)<<6|63&C)<=65535||I>=1114112)&&(I=null)),null===I?(I=65533,P=1):I>65535&&(I-=65536,m+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),m+=String.fromCharCode(I),_+=P}return m}(this.buf,r,o)},readBytes:function(){var o=this.readVarint()+this.pos,r=this.buf.subarray(this.pos,o);return this.pos=o,r},readPackedVarint:function(o,r){if(this.type!==yn.Bytes)return o.push(this.readVarint(r));var a=_s(this);for(o=o||[];this.pos<a;)o.push(this.readVarint(r));return o},readPackedSVarint:function(o){if(this.type!==yn.Bytes)return o.push(this.readSVarint());var r=_s(this);for(o=o||[];this.pos<r;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==yn.Bytes)return o.push(this.readBoolean());var r=_s(this);for(o=o||[];this.pos<r;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==yn.Bytes)return o.push(this.readFloat());var r=_s(this);for(o=o||[];this.pos<r;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==yn.Bytes)return o.push(this.readDouble());var r=_s(this);for(o=o||[];this.pos<r;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==yn.Bytes)return o.push(this.readFixed32());var r=_s(this);for(o=o||[];this.pos<r;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==yn.Bytes)return o.push(this.readSFixed32());var r=_s(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==yn.Bytes)return o.push(this.readFixed64());var r=_s(this);for(o=o||[];this.pos<r;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==yn.Bytes)return o.push(this.readSFixed64());var r=_s(this);for(o=o||[];this.pos<r;)o.push(this.readSFixed64());return o},skip:function(o){var r=7&o;if(r===yn.Varint)for(;this.buf[this.pos++]>127;);else if(r===yn.Bytes)this.pos=this.readVarint()+this.pos;else if(r===yn.Fixed32)this.pos+=4;else{if(r!==yn.Fixed64)throw new Error("Unimplemented type: "+r);this.pos+=8}},writeTag:function(o,r){this.writeVarint(o<<3|r)},realloc:function(o){for(var r=this.length||16;r<this.pos+o;)r*=2;if(r!==this.length){var a=new Uint8Array(r);a.set(this.buf),this.buf=a,this.length=r}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Cl(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Cl(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Cl(this.buf,-1&o,this.pos),Cl(this.buf,Math.floor(o*wp),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Cl(this.buf,-1&o,this.pos),Cl(this.buf,Math.floor(o*wp),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(r,a){var l,h,m,x;if(r>=0?(l=r%4294967296|0,h=r/4294967296|0):(h=~(-r/4294967296),4294967295^(l=~(-r%4294967296))?l=l+1|0:(l=0,h=h+1|0)),r>=0x10000000000000000||r<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),m=l,(x=a).buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,m>>>=7,x.buf[x.pos++]=127&m|128,x.buf[x.pos]=127&(m>>>=7),function(m,_){var x=(7&m)<<4;_.buf[_.pos++]|=x|((m>>>=3)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m|((m>>>=7)?128:0),m&&(_.buf[_.pos++]=127&m)))))}(h,a)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(Boolean(o))},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var r=this.pos;this.pos=function(l,h,m){for(var _,x,w=0;w<h.length;w++){if((_=h.charCodeAt(w))>55295&&_<57344){if(!x){_>56319||w+1===h.length?(l[m++]=239,l[m++]=191,l[m++]=189):x=_;continue}if(_<56320){l[m++]=239,l[m++]=191,l[m++]=189,x=_;continue}_=x-55296<<10|_-56320|65536,x=null}else x&&(l[m++]=239,l[m++]=191,l[m++]=189,x=null);_<128?l[m++]=_:(_<2048?l[m++]=_>>6|192:(_<65536?l[m++]=_>>12|224:(l[m++]=_>>18|240,l[m++]=_>>12&63|128),l[m++]=_>>6&63|128),l[m++]=63&_|128)}return m}(this.buf,o,this.pos);var a=this.pos-r;a>=128&&T_(r,a,this),this.pos=r-1,this.writeVarint(a),this.pos+=a},writeFloat:function(o){this.realloc(4),sm(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),sm(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var r=o.length;this.writeVarint(r),this.realloc(r);for(var a=0;a<r;a++)this.buf[this.pos++]=o[a]},writeRawMessage:function(o,r){this.pos++;var a=this.pos;o(r,this);var l=this.pos-a;l>=128&&T_(a,l,this),this.pos=a-1,this.writeVarint(l),this.pos+=l},writeMessage:function(o,r,a){this.writeTag(o,yn.Bytes),this.writeRawMessage(r,a)},writePackedVarint:function(o,r){r.length&&this.writeMessage(o,sx,r)},writePackedSVarint:function(o,r){r.length&&this.writeMessage(o,ax,r)},writePackedBoolean:function(o,r){r.length&&this.writeMessage(o,t1,r)},writePackedFloat:function(o,r){r.length&&this.writeMessage(o,lx,r)},writePackedDouble:function(o,r){r.length&&this.writeMessage(o,D_,r)},writePackedFixed32:function(o,r){r.length&&this.writeMessage(o,cx,r)},writePackedSFixed32:function(o,r){r.length&&this.writeMessage(o,n1,r)},writePackedFixed64:function(o,r){r.length&&this.writeMessage(o,S_,r)},writePackedSFixed64:function(o,r){r.length&&this.writeMessage(o,M_,r)},writeBytesField:function(o,r){this.writeTag(o,yn.Bytes),this.writeBytes(r)},writeFixed32Field:function(o,r){this.writeTag(o,yn.Fixed32),this.writeFixed32(r)},writeSFixed32Field:function(o,r){this.writeTag(o,yn.Fixed32),this.writeSFixed32(r)},writeFixed64Field:function(o,r){this.writeTag(o,yn.Fixed64),this.writeFixed64(r)},writeSFixed64Field:function(o,r){this.writeTag(o,yn.Fixed64),this.writeSFixed64(r)},writeVarintField:function(o,r){this.writeTag(o,yn.Varint),this.writeVarint(r)},writeSVarintField:function(o,r){this.writeTag(o,yn.Varint),this.writeSVarint(r)},writeStringField:function(o,r){this.writeTag(o,yn.Bytes),this.writeString(r)},writeFloatField:function(o,r){this.writeTag(o,yn.Fixed32),this.writeFloat(r)},writeDoubleField:function(o,r){this.writeTag(o,yn.Fixed64),this.writeDouble(r)},writeBooleanField:function(o,r){this.writeVarintField(o,Boolean(r))}};class I_{constructor(r,{pixelRatio:a,version:l,stretchX:h,stretchY:m,content:_}){this.paddedRect=r,this.pixelRatio=a,this.stretchX=h,this.stretchY=m,this.content=_,this.version=l}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class hx{constructor(r,a){const l={},h={};this.haveRenderCallbacks=[];const m=[];this.addImages(r,l,m),this.addImages(a,h,m);const{w:_,h:x}=A_(m),w=new no({width:_||1,height:x||1});for(const C in r){const M=r[C],I=l[C].paddedRect;no.copy(M.data,w,{x:0,y:0},{x:I.x+1,y:I.y+1},M.data)}for(const C in a){const M=a[C],I=h[C].paddedRect,P=I.x+1,F=I.y+1,z=M.data.width,U=M.data.height;no.copy(M.data,w,{x:0,y:0},{x:P,y:F},M.data),no.copy(M.data,w,{x:0,y:U-1},{x:P,y:F-1},{width:z,height:1}),no.copy(M.data,w,{x:0,y:0},{x:P,y:F+U},{width:z,height:1}),no.copy(M.data,w,{x:z-1,y:0},{x:P-1,y:F},{width:1,height:U}),no.copy(M.data,w,{x:0,y:0},{x:P+z,y:F},{width:1,height:U})}this.image=w,this.iconPositions=l,this.patternPositions=h}addImages(r,a,l){for(const h in r){const m=r[h],_={x:0,y:0,w:m.data.width+2,h:m.data.height+2};l.push(_),a[h]=new I_(_,m),m.hasRenderCallback&&this.haveRenderCallbacks.push(h)}}patchUpdatedImages(r,a){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(l=>r.hasImage(l)),r.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const l in r.updatedImages)this.patchUpdatedImage(this.iconPositions[l],r.getImage(l),a),this.patchUpdatedImage(this.patternPositions[l],r.getImage(l),a)}patchUpdatedImage(r,a,l){if(!r||!a||r.version===a.version)return;r.version=a.version;const[h,m]=r.tl;l.update(a.data,void 0,{x:h,y:m})}}tt(I_,"ImagePosition"),tt(hx,"ImageAtlas");const Go={horizontal:1,vertical:2,horizontalOnly:3};class Tp{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(r,a){const l=new Tp;return l.scale=r||1,l.fontStack=a,l}static forImage(r){const a=new Tp;return a.imageName=r,a}}class Xh{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(r,a){const l=new Xh;for(let h=0;h<r.sections.length;h++){const m=r.sections[h];m.image?l.addImageSection(m):l.addTextSection(m,a)}return l}length(){return this.text.length}getSection(r){return this.sections[this.sectionIndex[r]]}getSections(){return this.sections}getSectionIndex(r){return this.sectionIndex[r]}getCharCode(r){return this.text.charCodeAt(r)}verticalizePunctuation(r){this.text=function(a,l){let h="";for(let m=0;m<a.length;m++){const _=a.charCodeAt(m+1)||null,x=a.charCodeAt(m-1)||null;h+=!l&&(_&&g(_)&&!yc[a[m+1]]||x&&g(x)&&!yc[a[m-1]])||!yc[a[m]]?a[m]:yc[a[m]]}return h}(this.text,r)}trim(){let r=0;for(let l=0;l<this.text.length&&ku[this.text.charCodeAt(l)];l++)r++;let a=this.text.length;for(let l=this.text.length-1;l>=0&&l>=r&&ku[this.text.charCodeAt(l)];l--)a--;this.text=this.text.substring(r,a),this.sectionIndex=this.sectionIndex.slice(r,a)}substring(r,a){const l=new Xh;return l.text=this.text.substring(r,a),l.sectionIndex=this.sectionIndex.slice(r,a),l.sections=this.sections,l}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((r,a)=>Math.max(r,this.sections[a].scale),0)}addTextSection(r,a){this.text+=r.text,this.sections.push(Tp.forText(r.scale,r.fontStack||a));const l=this.sections.length-1;for(let h=0;h<r.text.length;++h)this.sectionIndex.push(l)}addImageSection(r){const a=r.image?r.image.name:"";if(0===a.length)return void rr("Can't add FormattedSection with an empty image.");const l=this.getNextImageSectionCharCode();l?(this.text+=String.fromCharCode(l),this.sections.push(Tp.forImage(a)),this.sectionIndex.push(this.sections.length-1)):rr("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Ws(o,r,a,l,h,m,_,x,w,C,M,I,P,F,z,U){const X=Xh.fromFeature(o,h);let ee;I===Go.vertical&&X.verticalizePunctuation(P);const{processBidirectionalText:ce,processStyledBidirectionalText:se}=Q;if(ce&&1===X.sections.length){ee=[];const _e=ce(X.toString(),Xs(X,C,m,r,l,F,z));for(const Te of _e){const De=new Xh;De.text=Te,De.sections=X.sections;for(let Pe=0;Pe<Te.length;Pe++)De.sectionIndex.push(0);ee.push(De)}}else if(se){ee=[];const _e=se(X.text,X.sectionIndex,Xs(X,C,m,r,l,F,z));for(const Te of _e){const De=new Xh;De.text=Te[0],De.sectionIndex=Te[1],De.sections=X.sections,ee.push(De)}}else ee=function(_e,Te){const De=[],Pe=_e.text;let Be=0;for(const xe of Te)De.push(_e.substring(Be,xe)),Be=xe;return Be<Pe.length&&De.push(_e.substring(Be,Pe.length)),De}(X,Xs(X,C,m,r,l,F,z));const pe=[],he={positionedLines:pe,text:X.toString(),top:M[1],bottom:M[1],left:M[0],right:M[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(_e,Te,De,Pe,Be,xe,Ae,Ne,Ue,rt,Oe,Je){let At=0,Nt=0,ft=0;const at="right"===Ne?1:"left"===Ne?0:.5;let Gt=!1;for(const jt of Be){const nn=jt.getSections();for(const Dn of nn){if(Dn.imageName)continue;const pn=Te[Dn.fontStack];if(pn&&(Gt=void 0!==pn.ascender&&void 0!==pn.descender,!Gt))break}if(!Gt)break}let kt=0;for(const jt of Be){jt.trim();const nn=jt.getMaxScale(),Dn=24*(nn-1),pn={positionedGlyphs:[],lineOffset:0};_e.positionedLines[kt]=pn;const En=pn.positionedGlyphs;let Ln=0;if(!jt.length()){Nt+=xe,++kt;continue}let Jn=0,Nr=0;for(let Wt=0;Wt<jt.length();Wt++){const ar=jt.getSection(Wt),Wr=jt.getSectionIndex(Wt),cn=jt.getCharCode(Wt);let qn=ar.scale,hi=null,On=null,gr=null,Sr=24,Pr=0;const di=!(Ue===Go.horizontal||!Oe&&!u(cn)||Oe&&(ku[cn]||(ct=cn,Wd(ct)||Xd(ct)||tc(ct)||ep(ct)||fl(ct))));if(ar.imageName){const ze=Pe[ar.imageName];if(!ze)continue;gr=ar.imageName,_e.iconsInText=_e.iconsInText||!0,On=ze.paddedRect;const Mr=ze.displaySize;qn=24*qn/Je,hi={width:Mr[0],height:Mr[1],left:1,top:-3,advance:di?Mr[1]:Mr[0],localGlyph:!1},Pr=Gt?-hi.height*qn:24*nn-17-Mr[1]*qn,Sr=hi.advance;const vn=(di?Mr[0]:Mr[1])*qn-24*nn;vn>0&&vn>Ln&&(Ln=vn)}else{const ze=De[ar.fontStack];if(!ze)continue;ze[cn]&&(On=ze[cn]);const Mr=Te[ar.fontStack];if(!Mr)continue;const vn=Mr.glyphs[cn];if(!vn)continue;if(hi=vn.metrics,Sr=8203!==cn?24:0,Gt){const Al=void 0!==Mr.ascender?Math.abs(Mr.ascender):0,sd=void 0!==Mr.descender?Math.abs(Mr.descender):0,mt=(Al+sd)*qn;Jn<mt&&(Jn=mt,Nr=(Al-sd)/2*qn),Pr=-Al*qn}else Pr=24*(nn-qn)-17}di?(_e.verticalizable=!0,En.push({glyph:cn,imageName:gr,x:At,y:Nt+Pr,vertical:di,scale:qn,localGlyph:hi.localGlyph,fontStack:ar.fontStack,sectionIndex:Wr,metrics:hi,rect:On}),At+=Sr*qn+rt):(En.push({glyph:cn,imageName:gr,x:At,y:Nt+Pr,vertical:di,scale:qn,localGlyph:hi.localGlyph,fontStack:ar.fontStack,sectionIndex:Wr,metrics:hi,rect:On}),At+=hi.advance*qn+rt)}0!==En.length&&(ft=Math.max(At-rt,ft),Gt?R_(En,at,Ln,Nr,xe*nn/2):R_(En,at,Ln,0,xe/2)),At=0;const zi=xe*nn+Ln;pn.lineOffset=Math.max(Ln,Dn),Nt+=zi,++kt}var ct;const br=Nt,{horizontalAlign:jn,verticalAlign:sr}=Mp(Ae);(function(jt,nn,Dn,pn,En,Ln){const Jn=(nn-Dn)*En,Nr=-Ln*pn;for(const zi of jt)for(const Wt of zi.positionedGlyphs)Wt.x+=Jn,Wt.y+=Nr})(_e.positionedLines,at,jn,sr,ft,br),_e.top+=-sr*br,_e.bottom=_e.top+br,_e.left+=-jn*ft,_e.right=_e.left+ft,_e.hasBaseline=Gt}(he,r,a,l,ee,_,x,w,I,C,P,U),!function(_e){for(const Te of _e)if(0!==Te.positionedGlyphs.length)return!1;return!0}(pe)&&he}const ku={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},dx={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function am(o,r,a,l,h,m){if(r.imageName){const _=l[r.imageName];return _?_.displaySize[0]*r.scale*24/m+h:0}{const _=a[r.fontStack],x=_&&_.glyphs[o];return x?x.metrics.advance*r.scale+h:0}}function Dp(o,r,a,l){const h=Math.pow(o-r,2);return l?o<r?h/2:2*h:h+Math.abs(a)*a}function P_(o,r,a){let l=0;return 10===o&&(l-=1e4),a&&(l+=150),40!==o&&65288!==o||(l+=50),41!==r&&65289!==r||(l+=50),l}function Sp(o,r,a,l,h,m){let _=null,x=Dp(r,a,h,m);for(const w of l){const C=Dp(r-w.x,a,h,m)+w.badness;C<=x&&(_=w,x=C)}return{index:o,x:r,priorBreak:_,badness:x}}function k_(o){return o?k_(o.priorBreak).concat(o.index):[]}function Xs(o,r,a,l,h,m,_){if("point"!==m)return[];if(!o)return[];const x=[],w=function(P,F,z,U,X,ee){let ce=0;for(let se=0;se<P.length();se++){const pe=P.getSection(se);ce+=am(P.getCharCode(se),pe,U,X,F,ee)}return ce/Math.max(1,Math.ceil(ce/z))}(o,r,a,l,h,_),C=o.text.indexOf("\u200b")>=0;let M=0;for(let P=0;P<o.length();P++){const F=o.getSection(P),z=o.getCharCode(P);if(ku[z]||(M+=am(z,F,l,h,r,_)),P<o.length()-1){const U=!((I=z)<11904||!(au(I)||rc(I)||Vs(I)||wf(I)||lu(I)||Yd(I)||Ch(I)||Ea(I)||Jd(I)||Da(I)||Ns(I)||oc(I)||Ca(I)||nc(I)||Kd(I)||No(I)||Ta(I)||ic(I)||uu(I)||cu(I)));(dx[z]||U||F.imageName)&&x.push(Sp(P+1,M,w,x,P_(z,o.getCharCode(P+1),U&&C),!1))}}var I;return k_(Sp(o.length(),M,w,x,0,!0))}function Mp(o){let r=.5,a=.5;switch(o){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:r,verticalAlign:a}}function R_(o,r,a,l,h){if(!(r||a||l||h))return;const m=o.length-1,_=o[m],x=(_.x+_.metrics.advance*_.scale)*r;for(let w=0;w<=m;w++)o[w].x-=x,o[w].y+=a+l+h}function lm(o,r,a){const{horizontalAlign:l,verticalAlign:h}=Mp(a),m=r[0]-o.displaySize[0]*l,_=r[1]-o.displaySize[1]*h;return{image:o,top:_,bottom:_+o.displaySize[1],left:m,right:m+o.displaySize[0]}}function F_(o,r,a,l,h,m){const _=o.image;let x;if(_.content){const X=_.content,ee=_.pixelRatio||1;x=[X[0]/ee,X[1]/ee,_.displaySize[0]-X[2]/ee,_.displaySize[1]-X[3]/ee]}const w=r.left*m,C=r.right*m;let M,I,P,F;"width"===a||"both"===a?(F=h[0]+w-l[3],I=h[0]+C+l[1]):(F=h[0]+(w+C-_.displaySize[0])/2,I=F+_.displaySize[0]);const z=r.top*m,U=r.bottom*m;return"height"===a||"both"===a?(M=h[1]+z-l[0],P=h[1]+U+l[2]):(M=h[1]+(z+U-_.displaySize[1])/2,P=M+_.displaySize[1]),{image:_,top:M,right:I,bottom:P,left:F,collisionPadding:x}}class Ys extends Ye{constructor(r,a,l,h,m){super(r,a),this.angle=h,this.z=l,void 0!==m&&(this.segment=m)}clone(){return new Ys(this.x,this.y,this.z,this.angle,this.segment)}}function L_(o,r,a,l,h){if(void 0===r.segment)return!0;let m=r,_=r.segment+1,x=0;for(;x>-a/2;){if(_--,_<0)return!1;x-=o[_].dist(m),m=o[_]}x+=o[_].dist(o[_+1]),_++;const w=[];let C=0;for(;x<a/2;){const M=o[_],I=o[_+1];if(!I)return!1;let P=o[_-1].angleTo(M)-M.angleTo(I);for(P=Math.abs((P+3*Math.PI)%(2*Math.PI)-Math.PI),w.push({distance:x,angleDelta:P}),C+=P;x-w[0].distance>l;)C-=w.shift().angleDelta;if(C>h)return!1;_++,x+=M.dist(I)}return!0}function O_(o){let r=0;for(let a=0;a<o.length-1;a++)r+=o[a].dist(o[a+1]);return r}function Ru(o,r,a){return o?.6*r*a:0}function vc(o,r){return Math.max(o?o.right-o.left:0,r?r.right-r.left:0)}function cm(o,r,a,l,h,m){const _=Ru(a,h,m),x=vc(a,l)*m;let w=0;const C=O_(o)/2;for(let M=0;M<o.length-1;M++){const I=o[M],P=o[M+1],F=I.dist(P);if(w+F>C){const z=(C-w)/F,U=Ht(I.x,P.x,z),X=Ht(I.y,P.y,z),ee=new Ys(U,X,0,P.angleTo(I),M);return!_||L_(o,ee,x,_,r)?ee:void 0}w+=F}}function Fu(o,r,a,l,h,m,_,x,w){const C=Ru(l,m,_),M=vc(l,h),I=M*_,P=0===o[0].x||o[0].x===w||0===o[0].y||o[0].y===w;return r-I<r/4&&(r=I+r/4),Lu(o,P?r/2*x%r:(M/2+2*m)*_*x%r,r,C,a,I,P,!1,w)}function Lu(o,r,a,l,h,m,_,x,w){const C=m/2,M=O_(o);let I=0,P=r-a,F=[];for(let z=0;z<o.length-1;z++){const U=o[z],X=o[z+1],ee=U.dist(X),ce=X.angleTo(U);for(;P+a<I+ee;){P+=a;const se=(P-I)/ee,pe=Ht(U.x,X.x,se),he=Ht(U.y,X.y,se);if(pe>=0&&pe<w&&he>=0&&he<w&&P-C>=0&&P+C<=M){const _e=new Ys(pe,he,0,ce,z);_e._round(),l&&!L_(o,_e,m,l,h)||F.push(_e)}}I+=ee}return x||F.length||_||(F=Lu(o,I/2,a,l,h,m,_,!0,w)),F}function xc(o,r,a,l,h){const m=[];for(let _=0;_<o.length;_++){const x=o[_];let w;for(let C=0;C<x.length-1;C++){let M=x[C],I=x[C+1];M.x<r&&I.x<r||(M.x<r?M=new Ye(r,M.y+(r-M.x)/(I.x-M.x)*(I.y-M.y))._round():I.x<r&&(I=new Ye(r,M.y+(r-M.x)/(I.x-M.x)*(I.y-M.y))._round()),M.y<a&&I.y<a||(M.y<a?M=new Ye(M.x+(a-M.y)/(I.y-M.y)*(I.x-M.x),a)._round():I.y<a&&(I=new Ye(M.x+(a-M.y)/(I.y-M.y)*(I.x-M.x),a)._round()),M.x>=l&&I.x>=l||(M.x>=l?M=new Ye(l,M.y+(l-M.x)/(I.x-M.x)*(I.y-M.y))._round():I.x>=l&&(I=new Ye(l,M.y+(l-M.x)/(I.x-M.x)*(I.y-M.y))._round()),M.y>=h&&I.y>=h||(M.y>=h?M=new Ye(M.x+(h-M.y)/(I.y-M.y)*(I.x-M.x),h)._round():I.y>=h&&(I=new Ye(M.x+(h-M.y)/(I.y-M.y)*(I.x-M.x),h)._round()),w&&M.equals(w[w.length-1])||(w=[M],m.push(w)),w.push(I)))))}}return m}tt(Ys,"Anchor");const Yh=1e20;function um(o,r,a,l,h,m,_,x,w){for(let C=r;C<r+l;C++)hm(o,a*m+C,m,h,_,x,w);for(let C=a;C<a+h;C++)hm(o,C*m+r,1,l,_,x,w)}function hm(o,r,a,l,h,m,_){m[0]=0,_[0]=-Yh,_[1]=Yh,h[0]=o[r];for(let x=1,w=0,C=0;x<l;x++){h[x]=o[r+x*a];const M=x*x;do{const I=m[w];C=(h[x]-h[I]+M-I*I)/(x-I)/2}while(C<=_[w]&&--w>-1);w++,m[w]=x,_[w]=C,_[w+1]=Yh}for(let x=0,w=0;x<l;x++){for(;_[w+1]<x;)w++;const C=m[w],M=x-C;o[r+x*a]=h[C]+M*M}}const Kh={none:0,ideographs:1,all:2};class Tl{constructor(r,a,l){this.requestManager=r,this.localGlyphMode=a,this.localFontFamily=l,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(r){this.url=r}getGlyphs(r,a){const l=[];for(const h in r)for(const m of r[h])l.push({stack:h,id:m});Xo(l,({stack:h,id:m},_)=>{let x=this.entries[h];x||(x=this.entries[h]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let w=x.glyphs[m];if(void 0!==w)return void _(null,{stack:h,id:m,glyph:w});if(w=this._tinySDF(x,h,m),w)return x.glyphs[m]=w,void _(null,{stack:h,id:m,glyph:w});const C=Math.floor(m/256);if(256*C>65535)return void _(new Error("glyphs > 65535 not supported"));if(x.ranges[C])return void _(null,{stack:h,id:m,glyph:w});let M=x.requests[C];M||(M=x.requests[C]=[],Tl.loadGlyphRange(h,C,this.url,this.requestManager,(I,P)=>{if(P){x.ascender=P.ascender,x.descender=P.descender;for(const F in P.glyphs)this._doesCharSupportLocalGlyph(+F)||(x.glyphs[+F]=P.glyphs[+F]);x.ranges[C]=!0}for(const F of M)F(I,P);delete x.requests[C]})),M.push((I,P)=>{I?_(I):P&&_(null,{stack:h,id:m,glyph:P.glyphs[m]||null})})},(h,m)=>{if(h)a(h);else if(m){const _={};for(const{stack:x,id:w,glyph:C}of m)void 0===_[x]&&(_[x]={}),void 0===_[x].glyphs&&(_[x].glyphs={}),_[x].glyphs[w]=C&&{id:C.id,bitmap:C.bitmap.clone(),metrics:C.metrics},_[x].ascender=this.entries[x].ascender,_[x].descender=this.entries[x].descender;a(null,_)}})}_doesCharSupportLocalGlyph(r){return this.localGlyphMode!==Kh.none&&(this.localGlyphMode===Kh.all?!!this.localFontFamily:!!this.localFontFamily&&(Da(r)||Qd(r)||Ca(r)||Ta(r)||Ea(r)))}_tinySDF(r,a,l){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(l))return;let m=r.tinySDF;if(!m){let U="400";/bold/i.test(a)?U="900":/medium/i.test(a)?U="500":/light/i.test(a)&&(U="200"),m=r.tinySDF=new Tl.TinySDF({fontFamily:h,fontWeight:U,fontSize:48,buffer:6,radius:16}),m.fontWeight=U}if(this.localGlyphs[m.fontWeight][l])return this.localGlyphs[m.fontWeight][l];const _=String.fromCharCode(l),{data:x,width:w,height:C,glyphWidth:M,glyphHeight:I,glyphLeft:P,glyphTop:F,glyphAdvance:z}=m.draw(_);return this.localGlyphs[m.fontWeight][l]={id:l,bitmap:new bo({width:w,height:C},x),metrics:{width:M/2,height:I/2,left:P/2,top:F/2-27,advance:z/2,localGlyph:!0}}}}function dm(o,r,a,l){const h=[],m=o.image,_=m.pixelRatio,x=m.paddedRect.w-2,w=m.paddedRect.h-2,C=o.right-o.left,M=o.bottom-o.top,I=m.stretchX||[[0,x]],P=m.stretchY||[[0,w]],F=(xe,Ae)=>xe+Ae[1]-Ae[0],z=I.reduce(F,0),U=P.reduce(F,0),X=x-z,ee=w-U;let ce=0,se=z,pe=0,he=U,_e=0,Te=X,De=0,Pe=ee;if(m.content&&l){const xe=m.content;ce=bc(I,0,xe[0]),pe=bc(P,0,xe[1]),se=bc(I,xe[0],xe[2]),he=bc(P,xe[1],xe[3]),_e=xe[0]-ce,De=xe[1]-pe,Te=xe[2]-xe[0]-se,Pe=xe[3]-xe[1]-he}const Be=(xe,Ae,Ne,Ue)=>{const rt=Jh(xe.stretch-ce,se,C,o.left),Oe=pm(xe.fixed-_e,Te,xe.stretch,z),Je=Jh(Ae.stretch-pe,he,M,o.top),At=pm(Ae.fixed-De,Pe,Ae.stretch,U),Nt=Jh(Ne.stretch-ce,se,C,o.left),ft=pm(Ne.fixed-_e,Te,Ne.stretch,z),at=Jh(Ue.stretch-pe,he,M,o.top),Gt=pm(Ue.fixed-De,Pe,Ue.stretch,U),kt=new Ye(rt,Je),ct=new Ye(Nt,Je),br=new Ye(Nt,at),jn=new Ye(rt,at),sr=new Ye(Oe/_,At/_),jt=new Ye(ft/_,Gt/_),nn=r*Math.PI/180;if(nn){const En=Math.sin(nn),Ln=Math.cos(nn),Jn=[Ln,-En,En,Ln];kt._matMult(Jn),ct._matMult(Jn),jn._matMult(Jn),br._matMult(Jn)}const Dn=xe.stretch+xe.fixed,pn=Ae.stretch+Ae.fixed;return{tl:kt,tr:ct,bl:jn,br,tex:{x:m.paddedRect.x+1+Dn,y:m.paddedRect.y+1+pn,w:Ne.stretch+Ne.fixed-Dn,h:Ue.stretch+Ue.fixed-pn},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:sr,pixelOffsetBR:jt,minFontScaleX:Te/_/C,minFontScaleY:Pe/_/M,isSDF:a}};if(l&&(m.stretchX||m.stretchY)){const xe=z_(I,X,z),Ae=z_(P,ee,U);for(let Ne=0;Ne<xe.length-1;Ne++){const Ue=xe[Ne],rt=xe[Ne+1];for(let Oe=0;Oe<Ae.length-1;Oe++)h.push(Be(Ue,Ae[Oe],rt,Ae[Oe+1]))}}else h.push(Be({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:x+1},{fixed:0,stretch:w+1}));return h}function bc(o,r,a){let l=0;for(const h of o)l+=Math.max(r,Math.min(a,h[1]))-Math.max(r,Math.min(a,h[0]));return l}function z_(o,r,a){const l=[{fixed:-1,stretch:0}];for(const[h,m]of o){const _=l[l.length-1];l.push({fixed:h-_.stretch,stretch:_.stretch}),l.push({fixed:h-_.stretch,stretch:_.stretch+(m-h)})}return l.push({fixed:r+1,stretch:a}),l}function Jh(o,r,a,l){return o/r*a+l}function pm(o,r,a,l){return o-r*a/l}function B_(o,r,a,l){const h=r+o.positionedLines[l].lineOffset;return 0===l?a+h/2:a+(h+(r+o.positionedLines[l-1].lineOffset))/2}Tl.loadGlyphRange=function(o,r,a,l,h){const m=256*r,_=m+255,x=l.transformRequest(l.normalizeGlyphsURL(a).replace("{fontstack}",o).replace("{range}",`${m}-${_}`),K.Glyphs);me(x,(w,C)=>{if(w)h(w);else if(C){const M={},I=new bp(C).readFields(r1,{});for(const P of I.glyphs)M[P.id]=P;h(null,{glyphs:M,ascender:I.ascender,descender:I.descender})}})},Tl.TinySDF=class{constructor({fontSize:o=24,buffer:r=3,radius:a=8,cutoff:l=.25,fontFamily:h="sans-serif",fontWeight:m="normal",fontStyle:_="normal"}={}){this.buffer=r,this.cutoff=l,this.radius=a;const x=this.size=o+4*r,w=this._createCanvas(x),C=this.ctx=w.getContext("2d",{willReadFrequently:!0});C.font=`${_} ${m} ${o}px ${h}`,C.textBaseline="alphabetic",C.textAlign="left",C.fillStyle="black",this.gridOuter=new Float64Array(x*x),this.gridInner=new Float64Array(x*x),this.f=new Float64Array(x),this.z=new Float64Array(x+1),this.v=new Uint16Array(x)}_createCanvas(o){const r=document.createElement("canvas");return r.width=r.height=o,r}draw(o){const{width:r,actualBoundingBoxAscent:a,actualBoundingBoxDescent:l,actualBoundingBoxLeft:h,actualBoundingBoxRight:m}=this.ctx.measureText(o),_=Math.ceil(a),x=Math.min(this.size-this.buffer,Math.ceil(m-h)),w=Math.min(this.size-this.buffer,_+Math.ceil(l)),C=x+2*this.buffer,M=w+2*this.buffer,I=Math.max(C*M,0),P=new Uint8ClampedArray(I),F={data:P,width:C,height:M,glyphWidth:x,glyphHeight:w,glyphTop:_,glyphLeft:0,glyphAdvance:r};if(0===x||0===w)return F;const{ctx:z,buffer:U,gridInner:X,gridOuter:ee}=this;z.clearRect(U,U,x,w),z.fillText(o,U,U+_);const ce=z.getImageData(U,U,x,w);ee.fill(Yh,0,I),X.fill(0,0,I);for(let se=0;se<w;se++)for(let pe=0;pe<x;pe++){const he=ce.data[4*(se*x+pe)+3]/255;if(0===he)continue;const _e=(se+U)*C+pe+U;if(1===he)ee[_e]=0,X[_e]=Yh;else{const Te=.5-he;ee[_e]=Te>0?Te*Te:0,X[_e]=Te<0?Te*Te:0}}um(ee,0,0,C,M,C,this.f,this.v,this.z),um(X,U,U,x,w,C,this.f,this.v,this.z);for(let se=0;se<I;se++){const pe=Math.sqrt(ee[se])-Math.sqrt(X[se]);P[se]=Math.round(255-255*(pe/this.radius+this.cutoff))}return F}};class N_{constructor(r=[],a=px){if(this.data=r,this.length=this.data.length,this.compare=a,this.length>0)for(let l=(this.length>>1)-1;l>=0;l--)this._down(l)}push(r){this.data.push(r),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const r=this.data[0],a=this.data.pop();return this.length--,this.length>0&&(this.data[0]=a,this._down(0)),r}peek(){return this.data[0]}_up(r){const{data:a,compare:l}=this,h=a[r];for(;r>0;){const m=r-1>>1,_=a[m];if(l(h,_)>=0)break;a[r]=_,r=m}a[r]=h}_down(r){const{data:a,compare:l}=this,h=this.length>>1,m=a[r];for(;r<h;){let _=1+(r<<1),x=a[_];const w=_+1;if(w<this.length&&l(a[w],x)<0&&(_=w,x=a[w]),l(x,m)>=0)break;a[r]=x,r=_}a[r]=m}}function px(o,r){return o<r?-1:o>r?1:0}function V_(o,r=1,a=!1){let l=1/0,h=1/0,m=-1/0,_=-1/0;const x=o[0];for(let F=0;F<x.length;F++){const z=x[F];(!F||z.x<l)&&(l=z.x),(!F||z.y<h)&&(h=z.y),(!F||z.x>m)&&(m=z.x),(!F||z.y>_)&&(_=z.y)}const w=Math.min(m-l,_-h);let C=w/2;const M=new N_([],fx);if(0===w)return new Ye(l,h);for(let F=l;F<m;F+=w)for(let z=h;z<_;z+=w)M.push(new Ou(F+C,z+C,C,o));let I=function(F){let z=0,U=0,X=0;const ee=F[0];for(let ce=0,se=ee.length,pe=se-1;ce<se;pe=ce++){const he=ee[ce],_e=ee[pe],Te=he.x*_e.y-_e.x*he.y;U+=(he.x+_e.x)*Te,X+=(he.y+_e.y)*Te,z+=3*Te}return new Ou(U/z,X/z,0,F)}(o),P=M.length;for(;M.length;){const F=M.pop();(F.d>I.d||!I.d)&&(I=F,a&&console.log("found best %d after %d probes",Math.round(1e4*F.d)/1e4,P)),F.max-I.d<=r||(C=F.h/2,M.push(new Ou(F.p.x-C,F.p.y-C,C,o)),M.push(new Ou(F.p.x+C,F.p.y-C,C,o)),M.push(new Ou(F.p.x-C,F.p.y+C,C,o)),M.push(new Ou(F.p.x+C,F.p.y+C,C,o)),P+=4)}return a&&(console.log(`num probes: ${P}`),console.log(`best distance: ${I.d}`)),I.p}function fx(o,r){return r.max-o.max}function Ou(o,r,a,l){this.p=new Ye(o,r),this.h=a,this.d=function(h,m){let _=!1,x=1/0;for(let w=0;w<m.length;w++){const C=m[w];for(let M=0,I=C.length,P=I-1;M<I;P=M++){const F=C[M],z=C[P];F.y>h.y!=z.y>h.y&&h.x<(z.x-F.x)*(h.y-F.y)/(z.y-F.y)+F.x&&(_=!_),x=Math.min(x,Wg(h,F,z))}}return(_?1:-1)*Math.sqrt(x)}(this.p,l),this.max=this.d+this.h*Math.SQRT2}const Fi=Number.POSITIVE_INFINITY,mx=Math.sqrt(2);function U_(o,r){return r[1]!==Fi?function(a,l,h){let m=0,_=0;switch(l=Math.abs(l),h=Math.abs(h),a){case"top-right":case"top-left":case"top":_=h-7;break;case"bottom-right":case"bottom-left":case"bottom":_=7-h}switch(a){case"top-right":case"bottom-right":case"right":m=-l;break;case"top-left":case"bottom-left":case"left":m=l}return[m,_]}(o,r[0],r[1]):function(a,l){let h=0,m=0;l<0&&(l=0);const _=l/mx;switch(a){case"top-right":case"top-left":m=_-7;break;case"bottom-right":case"bottom-left":m=7-_;break;case"bottom":m=7-l;break;case"top":m=l-7}switch(a){case"top-right":case"bottom-right":h=-_;break;case"top-left":case"bottom-left":h=_;break;case"left":h=l;break;case"right":h=-l}return[h,m]}(o,r[0])}function s1(o,r,a,l,h,m,_,x,w,C){o.createArrays(),o.tilePixelRatio=vt/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;const M=o.layers[0].layout,I=o.layers[0]._unevaluatedLayout._values,P={};if("composite"===o.textSizeData.kind){const{minZoom:U,maxZoom:X}=o.textSizeData;P.compositeTextSizes=[I["text-size"].possiblyEvaluate(new q(U),x),I["text-size"].possiblyEvaluate(new q(X),x)]}if("composite"===o.iconSizeData.kind){const{minZoom:U,maxZoom:X}=o.iconSizeData;P.compositeIconSizes=[I["icon-size"].possiblyEvaluate(new q(U),x),I["icon-size"].possiblyEvaluate(new q(X),x)]}P.layoutTextSize=I["text-size"].possiblyEvaluate(new q(w+1),x),P.layoutIconSize=I["icon-size"].possiblyEvaluate(new q(w+1),x),P.textMaxSize=I["text-size"].possiblyEvaluate(new q(18),x);const F="map"===M.get("text-rotation-alignment")&&"point"!==M.get("symbol-placement"),z=M.get("text-size");for(const U of o.features){const X=M.get("text-font").evaluate(U,{},x).join(","),ee=z.evaluate(U,{},x),ce=P.layoutTextSize.evaluate(U,{},x),se=(P.layoutIconSize.evaluate(U,{},x),{horizontal:{},vertical:void 0}),pe=U.text;let he,_e=[0,0];if(pe){const Pe=pe.toString(),Be=24*M.get("text-letter-spacing").evaluate(U,{},x),xe=24*M.get("text-line-height").evaluate(U,{},x),Ae=p(Pe)?Be:0,Ne=M.get("text-anchor").evaluate(U,{},x),Ue=M.get("text-variable-anchor");if(!Ue){const ft=M.get("text-radial-offset").evaluate(U,{},x);_e=ft?U_(Ne,[24*ft,Fi]):M.get("text-offset").evaluate(U,{},x).map(at=>24*at)}let rt=F?"center":M.get("text-justify").evaluate(U,{},x);const Oe=M.get("symbol-placement"),Je="point"===Oe,At="point"===Oe?24*M.get("text-max-width").evaluate(U,{},x):0,Nt=ft=>{o.allowVerticalPlacement&&Sa(Pe)&&(se.vertical=Ws(pe,r,a,h,X,At,xe,Ne,ft,Ae,_e,Go.vertical,!0,Oe,ce,ee))};if(!F&&Ue){const ft="auto"===rt?Ue.map(Gt=>j_(Gt)):[rt];let at=!1;for(let Gt=0;Gt<ft.length;Gt++){const kt=ft[Gt];if(!se.horizontal[kt])if(at)se.horizontal[kt]=se.horizontal[0];else{const ct=Ws(pe,r,a,h,X,At,xe,"center",kt,Ae,_e,Go.horizontal,!1,Oe,ce,ee);ct&&(se.horizontal[kt]=ct,at=1===ct.positionedLines.length)}}Nt("left")}else{if("auto"===rt&&(rt=j_(Ne)),Je||M.get("text-writing-mode").indexOf("horizontal")>=0||!Sa(Pe)){const ft=Ws(pe,r,a,h,X,At,xe,Ne,rt,Ae,_e,Go.horizontal,!1,Oe,ce,ee);ft&&(se.horizontal[rt]=ft)}Nt("point"===Oe?"left":rt)}}let Te=!1;if(U.icon&&U.icon.name){const Pe=l[U.icon.name];Pe&&(he=lm(h[U.icon.name],M.get("icon-offset").evaluate(U,{},x),M.get("icon-anchor").evaluate(U,{},x)),Te=Pe.sdf,void 0===o.sdfIcons?o.sdfIcons=Pe.sdf:o.sdfIcons!==Pe.sdf&&rr("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Pe.pixelRatio!==o.pixelRatio||0!==M.get("icon-rotate").constantOr(1))&&(o.iconsNeedLinear=!0))}const De=Ap(se.horizontal)||se.vertical;o.iconsInText||(o.iconsInText=!!De&&De.iconsInText),(De||he)&&$_(o,U,se,he,l,P,ce,0,_e,Te,_,x,C)}m&&o.generateCollisionDebugBuffers(w,o.collisionBoxArray)}function j_(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function $_(o,r,a,l,h,m,_,x,w,C,M,I,P){let F=m.textMaxSize.evaluate(r,{},I);void 0===F&&(F=_);const z=o.layers[0].layout,U=z.get("icon-offset").evaluate(r,{},I),X=Ap(a.horizontal)||a.vertical,ee="globe"===P.name,ce=_/24,se=o.tilePixelRatio*F/24,pe=(Ae=o.overscaling,o.zoom>18&&Ae>2&&(Ae>>=1),Math.max(vt/(512*Ae),1)*z.get("symbol-spacing")),he=z.get("text-padding")*o.tilePixelRatio,_e=z.get("icon-padding")*o.tilePixelRatio,Te=Ft(z.get("text-max-angle")),De="map"===z.get("text-rotation-alignment")&&"point"!==z.get("symbol-placement"),Pe="map"===z.get("icon-rotation-alignment")&&"point"!==z.get("symbol-placement"),Be=z.get("symbol-placement"),xe=pe/2;var Ae;const Ne=z.get("icon-text-fit");let Ue;l&&"none"!==Ne&&(o.allowVerticalPlacement&&a.vertical&&(Ue=F_(l,a.vertical,Ne,z.get("icon-text-fit-padding"),U,ce)),X&&(l=F_(l,X,Ne,z.get("icon-text-fit-padding"),U,ce)));const rt=(Oe,Je,At)=>{if(Je.x<0||Je.x>=vt||Je.y<0||Je.y>=vt)return;let Nt=null;if(ee){const{x:ft,y:at,z:Gt}=P.projectTilePoint(Je.x,Je.y,At);Nt={anchor:new Ys(ft,at,Gt,0,void 0),up:P.upVector(At,Je.x,Je.y)}}!function(ft,at,Gt,kt,ct,br,jn,sr,jt,nn,Dn,pn,En,Ln,Jn,Nr,zi,Wt,ar,Wr,cn,qn,hi,On,gr){const Sr=ft.addToLineVertexArray(at,kt);let Pr,di,ze,Mr,vn,Al,sd,mt=0,pt=0,kr=0,Ax=0,Um=-1,Yu=-1;const So={};let jm=Sh("");const ea=Gt?Gt.anchor:at;let Sc=0,qp=0;if(void 0===jt._unevaluatedLayout.getValue("text-radial-offset")?[Sc,qp]=jt.layout.get("text-offset").evaluate(cn,{},gr).map(oo=>24*oo):(Sc=24*jt.layout.get("text-radial-offset").evaluate(cn,{},gr),qp=Fi),ft.allowVerticalPlacement&&ct.vertical){const oo=ct.vertical;if(Jn)Al=fm(oo),sr&&(sd=fm(sr));else{const Bi=jt.layout.get("text-rotate").evaluate(cn,{},gr)+90;ze=Qh(nn,ea,at,Dn,pn,En,oo,Ln,Bi,Nr),sr&&(Mr=Qh(nn,ea,at,Dn,pn,En,sr,Wt,Bi))}}if(br){const oo=jt.layout.get("icon-rotate").evaluate(cn,{},gr),Bi="none"!==jt.layout.get("icon-text-fit"),Ku=dm(br,oo,hi,Bi),ad=sr?dm(sr,oo,hi,Bi):void 0;di=Qh(nn,ea,at,Dn,pn,En,br,Wt,oo),mt=4*Ku.length;const na=ft.iconSizeData;let Mc=null;"source"===na.kind?(Mc=[Eo*jt.layout.get("icon-size").evaluate(cn,{},gr)],Mc[0]>wc&&rr(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===na.kind&&(Mc=[Eo*qn.compositeIconSizes[0].evaluate(cn,{},gr),Eo*qn.compositeIconSizes[1].evaluate(cn,{},gr)],(Mc[0]>wc||Mc[1]>wc)&&rr(`${ft.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),ft.addSymbols(ft.icon,Ku,Mc,Wr,ar,cn,!1,Gt,at,Sr.lineStartIndex,Sr.lineLength,-1,On,gr),Um=ft.icon.placedSymbolArray.length-1,ad&&(pt=4*ad.length,ft.addSymbols(ft.icon,ad,Mc,Wr,ar,cn,Go.vertical,Gt,at,Sr.lineStartIndex,Sr.lineLength,-1,On,gr),Yu=ft.icon.placedSymbolArray.length-1)}for(const oo in ct.horizontal){const Bi=ct.horizontal[oo];Pr||(jm=Sh(Bi.text),Jn?vn=fm(Bi):Pr=Qh(nn,ea,at,Dn,pn,En,Bi,Ln,jt.layout.get("text-rotate").evaluate(cn,{},gr),Nr));const Ku=1===Bi.positionedLines.length;if(kr+=G_(ft,Gt,at,Bi,jn,jt,Jn,cn,Nr,Sr,ct.vertical?Go.horizontal:Go.horizontalOnly,Ku?Object.keys(ct.horizontal):[oo],So,Um,qn,On,gr),Ku)break}ct.vertical&&(Ax+=G_(ft,Gt,at,ct.vertical,jn,jt,Jn,cn,Nr,Sr,Go.vertical,["vertical"],So,Yu,qn,On,gr));let ta=-1;const Rr=(oo,Bi)=>oo?Math.max(oo,Bi):Bi;ta=Rr(vn,ta),ta=Rr(Al,ta),ta=Rr(sd,ta);const ay=ta>-1?1:0;ft.glyphOffsetArray.length>=Sl.MAX_GLYPHS&&rr("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==cn.sortKey&&ft.addToSortKeyRanges(ft.symbolInstances.length,cn.sortKey),ft.symbolInstances.emplaceBack(ea.x,ea.y,ea.z,at.x,at.y,So.right>=0?So.right:-1,So.center>=0?So.center:-1,So.left>=0?So.left:-1,So.vertical>=0?So.vertical:-1,Um,Yu,jm,void 0!==Pr?Pr:ft.collisionBoxArray.length,void 0!==Pr?Pr+1:ft.collisionBoxArray.length,void 0!==ze?ze:ft.collisionBoxArray.length,void 0!==ze?ze+1:ft.collisionBoxArray.length,void 0!==di?di:ft.collisionBoxArray.length,void 0!==di?di+1:ft.collisionBoxArray.length,Mr||ft.collisionBoxArray.length,Mr?Mr+1:ft.collisionBoxArray.length,Dn,kr,Ax,mt,pt,ay,0,Sc,qp,ta)}(o,Je,Nt,Oe,a,l,h,Ue,o.layers[0],o.collisionBoxArray,r.index,r.sourceLayerIndex,o.index,he,De,w,0,_e,Pe,U,r,m,C,M,I)};if("line"===Be)for(const Oe of xc(r.geometry,0,0,vt,vt)){const Je=Fu(Oe,pe,Te,a.vertical||X,l,24,se,o.overscaling,vt);for(const At of Je){const Nt=X;Nt&&gx(o,Nt.text,xe,At)||rt(Oe,At,I)}}else if("line-center"===Be){for(const Oe of r.geometry)if(Oe.length>1){const Je=cm(Oe,Te,a.vertical||X,l,24,se);Je&&rt(Oe,Je,I)}}else if("Polygon"===r.type)for(const Oe of Hf(r.geometry,0)){const Je=V_(Oe,16);rt(Oe[0],new Ys(Je.x,Je.y,0,0,void 0),I)}else if("LineString"===r.type)for(const Oe of r.geometry)rt(Oe,new Ys(Oe[0].x,Oe[0].y,0,0,void 0),I);else if("Point"===r.type)for(const Oe of r.geometry)for(const Je of Oe)rt([Je],new Ys(Je.x,Je.y,0,0,void 0),I)}const wc=32640;function G_(o,r,a,l,h,m,_,x,w,C,M,I,P,F,z,U,X){const ee=function(pe,he,_e,Te,De,Pe,Be,xe){const Ae=[];if(0===he.positionedLines.length)return Ae;const Ne=Te.layout.get("text-rotate").evaluate(Pe,{})*Math.PI/180,Ue=function(Nt){const ft=Nt[0],at=Nt[1],Gt=ft*at;return Gt>0?[ft,-at]:Gt<0?[-ft,at]:0===ft?[at,ft]:[at,-ft]}(_e);let rt=Math.abs(he.top-he.bottom);for(const Nt of he.positionedLines)rt-=Nt.lineOffset;const Oe=he.positionedLines.length,Je=rt/Oe;let At=he.top-_e[1];for(let Nt=0;Nt<Oe;++Nt){const ft=he.positionedLines[Nt];At=B_(he,Je,At,Nt);for(const at of ft.positionedGlyphs){if(!at.rect)continue;const Gt=at.rect||{};let kt=4,ct=!0,br=1,jn=0;if(at.imageName){const On=Be[at.imageName];if(!On)continue;if(On.sdf){rr("SDF images are not supported in formatted text and will be ignored.");continue}ct=!1,br=On.pixelRatio,kt=1/br}const sr=(De||xe)&&at.vertical,jt=at.metrics.advance*at.scale/2,nn=at.metrics,Dn=at.rect;if(null===Dn)continue;xe&&he.verticalizable&&(jn=at.imageName?jt-at.metrics.width*at.scale/2:0);const pn=De?[at.x+jt,at.y]:[0,0];let En=[0,0],Ln=[0,0],Jn=!1;De||(sr?(Ln=[at.x+jt+Ue[0],at.y+Ue[1]-jn],Jn=!0):En=[at.x+jt+_e[0],at.y+_e[1]-jn]);const Nr=Dn.w*at.scale/(br*(at.localGlyph?2:1)),zi=Dn.h*at.scale/(br*(at.localGlyph?2:1));let Wt,ar,Wr,cn;if(sr){const On=at.y-At,gr=new Ye(-jt,jt-On),Sr=-Math.PI/2,Pr=new Ye(...Ln);Wt=new Ye(-jt+En[0],En[1]),Wt._rotateAround(Sr,gr)._add(Pr),Wt.x+=-On+jt,Wt.y-=(nn.left-kt)*at.scale;const di=at.imageName?nn.advance*at.scale:24*at.scale,ze=String.fromCharCode(at.glyph);C_(ze)?Wt.x+=(1-kt)*at.scale:om(ze)?Wt.x+=di-nn.height*at.scale+(-kt-1)*at.scale:Wt.x+=at.imageName||nn.width+2*kt===Dn.w&&nn.height+2*kt===Dn.h?(di-zi)/2:(di-(nn.height+2*kt)*at.scale)/2,ar=new Ye(Wt.x,Wt.y-Nr),Wr=new Ye(Wt.x+zi,Wt.y),cn=new Ye(Wt.x+zi,Wt.y-Nr)}else{const On=(nn.left-kt)*at.scale-jt+En[0],gr=(-nn.top-kt)*at.scale+En[1],Sr=On+Nr,Pr=gr+zi;Wt=new Ye(On,gr),ar=new Ye(Sr,gr),Wr=new Ye(On,Pr),cn=new Ye(Sr,Pr)}if(Ne){let On;On=De?new Ye(0,0):Jn?new Ye(Ue[0],Ue[1]):new Ye(_e[0],_e[1]),Wt._rotateAround(Ne,On),ar._rotateAround(Ne,On),Wr._rotateAround(Ne,On),cn._rotateAround(Ne,On)}const qn=new Ye(0,0),hi=new Ye(0,0);Ae.push({tl:Wt,tr:ar,bl:Wr,br:cn,tex:Gt,writingMode:he.writingMode,glyphOffset:pn,sectionIndex:at.sectionIndex,isSDF:ct,pixelOffsetTL:qn,pixelOffsetBR:hi,minFontScaleX:0,minFontScaleY:0})}}return Ae}(0,l,w,m,_,x,h,o.allowVerticalPlacement),ce=o.textSizeData;let se=null;"source"===ce.kind?(se=[Eo*m.layout.get("text-size").evaluate(x,{},X)],se[0]>wc&&rr(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===ce.kind&&(se=[Eo*z.compositeTextSizes[0].evaluate(x,{},X),Eo*z.compositeTextSizes[1].evaluate(x,{},X)],(se[0]>wc||se[1]>wc)&&rr(`${o.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),o.addSymbols(o.text,ee,se,w,_,x,M,r,a,C.lineStartIndex,C.lineLength,F,U,X);for(const pe of I)P[pe]=o.text.placedSymbolArray.length-1;return 4*ee.length}function Ap(o){for(const r in o)return o[r];return null}function Qh(o,r,a,l,h,m,_,x,w,C){let M=_.top,I=_.bottom,P=_.left,F=_.right;const z=_.collisionPadding;if(z&&(P-=z[0],M-=z[1],F+=z[2],I+=z[3]),w){const U=new Ye(P,M),X=new Ye(F,M),ee=new Ye(P,I),ce=new Ye(F,I),se=Ft(w);let pe=new Ye(0,0);C&&(pe=new Ye(C[0],C[1])),U._rotateAround(se,pe),X._rotateAround(se,pe),ee._rotateAround(se,pe),ce._rotateAround(se,pe),P=Math.min(U.x,X.x,ee.x,ce.x),F=Math.max(U.x,X.x,ee.x,ce.x),M=Math.min(U.y,X.y,ee.y,ce.y),I=Math.max(U.y,X.y,ee.y,ce.y)}return o.emplaceBack(r.x,r.y,r.z,a.x,a.y,P,M,F,I,x,l,h,m),o.length-1}function fm(o){o.collisionPadding&&(o.top-=o.collisionPadding[1],o.bottom+=o.collisionPadding[3]);const r=o.bottom-o.top;return r>0?Math.max(10,r):null}function gx(o,r,a,l){const h=o.compareText;if(r in h){const m=h[r];for(let _=m.length-1;_>=0;_--)if(l.dist(m[_])<a)return!0}else h[r]=[];return h[r].push(l),!1}const _x=st([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),{members:mm}=_x,H_=st([{name:"a_pos_3",components:3,type:"Int16"}]);var zu=st([{name:"a_pos",type:"Int16",components:2}]);const Ec=vt/Math.PI/2,gm=2*Ri(1,0)*Ec*Math.PI,Cc=[64,32,16],Li=-Ec,ro=Ec,Ks=[new xo([Li,Li,Li],[ro,ro,ro]),new xo([Li,Li,Li],[0,0,ro]),new xo([0,Li,Li],[ro,0,ro]),new xo([Li,0,Li],[0,ro,ro]),new xo([0,0,Li],[ro,ro,ro])];function Ip(o,r,a,l=!0){const h=qs([],o._camera.position,o.worldSize),m=[r,a,1,1];xr(m,m,o.pixelMatrixInverse),zf(m,m,1/m[3]);const _=wi([],nr([],m,h)),x=o.globeMatrix,w=[x[12],x[13],x[14]],C=nr([],w,h),M=dc(C),I=wi([],C),P=o.worldSize/(2*Math.PI),F=$o(I,_),z=Math.asin(P/M);if(z<Math.acos(F)){if(!l)return null;const Be=[],xe=[];qs(Be,_,M/F),wi(xe,nr(xe,Be,C)),wi(_,Kn(_,C,qs(_,xe,Math.tan(z)*M)))}const U=[];new hp(h,_).closestPointOnSphere(w,P,U);const X=wi([],co(x,0)),ee=wi([],co(x,1)),ce=wi([],co(x,2)),se=$o(X,U),pe=$o(ee,U),he=$o(ce,U),_e=Qr(Math.asin(-pe/P));let Te=Qr(Math.atan2(se,he));Te=o.center.lng+function(Be,xe){const Ae=(xe-Be+180)%360-180;return Ae<-180?Ae+360:Ae}(o.center.lng,Te);const De=lc(Te),Pe=Et(yu(_e),0,1);return new cc(De,Pe)}class yx{constructor(r,a,l){this.a=nr([],r,l),this.b=nr([],a,l),this.center=l;const h=wi([],this.a),m=wi([],this.b);this.angle=Math.acos($o(h,m))}}function _m(o,r){if(0===o.angle)return null;let a;return a=0===o.a[r]?1/o.angle*.5*Math.PI:1/o.angle*Math.atan(o.b[r]/o.a[r]/Math.sin(o.angle)-1/Math.tan(o.angle)),a<0||a>1?null:function(l,h,m,_){const x=Math.sin(m);return l*(Math.sin((1-_)*m)/x)+h*(Math.sin(_*m)/x)}(o.a[r],o.b[r],o.angle,Et(a,0,1))+o.center[r]}function Oa(o){if(o.z<=1)return Ks[o.z+2*o.y+o.x];const[r,a]=ym(o),l=[Ci(r[0],r[1]),Ci(r[0],a[1]),Ci(a[0],r[1]),Ci(a[0],a[1])],h=[ro,ro,ro],m=[Li,Li,Li];for(const _ of l)h[0]=Math.min(h[0],_[0]),h[1]=Math.min(h[1],_[1]),h[2]=Math.min(h[2],_[2]),m[0]=Math.max(m[0],_[0]),m[1]=Math.max(m[1],_[1]),m[2]=Math.max(m[2],_[2]);return new xo(h,m)}function ym(o){const r=1<<o.z,a=o.x/r,l=(o.x+1)/r,h=(o.y+1)/r;return[[fr(o.y/r),Zr(a)],[fr(h),Zr(l)]]}function Z_(o,r,a,l=Ec){return a=Ft(a),[o*Math.sin(a)*l,-r*l,o*Math.cos(a)*l]}function Ci(o,r,a){return Z_(Math.cos(Ft(o)),Math.sin(Ft(o)),r,a)}function Pp(o,r,a){const l=Math.pow(2,a.z),h=(o/vt+a.x)/l;return Ci(fr((r/vt+a.y)/l),Zr(h))}function kp(o){return 16383/Math.max(...nr([],o.max,o.min))}function ed(o){const r=vo(new Float64Array(16)),a=kp(o);var l,h;return Hs(r,r,[a,a,a]),yl(r,r,((l=[])[0]=-(h=o.min)[0],l[1]=-h[1],l[2]=-h[2],l)),r}function td(o){const r=vo(new Float64Array(16)),a=1/kp(o);return yl(r,r,o.min),Hs(r,r,[a,a,a]),r}function Rp(o,r,a,l,h){const m=function(w){const C=vt/(2*Math.PI);return w/(2*Math.PI)/C}(a),_=[o,r,-a/(2*Math.PI)],x=vo(new Float64Array(16));return yl(x,x,_),Hs(x,x,[m,m,m]),ap(x,x,Ft(-h)),lp(x,x,Ft(-l)),x}function vm(o){return Ti(5,6,o)}function Fp(o,r){const a=Ci(r.lat,r.lng);return m=(l=Ff([],function(F){const z=Ci(F._center.lat,F._center.lng);let U=Lf([],wu(0,1,0),z);const X=Xg([],-F.angle,z);U=ci(U,U,X),Xg(X,-F._pitch,U);const ee=wi([],z);return qs(ee,ee,F.cameraToCenterDistance/F.pixelsPerMeter*gm),ci(ee,ee,X),Kn([],z,ee)}(o),a))[0],_=l[1],x=l[2],w=(h=a)[0],C=h[1],M=h[2],P=(I=Math.sqrt(m*m+_*_+x*x)*Math.sqrt(w*w+C*C+M*M))&&$o(l,h)/I,Math.acos(Math.min(Math.max(P,-1),1));var l,h,m,_,x,w,C,M,I,P}const Lp=Ft(85),W_=Math.cos(Lp),a1=Math.sin(Lp);function vx(o,r){const a=o.fovAboveCenter,l=o.elevation?o.elevation.getMinElevationBelowMSL()*r:0,h=(o._camera.position[2]*o.worldSize-l)/Math.cos(o._pitch),m=Math.sin(a)*h/Math.sin(Math.max(Math.PI/2-o._pitch-a,.01)),_=Math.sin(o._pitch)*m+h;return Math.min(1.01*_,h*(1/o._horizonShift))}function za(o,r){if(!r.isReprojectedInTileSpace)return{scale:1<<o.z,x:o.x,y:o.y,x2:o.x+1,y2:o.y+1,projection:r};const a=Math.pow(2,-o.z),l=o.x*a,h=(o.x+1)*a,m=o.y*a,_=(o.y+1)*a,x=Zr(l),w=Zr(h),C=fr(m),M=fr(_),I=r.project(x,C),P=r.project(w,C),F=r.project(w,M),z=r.project(x,M);let U=Math.min(I.x,P.x,F.x,z.x),X=Math.min(I.y,P.y,F.y,z.y),ee=Math.max(I.x,P.x,F.x,z.x),ce=Math.max(I.y,P.y,F.y,z.y);const se=a/16;function pe(_e,Te,De,Pe,Be,xe){const Ae=(De+Be)/2,Ne=(Pe+xe)/2,Ue=r.project(Zr(Ae),fr(Ne)),rt=Math.max(0,U-Ue.x,X-Ue.y,Ue.x-ee,Ue.y-ce);U=Math.min(U,Ue.x),ee=Math.max(ee,Ue.x),X=Math.min(X,Ue.y),ce=Math.max(ce,Ue.y),rt>se&&(pe(_e,Ue,De,Pe,Ae,Ne),pe(Ue,Te,Ae,Ne,Be,xe))}pe(I,P,l,m,h,m),pe(P,F,h,m,h,_),pe(F,z,h,_,l,_),pe(z,I,l,_,l,m),U-=se,X-=se,ee+=se,ce+=se;const he=1/Math.max(ee-U,ce-X);return{scale:he,x:U*he,y:X*he,x2:ee*he,y2:ce*he,projection:r}}const l1=vo(new Float32Array(16));class Dl{constructor(r){this.spec=r,this.name=r.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(r,a){return{x:0,y:0,z:0}}unproject(r,a){return new dn(0,0)}projectTilePoint(r,a,l){return{x:r,y:a,z:0}}locationPoint(r,a,l=!0){return r._coordinatePoint(r.locationCoordinate(a),l)}pixelsPerMeter(r,a){return Ri(1,r)*a}pixelSpaceConversion(r,a,l){return 1}farthestPixelDistance(r){return vx(r,r.pixelsPerMeter)}pointCoordinate(r,a,l,h){const m=r.horizonLineFromTop(!1),_=new Ye(a,Math.max(m,l));return r.rayIntersectionCoordinate(r.pointRayIntersection(_,h))}pointCoordinate3D(r,a,l){const h=new Ye(a,l);if(r.elevation)return r.elevation.pointCoordinate(h);{const m=this.pointCoordinate(r,h.x,h.y,0);return[m.x,m.y,m.z]}}isPointAboveHorizon(r,a){if(r.elevation)return!this.pointCoordinate3D(r,a.x,a.y);const l=r.horizonLineFromTop();return a.y<l}createInversionMatrix(r,a){return l1}createTileMatrix(r,a,l){let h,m,_;const x=l.canonical,w=vo(new Float64Array(16));if(this.isReprojectedInTileSpace){const C=za(x,this);h=1,m=C.x+l.wrap*C.scale,_=C.y,Hs(w,w,[h/C.scale,h/C.scale,r.pixelsPerMeter/a])}else h=a/r.zoomScale(x.z),m=(x.x+Math.pow(2,x.z)*l.wrap)*h,_=x.y*h;return yl(w,w,[m,_,0]),Hs(w,w,[h/vt,h/vt,1]),w}upVector(r,a,l){return[0,0,1]}upVectorScale(r,a,l){return{metersToTile:1}}}class X_ extends Dl{constructor(r){super(r),this.range=[4,7],this.center=r.center||[-96,37.5];const[a,l]=this.parallels=r.parallels||[29.5,45.5],h=Math.sin(Ft(a));this.n=(h+Math.sin(Ft(l)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(r,a){const{n:l,c:h,r0:m}=this,_=Ft(r-this.center[0]),x=Ft(a),w=Math.sqrt(h-2*l*Math.sin(x))/l;return{x:w*Math.sin(_*l),y:w*Math.cos(_*l)-m,z:0}}unproject(r,a){const{n:l,c:h,r0:m}=this,_=m+a;let x=Math.atan2(r,Math.abs(_))*Math.sign(_);_*l<0&&(x-=Math.PI*Math.sign(r)*Math.sign(_));const w=Ft(this.center[0])*l;x=aa(x,-Math.PI-w,Math.PI-w);const C=Qr(x/l)+this.center[0],M=Math.asin(Et((h-(r*r+_*_)*l*l)/(2*l),-1,1)),I=Et(Qr(M),-85.051129,fs);return new dn(C,I)}}const Bu=1.340264,Nu=-.081106,Vu=893e-6,Uu=.003796,Ho=Math.sqrt(3)/2;class Op extends Dl{project(r,a){a=a/180*Math.PI,r=r/180*Math.PI;const l=Math.asin(Ho*Math.sin(a)),h=l*l,m=h*h*h;return{x:.5*(r*Math.cos(l)/(Ho*(Bu+3*Nu*h+m*(7*Vu+9*Uu*h)))/Math.PI+.5),y:1-.5*(l*(Bu+Nu*h+m*(Vu+Uu*h))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let l=a=(2*(1-a)-1)*Math.PI,h=l*l,m=h*h*h;for(let M,I,P,F=0;F<12&&(I=l*(Bu+Nu*h+m*(Vu+Uu*h))-a,P=Bu+3*Nu*h+m*(7*Vu+9*Uu*h),M=I/P,l=Et(l-M,-Math.PI/3,Math.PI/3),h=l*l,m=h*h*h,!(Math.abs(M)<1e-12));++F);const _=Ho*r*(Bu+3*Nu*h+m*(7*Vu+9*Uu*h))/Math.cos(l),x=Math.asin(Math.sin(l)/Ho),w=Et(180*_/Math.PI,-180,180),C=Et(180*x/Math.PI,-85.051129,fs);return new dn(w,C)}}class xx extends Dl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){return{x:.5+r/360,y:.5-a/360,z:0}}unproject(r,a){const l=360*(r-.5),h=Et(360*(.5-a),-85.051129,fs);return new dn(l,h)}}const ju=Math.PI/2;function xm(o){return Math.tan((ju+o)/2)}class bm extends Dl{constructor(r){super(r),this.center=r.center||[0,30];const[a,l]=this.parallels=r.parallels||[30,30],h=Ft(a),m=Ft(l),_=Math.cos(h);this.n=h===m?Math.sin(h):Math.log(_/Math.cos(m))/Math.log(xm(m)/xm(h)),this.f=_*Math.pow(xm(h),this.n)/this.n}project(r,a){a=Ft(a),r=Ft(r-this.center[0]);const l=1e-6,{n:h,f:m}=this;m>0?a<-ju+l&&(a=-ju+l):a>ju-l&&(a=ju-l);const _=m/Math.pow(xm(a),h),x=_*Math.sin(h*r),w=m-_*Math.cos(h*r);return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+.5),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI,a=(2*(1-a)-.5)*Math.PI;const{n:l,f:h}=this,m=h-a,_=Math.sign(m),x=Math.sign(l)*Math.sqrt(r*r+m*m);let w=Math.atan2(r,Math.abs(m))*_;m*l<0&&(w-=Math.PI*Math.sign(r)*_);const C=Et(Qr(w/l)+this.center[0],-180,180),M=Et(Qr(2*Math.atan(Math.pow(h/x,1/l))-ju),-85.051129,fs);return new dn(C,M)}}class wm extends Dl{constructor(r){super(r),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(r,a){return{x:lc(r),y:yu(a),z:0}}unproject(r,a){const l=Zr(r),h=fr(a);return new dn(l,h)}}const zp=Ft(fs);class nd extends Dl{project(r,a){const l=(a=Ft(a))*a,h=l*l;return{x:.5*((r=Ft(r))*(.8707-.131979*l+h*(h*(.003971*l-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+l*(.015085+h*(.028874*l-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(r,a){r=(2*r-.5)*Math.PI;let l=a=(2*(1-a)-1)*Math.PI,h=25,m=0,_=l*l;do{_=l*l;const C=_*_;m=(l*(1.007226+_*(.015085+C*(.028874*_-.044475-.005916*C)))-a)/(1.007226+_*(.045255+C*(.259866*_-.311325-.005916*11*C))),l=Et(l-m,-zp,zp)}while(Math.abs(m)>1e-6&&--h>0);_=l*l;const x=Et(Qr(r/(.8707+_*(_*(_*_*_*(.003971-.001529*_)-.013791)-.131979))),-180,180),w=Qr(l);return new dn(x,w)}}const Y_=Ft(fs);class Em extends Dl{project(r,a){a=Ft(a),r=Ft(r);const l=Math.cos(a),h=2/Math.PI,m=Math.acos(l*Math.cos(r/2)),_=Math.sin(m)/m,x=.5*(r*h+2*l*Math.sin(r/2)/_)||0,w=.5*(a+Math.sin(a)/_)||0;return{x:.5*(x/Math.PI+.5),y:1-.5*(w/Math.PI+1),z:0}}unproject(r,a){let l=r=(2*r-.5)*Math.PI,h=a=(2*(1-a)-1)*Math.PI,m=25;const _=1e-6;let x=0,w=0;do{const C=Math.cos(h),M=Math.sin(h),I=2*M*C,P=M*M,F=C*C,z=Math.cos(l/2),U=Math.sin(l/2),X=2*z*U,ee=U*U,ce=1-F*z*z,se=ce?1/ce:0,pe=ce?Math.acos(C*z)*Math.sqrt(1/ce):0,he=.5*(2*pe*C*U+2*l/Math.PI)-r,_e=.5*(pe*M+h)-a,Te=.5*se*(F*ee+pe*C*z*P)+1/Math.PI,De=se*(X*I/4-pe*M*U),Pe=.125*se*(I*U-pe*M*F*X),Be=.5*se*(P*z+pe*ee*C)+.5,xe=De*Pe-Be*Te;x=(_e*De-he*Be)/xe,w=(he*Pe-_e*Te)/xe,l=Et(l-x,-Math.PI,Math.PI),h=Et(h-w,-Y_,Y_)}while((Math.abs(x)>_||Math.abs(w)>_)&&--m>0);return new dn(Qr(l),Qr(h))}}class Cm extends Dl{constructor(r){super(r),this.center=r.center||[0,0],this.parallels=r.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ft(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(r,a){const{scale:l,cosPhi:h}=this;return{x:Ft(r)*h*l+.5,y:-Math.sin(Ft(a))/h*l+.5,z:0}}unproject(r,a){const{scale:l,cosPhi:h}=this,m=-(a-.5)/l,_=Et(Qr((r-.5)/l)/h,-180,180),x=Math.asin(Et(m*h,-1,1)),w=Et(Qr(x),-85.051129,fs);return new dn(_,w)}}class K_ extends wm{constructor(r){super(r),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug","custom"],this.range=[3,5]}projectTilePoint(r,a,l){const h=Math.pow(2,l.z),m=(r/vt+l.x)/h,_=Ci(fr((a/vt+l.y)/h),Zr(m));return ci(_,_,ed(Oa(l))),{x:_[0],y:_[1],z:_[2]}}locationPoint(r,a){const l=Ci(a.lat,a.lng),h=wi([],l),m=r.elevation?r.elevation.getAtPointOrZero(r.locationCoordinate(a),r._centerAltitude):r._centerAltitude;cp(l,l,h,Ri(1,0)*vt*m);const _=vo(new Float64Array(16));return hc(_,r.pixelMatrix,r.globeMatrix),ci(l,l,_),new Ye(l[0],l[1])}pixelsPerMeter(r,a){return Ri(1,0)*a}pixelSpaceConversion(r,a,l){const h=Ht(Ri(1,45)*a,Ri(1,r)*a,l);return this.pixelsPerMeter(r,a)/h}createTileMatrix(r,a,l){const h=td(Oa(l.canonical));return hc(new Float64Array(16),r.globeMatrix,h)}createInversionMatrix(r,a){const{center:l}=r,h=vo(new Float64Array(16));return hc(h,h,ed(Oa(a))),lp(h,h,Ft(l.lng)),ap(h,h,Ft(l.lat)),Hs(h,h,[r._projectionScaler,r._projectionScaler,1]),Float32Array.from(h)}pointCoordinate(r,a,l,h){return Ip(r,a,l,!0)||new cc(0,0)}pointCoordinate3D(r,a,l){const h=this.pointCoordinate(r,a,l,0);return[h.x,h.y,h.z]}isPointAboveHorizon(r,a){return!Ip(r,a.x,a.y,!1)}farthestPixelDistance(r){const a=function(h,m){const _=h.cameraToCenterDistance,x=h._centerAltitude*m,w=h._camera,C=h._camera.forward(),M=Kn([],qs([],C,-_),[0,0,x]),I=h.worldSize/(2*Math.PI),P=[0,0,-I],F=h.width/h.height,z=Math.tan(h.fovAboveCenter),U=qs([],w.up(),z),X=qs([],w.right(),z*F),ee=wi([],Kn([],Kn([],C,U),X)),ce=[];let se;if(new hp(M,ee).closestPointOnSphere(P,I,ce)){const pe=Kn([],ce,P),he=nr([],pe,M);se=Math.cos(h.fovAboveCenter)*dc(he)}else{const pe=nr([],M,P),he=nr([],P,M);wi(he,he);const _e=dc(pe)-I;se=Math.sqrt(_e*(_e+2*I));const Te=Math.acos(se/(I+_e))-Math.acos($o(C,he));se*=Math.cos(Te)}return 1.01*se}(r,this.pixelsPerMeter(r.center.lat,r.worldSize)),l=vm(r.zoom);if(l>0){const h=vx(r,Ri(1,r.center.lat)*r.worldSize),m=r.worldSize/(2*Math.PI),_=Math.max(r.width,r.height)/r.worldSize*Math.PI;return Ht(a,h+m*(1-Math.cos(_)),Math.pow(l,10))}return a}upVector(r,a,l){const h=1<<r.z,m=(a/vt+r.x)/h;return Ci(fr((l/vt+r.y)/h),Zr(m),1)}upVectorScale(r){return{metersToTile:gm*kp(Oa(r))}}}function Tm(o){const r=o.parallels,a=!!r&&Math.abs(r[0]+r[1])<.01;switch(o.name){case"mercator":return new wm(o);case"equirectangular":return new xx(o);case"naturalEarth":return new nd(o);case"equalEarth":return new Op(o);case"winkelTripel":return new Em(o);case"albers":return a?new Cm(o):new X_(o);case"lambertConformalConic":return a?new Cm(o):new bm(o);case"globe":return new K_(o)}throw new Error(`Invalid projection name: ${o.name}`)}const bx=wl.VectorTileFeature.types,Dm=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Bp(o,r,a,l,h,m,_,x,w,C,M,I,P){const F=x?Math.min(wc,Math.round(x[0])):0,z=x?Math.min(wc,Math.round(x[1])):0;o.emplaceBack(r,a,Math.round(32*l),Math.round(32*h),m,_,(F<<1)+(w?1:0),z,16*C,16*M,256*I,256*P)}function Np(o,r,a,l,h,m,_){o.emplaceBack(r,a,l,h,m,_)}function rd(o,r,a,l,h){o.emplaceBack(r,a,l,h),o.emplaceBack(r,a,l,h),o.emplaceBack(r,a,l,h),o.emplaceBack(r,a,l,h)}function $u(o){for(const r of o.sections)if(T(r.text))return!0;return!1}class Vp{constructor(r){this.layoutVertexArray=new ds,this.indexArray=new Yn,this.programConfigurations=r,this.segments=new cr,this.dynamicLayoutVertexArray=new Rn,this.opacityVertexArray=new Mn,this.placedSymbolArray=new Fg,this.globeExtVertexArray=new Vn}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(r,a,l,h){this.isEmpty()||(l&&(this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,w_.members),this.indexBuffer=r.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=r.createVertexBuffer(this.dynamicLayoutVertexArray,rx.members,!0),this.opacityVertexBuffer=r.createVertexBuffer(this.opacityVertexArray,Dm,!0),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=r.createVertexBuffer(this.globeExtVertexArray,nx.members,!0)),this.opacityVertexBuffer.itemSize=1),(l||h)&&this.programConfigurations.upload(r))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}}tt(Vp,"SymbolBuffers");class Sm{constructor(r,a,l){this.layoutVertexArray=new r,this.layoutAttributes=a,this.indexArray=new l,this.segments=new cr,this.collisionVertexArray=new Un,this.collisionVertexArrayExt=new Qt}upload(r){this.layoutVertexBuffer=r.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=r.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=r.createVertexBuffer(this.collisionVertexArray,ix.members,!0),this.collisionVertexBufferExt=r.createVertexBuffer(this.collisionVertexArrayExt,$t.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}tt(Sm,"CollisionBuffers");class Sl{constructor(r){this.collisionBoxArray=r.collisionBoxArray,this.zoom=r.zoom,this.overscaling=r.overscaling,this.layers=r.layers,this.layerIds=this.layers.map(_=>_.id),this.index=r.index,this.pixelRatio=r.pixelRatio,this.sourceLayerIndex=r.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=vo([]),this.placementViewportMatrix=vo([]);const a=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Co(this.zoom,a["text-size"]),this.iconSizeData=Co(this.zoom,a["icon-size"]);const l=this.layers[0].layout,h=l.get("symbol-sort-key"),m=l.get("symbol-z-order");this.canOverlap=l.get("text-allow-overlap")||l.get("icon-allow-overlap")||l.get("text-ignore-placement")||l.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==m&&void 0!==h.constantOr(1),this.sortFeaturesByY=("viewport-y"===m||"auto"===m&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=l.get("text-writing-mode").map(_=>Go[_]),this.stateDependentLayerIds=this.layers.filter(_=>_.isStateDependent()).map(_=>_.id),this.sourceID=r.sourceID,this.projection=r.projection}createArrays(){this.text=new Vp(new ml(this.layers,this.zoom,r=>/^text/.test(r))),this.icon=new Vp(new ml(this.layers,this.zoom,r=>/^icon/.test(r))),this.glyphOffsetArray=new zg,this.lineVertexArray=new Ef,this.symbolInstances=new Og}calculateGlyphDependencies(r,a,l,h,m){for(let _=0;_<r.length;_++)if(a[r.charCodeAt(_)]=!0,h&&m){const x=yc[r.charAt(_)];x&&(a[x.charCodeAt(0)]=!0)}}populate(r,a,l,h){const m=this.layers[0],_=m.layout,x="globe"===this.projection.name,w=_.get("text-font"),C=_.get("text-field"),M=_.get("icon-image"),I=("constant"!==C.value.kind||C.value.value instanceof ei&&!C.value.value.isEmpty()||C.value.value.toString().length>0)&&("constant"!==w.value.kind||w.value.value.length>0),P="constant"!==M.value.kind||!!M.value.value||Object.keys(M.parameters).length>0,F=_.get("symbol-sort-key");if(this.features=[],!I&&!P)return;const z=a.iconDependencies,U=a.glyphDependencies,X=a.availableImages,ee=new q(this.zoom);for(const{feature:ce,id:se,index:pe,sourceLayerIndex:he}of r){const _e=m._featureFilter.needGeometry,Te=vu(ce,_e);if(!m._featureFilter.filter(ee,Te,l))continue;if(_e||(Te.geometry=Ra(ce,l,h)),x&&1!==ce.type&&l.z<=5){const xe=Te.geometry,Ae=1<<l.z,Ne=l.x,Ue=l.y,rt=.98078528056;for(let Oe=0;Oe<xe.length;Oe++)xe[Oe]=kv(xe[Oe],Je=>Je,(Je,At)=>$o(Ci(fr((Je.y/vt+Ue)/Ae),Zr((Je.x/vt+Ne)/Ae),1),Ci(fr((At.y/vt+Ue)/Ae),Zr((At.x/vt+Ne)/Ae),1))<rt)}let De,Pe;if(I){const xe=m.getValueAndResolveTokens("text-field",Te,l,X),Ae=ei.factory(xe);$u(Ae)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===ne()||this.hasRTLText&&Q.isParsed())&&(De=La(Ae,m,Te))}if(P){const xe=m.getValueAndResolveTokens("icon-image",Te,l,X);Pe=xe instanceof hr?xe:hr.fromString(xe)}if(!De&&!Pe)continue;const Be=this.sortFeaturesByKey?F.evaluate(Te,{},l):void 0;if(this.features.push({id:se,text:De,icon:Pe,index:pe,sourceLayerIndex:he,geometry:Te.geometry,properties:ce.properties,type:bx[ce.type],sortKey:Be}),Pe&&(z[Pe.name]=!0),De){const xe=w.evaluate(Te,{},l).join(","),Ae="map"===_.get("text-rotation-alignment")&&"point"!==_.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Go.vertical)>=0;for(const Ne of De.sections)if(Ne.image)z[Ne.image.name]=!0;else{const Ue=Sa(De.toString()),rt=Ne.fontStack||xe,Oe=U[rt]=U[rt]||{};this.calculateGlyphDependencies(Ne.text,Oe,Ae,this.allowVerticalPlacement,Ue)}}}"line"===_.get("symbol-placement")&&(this.features=function(ce){const se={},pe={},he=[];let _e=0;function Te(xe){he.push(ce[xe]),_e++}function De(xe,Ae,Ne){const Ue=pe[xe];return delete pe[xe],pe[Ae]=Ue,he[Ue].geometry[0].pop(),he[Ue].geometry[0]=he[Ue].geometry[0].concat(Ne[0]),Ue}function Pe(xe,Ae,Ne){const Ue=se[Ae];return delete se[Ae],se[xe]=Ue,he[Ue].geometry[0].shift(),he[Ue].geometry[0]=Ne[0].concat(he[Ue].geometry[0]),Ue}function Be(xe,Ae,Ne){const Ue=Ne?Ae[0][Ae[0].length-1]:Ae[0][0];return`${xe}:${Ue.x}:${Ue.y}`}for(let xe=0;xe<ce.length;xe++){const Ae=ce[xe],Ne=Ae.geometry,Ue=Ae.text?Ae.text.toString():null;if(!Ue){Te(xe);continue}const rt=Be(Ue,Ne),Oe=Be(Ue,Ne,!0);if(rt in pe&&Oe in se&&pe[rt]!==se[Oe]){const Je=Pe(rt,Oe,Ne),At=De(rt,Oe,he[Je].geometry);delete se[rt],delete pe[Oe],pe[Be(Ue,he[At].geometry,!0)]=At,he[Je].geometry=null}else rt in pe?De(rt,Oe,Ne):Oe in se?Pe(rt,Oe,Ne):(Te(xe),se[rt]=_e-1,pe[Oe]=_e-1)}return he.filter(xe=>xe.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((ce,se)=>ce.sortKey-se.sortKey)}update(r,a,l,h){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(r,a,this.layers,l,h),this.icon.programConfigurations.updatePaintArrays(r,a,this.layers,l,h))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(r){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(r),this.iconCollisionBox.upload(r)),this.text.upload(r,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(r,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=Tm(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(r,a){const l=this.lineVertexArray.length,h=r.segment;if(void 0!==h){let m=r.dist(a[h+1]),_=r.dist(a[h]);const x={};for(let w=h+1;w<a.length;w++)x[w]={x:a[w].x,y:a[w].y,tileUnitDistanceFromAnchor:m},w<a.length-1&&(m+=a[w+1].dist(a[w]));for(let w=h||0;w>=0;w--)x[w]={x:a[w].x,y:a[w].y,tileUnitDistanceFromAnchor:_},w>0&&(_+=a[w-1].dist(a[w]));for(let w=0;w<a.length;w++){const C=x[w];this.lineVertexArray.emplaceBack(C.x,C.y,C.tileUnitDistanceFromAnchor)}}return{lineStartIndex:l,lineLength:this.lineVertexArray.length-l}}addSymbols(r,a,l,h,m,_,x,w,C,M,I,P,F,z){const U=r.indexArray,X=r.layoutVertexArray,ee=r.globeExtVertexArray,ce=r.segments.prepareSegment(4*a.length,X,U,this.canOverlap?_.sortKey:void 0),se=this.glyphOffsetArray.length,pe=ce.vertexLength,he=this.allowVerticalPlacement&&x===Go.vertical?Math.PI/2:0,_e=_.text&&_.text.sections;for(let De=0;De<a.length;De++){const{tl:Pe,tr:Be,bl:xe,br:Ae,tex:Ne,pixelOffsetTL:Ue,pixelOffsetBR:rt,minFontScaleX:Oe,minFontScaleY:Je,glyphOffset:At,isSDF:Nt,sectionIndex:ft}=a[De],at=ce.vertexLength,Gt=At[1];if(Bp(X,C.x,C.y,Pe.x,Gt+Pe.y,Ne.x,Ne.y,l,Nt,Ue.x,Ue.y,Oe,Je),Bp(X,C.x,C.y,Be.x,Gt+Be.y,Ne.x+Ne.w,Ne.y,l,Nt,rt.x,Ue.y,Oe,Je),Bp(X,C.x,C.y,xe.x,Gt+xe.y,Ne.x,Ne.y+Ne.h,l,Nt,Ue.x,rt.y,Oe,Je),Bp(X,C.x,C.y,Ae.x,Gt+Ae.y,Ne.x+Ne.w,Ne.y+Ne.h,l,Nt,rt.x,rt.y,Oe,Je),w){const kt=w.anchor,ct=w.up;Np(ee,kt.x,kt.y,kt.z,ct[0],ct[1],ct[2]),Np(ee,kt.x,kt.y,kt.z,ct[0],ct[1],ct[2]),Np(ee,kt.x,kt.y,kt.z,ct[0],ct[1],ct[2]),Np(ee,kt.x,kt.y,kt.z,ct[0],ct[1],ct[2]),rd(r.dynamicLayoutVertexArray,kt.x,kt.y,kt.z,he)}else rd(r.dynamicLayoutVertexArray,C.x,C.y,C.z,he);U.emplaceBack(at,at+1,at+2),U.emplaceBack(at+1,at+2,at+3),ce.vertexLength+=4,ce.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(At[0]),De!==a.length-1&&ft===a[De+1].sectionIndex||r.programConfigurations.populatePaintArrays(X.length,_,_.index,{},F,z,_e&&_e[ft])}const Te=w?w.anchor:C;r.placedSymbolArray.emplaceBack(Te.x,Te.y,Te.z,C.x,C.y,se,this.glyphOffsetArray.length-se,pe,M,I,C.segment,l?l[0]:0,l?l[1]:0,h[0],h[1],x,0,!1,0,P,0)}_commitLayoutVertex(r,a,l,h,m,_,x){r.emplaceBack(a,l,h,m,_,Math.round(x.x),Math.round(x.y))}_addCollisionDebugVertices(r,a,l,h,m,_,x){const w=l.segments.prepareSegment(4,l.layoutVertexArray,l.indexArray),C=w.vertexLength,M=x.tileAnchorX,I=x.tileAnchorY;for(let F=0;F<4;F++)l.collisionVertexArray.emplaceBack(0,0,0,0);l.collisionVertexArrayExt.emplaceBack(a,-r.padding,-r.padding),l.collisionVertexArrayExt.emplaceBack(a,r.padding,-r.padding),l.collisionVertexArrayExt.emplaceBack(a,r.padding,r.padding),l.collisionVertexArrayExt.emplaceBack(a,-r.padding,r.padding),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,M,I,new Ye(r.x1,r.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,M,I,new Ye(r.x2,r.y1)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,M,I,new Ye(r.x2,r.y2)),this._commitLayoutVertex(l.layoutVertexArray,h,m,_,M,I,new Ye(r.x1,r.y2)),w.vertexLength+=4;const P=l.indexArray;P.emplaceBack(C,C+1),P.emplaceBack(C+1,C+2),P.emplaceBack(C+2,C+3),P.emplaceBack(C+3,C),w.primitiveLength+=4}_addTextDebugCollisionBoxes(r,a,l,h,m,_){for(let x=h;x<m;x++){const w=l.get(x),C=this.getSymbolInstanceTextSize(r,_,a,x);this._addCollisionDebugVertices(w,C,this.textCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}_addIconDebugCollisionBoxes(r,a,l,h,m,_){for(let x=h;x<m;x++){const w=l.get(x),C=this.getSymbolInstanceIconSize(r,a,x);this._addCollisionDebugVertices(w,C,this.iconCollisionBox,w.projectedAnchorX,w.projectedAnchorY,w.projectedAnchorZ,_)}}generateCollisionDebugBuffers(r,a){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Sm(ln,In.members,to),this.iconCollisionBox=new Sm(ln,In.members,to);const l=Iu(this.iconSizeData,r),h=Iu(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._addTextDebugCollisionBoxes(h,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._addTextDebugCollisionBoxes(h,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex,_),this._addIconDebugCollisionBoxes(l,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex,_)}}getSymbolInstanceTextSize(r,a,l,h){const m=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:h),_=Zh(this.textSizeData,r,m)/24;return this.tilePixelRatio*_}getSymbolInstanceIconSize(r,a,l){const h=this.icon.placedSymbolArray.get(l),m=Zh(this.iconSizeData,r,h);return this.tilePixelRatio*m}_commitDebugCollisionVertexUpdate(r,a,l){r.emplaceBack(a,-l,-l),r.emplaceBack(a,l,-l),r.emplaceBack(a,l,l),r.emplaceBack(a,-l,l)}_updateTextDebugCollisionBoxes(r,a,l,h,m,_){for(let x=h;x<m;x++){const w=l.get(x),C=this.getSymbolInstanceTextSize(r,_,a,x);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,C,w.padding)}}_updateIconDebugCollisionBoxes(r,a,l,h,m){for(let _=h;_<m;_++){const x=l.get(_),w=this.getSymbolInstanceIconSize(r,a,_);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,w,x.padding)}}updateCollisionDebugBuffers(r,a){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const l=Iu(this.iconSizeData,r),h=Iu(this.textSizeData,r);for(let m=0;m<this.symbolInstances.length;m++){const _=this.symbolInstances.get(m);this._updateTextDebugCollisionBoxes(h,r,a,_.textBoxStartIndex,_.textBoxEndIndex,_),this._updateTextDebugCollisionBoxes(h,r,a,_.verticalTextBoxStartIndex,_.verticalTextBoxEndIndex,_),this._updateIconDebugCollisionBoxes(l,r,a,_.iconBoxStartIndex,_.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(l,r,a,_.verticalIconBoxStartIndex,_.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(r,a,l,h,m,_,x,w,C){const M={};for(let I=a;I<l;I++){const P=r.get(I);M.textBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},M.textFeatureIndex=P.featureIndex;break}for(let I=h;I<m;I++){const P=r.get(I);M.verticalTextBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},M.verticalTextFeatureIndex=P.featureIndex;break}for(let I=_;I<x;I++){const P=r.get(I);M.iconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},M.iconFeatureIndex=P.featureIndex;break}for(let I=w;I<C;I++){const P=r.get(I);M.verticalIconBox={x1:P.x1,y1:P.y1,x2:P.x2,y2:P.y2,padding:P.padding,projectedAnchorX:P.projectedAnchorX,projectedAnchorY:P.projectedAnchorY,projectedAnchorZ:P.projectedAnchorZ,tileAnchorX:P.tileAnchorX,tileAnchorY:P.tileAnchorY},M.verticalIconFeatureIndex=P.featureIndex;break}return M}deserializeCollisionBoxes(r){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const l=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(r,l.textBoxStartIndex,l.textBoxEndIndex,l.verticalTextBoxStartIndex,l.verticalTextBoxEndIndex,l.iconBoxStartIndex,l.iconBoxEndIndex,l.verticalIconBoxStartIndex,l.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(r,a){const l=r.placedSymbolArray.get(a),h=l.vertexStartIndex+4*l.numGlyphs;for(let m=l.vertexStartIndex;m<h;m+=4)r.indexArray.emplaceBack(m,m+1,m+2),r.indexArray.emplaceBack(m+1,m+2,m+3)}getSortedSymbolIndexes(r){if(this.sortedAngle===r&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const a=Math.sin(r),l=Math.cos(r),h=[],m=[],_=[];for(let x=0;x<this.symbolInstances.length;++x){_.push(x);const w=this.symbolInstances.get(x);h.push(0|Math.round(a*w.tileAnchorX+l*w.tileAnchorY)),m.push(w.featureIndex)}return _.sort((x,w)=>h[x]-h[w]||m[w]-m[x]),_}addToSortKeyRanges(r,a){const l=this.sortKeyRanges[this.sortKeyRanges.length-1];l&&l.sortKey===a?l.symbolInstanceEnd=r+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:r,symbolInstanceEnd:r+1})}sortFeatures(r){if(this.sortFeaturesByY&&this.sortedAngle!==r&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(r),this.sortedAngle=r,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const l=this.symbolInstances.get(a);this.featureSortOrder.push(l.featureIndex),[l.rightJustifiedTextSymbolIndex,l.centerJustifiedTextSymbolIndex,l.leftJustifiedTextSymbolIndex].forEach((h,m,_)=>{h>=0&&_.indexOf(h)===m&&this.addIndicesForPlacedSymbol(this.text,h)}),l.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,l.verticalPlacedTextSymbolIndex),l.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.placedIconSymbolIndex),l.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,l.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}tt(Sl,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),Sl.MAX_GLYPHS=65535,Sl.addDynamicAttributes=rd;const Gu=new it({"symbol-placement":new ie(ye.layout_symbol["symbol-placement"]),"symbol-spacing":new ie(ye.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new ie(ye.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new ve(ye.layout_symbol["symbol-sort-key"]),"symbol-z-order":new ie(ye.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new ie(ye.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new ie(ye.layout_symbol["icon-ignore-placement"]),"icon-optional":new ie(ye.layout_symbol["icon-optional"]),"icon-rotation-alignment":new ie(ye.layout_symbol["icon-rotation-alignment"]),"icon-size":new ve(ye.layout_symbol["icon-size"]),"icon-text-fit":new ie(ye.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new ie(ye.layout_symbol["icon-text-fit-padding"]),"icon-image":new ve(ye.layout_symbol["icon-image"]),"icon-rotate":new ve(ye.layout_symbol["icon-rotate"]),"icon-padding":new ie(ye.layout_symbol["icon-padding"]),"icon-keep-upright":new ie(ye.layout_symbol["icon-keep-upright"]),"icon-offset":new ve(ye.layout_symbol["icon-offset"]),"icon-anchor":new ve(ye.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new ie(ye.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new ie(ye.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new ie(ye.layout_symbol["text-rotation-alignment"]),"text-field":new ve(ye.layout_symbol["text-field"]),"text-font":new ve(ye.layout_symbol["text-font"]),"text-size":new ve(ye.layout_symbol["text-size"]),"text-max-width":new ve(ye.layout_symbol["text-max-width"]),"text-line-height":new ve(ye.layout_symbol["text-line-height"]),"text-letter-spacing":new ve(ye.layout_symbol["text-letter-spacing"]),"text-justify":new ve(ye.layout_symbol["text-justify"]),"text-radial-offset":new ve(ye.layout_symbol["text-radial-offset"]),"text-variable-anchor":new ie(ye.layout_symbol["text-variable-anchor"]),"text-anchor":new ve(ye.layout_symbol["text-anchor"]),"text-max-angle":new ie(ye.layout_symbol["text-max-angle"]),"text-writing-mode":new ie(ye.layout_symbol["text-writing-mode"]),"text-rotate":new ve(ye.layout_symbol["text-rotate"]),"text-padding":new ie(ye.layout_symbol["text-padding"]),"text-keep-upright":new ie(ye.layout_symbol["text-keep-upright"]),"text-transform":new ve(ye.layout_symbol["text-transform"]),"text-offset":new ve(ye.layout_symbol["text-offset"]),"text-allow-overlap":new ie(ye.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new ie(ye.layout_symbol["text-ignore-placement"]),"text-optional":new ie(ye.layout_symbol["text-optional"])});var Mm={paint:new it({"icon-opacity":new ve(ye.paint_symbol["icon-opacity"]),"icon-color":new ve(ye.paint_symbol["icon-color"]),"icon-halo-color":new ve(ye.paint_symbol["icon-halo-color"]),"icon-halo-width":new ve(ye.paint_symbol["icon-halo-width"]),"icon-halo-blur":new ve(ye.paint_symbol["icon-halo-blur"]),"icon-translate":new ie(ye.paint_symbol["icon-translate"]),"icon-translate-anchor":new ie(ye.paint_symbol["icon-translate-anchor"]),"text-opacity":new ve(ye.paint_symbol["text-opacity"]),"text-color":new ve(ye.paint_symbol["text-color"],{runtimeType:Mi,getOverride:o=>o.textColor,hasOverride:o=>!!o.textColor}),"text-halo-color":new ve(ye.paint_symbol["text-halo-color"]),"text-halo-width":new ve(ye.paint_symbol["text-halo-width"]),"text-halo-blur":new ve(ye.paint_symbol["text-halo-blur"]),"text-translate":new ie(ye.paint_symbol["text-translate"]),"text-translate-anchor":new ie(ye.paint_symbol["text-translate-anchor"])}),layout:Gu};class J_{constructor(r){this.type=r.property.overrides?r.property.overrides.runtimeType:Gc,this.defaultValue=r}evaluate(r){if(r.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(r.formattedSection))return a.getOverride(r.formattedSection)}return r.feature&&r.featureState?this.defaultValue.evaluate(r.feature,r.featureState):this.defaultValue.property.specification.default}eachChild(r){this.defaultValue.isConstant()||r(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}tt(J_,"FormatSectionOverride",{omit:["defaultValue"]});class Up extends jo{constructor(r){super(r,Mm)}recalculate(r,a){super.recalculate(r,a),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const l=this.layout.get("text-writing-mode");if(l){const h=[];for(const m of l)h.indexOf(m)<0&&h.push(m);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(r,a,l,h){const m=this.layout.get(r).evaluate(a,{},l,h),_=this._unevaluatedLayout._values[r];return _.isDataDriven()||cl(_.value)||!m?m:(x=a.properties,m.replace(/{([^{}]+)}/g,(C,M)=>M in x?String(x[M]):""));var x}createBucket(r){return new Sl(r)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const r of Mm.paint.overridableProperties){if(!Up.hasPaintOverride(this.layout,r))continue;const a=this.paint.get(r),l=new J_(a),h=new eu(l,a.property.specification);let m=null;m="constant"===a.value.kind||"source"===a.value.kind?new Hr("source",h):new ul("composite",h,a.value.zoomStops,a.value._interpolationType),this.paint._values[r]=new be(a.property,m,a.parameters)}}_handleOverridablePaintPropertyUpdate(r,a,l){return!(!this.layout||a.isDataDriven()||l.isDataDriven())&&Up.hasPaintOverride(this.layout,r)}static hasPaintOverride(r,a){const l=r.get("text-field"),h=Mm.paint.properties[a];let m=!1;const _=x=>{for(const w of x)if(h.overrides&&h.overrides.hasOverride(w))return void(m=!0)};if("constant"===l.value.kind&&l.value.value instanceof ei)_(l.value.value.sections);else if("source"===l.value.kind){const x=C=>{m||(C instanceof qc&&Qn(C.value)===pa?_(C.value.sections):C instanceof Fo?_(C.sections):C.eachChild(x))},w=l.value;w._styleExpression&&x(w._styleExpression.expression)}return m}getProgramConfiguration(r){return new ps(this,r)}}var wx={paint:new it({"background-color":new ie(ye.paint_background["background-color"]),"background-pattern":new Ze(ye.paint_background["background-pattern"]),"background-opacity":new ie(ye.paint_background["background-opacity"])})},Oi={paint:new it({"raster-opacity":new ie(ye.paint_raster["raster-opacity"]),"raster-hue-rotate":new ie(ye.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new ie(ye.paint_raster["raster-brightness-min"]),"raster-brightness-max":new ie(ye.paint_raster["raster-brightness-max"]),"raster-saturation":new ie(ye.paint_raster["raster-saturation"]),"raster-contrast":new ie(ye.paint_raster["raster-contrast"]),"raster-resampling":new ie(ye.paint_raster["raster-resampling"]),"raster-fade-duration":new ie(ye.paint_raster["raster-fade-duration"])})};class Am extends jo{constructor(r){super(r,{}),this.implementation=r}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(r){this.implementation.onAdd&&this.implementation.onAdd(r,r.painter.context.gl)}onRemove(r){this.implementation.onRemove&&this.implementation.onRemove(r,r.painter.context.gl)}}var Q_={paint:new it({"sky-type":new ie(ye.paint_sky["sky-type"]),"sky-atmosphere-sun":new ie(ye.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new ie(ye.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new ie(ye.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new ie(ye.paint_sky["sky-gradient-radius"]),"sky-gradient":new Me(ye.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new ie(ye.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new ie(ye.paint_sky["sky-atmosphere-color"]),"sky-opacity":new ie(ye.paint_sky["sky-opacity"])})};function jp(o,r,a){const l=[0,0,1],h=up([]);return t_(h,h,a?-Ft(o)+Math.PI:Ft(o)),e_(h,h,-Ft(r)),zv(l,l,h),wi(l,l)}const ey={circle:class extends jo{constructor(o){super(o,Jb)}createBucket(o){return new Gg(o)}queryRadius(o){const r=o;return uc("circle-radius",this,r)+uc("circle-stroke-width",this,r)+Lh(this.paint.get("circle-translate"))}queryIntersectsFeature(o,r,a,l,h,m,_,x){const w=Ov(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),C=this.paint.get("circle-radius").evaluate(r,a)+this.paint.get("circle-stroke-width").evaluate(r,a);return Nf(o,l,m,_,x,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),w,C)}getProgramIds(){return["circle"]}getProgramConfiguration(o){return new ps(this,o)}},heatmap:class extends jo{createBucket(o){return new r_(o)}constructor(o){super(o,Vv),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"heatmap-color"===o&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=jf({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(o){return uc("heatmap-radius",this,o)}queryIntersectsFeature(o,r,a,l,h,m,_,x){const w=this.paint.get("heatmap-radius").evaluate(r,a);return Nf(o,l,m,_,x,!0,!0,new Ye(0,0),w)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(o){return new ps(this,o)}},hillshade:class extends jo{constructor(o){super(o,Uv)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends jo{constructor(o){super(o,Wf)}getProgramIds(){const o=this.paint.get("fill-pattern"),r=o&&o.constantOr(1),a=[r?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(r&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getProgramConfiguration(o){return new ps(this,o)}recalculate(o,r){super.recalculate(o,r);const a=this.paint._values["fill-outline-color"];"constant"===a.value.kind&&void 0===a.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(o){return new yp(o)}queryRadius(){return Lh(this.paint.get("fill-translate"))}queryIntersectsFeature(o,r,a,l,h,m){return!o.queryGeometry.isAboveHorizon&&qg(Rf(o.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),l)}isTileClipped(){return!0}},"fill-extrusion":class extends jo{constructor(o){super(o,Gh)}createBucket(o){return new Mu(o)}queryRadius(){return Lh(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(o){return new ps(this,o)}queryIntersectsFeature(o,r,a,l,h,m,_,x,w){const C=Ov(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),M=this.paint.get("fill-extrusion-height").evaluate(r,a),I=this.paint.get("fill-extrusion-base").evaluate(r,a),P=[0,0],F=x&&m.elevation,z=m.elevation?m.elevation.exaggeration():1,U=o.tile.getBucket(this);if(F&&U instanceof Mu){const ce=U.centroidVertexArray,se=w+1;if(se<ce.length){const pe=ce.get(se);P[0]=pe.a_centroid_pos0,P[1]=pe.a_centroid_pos1}}if(0===P[0]&&1===P[1])return!1;"globe"===m.projection.name&&(l=xp([l],[new Ye(0,0),new Ye(vt,vt)],o.tileID.canonical).map(ce=>ce.polygon).flat());const X=(se=l,pe=I,he=M,_e=C,Te=_,De=F?x:null,Pe=P,Be=z,xe=m.center.lat,"globe"===(ce=m).projection.name?function(Ne,Ue,rt,Oe,Je,At,Nt,ft,at,Gt,kt){const ct=[],br=[],jn=Ne.projection.upVectorScale(kt,Ne.center.lat,Ne.worldSize).metersToTile,sr=[0,0,0,1],jt=[0,0,0,1],nn=(pn,En,Ln,Jn)=>{pn[0]=En,pn[1]=Ln,pn[2]=Jn,pn[3]=1},Dn=em();rt>0&&(rt+=Dn),Oe+=Dn;for(const pn of Ue){const En=[],Ln=[];for(const Jn of pn){const Nr=Jn.x+Je.x,zi=Jn.y+Je.y,Wt=Ne.projection.projectTilePoint(Nr,zi,kt),ar=Ne.projection.upVector(kt,Jn.x,Jn.y);let Wr=rt,cn=Oe;if(Nt){const qn=rm(Nr,zi,rt,Oe,Nt,ft,at,Gt);Wr+=qn.base,cn+=qn.top}0!==rt?nn(sr,Wt.x+ar[0]*jn*Wr,Wt.y+ar[1]*jn*Wr,Wt.z+ar[2]*jn*Wr):nn(sr,Wt.x,Wt.y,Wt.z),nn(jt,Wt.x+ar[0]*jn*cn,Wt.y+ar[1]*jn*cn,Wt.z+ar[2]*jn*cn),ci(sr,sr,At),ci(jt,jt,At),En.push(nm(sr)),Ln.push(nm(jt))}ct.push(En),br.push(Ln)}return[ct,br]}(ce,se,pe,he,_e,Te,De,Pe,Be,xe,o.tileID.canonical):De?function(Ne,Ue,rt,Oe,Je,At,Nt,ft,at){const Gt=[],kt=[],ct=[0,0,0,1];for(const br of Ne){const jn=[],sr=[];for(const jt of br){const nn=jt.x+Oe.x,Dn=jt.y+Oe.y,pn=rm(nn,Dn,Ue,rt,At,Nt,ft,at);ct[0]=nn,ct[1]=Dn,ct[2]=pn.base,ct[3]=1,xr(ct,ct,Je),ct[3]=Math.max(ct[3],1e-5);const En=nm([ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]]);ct[0]=nn,ct[1]=Dn,ct[2]=pn.top,ct[3]=1,xr(ct,ct,Je),ct[3]=Math.max(ct[3],1e-5);const Ln=nm([ct[0]/ct[3],ct[1]/ct[3],ct[2]/ct[3]]);jn.push(En),sr.push(Ln)}Gt.push(jn),kt.push(sr)}return[Gt,kt]}(se,pe,he,_e,Te,De,Pe,Be,xe):function(Ne,Ue,rt,Oe,Je){const At=[],Nt=[],ft=Je[8]*Ue,at=Je[9]*Ue,Gt=Je[10]*Ue,kt=Je[11]*Ue,ct=Je[8]*rt,br=Je[9]*rt,jn=Je[10]*rt,sr=Je[11]*rt;for(const jt of Ne){const nn=[],Dn=[];for(const pn of jt){const En=pn.x+Oe.x,Ln=pn.y+Oe.y,Jn=Je[0]*En+Je[4]*Ln+Je[12],Nr=Je[1]*En+Je[5]*Ln+Je[13],zi=Je[2]*En+Je[6]*Ln+Je[14],Wt=Je[3]*En+Je[7]*Ln+Je[15],ar=Jn+ft,Wr=Nr+at,cn=zi+Gt,qn=Math.max(Wt+kt,1e-5),hi=Jn+ct,On=Nr+br,gr=zi+jn,Sr=Math.max(Wt+sr,1e-5),Pr=new Ye(ar/qn,Wr/qn);Pr.z=cn/qn,nn.push(Pr);const di=new Ye(hi/Sr,On/Sr);di.z=gr/Sr,Dn.push(di)}At.push(nn),Nt.push(Dn)}return[At,Nt]}(se,pe,he,_e,Te)),ee=o.queryGeometry;var ce,se,pe,he,_e,Te,De,Pe,Be,xe;return function(ce,se,pe){let he=1/0;qg(pe,se)&&(he=tm(pe,se[0]));for(let _e=0;_e<se.length;_e++){const Te=se[_e],De=ce[_e];for(let Pe=0;Pe<Te.length-1;Pe++){const Be=Te[Pe],xe=[Be,Te[Pe+1],De[Pe+1],De[Pe],Be];Rv(pe,xe)&&(he=Math.min(he,tm(pe,xe)))}}return he!==1/0&&he}(X[0],X[1],ee.isPointQuery()?ee.screenBounds:ee.screenGeometry)}},line:class extends jo{constructor(o){super(o,v_),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(o){if("line-gradient"===o){const r=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=r._styleExpression&&r._styleExpression.expression instanceof Bt,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(o,r){super.recalculate(o,r),this.paint._values["line-floorwidth"]=x_.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,o)}createBucket(o){return new qh(o)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(o){return new ps(this,o)}queryRadius(o){const r=o,a=b_(uc("line-width",this,r),uc("line-gap-width",this,r)),l=uc("line-offset",this,r);return a/2+Math.abs(l)+Lh(this.paint.get("line-translate"))}queryIntersectsFeature(o,r,a,l,h,m){if(o.queryGeometry.isAboveHorizon)return!1;const _=Rf(o.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),m.angle,o.pixelToTileUnitsFactor),x=o.pixelToTileUnitsFactor/2*b_(this.paint.get("line-width").evaluate(r,a),this.paint.get("line-gap-width").evaluate(r,a)),w=this.paint.get("line-offset").evaluate(r,a);return w&&(l=function(C,M){const I=[],P=new Ye(0,0);for(let F=0;F<C.length;F++){const z=C[F],U=[];for(let X=0;X<z.length;X++){const ee=z[X-1],ce=z[X],se=z[X+1],pe=0===X?P:ce.sub(ee)._unit()._perp(),he=X===z.length-1?P:se.sub(ce)._unit()._perp(),_e=pe._add(he)._unit();_e._mult(1/(_e.x*he.x+_e.y*he.y)),U.push(_e._mult(M)._add(ce))}I.push(U)}return I}(l,w*o.pixelToTileUnitsFactor)),function(C,M,I){for(let P=0;P<M.length;P++){const F=M[P];if(C.length>=3)for(let z=0;z<F.length;z++)if(_l(C,F[z]))return!0;if(Fv(C,F,I))return!0}return!1}(_,l,x)}isTileClipped(){return!0}},symbol:Up,background:class extends jo{constructor(o){super(o,wx)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends jo{constructor(o){super(o,Oi)}getProgramIds(){return["raster"]}},sky:class extends jo{constructor(o){super(o,Q_),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(o){"sky-gradient"===o?this._updateColorRamp():"sky-atmosphere-sun"!==o&&"sky-atmosphere-halo-color"!==o&&"sky-atmosphere-color"!==o&&"sky-atmosphere-sun-intensity"!==o||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=jf({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(o){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const r=o.style.light.properties.get("position");return this._lightPosition.azimuthal!==r.azimuthal||this._lightPosition.polar!==r.polar}return!1}getCenter(o,r){if("atmosphere"===this.paint.get("sky-type")){const l=this.paint.get("sky-atmosphere-sun"),h=!l,m=o.style.light,_=m.properties.get("position");return h&&"viewport"===m.properties.get("anchor")&&rr("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?jp(_.azimuthal,90-_.polar,r):jp(l[0],90-l[1],r)}const a=this.paint.get("sky-gradient-center");return jp(a[0],90-a[1],r)}is3D(){return!1}isSky(){return!0}markSkyboxValid(o){this._skyboxInvalidated=!1,this._lightPosition=o.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const o=this.paint.get("sky-type");return"atmosphere"===o?["skyboxCapture","skybox"]:"gradient"===o?["skyboxGradient"]:null}}};class Hu{constructor(r,a,l,h){this.context=r,this.format=l,this.texture=r.gl.createTexture(),this.update(a,h)}update(r,a,l){const{width:h,height:m}=r,{context:_}=this,{gl:x}=_,{HTMLImageElement:w,HTMLCanvasElement:C,HTMLVideoElement:M,ImageData:I,ImageBitmap:P}=Ge;if(x.bindTexture(x.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA&&(!a||!1!==a.premultiply)),l||this.size&&this.size[0]===h&&this.size[1]===m){const{x:F,y:z}=l||{x:0,y:0};r instanceof w||r instanceof C||r instanceof M||r instanceof I||P&&r instanceof P?x.texSubImage2D(x.TEXTURE_2D,0,F,z,x.RGBA,x.UNSIGNED_BYTE,r):x.texSubImage2D(x.TEXTURE_2D,0,F,z,h,m,x.RGBA,x.UNSIGNED_BYTE,r.data)}else this.size=[h,m],r instanceof w||r instanceof C||r instanceof M||r instanceof I||P&&r instanceof P?x.texImage2D(x.TEXTURE_2D,0,this.format,this.format,x.UNSIGNED_BYTE,r):x.texImage2D(x.TEXTURE_2D,0,this.format,h,m,0,this.format,x.UNSIGNED_BYTE,r.data);this.useMipmap=Boolean(a&&a.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(r,a){const{context:l}=this,{gl:h}=l;h.bindTexture(h.TEXTURE_2D,this.texture),r!==this.filter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,r),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,this.useMipmap?r===h.NEAREST?h.NEAREST_MIPMAP_NEAREST:h.LINEAR_MIPMAP_NEAREST:r),this.filter=r),a!==this.wrap&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,a),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,a),this.wrap=a)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:r}=this.context;r.deleteTexture(this.texture),this.texture=null}}class Im{constructor(r,a){this.width=r,this.height=a,this.nextRow=0,this.image=new bo({width:r,height:a}),this.positions={},this.uploaded=!1}getDash(r,a){const l=this.getKey(r,a);return this.positions[l]}trim(){const r=this.width,a=this.height=Ol(this.nextRow);this.image.resize({width:r,height:a})}getKey(r,a){return r.join(",")+a}getDashRanges(r,a,l){const h=[];let m=r.length%2==1?-r[r.length-1]*l:0,_=r[0]*l,x=!0;h.push({left:m,right:_,isDash:x,zeroLength:0===r[0]});let w=r[0];for(let C=1;C<r.length;C++){x=!x;const M=r[C];m=w*l,w+=M,_=w*l,h.push({left:m,right:_,isDash:x,zeroLength:0===M})}return h}addRoundDash(r,a,l){const h=a/2;for(let m=-l;m<=l;m++){const _=this.width*(this.nextRow+l+m);let x=0,w=r[x];for(let C=0;C<this.width;C++){C/w.right>1&&(w=r[++x]);const M=Math.abs(C-w.left),I=Math.abs(C-w.right),P=Math.min(M,I);let F;const z=m/l*(h+1);if(w.isDash){const U=h-Math.abs(z);F=Math.sqrt(P*P+U*U)}else F=h-Math.sqrt(P*P+z*z);this.image.data[_+C]=Math.max(0,Math.min(255,F+128))}}}addRegularDash(r,a){for(let w=r.length-1;w>=0;--w){const C=r[w],M=r[w+1];C.zeroLength?r.splice(w,1):M&&M.isDash===C.isDash&&(M.left=C.left,r.splice(w,1))}const l=r[0],h=r[r.length-1];l.isDash===h.isDash&&(l.left=h.left-this.width,h.right=l.right+this.width);const m=this.width*this.nextRow;let _=0,x=r[_];for(let w=0;w<this.width;w++){w/x.right>1&&(x=r[++_]);const C=Math.abs(w-x.left),M=Math.abs(w-x.right),I=Math.min(C,M);this.image.data[m+w]=Math.max(0,Math.min(255,(x.isDash?I:-I)+a+128))}}addDash(r,a){const l=this.getKey(r,a);if(this.positions[l])return this.positions[l];const h="round"===a,m=h?7:0,_=2*m+1;if(this.nextRow+_>this.height)return rr("LineAtlas out of space"),null;0===r.length&&r.push(1);let x=0;for(let M=0;M<r.length;M++)r[M]<0&&(rr("Negative value is found in line dasharray, replacing values with 0"),r[M]=0),x+=r[M];if(0!==x){const M=this.width/x,I=this.getDashRanges(r,this.width,M);h?this.addRoundDash(I,M,m):this.addRegularDash(I,"square"===a?.5*M:0)}const w=this.nextRow+m;this.nextRow+=_;const C={tl:[w,m],br:[x,0]};return this.positions[l]=C,C}}tt(Im,"LineAtlas");class Ex{constructor(r){this._callback=r,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class Cx{constructor(){this.tasks={},this.taskQueue=[],Yo(["process"],this),this.invoker=new Ex(this.process),this.nextId=0}add(r,a){const l=this.nextId++,h=function({type:m,isSymbolTile:_,zoom:x}){return x=x||0,"message"===m?0:"maybePrepare"!==m||_?"parseTile"!==m||_?"parseTile"===m&&_?300-x:"maybePrepare"===m&&_?400-x:500:200-x:100-x}(a);if(0===h){Gi();try{r()}finally{}return{cancel:()=>{}}}return this.tasks[l]={fn:r,metadata:a,priority:h,id:l},this.taskQueue.push(l),this.invoker.trigger(),{cancel:()=>{delete this.tasks[l]}}}process(){Gi();try{if(this.taskQueue=this.taskQueue.filter(l=>!!this.tasks[l]),!this.taskQueue.length)return;const r=this.pick();if(null===r)return;const a=this.tasks[r];if(delete this.tasks[r],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let r=null,a=1/0;for(let h=0;h<this.taskQueue.length;h++){const m=this.tasks[this.taskQueue[h]];m.priority<a&&(a=m.priority,r=h)}if(null===r)return null;const l=this.taskQueue[r];return this.taskQueue.splice(r,1),l}remove(){this.invoker.remove()}}class ty{constructor(r){this._stringToNumber={},this._numberToString=[];for(let a=0;a<r.length;a++){const l=r[a];this._stringToNumber[l]=a,this._numberToString[a]=l}}encode(r){return this._stringToNumber[r]}decode(r){return this._numberToString[r]}}const ny=["tile","layer","source","sourceLayer","state"];class Tx{constructor(r,a,l,h,m){this.type="Feature",this._vectorTileFeature=r,this._z=a,this._x=l,this._y=h,this.properties=r.properties,this.id=m}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(r){this._geometry=r}toJSON(){const r={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(r.id=this.id);for(const a of ny)void 0!==this[a]&&(r[a]=this[a]);return r}}const Ml=new Uint16Array(8184);for(let o=0;o<2046;o++){let r=o+2,a=0,l=0,h=0,m=0,_=0,x=0;for(1&r?h=m=_=32:a=l=x=32;(r>>=1)>1;){const C=a+h>>1,M=l+m>>1;1&r?(h=a,m=l,a=_,l=x):(a=h,l=m,h=_,m=x),_=C,x=M}const w=4*o;Ml[w+0]=a,Ml[w+1]=l,Ml[w+2]=h,Ml[w+3]=m}const Ba=new Uint16Array(2178),Tc=new Uint8Array(1089),qu=new Uint16Array(1089);function ry(o){return 0===o?-.03125:32===o?.03125:0}var Pm=st([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const km={type:2,extent:vt,loadGeometry:()=>[[new Ye(0,0),new Ye(8193,0),new Ye(8193,8193),new Ye(0,8193),new Ye(0,0)]]};class iy{constructor(r,a,l,h,m){this.tileID=r,this.uid=lo(),this.uses=0,this.tileSize=a,this.tileZoom=l,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=m,this.expiredRequestCount=0,this.state="loading",h&&h.transform&&(this.projection=h.transform.projection)}registerFadeDuration(r){const a=r+this.timeAdded;a<zn.now()||this.fadeEndTime&&a<this.fadeEndTime||(this.fadeEndTime=a)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=za(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,a,l){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=function(h,m){const _={};if(!m)return _;for(const x of h){const w=x.layerIds.map(C=>m.getLayer(C)).filter(Boolean);if(0!==w.length){x.layers=w,x.stateDependentLayerIds&&(x.stateDependentLayers=x.stateDependentLayerIds.map(C=>w.filter(M=>M.id===C)[0]));for(const C of w)_[C.id]=x}}return _}(r.buckets,a.style),this.hasSymbolBuckets=!1;for(const h in this.buckets){const m=this.buckets[h];if(m instanceof Sl){if(this.hasSymbolBuckets=!0,!l)break;m.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const h in this.buckets){const m=this.buckets[h];if(m instanceof Sl&&m.hasRTLText){this.hasRTLText=!0,Q.isLoading()||Q.isLoaded()||"deferred"!==ne()||W();break}}this.queryPadding=0;for(const h in this.buckets){const m=this.buckets[h];this.queryPadding=Math.max(this.queryPadding,a.style.getLayer(h).queryRadius(m))}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas)}else this.collisionBoxArray=new np}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(r){return this.buckets[r.id]}upload(r){for(const l in this.buckets){const h=this.buckets[l];h.uploadPending()&&h.upload(r)}const a=r.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Hu(r,this.imageAtlas.image,a.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Hu(r,this.glyphAtlasImage,a.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new Hu(r,this.lineAtlas.image,a.ALPHA),this.lineAtlas.uploaded=!0)}prepare(r){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture)}queryRenderedFeatures(r,a,l,h,m,_,x,w){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:h,pixelPosMatrix:x,transform:_,params:m,tileTransform:this.tileTransform},r,a,l):{}}querySourceFeatures(r,a){const l=this.latestFeatureIndex;if(!l||!l.rawTileData)return;const h=l.loadVTLayers(),m=a?a.sourceLayer:"",_=h._geojsonTileLayer||h[m];if(!_)return;const x=va(a&&a.filter),{z:w,x:C,y:M}=this.tileID.canonical,I={z:w,x:C,y:M};for(let P=0;P<_.length;P++){const F=_.feature(P);if(x.needGeometry){const X=vu(F,!0);if(!x.filter(new q(this.tileID.overscaledZ),X,this.tileID.canonical))continue}else if(!x.filter(new q(this.tileID.overscaledZ),F))continue;const z=l.getId(F,m),U=new Tx(F,w,C,M,z);U.tile=I,r.push(U)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(r){const a=this.expirationTime;if(r.cacheControl){const l=Jo(r.cacheControl);l["max-age"]&&(this.expirationTime=Date.now()+1e3*l["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const l=Date.now();let h=!1;if(this.expirationTime>l)h=!1;else if(a)if(this.expirationTime<a)h=!0;else{const m=this.expirationTime-a;m?this.expirationTime=l+Math.max(m,3e4):h=!0}else h=!0;h?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(r,a){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(r).length||!a)return;const l=this.latestFeatureIndex.loadVTLayers(),h=a.style.listImages();for(const m in this.buckets){if(!a.style.hasLayer(m))continue;const _=this.buckets[m],x=_.layers[0].sourceLayer||"_geojsonTileLayer",w=l[x],C=r[x];if(!w||!C||0===Object.keys(C).length)continue;if(_.update(C,w,h,this.imageAtlas&&this.imageAtlas.patternPositions||{}),_ instanceof qh||_ instanceof yp){const I=a.style._getSourceCache(_.layers[0].source);a._terrain&&a._terrain.enabled&&I&&_.programConfigurations.needsUpload&&a._terrain._clearRenderCacheForTile(I.id,this.tileID)}const M=a&&a.style&&a.style.getLayer(m);M&&(this.queryPadding=Math.max(this.queryPadding,M.queryRadius(_)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<zn.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=zn.now()+r}setTexture(r,a){const l=a.context,h=l.gl;this.texture=a.getTileTexture(r.width),this.texture?this.texture.update(r,{useMipmap:!0}):(this.texture=new Hu(l,r,h.RGBA,{useMipmap:!0}),this.texture.bind(h.LINEAR,h.CLAMP_TO_EDGE),l.extTextureFilterAnisotropic&&h.texParameterf(h.TEXTURE_2D,l.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,l.extTextureFilterAnisotropicMax))}setDependencies(r,a){const l={};for(const h of a)l[h]=!0;this.dependencies[r]=l}hasDependency(r,a){for(const l of r){const h=this.dependencies[l];if(h)for(const m of a)if(h[m])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,a){if(!a||"mercator"===a.name||this._tileDebugBuffer)return;const l=Ra(km,this.tileID.canonical,this.tileTransform)[0],h=new Dt,m=new yo;for(let _=0;_<l.length;_++){const{x,y:w}=l[_];h.emplaceBack(x,w),m.emplaceBack(_)}m.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(h,zu.members),this._tileDebugSegments=cr.simpleSegment(0,0,h.length,m.length)}_makeTileBoundsBuffers(r,a){if(this._tileBoundsBuffer||!a||"mercator"===a.name)return;const l=Ra(km,this.tileID.canonical,this.tileTransform)[0];let h,m;if(this.isRaster){const _=function(x,w){const C=za(x,w),M=Math.pow(2,x.z);for(let X=0;X<33;X++)for(let ee=0;ee<33;ee++){const ce=Zr((x.x+(ee+ry(ee))/32)/M),se=fr((x.y+(X+ry(X))/32)/M),pe=w.project(ce,se),he=33*X+ee;Ba[2*he+0]=Math.round((pe.x*C.scale-C.x)*vt),Ba[2*he+1]=Math.round((pe.y*C.scale-C.y)*vt)}Tc.fill(0),qu.fill(0);for(let X=2045;X>=0;X--){const ee=4*X,ce=Ml[ee+0],se=Ml[ee+1],pe=Ml[ee+2],he=Ml[ee+3],_e=ce+pe>>1,Te=se+he>>1,De=_e+Te-se,Pe=Te+ce-_e,Be=33*se+ce,xe=33*he+pe,Ae=33*Te+_e,Ne=Math.hypot((Ba[2*Be+0]+Ba[2*xe+0])/2-Ba[2*Ae+0],(Ba[2*Be+1]+Ba[2*xe+1])/2-Ba[2*Ae+1])>=16;if(Tc[Ae]=Tc[Ae]||(Ne?1:0),X<1022){const Ue=33*(se+Pe>>1)+(ce+De>>1),rt=33*(he+Pe>>1)+(pe+De>>1);Tc[Ae]=Tc[Ae]||Tc[Ue]||Tc[rt]}}const I=new Ct,P=new Yn;let F=0;function z(X,ee){const ce=33*ee+X;return 0===qu[ce]&&(I.emplaceBack(Ba[2*ce+0],Ba[2*ce+1],X*vt/32,ee*vt/32),qu[ce]=++F),qu[ce]-1}function U(X,ee,ce,se,pe,he){const _e=X+ce>>1,Te=ee+se>>1;if(Math.abs(X-pe)+Math.abs(ee-he)>1&&Tc[33*Te+_e])U(pe,he,X,ee,_e,Te),U(ce,se,pe,he,_e,Te);else{const De=z(X,ee),Pe=z(ce,se),Be=z(pe,he);P.emplaceBack(De,Pe,Be)}}return U(0,0,32,32,32,0),U(32,32,0,0,0,32),{vertices:I,indices:P}}(this.tileID.canonical,a);h=_.vertices,m=_.indices}else{h=new Ct,m=new Yn;for(const{x,y:w}of l)h.emplaceBack(x,w,0,0);const _=fp(h.int16,void 0,4);for(let x=0;x<_.length;x+=3)m.emplaceBack(_[x],_[x+1],_[x+2])}this._tileBoundsBuffer=r.createVertexBuffer(h,Pm.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(m),this._tileBoundsSegments=cr.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugBuffers(r,a){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!a||"globe"!==a.name)return;const l=this.tileID.canonical,h=ed(Oa(l));this._makeGlobeTileDebugBorderBuffer(r,l,h),this._makeGlobeTileDebugTextBuffer(r,l,h)}_makeGlobeTileDebugBorderBuffer(r,a,l){const h=new Dt,m=new yo,_=new ht,x=(C,M,I,P,F)=>{const z=(I-C)/(F-1),U=(P-M)/(F-1),X=h.length;for(let ee=0;ee<F;ee++){const ce=C+ee*z,se=M+ee*U;h.emplaceBack(ce,se);const pe=Pp(ce,se,a),he=ci(pe,pe,l);_.emplaceBack(he[0],he[1],he[2]),m.emplaceBack(X+ee)}},w=vt;x(0,0,w,0,16),x(w,0,w,w,16),x(w,w,0,w,16),x(0,w,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(m),this._tileDebugBuffer=r.createVertexBuffer(h,zu.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(_,H_.members),this._tileDebugSegments=cr.simpleSegment(0,0,h.length,m.length)}_makeGlobeTileDebugTextBuffer(r,a,l){const h=new Dt,m=new Yn,_=new ht,x=25;m.reserve(32),h.reserve(x),_.reserve(x);const w=(C,M)=>x*C+M;for(let C=0;C<x;C++){const M=2048*C;for(let I=0;I<x;I++){const P=2048*I;h.emplaceBack(P,M);const F=Pp(P,M,a),z=ci(F,F,l);_.emplaceBack(z[0],z[1],z[2])}}for(let C=0;C<4;C++)for(let M=0;M<4;M++){const I=w(C,M),P=w(C,M+1),F=w(C+1,M),z=w(C+1,M+1);m.emplaceBack(I,P,F),m.emplaceBack(F,P,z)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(m),this._tileDebugTextBuffer=r.createVertexBuffer(h,zu.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(_,H_.members),this._tileDebugTextSegments=cr.simpleSegment(0,0,x,32)}}class ys{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,a,l){const h=String(a);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][h]=this.stateChanges[r][h]||{},_r(this.stateChanges[r][h],l),null===this.deletedStates[r]){this.deletedStates[r]={};for(const m in this.state[r])m!==h&&(this.deletedStates[r][m]=null)}else if(this.deletedStates[r]&&null===this.deletedStates[r][h]){this.deletedStates[r][h]={};for(const m in this.state[r][h])l[m]||(this.deletedStates[r][h][m]=null)}else for(const m in l)this.deletedStates[r]&&this.deletedStates[r][h]&&null===this.deletedStates[r][h][m]&&delete this.deletedStates[r][h][m]}removeFeatureState(r,a,l){if(null===this.deletedStates[r])return;const h=String(a);if(this.deletedStates[r]=this.deletedStates[r]||{},l&&void 0!==a)null!==this.deletedStates[r][h]&&(this.deletedStates[r][h]=this.deletedStates[r][h]||{},this.deletedStates[r][h][l]=null);else if(void 0!==a)if(this.stateChanges[r]&&this.stateChanges[r][h])for(l in this.deletedStates[r][h]={},this.stateChanges[r][h])this.deletedStates[r][h][l]=null;else this.deletedStates[r][h]=null;else this.deletedStates[r]=null}getState(r,a){const l=String(a),h=_r({},(this.state[r]||{})[l],(this.stateChanges[r]||{})[l]);if(null===this.deletedStates[r])return{};if(this.deletedStates[r]){const m=this.deletedStates[r][a];if(null===m)return{};for(const _ in m)delete h[_]}return h}initializeTileState(r,a){r.setFeatureState(this.state,a)}coalesceChanges(r,a){const l={};for(const h in this.stateChanges){this.state[h]=this.state[h]||{};const m={};for(const _ in this.stateChanges[h])this.state[h][_]||(this.state[h][_]={}),_r(this.state[h][_],this.stateChanges[h][_]),m[_]=this.state[h][_];l[h]=m}for(const h in this.deletedStates){this.state[h]=this.state[h]||{};const m={};if(null===this.deletedStates[h])for(const _ in this.state[h])m[_]={},this.state[h][_]={};else for(const _ in this.deletedStates[h]){if(null===this.deletedStates[h][_])this.state[h][_]={};else for(const x of Object.keys(this.deletedStates[h][_]))delete this.state[h][_][x];m[_]=this.state[h][_]}l[h]=l[h]||{},_r(l[h],m)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(l).length)for(const h in r)r[h].setFeatureState(l,a)}}class Dx{constructor(r){this.size=r,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(r,a){const l=this.toIdx(r,a);return{min:this.minimums[l],max:this.maximums[l]}}isLeaf(r,a){return this.leaves[this.toIdx(r,a)]}toIdx(r,a){return a*this.size+r}}function Sx(o,r,a,l){let h=0,m=Number.MAX_VALUE;for(let _=0;_<3;_++)if(Math.abs(l[_])<1e-15){if(a[_]<o[_]||a[_]>r[_])return null}else{const x=1/l[_];let w=(o[_]-a[_])*x,C=(r[_]-a[_])*x;if(w>C){const M=w;w=C,C=M}if(w>h&&(h=w),C<m&&(m=C),h>m)return null}return h}function Rm(o,r,a,l,h,m,_,x,w,C,M){const I=l-o,P=h-r,F=m-a,z=_-o,U=x-r,X=w-a,ee=M[1]*X-M[2]*U,ce=M[2]*z-M[0]*X,se=M[0]*U-M[1]*z,pe=I*ee+P*ce+F*se;if(Math.abs(pe)<1e-15)return null;const he=1/pe,_e=C[0]-o,Te=C[1]-r,De=C[2]-a,Pe=(_e*ee+Te*ce+De*se)*he;if(Pe<0||Pe>1)return null;const Be=Te*F-De*P,xe=De*I-_e*F,Ae=_e*P-Te*I,Ne=(M[0]*Be+M[1]*xe+M[2]*Ae)*he;return Ne<0||Pe+Ne>1?null:(z*Be+U*xe+X*Ae)*he}function Fm(o,r,a){return(o-r)/(a-r)}function Lm(o,r,a,l,h,m,_,x,w){const C=1<<a,M=m-l,I=_-h,P=(o+1)/C*M+l,F=(r+0)/C*I+h,z=(r+1)/C*I+h;x[0]=(o+0)/C*M+l,x[1]=F,w[0]=P,w[1]=z}class oy{constructor(r){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=r,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=function(m){const _=Math.ceil(Math.log2(m.dim/8)),x=[];let w=Math.ceil(Math.pow(2,_));const C=1/w,M=(F,z,U,X,ee)=>{const ce=X?1:0,se=(F+1)*U-ce,pe=z*U,he=(z+1)*U-ce;ee[0]=F*U,ee[1]=pe,ee[2]=se,ee[3]=he};let I=new Dx(w);const P=[];for(let F=0;F<w*w;F++){M(F%w,Math.floor(F/w),C,!1,P);const z=Na(P[0],P[1],m),U=Na(P[2],P[1],m),X=Na(P[2],P[3],m),ee=Na(P[0],P[3],m);I.minimums.push(Math.min(z,U,X,ee)),I.maximums.push(Math.max(z,U,X,ee)),I.leaves.push(1)}for(x.push(I),w/=2;w>=1;w/=2){const F=x[x.length-1];I=new Dx(w);for(let z=0;z<w*w;z++){M(z%w,Math.floor(z/w),2,!0,P);const U=F.getElevation(P[0],P[1]),X=F.getElevation(P[2],P[1]),ee=F.getElevation(P[2],P[3]),ce=F.getElevation(P[0],P[3]),se=F.isLeaf(P[0],P[1]),pe=F.isLeaf(P[2],P[1]),he=F.isLeaf(P[2],P[3]),_e=F.isLeaf(P[0],P[3]),Te=Math.min(U.min,X.min,ee.min,ce.min),De=Math.max(U.max,X.max,ee.max,ce.max),Pe=se&&pe&&he&&_e;I.maximums.push(De),I.minimums.push(Te),I.leaves.push(De-Te<=5&&Pe?1:0)}x.push(I)}return x}(this.dem),l=a.length-1,h=a[l];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(a,0,0,l,0)}raycastRoot(r,a,l,h,m,_,x=1){return Sx([r,a,-100],[l,h,this.maximums[0]*x],m,_)}raycast(r,a,l,h,m,_,x=1){if(!this.nodeCount)return null;const w=this.raycastRoot(r,a,l,h,m,_,x);if(null==w)return null;const C=[],M=[],I=[],P=[],F=[{idx:0,t:w,nodex:0,nodey:0,depth:0}];for(;F.length>0;){const{idx:z,t:U,nodex:X,nodey:ee,depth:ce}=F.pop();if(this.leaves[z]){Lm(X,ee,ce,r,a,l,h,I,P);const pe=1<<ce,he=(X+0)/pe,_e=(X+1)/pe,Te=(ee+0)/pe,De=(ee+1)/pe,Pe=Na(he,Te,this.dem)*x,Be=Na(_e,Te,this.dem)*x,xe=Na(_e,De,this.dem)*x,Ae=Na(he,De,this.dem)*x,Ne=Rm(I[0],I[1],Pe,P[0],I[1],Be,P[0],P[1],xe,m,_),Ue=Rm(P[0],P[1],xe,I[0],P[1],Ae,I[0],I[1],Pe,m,_),rt=Math.min(null!==Ne?Ne:Number.MAX_VALUE,null!==Ue?Ue:Number.MAX_VALUE);if(rt!==Number.MAX_VALUE)return rt;{const Oe=cp([],m,_,U);if(Mx(Pe,Be,Ae,xe,Fm(Oe[0],I[0],P[0]),Fm(Oe[1],I[1],P[1]))>=Oe[2])return U}continue}let se=0;for(let pe=0;pe<this._siblingOffset.length;pe++){Lm((X<<1)+this._siblingOffset[pe][0],(ee<<1)+this._siblingOffset[pe][1],ce+1,r,a,l,h,I,P),I[2]=-100,P[2]=this.maximums[this.childOffsets[z]+pe]*x;const he=Sx(I,P,m,_);if(null!=he){const _e=he;C[pe]=_e;let Te=!1;for(let De=0;De<se&&!Te;De++)_e>=C[M[De]]&&(M.splice(De,0,pe),Te=!0);Te||(M[se]=pe),se++}}for(let pe=0;pe<se;pe++){const he=M[pe];F.push({idx:this.childOffsets[z]+he,t:C[he],nodex:(X<<1)+this._siblingOffset[he][0],nodey:(ee<<1)+this._siblingOffset[he][1],depth:ce+1})}}return null}_addNode(r,a,l){return this.minimums.push(r),this.maximums.push(a),this.leaves.push(l),this.childOffsets.push(0),this.nodeCount++}_construct(r,a,l,h,m){if(1===r[h].isLeaf(a,l))return;this.childOffsets[m]||(this.childOffsets[m]=this.nodeCount);const _=h-1,x=r[_];let w=0,C=0;for(let M=0;M<this._siblingOffset.length;M++){const I=2*a+this._siblingOffset[M][0],P=2*l+this._siblingOffset[M][1],F=x.getElevation(I,P),z=x.isLeaf(I,P),U=this._addNode(F.min,F.max,z);z&&(w|=1<<M),C||(C=U)}for(let M=0;M<this._siblingOffset.length;M++)w&1<<M||this._construct(r,2*a+this._siblingOffset[M][0],2*l+this._siblingOffset[M][1],_,C+M)}}function Mx(o,r,a,l,h,m){return Ht(Ht(o,a,m),Ht(r,l,m),h)}function Na(o,r,a){const l=a.dim,h=Et(o*l-.5,0,l-1),m=Et(r*l-.5,0,l-1),_=Math.floor(h),x=Math.floor(m),w=Math.min(_+1,l-1),C=Math.min(x+1,l-1);return Mx(a.get(_,x),a.get(w,x),a.get(_,C),a.get(w,C),h-_,m-x)}const Fn={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class $p{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(r,a,l,h=!1,m=!1){if(this.uid=r,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(l&&"mapbox"!==l&&"terrarium"!==l)return rr(`"${l}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2,x=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.encoding=l||"mapbox",this.borderReady=h,!h){for(let w=0;w<_;w++)x[this._idx(-1,w)]=x[this._idx(0,w)],x[this._idx(_,w)]=x[this._idx(_-1,w)],x[this._idx(w,-1)]=x[this._idx(w,0)],x[this._idx(w,_)]=x[this._idx(w,_-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(_,-1)]=x[this._idx(_-1,0)],x[this._idx(-1,_)]=x[this._idx(0,_-1)],x[this._idx(_,_)]=x[this._idx(_-1,_-1)],m&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new oy(this)}get(r,a,l=!1){l&&(r=Et(r,-1,this.dim),a=Et(a,-1,this.dim));const h=4*this._idx(r,a);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[h],this.pixels[h+1],this.pixels[h+2])}static getUnpackVector(r){return Fn[r]}get unpackVector(){return Fn[this.encoding]}_idx(r,a){if(r<-1||r>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(r+1)}_unpackMapbox(r,a,l){return(256*r*256+256*a+l)/10-1e4}_unpackTerrarium(r,a,l){return 256*r+a+l/256-32768}static pack(r,a){const l=[0,0,0,0],h=$p.getUnpackVector(a);let m=Math.floor((r+h[3])/h[2]);return l[2]=m%256,m=Math.floor(m/256),l[1]=m%256,m=Math.floor(m/256),l[0]=m,l}getPixels(){return new no({width:this.stride,height:this.stride},this.pixels)}backfillBorder(r,a,l){if(this.dim!==r.dim)throw new Error("dem dimension mismatch");let h=a*this.dim,m=a*this.dim+this.dim,_=l*this.dim,x=l*this.dim+this.dim;switch(a){case-1:h=m-1;break;case 1:m=h+1}switch(l){case-1:_=x-1;break;case 1:x=_+1}const w=-a*this.dim,C=-l*this.dim;for(let M=_;M<x;M++)for(let I=h;I<m;I++){const P=4*this._idx(I,M),F=4*this._idx(I+w,M+C);this.pixels[P+0]=r.pixels[F+0],this.pixels[P+1]=r.pixels[F+1],this.pixels[P+2]=r.pixels[F+2],this.pixels[P+3]=r.pixels[F+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}tt($p,"DEMData"),tt(oy,"DemMinMaxQuadTree",{omit:["dem"]});class Om{constructor(r,a){this.max=r,this.onRemove=a,this.reset()}reset(){for(const r in this.data)for(const a of this.data[r])a.timeout&&clearTimeout(a.timeout),this.onRemove(a.value);return this.data={},this.order=[],this}add(r,a,l){const h=r.wrapped().key;void 0===this.data[h]&&(this.data[h]=[]);const m={value:a,timeout:void 0};if(void 0!==l&&(m.timeout=setTimeout(()=>{this.remove(r,m)},l)),this.data[h].push(m),this.order.push(h),this.order.length>this.max){const _=this._getAndRemoveByKey(this.order[0]);_&&this.onRemove(_)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const a=this.data[r].shift();return a.timeout&&clearTimeout(a.timeout),0===this.data[r].length&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),a.value}getByKey(r){const a=this.data[r];return a?a[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,a){if(!this.has(r))return this;const l=r.wrapped().key,h=void 0===a?0:this.data[l].indexOf(a),m=this.data[l][h];return this.data[l].splice(h,1),m.timeout&&clearTimeout(m.timeout),0===this.data[l].length&&delete this.data[l],this.onRemove(m.value),this.order.splice(this.order.indexOf(l),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this}filter(r){const a=[];for(const l in this.data)for(const h of this.data[l])r(h.value)||a.push(h);for(const l of a)this.remove(l.value.tileID,l)}}class Zu{constructor(r,a,l){this.func=r,this.mask=a,this.range=l}}Zu.ReadOnly=!1,Zu.ReadWrite=!0,Zu.disabled=new Zu(519,Zu.ReadOnly,[0,1]);class Bm{constructor(r,a,l,h,m,_){this.test=r,this.ref=a,this.mask=l,this.fail=h,this.depthFail=m,this.pass=_}}Bm.disabled=new Bm({func:519,mask:0},0,0,7680,7680,7680);class Qs{constructor(r,a,l){this.blendFunction=r,this.blendColor=a,this.mask=l}}Qs.Replace=[1,0],Qs.disabled=new Qs(Qs.Replace,Cn.transparent,[!1,!1,!1,!1]),Qs.unblended=new Qs(Qs.Replace,Cn.transparent,[!0,!0,!0,!0]),Qs.alphaBlended=new Qs([1,771],Cn.transparent,[!0,!0,!0,!0]);class io{constructor(r,a,l){this.enable=r,this.mode=a,this.frontFace=l}}io.disabled=new io(!1,1029,2305),io.backCCW=new io(!0,1029,2305),io.backCW=new io(!0,1029,2304),io.frontCW=new io(!0,1028,2304),io.frontCCW=new io(!0,1028,2305);class qo extends gn{constructor(r,a,l){super(),this.id=r,this._onlySymbols=l,a.on("data",h=>{"source"===h.dataType&&"metadata"===h.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===h.dataType&&"content"===h.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),a.on("error",()=>{this._sourceErrored=!0}),this._source=a,this._tiles={},this._cache=new Om(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=a.minTileCacheSize,this._maxTileCacheSize=a.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new ys,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(r){this.map=r,this._minTileCacheSize=void 0===this._minTileCacheSize&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles){const a=this._tiles[r];if("loaded"!==a.state&&"errored"!==a.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,a){return r.isSymbolTile=this._onlySymbols,this._source.loadTile(r,a)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r,()=>{})}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r,()=>{})}serialize(){return this._source.serialize()}prepare(r){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const a in this._tiles){const l=this._tiles[a];this._source.prepareTile(l)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,l.tileID),l.upload(r),l.prepare(this.map.style.imageManager)}else for(const a in this._tiles){const l=this._tiles[a];l.upload(r),l.prepare(this.map.style.imageManager)}}getIds(){return kn(this._tiles).map(r=>r.tileID).sort(sy).map(r=>r.key)}getRenderableIds(r){const a=[];for(const l in this._tiles)this._isIdRenderable(+l,r)&&a.push(this._tiles[l]);return r?a.sort((l,h)=>{const m=l.tileID,_=h.tileID,x=new Ye(m.canonical.x,m.canonical.y)._rotate(this.transform.angle),w=new Ye(_.canonical.x,_.canonical.y)._rotate(this.transform.angle);return m.overscaledZ-_.overscaledZ||w.y-x.y||w.x-x.x}).map(l=>l.tileID.key):a.map(l=>l.tileID).sort(sy).map(l=>l.key)}hasRenderableParent(r){const a=this.findLoadedParent(r,0);return!!a&&this._isIdRenderable(a.tileID.key)}_isIdRenderable(r,a){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(a||!this._tiles[r].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)"errored"!==this._tiles[r].state&&this._reloadTile(+r,"reloading")}}_reloadTile(r,a){const l=this._tiles[r];l&&("loading"!==l.state&&(l.state=a),this._loadTile(l,this._tileLoaded.bind(this,l,r,a)))}_tileLoaded(r,a,l,h){if(h)if(r.state="errored",404!==h.status)this._source.fire(new Bn(h,{tile:r}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const m=this.map.painter.terrain;this.update(this.transform,m.getScaledDemTileSize(),!0),m.resetTileLookupCache(this.id)}else this.update(this.transform);else r.timeAdded=zn.now(),"expired"===l&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(a,r),"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new an("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const a=this.getRenderableIds();for(let h=0;h<a.length;h++){const m=a[h];if(r.neighboringTiles&&r.neighboringTiles[m]){const _=this.getTileByID(m);l(r,_),l(_,r)}}function l(h,m){if(!h.dem||h.dem.borderReady)return;h.needsHillshadePrepare=!0,h.needsDEMTextureUpload=!0;let _=m.tileID.canonical.x-h.tileID.canonical.x;const x=m.tileID.canonical.y-h.tileID.canonical.y,w=Math.pow(2,h.tileID.canonical.z),C=m.tileID.key;0===_&&0===x||Math.abs(x)>1||(Math.abs(_)>1&&(1===Math.abs(_+w)?_+=w:1===Math.abs(_-w)&&(_-=w)),m.dem&&h.dem&&(h.dem.backfillBorder(m.dem,_,x),h.neighboringTiles&&h.neighboringTiles[C]&&(h.neighboringTiles[C].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,a,l,h){for(const m in this._tiles){let _=this._tiles[m];if(h[m]||!_.hasData()||_.tileID.overscaledZ<=a||_.tileID.overscaledZ>l)continue;let x=_.tileID;for(;_&&_.tileID.overscaledZ>a+1;){const C=_.tileID.scaledTo(_.tileID.overscaledZ-1);_=this._tiles[C.key],_&&_.hasData()&&(x=C)}let w=x;for(;w.overscaledZ>a;)if(w=w.scaledTo(w.overscaledZ-1),r[w.key]){h[x.key]=x;break}}}findLoadedParent(r,a){if(r.key in this._loadedParentTiles){const l=this._loadedParentTiles[r.key];return l&&l.tileID.overscaledZ>=a?l:null}for(let l=r.overscaledZ-1;l>=a;l--){const h=r.scaledTo(l),m=this._getLoadedTile(h);if(m)return m}}_getLoadedTile(r){const a=this._tiles[r.key];return a&&a.hasData()?a:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,a){a=a||this._source.tileSize;const l=Math.ceil(r.width/a)+1,h=Math.ceil(r.height/a)+1,m=Math.floor(l*h*5),_="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,m):m,x="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,_):_;this._cache.setMaxSize(x)}handleWrapJump(r){const a=Math.round((r-(void 0===this._prevLng?r:this._prevLng))/360);if(this._prevLng=r,a){const l={};for(const h in this._tiles){const m=this._tiles[h];m.tileID=m.tileID.unwrapTo(m.tileID.wrap+a),l[m.tileID.key]=m}this._tiles=l;for(const h in this._timers)clearTimeout(this._timers[h]),delete this._timers[h];for(const h in this._tiles)this._setTileReloadTimer(+h,this._tiles[h])}}update(r,a,l){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!l)return;let h;this.updateCacheSize(r,a),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?h=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(x=>new Ei(x.canonical.z,x.wrap,x.canonical.z,x.canonical.x,x.canonical.y)):(h=r.coveringTiles({tileSize:a||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!l,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(h=h.filter(x=>this._source.hasTile(x)))):h=[];const m=this._updateRetainedTiles(h);if(Wu(this._source.type)&&0!==h.length){const x={},w={},C=Object.keys(m);for(const I of C){const P=m[I],F=this._tiles[I];if(!F||F.fadeEndTime&&F.fadeEndTime<=zn.now())continue;const z=this.findLoadedParent(P,Math.max(P.overscaledZ-qo.maxOverzooming,this._source.minzoom));z&&(this._addTile(z.tileID),x[z.tileID.key]=z.tileID),w[I]=P}const M=h[h.length-1].overscaledZ;for(const I in this._tiles){const P=this._tiles[I];if(m[I]||!P.hasData())continue;let F=P.tileID;for(;F.overscaledZ>M;){F=F.scaledTo(F.overscaledZ-1);const z=this._tiles[F.key];if(z&&z.hasData()&&w[F.key]){m[I]=P.tileID;break}}}for(const I in x)m[I]||(this._coveredTiles[I]=!0,m[I]=x[I])}for(const x in m)this._tiles[x].clearFadeHold();const _=function(x,w){const C=[];for(const M in x)M in w||C.push(M);return C}(this._tiles,m);for(const x of _){const w=this._tiles[x];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(+x)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const a={};if(0===r.length)return a;const l={},h=r.reduce((C,M)=>Math.min(C,M.overscaledZ),1/0),m=r[0].overscaledZ,_=Math.max(m-qo.maxOverzooming,this._source.minzoom),x=Math.max(m+qo.maxUnderzooming,this._source.minzoom),w={};for(const C of r){const M=this._addTile(C);a[C.key]=C,M.hasData()||h<this._source.maxzoom&&(w[C.key]=C)}this._retainLoadedChildren(w,h,x,a);for(const C of r){let M=this._tiles[C.key];if(M.hasData())continue;if(C.canonical.z>=this._source.maxzoom){const P=C.children(this._source.maxzoom)[0],F=this.getTile(P);if(F&&F.hasData()){a[P.key]=P;continue}}else{const P=C.children(this._source.maxzoom);if(a[P[0].key]&&a[P[1].key]&&a[P[2].key]&&a[P[3].key])continue}let I=M.wasRequested();for(let P=C.overscaledZ-1;P>=_;--P){const F=C.scaledTo(P);if(l[F.key]||(l[F.key]=!0,M=this.getTile(F),!M&&I&&(M=this._addTile(F)),M&&(a[F.key]=F,I=M.wasRequested(),M.hasData())))break}}return a}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const a=[];let l,h=this._tiles[r].tileID;for(;h.overscaledZ>0;){if(h.key in this._loadedParentTiles){l=this._loadedParentTiles[h.key];break}a.push(h.key);const m=h.scaledTo(h.overscaledZ-1);if(l=this._getLoadedTile(m),l)break;h=m}for(const m of a)this._loadedParentTiles[m]=l}}_addTile(r){let a=this._tiles[r.key];if(a)return this._source.prepareTile&&this._source.prepareTile(a),a;a=this._cache.getAndRemove(r),a&&(this._setTileReloadTimer(r.key,a),a.tileID=r,this._state.initializeTileState(a,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,a)));const l=Boolean(a);if(!l){const h=this.map?this.map.painter:null;a=new iy(r,this._source.tileSize*r.overscaleFactor(),this.transform.tileZoom,h,this._isRaster),this._source.prepareTile&&this._source.prepareTile(a)||this._loadTile(a,this._tileLoaded.bind(this,a,r.key,a.state))}return a?(a.uses++,this._tiles[r.key]=a,l||this._source.fire(new an("dataloading",{tile:a,coord:a.tileID,dataType:"source"})),a):null}_setTileReloadTimer(r,a){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const l=a.getExpiryTimeout();l&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},l))}_removeTile(r){const a=this._tiles[r];a&&(a.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),a.uses>0||(a.hasData()&&"reloading"!==a.state?this._cache.add(a.tileID,a,a.getExpiryTimeout()):(a.aborted=!0,this._abortTile(a),this._unloadTile(a))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,a,l){const h=[],m=this.transform;if(!m)return h;const _="globe"===m.projection.name,x=lc(m.center.lng);for(const w in this._tiles){const C=this._tiles[w];if(l&&C.clearQueryDebugViz(),C.holdingForFade())continue;let M;if(_){const I=C.tileID.canonical;if(0===I.z){const P=[Math.abs(Et(x,...id(I,-1))-x),Math.abs(Et(x,...id(I,1))-x)];M=[0,2*P.indexOf(Math.min(...P))-1]}else{const P=[Math.abs(Et(x,...id(I,-1))-x),Math.abs(Et(x,...id(I,0))-x),Math.abs(Et(x,...id(I,1))-x)];M=[P.indexOf(Math.min(...P))-1]}}else M=[0];for(const I of M){const P=r.containsTile(C,m,a,I);P&&h.push(P)}}return h}getVisibleCoordinates(r){const a=this.getRenderableIds(r).map(l=>this._tiles[l].tileID);for(const l of a)l.projMatrix=this.transform.calculateProjMatrix(l.toUnwrapped());return a}hasTransition(){if(this._source.hasTransition())return!0;if(Wu(this._source.type))for(const r in this._tiles){const a=this._tiles[r];if(void 0!==a.fadeEndTime&&a.fadeEndTime>=zn.now())return!0}return!1}setFeatureState(r,a,l){this._state.updateState(r=r||"_geojsonTileLayer",a,l)}removeFeatureState(r,a,l){this._state.removeFeatureState(r=r||"_geojsonTileLayer",a,l)}getFeatureState(r,a){return this._state.getState(r=r||"_geojsonTileLayer",a)}setDependencies(r,a,l){const h=this._tiles[r];h&&h.setDependencies(a,l)}reloadTilesForDependencies(r,a){for(const l in this._tiles)this._tiles[l].hasDependency(r,a)&&this._reloadTile(+l,"reloading");this._cache.filter(l=>!l.hasDependency(r,a))}_preloadTiles(r,a){const l=new Map,h=Array.isArray(r)?r:[r],m=this.map.painter.terrain,_=this.usedForTerrain&&m?m.getScaledDemTileSize():this._source.tileSize;for(const x of h){const w=x.coveringTiles({tileSize:_,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const C of w)l.set(C.key,C);this.usedForTerrain&&x.updateElevation(!1)}Xo(Array.from(l.values()),(x,w)=>{const C=new iy(x,this._source.tileSize*x.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(C,M=>{"raster-dem"===this._source.type&&C.dem&&this._backfillDEM(C),w(M,C)})},a)}}function sy(o,r){const a=Math.abs(2*o.wrap)-+(o.wrap<0),l=Math.abs(2*r.wrap)-+(r.wrap<0);return o.overscaledZ-r.overscaledZ||l-a||r.canonical.y-o.canonical.y||r.canonical.x-o.canonical.x}function Wu(o){return"raster"===o||"image"===o||"video"===o}function id(o,r){const a=1<<o.z;return[o.x/a+r,(o.x+1)/a+r]}qo.maxOverzooming=10,qo.maxUnderzooming=3;class Gp{constructor(r,a,l){this._demTile=r,this._dem=this._demTile.dem,this._scale=a,this._offset=l}static create(r,a,l){const h=l||r.findDEMTileFor(a);if(!h||!h.dem)return;const m=h.dem,_=h.tileID,x=1<<a.canonical.z-_.canonical.z;return new Gp(h,h.tileSize/vt/x,[(a.canonical.x/x-_.canonical.x)*m.dim,(a.canonical.y/x-_.canonical.y)*m.dim])}tileCoordToPixel(r,a){const l=a*this._scale+this._offset[1],h=Math.floor(r*this._scale+this._offset[0]),m=Math.floor(l);return new Ye(h,m)}getElevationAt(r,a,l,h){const m=r*this._scale+this._offset[0],_=a*this._scale+this._offset[1],x=Math.floor(m),w=Math.floor(_),C=this._dem;return h=!!h,l?Ht(Ht(C.get(x,w,h),C.get(x,w+1,h),_-w),Ht(C.get(x+1,w,h),C.get(x+1,w+1,h),_-w),m-x):C.get(x,w,h)}getElevationAtPixel(r,a,l){return this._dem.get(r,a,!!l)}getMeterToDEM(r){return(1<<this._demTile.tileID.canonical.z)*Ri(1,r)*this._dem.stride}}class Hp{constructor(r,a){this.tileID=r,this.x=r.canonical.x,this.y=r.canonical.y,this.z=r.canonical.z,this.grid=new wa(vt,16,0),this.featureIndexArray=new Th,this.promoteId=a}insert(r,a,l,h,m,_=0){const x=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(l,h,m,_);const w=this.grid;for(let C=0;C<a.length;C++){const M=a[C],I=[1/0,1/0,-1/0,-1/0];for(let P=0;P<M.length;P++){const F=M[P];I[0]=Math.min(I[0],F.x),I[1]=Math.min(I[1],F.y),I[2]=Math.max(I[2],F.x),I[3]=Math.max(I[3],F.y)}I[0]<vt&&I[1]<vt&&I[2]>=0&&I[3]>=0&&w.insert(x,I[0],I[1],I[2],I[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new wl.VectorTile(new bp(this.rawTileData)).layers,this.sourceLayerCoder=new ty(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const r in this.vtLayers)this.vtFeatures[r]=[]}return this.vtLayers}query(r,a,l,h){this.loadVTLayers();const m=r.params||{},_=va(m.filter),x=r.tileResult,w=r.transform,C=x.bufferedTilespaceBounds,M=this.grid.query(C.min.x,C.min.y,C.max.x,C.max.y,(z,U,X,ee)=>ms(x.bufferedTilespaceGeometry,z,U,X,ee));M.sort(od);let I=null;w.elevation&&M.length>0&&(I=Gp.create(w.elevation,this.tileID));const P={};let F;for(let z=0;z<M.length;z++){const U=M[z];if(U===F)continue;F=U;const X=this.featureIndexArray.get(U);let ee=null;this.loadMatchingFeature(P,X,_,m.layers,m.availableImages,a,l,h,(ce,se,pe,he=0)=>(ee||(ee=Ra(ce,this.tileID.canonical,r.tileTransform)),se.queryIntersectsFeature(x,ce,pe,ee,this.z,r.transform,r.pixelPosMatrix,I,he)))}return P}loadMatchingFeature(r,a,l,h,m,_,x,w,C){const{featureIndex:M,bucketIndex:I,sourceLayerIndex:P,layoutVertexArrayOffset:F}=a,z=this.bucketLayerIDs[I];if(h&&!function(ce,se){for(let pe=0;pe<ce.length;pe++)if(se.indexOf(ce[pe])>=0)return!0;return!1}(h,z))return;const U=this.sourceLayerCoder.decode(P),X=this.vtLayers[U].feature(M);if(l.needGeometry){const ce=vu(X,!0);if(!l.filter(new q(this.tileID.overscaledZ),ce,this.tileID.canonical))return}else if(!l.filter(new q(this.tileID.overscaledZ),X))return;const ee=this.getId(X,U);for(let ce=0;ce<z.length;ce++){const se=z[ce];if(h&&h.indexOf(se)<0)continue;const pe=_[se];if(!pe)continue;let he={};void 0!==ee&&w&&(he=w.getState(pe.sourceLayer||"_geojsonTileLayer",ee));const _e=_r({},x[se]);_e.paint=vs(_e.paint,pe.paint,X,he,m),_e.layout=vs(_e.layout,pe.layout,X,he,m);const Te=!C||C(X,pe,he,F);if(!Te)continue;const De=new Tx(X,this.z,this.x,this.y,ee);De.layer=_e;let Pe=r[se];void 0===Pe&&(Pe=r[se]=[]),Pe.push({featureIndex:M,feature:De,intersectionZ:Te})}}lookupSymbolFeatures(r,a,l,h,m,_,x,w){const C={};this.loadVTLayers();const M=va(m);for(const I of r)this.loadMatchingFeature(C,{bucketIndex:l,sourceLayerIndex:h,featureIndex:I,layoutVertexArrayOffset:0},M,_,x,w,a);return C}loadFeature(r){const{featureIndex:a,sourceLayerIndex:l}=r;this.loadVTLayers();const h=this.sourceLayerCoder.decode(l),m=this.vtFeatures[h];if(m[a])return m[a];const _=this.vtLayers[h].feature(a);return m[a]=_,_}hasLayer(r){for(const a of this.bucketLayerIDs)for(const l of a)if(r===l)return!0;return!1}getId(r,a){let l=r.id;return this.promoteId&&(l=r.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[a]],"boolean"==typeof l&&(l=Number(l))),l}}function vs(o,r,a,l,h){return Vt(o,(m,_)=>{const x=r instanceof Ve?r.get(_):null;return x&&x.evaluate?x.evaluate(a,l,h):x})}function od(o,r){return r-o}tt(Hp,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class ui{constructor(r){const a={},l=[];for(const x in r){const w=r[x],C=a[x]={};for(const M in w.glyphs){const I=w.glyphs[+M];if(!I||0===I.bitmap.width||0===I.bitmap.height)continue;const P=I.metrics.localGlyph?2:1,F={x:0,y:0,w:I.bitmap.width+2*P,h:I.bitmap.height+2*P};l.push(F),C[M]=F}}const{w:h,h:m}=A_(l),_=new bo({width:h||1,height:m||1});for(const x in r){const w=r[x];for(const C in w.glyphs){const M=w.glyphs[+C];if(!M||0===M.bitmap.width||0===M.bitmap.height)continue;const I=a[x][C],P=M.metrics.localGlyph?2:1;bo.copy(M.bitmap,_,{x:0,y:0},{x:I.x+P,y:I.y+P},M.bitmap)}}this.image=_,this.positions=a}}tt(ui,"GlyphAtlas");class Dc{constructor(r){this.tileID=new Ei(r.tileID.overscaledZ,r.tileID.wrap,r.tileID.canonical.z,r.tileID.canonical.x,r.tileID.canonical.y),this.tileZoom=r.tileZoom,this.uid=r.uid,this.zoom=r.zoom,this.canonical=r.tileID.canonical,this.pixelRatio=r.pixelRatio,this.tileSize=r.tileSize,this.source=r.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=r.showCollisionBoxes,this.collectResourceTiming=!!r.collectResourceTiming,this.returnDependencies=!!r.returnDependencies,this.promoteId=r.promoteId,this.enableTerrain=!!r.enableTerrain,this.isSymbolTile=r.isSymbolTile,this.tileTransform=za(r.tileID.canonical,r.projection),this.projection=r.projection}parse(r,a,l,h,m){this.status="parsing",this.data=r,this.collisionBoxArray=new np;const _=new ty(Object.keys(r.layers).sort()),x=new Hp(this.tileID,this.promoteId);x.bucketLayerIDs=[];const w={},C=new Im(256,256),M={featureIndex:x,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:C,availableImages:l},I=a.familiesBySource[this.source];for(const he in I){const _e=r.layers[he];if(!_e)continue;let Te=!1,De=!1;for(const xe of I[he])"symbol"===xe[0].type?Te=!0:De=!0;if(!0===this.isSymbolTile&&!Te||!1===this.isSymbolTile&&!De)continue;1===_e.version&&rr(`Vector tile source "${this.source}" layer "${he}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Pe=_.encode(he),Be=[];for(let xe=0;xe<_e.length;xe++){const Ae=_e.feature(xe),Ne=x.getId(Ae,he);Be.push({feature:Ae,id:Ne,index:xe,sourceLayerIndex:Pe})}for(const xe of I[he]){const Ae=xe[0];void 0!==this.isSymbolTile&&"symbol"===Ae.type!==this.isSymbolTile||Ae.minzoom&&this.zoom<Math.floor(Ae.minzoom)||Ae.maxzoom&&this.zoom>=Ae.maxzoom||"none"!==Ae.visibility&&(Xu(xe,this.zoom,l),(w[Ae.id]=Ae.createBucket({index:x.bucketLayerIDs.length,layers:xe,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Pe,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.spec,availableImages:l})).populate(Be,M,this.tileID.canonical,this.tileTransform),x.bucketLayerIDs.push(xe.map(Ne=>Ne.id)))}}let P,F,z,U;C.trim();const X={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},ee=Vt(M.glyphDependencies,he=>Object.keys(he).map(Number));Object.keys(ee).length?h.send("getGlyphs",{uid:this.uid,stacks:ee},(he,_e)=>{P||(P=he,F=_e,pe.call(this))},void 0,!1,X):F={};const ce=Object.keys(M.iconDependencies);ce.length?h.send("getImages",{icons:ce,source:this.source,tileID:this.tileID,type:"icons"},(he,_e)=>{P||(P=he,z=_e,pe.call(this))},void 0,!1,X):z={};const se=Object.keys(M.patternDependencies);function pe(){if(P)return m(P);if(F&&z&&U){const he=new ui(F),_e=new hx(z,U);for(const Te in w){const De=w[Te];De instanceof Sl?(Xu(De.layers,this.zoom,l),s1(De,F,he.positions,z,_e.iconPositions,this.showCollisionBoxes,l,this.tileID.canonical,this.tileZoom,this.projection)):De.hasPattern&&(De instanceof qh||De instanceof yp||De instanceof Mu)&&(Xu(De.layers,this.zoom,l),De.addFeatures(M,this.tileID.canonical,_e.patternPositions,l,this.tileTransform))}this.status="done",m(null,{buckets:kn(w).filter(Te=>!Te.isEmpty()),featureIndex:x,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:he.image,lineAtlas:C,imageAtlas:_e,glyphMap:this.returnDependencies?F:null,iconMap:this.returnDependencies?z:null,glyphPositions:this.returnDependencies?he.positions:null})}}se.length?h.send("getImages",{icons:se,source:this.source,tileID:this.tileID,type:"patterns"},(he,_e)=>{P||(P=he,U=_e,pe.call(this))},void 0,!1,X):U={},pe.call(this)}}function Xu(o,r,a){const l=new q(r);for(const h of o)h.recalculate(l,a)}class Do{constructor(r){this.entries={},this.scheduler=r}request(r,a,l,h){const m=this.entries[r]=this.entries[r]||{callbacks:[]};if(m.result){const[_,x]=m.result;return this.scheduler?this.scheduler.add(()=>{h(_,x)},a):h(_,x),()=>{}}return m.callbacks.push(h),m.cancel||(m.cancel=l((_,x)=>{m.result=[_,x];for(const w of m.callbacks)this.scheduler?this.scheduler.add(()=>{w(_,x)},a):w(_,x);setTimeout(()=>delete this.entries[r],3e3)})),()=>{m.result||(m.callbacks=m.callbacks.filter(_=>_!==h),m.callbacks.length||(m.cancel(),delete this.entries[r]))}}}function xs(o,r,a){const l=JSON.stringify(o.request);return o.data&&(this.deduped.entries[l]={result:[null,o.data]}),this.deduped.request(l,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom},h=>{const m=me(o.request,(_,x,w,C)=>{_?h(_):x&&h(null,{vectorTile:a?void 0:new wl.VectorTile(new bp(x)),rawData:x,cacheControl:w,expires:C})});return()=>{m.cancel(),h()}},r)}d.ARRAY_TYPE=bi,d.AUTH_ERR_MSG=Or,d.Aabb=xo,d.Actor=class{constructor(o,r,a){this.target=o,this.parent=r,this.mapId=a,this.callbacks={},this.cancelCallbacks={},Yo(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=Gi()?o:Ge,this.scheduler=new Cx}send(o,r,a,l,h=!1,m){const _=Math.round(1e18*Math.random()).toString(36).substring(0,10);a&&(a.metadata=m,this.callbacks[_]=a);const x=ca(this.globalScope)?void 0:[];return this.target.postMessage({id:_,type:o,hasCallback:!!a,targetMapId:l,mustQueue:h,sourceMapId:this.mapId,data:Tr(r,x)},x),{cancel:()=>{a&&delete this.callbacks[_],this.target.postMessage({id:_,type:"<cancel>",targetMapId:l,sourceMapId:this.mapId})}}}receive(o){const r=o.data,a=r.id;if(a&&(!r.targetMapId||this.mapId===r.targetMapId))if("<cancel>"===r.type){const l=this.cancelCallbacks[a];delete this.cancelCallbacks[a],l&&l.cancel()}else if(r.mustQueue||Gi()){const l=this.callbacks[a];this.cancelCallbacks[a]=this.scheduler.add(()=>this.processTask(a,r),l&&l.metadata||{type:"message"})}else this.processTask(a,r)}processTask(o,r){if("<response>"===r.type){const a=this.callbacks[o];delete this.callbacks[o],a&&(r.error?a(eo(r.error)):a(null,eo(r.data)))}else{const a=ca(this.globalScope)?void 0:[],l=r.hasCallback?(m,_)=>{delete this.cancelCallbacks[o],this.target.postMessage({id:o,type:"<response>",sourceMapId:this.mapId,error:m?Tr(m):null,data:Tr(_,a)},a)}:m=>{},h=eo(r.data);if(this.parent[r.type])this.parent[r.type](r.sourceMapId,h,l);else if(this.parent.getWorkerSource){const m=r.type.split(".");this.parent.getWorkerSource(r.sourceMapId,m[0],h.source)[m[1]](h,l)}else l(new Error(`Could not find function ${r.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},d.CanonicalTileID=Hh,d.Color=Cn,d.ColorMode=Qs,d.CullFaceMode=io,d.DEMData=$p,d.DataConstantProperty=ie,d.DedupedRequest=Do,d.DepthMode=Zu,d.EXTENT=vt,d.Elevation=class{isDataAvailableAtPoint(o){const r=this._source();if(!r||o.y<0||o.y>1)return!1;const a=r.getSource().maxzoom,l=1<<a,h=Math.floor(o.x),m=Math.floor((o.x-h)*l),_=Math.floor(o.y*l),x=this.findDEMTileFor(new Ei(a,h,a,m,_));return!(!x||!x.dem)}getAtPointOrZero(o,r=0){return this.getAtPoint(o,r)||0}getAtPoint(o,r,a=!0){null==r&&(r=null);const l=this._source();if(!l||o.y<0||o.y>1)return r;const h=l.getSource().maxzoom,m=1<<h,_=Math.floor(o.x),x=o.x-_,w=new Ei(h,_,h,Math.floor(x*m),Math.floor(o.y*m)),C=this.findDEMTileFor(w);if(!C||!C.dem)return r;const M=C.dem,I=1<<C.tileID.canonical.z,P=(x*I-C.tileID.canonical.x)*M.dim,F=(o.y*I-C.tileID.canonical.y)*M.dim,z=Math.floor(P),U=Math.floor(F);return(a?this.exaggeration():1)*Ht(Ht(M.get(z,U),M.get(z,U+1),F-U),Ht(M.get(z+1,U),M.get(z+1,U+1),F-U),P-z)}getAtTileOffset(o,r,a){const l=1<<o.canonical.z;return this.getAtPointOrZero(new cc(o.wrap+(o.canonical.x+r/vt)/l,(o.canonical.y+a/vt)/l))}getAtTileOffsetFunc(o,r,a,l){return h=>{const m=this.getAtTileOffset(o,h.x,h.y),_=l.upVector(o.canonical,h.x,h.y);return qs(_,_,m*l.upVectorScale(o.canonical,r,a).metersToTile),_}}getForTilePoints(o,r,a,l){const h=Gp.create(this,o,l);return!!h&&(r.forEach(m=>{m[2]=this.exaggeration()*h.getElevationAt(m[0],m[1],a)}),!0)}getMinMaxForTile(o){const r=this.findDEMTileFor(o);if(!r||!r.dem)return null;const a=r.dem.tree,l=r.tileID,h=1<<o.canonical.z-l.canonical.z;let m=o.canonical.x/h-l.canonical.x,_=o.canonical.y/h-l.canonical.y,x=0;for(let w=0;w<o.canonical.z-l.canonical.z&&!a.leaves[x];w++){m*=2,_*=2;const C=2*Math.floor(_)+Math.floor(m);x=a.childOffsets[x]+C,m%=1,_%=1}return{min:this.exaggeration()*a.minimums[x],max:this.exaggeration()*a.maximums[x]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(o,r,a){throw new Error("Pure virtual method called.")}pointCoordinate(o){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(o){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},d.ErrorEvent=Bn,d.EvaluationParameters=q,d.Event=an,d.Evented=gn,d.FillExtrusionBucket=Mu,d.Frustum=dp,d.FrustumCorners=Bf,d.GLOBE_METERS_TO_ECEF=gm,d.GLOBE_RADIUS=Ec,d.GLOBE_SCALE_MATCH_LATITUDE=45,d.GLOBE_ZOOM_THRESHOLD_MAX=6,d.GLOBE_ZOOM_THRESHOLD_MIN=5,d.GlobeSharedBuffers=class{constructor(o){this._createGrid(o),this._createPoles(o)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const o of this._poleSegments)o.destroy();for(const o of this._gridSegments)o.destroy();if(this._wireframeIndexBuffer){this._wireframeIndexBuffer.destroy();for(const o of this._wireframeSegments)o.destroy()}}_createGrid(o){const r=new Dt,a=new Yn,l=65;for(let h=0;h<l;h++)for(let m=0;m<l;m++)r.emplaceBack(m,h);this._gridSegments=[];for(let h=0,m=0;h<Cc.length;h++){const _=Cc[h];for(let w=0;w<_;w++)for(let C=0;C<64;C++){const M=w*l+C;a.emplaceBack(M+1,M,M+l),a.emplaceBack(M+l,M+l+1,M+1)}const x=64*_*2;this._gridSegments.push(cr.simpleSegment(0,m,(_+1)*l,x)),m+=x}this._gridBuffer=o.createVertexBuffer(r,zu.members),this._gridIndexBuffer=o.createIndexBuffer(a,!0)}_createPoles(o){const r=new Yn;for(let h=0;h<=64;h++)r.emplaceBack(0,h+1,h+2);this._poleIndexBuffer=o.createIndexBuffer(r,!0);const a=new Aa,l=new Aa;this._poleSegments=[];for(let h=0,m=0;h<5;h++){const _=1<<h,x=512*_/Math.PI/2,w=360/_;a.emplaceBack(0,-x,0,0,0,.5,0),l.emplaceBack(0,-x,0,0,0,.5,1);for(let C=0;C<=64;C++){const M=C/64,I=Ht(0,w,M),[P,F,z]=Z_(W_,a1,I,x);a.emplaceBack(P,F,z,0,0,M,0),l.emplaceBack(P,F,z,0,0,M,1)}this._poleSegments.push(cr.simpleSegment(m,0,66,64)),m+=66}this._poleNorthVertexBuffer=o.createVertexBuffer(a,mm,!1),this._poleSouthVertexBuffer=o.createVertexBuffer(l,mm,!1)}getGridBuffers(o){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments[o]]}getPoleBuffers(o){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[o]]}getWirefameBuffers(o,r){if(!this._wireframeSegments){const a=new to,l=64,h=l+1;this._wireframeSegments=[];for(let m=0,_=0;m<Cc.length;m++){const x=Cc[m];for(let C=0;C<x;C++)for(let M=0;M<l;M++){const I=C*h+M;a.emplaceBack(I,I+1),a.emplaceBack(I,I+h),a.emplaceBack(I,I+h+1)}const w=x*l*3;this._wireframeSegments.push(cr.simpleSegment(0,_,(x+1)*h,w)),_+=w}this._wireframeIndexBuffer=o.createIndexBuffer(a)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments[r]]}},d.GlyphManager=Tl,d.ImagePosition=I_,d.LineAtlas=Im,d.LngLat=dn,d.LngLatBounds=gl,d.LocalGlyphMode=Kh,d.MAX_MERCATOR_LATITUDE=fs,d.MercatorCoordinate=cc,d.ONE_EM=24,d.OverscaledTileID=Ei,d.Properties=it,d.RGBAImage=no,d.Ray=hp,d.RequestManager=class{constructor(o,r,a){this._transformRequestFn=o,this._customAccessToken=r,this._silenceAuthErrors=!!a,this._createSkuToken()}_createSkuToken(){const o=function(){let r="";for(let a=0;a<10;a++)r+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Vc,r].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(o,r){return this._transformRequestFn&&this._transformRequestFn(o,r)||{url:o}}normalizeStyleURL(o,r){if(!Hi(o))return o;const a=Di(o);return a.path=`/styles/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeGlyphsURL(o,r){if(!Hi(o))return o;const a=Di(o);return a.path=`/fonts/v1${a.path}`,this._makeAPIURL(a,this._customAccessToken||r)}normalizeSourceURL(o,r,a,l){if(!Hi(o))return o;const h=Di(o);return h.path=`/v4/${h.authority}.json`,h.params.push("secure"),a&&h.params.push(`language=${a}`),l&&h.params.push(`worldview=${l}`),this._makeAPIURL(h,this._customAccessToken||r)}normalizeSpriteURL(o,r,a,l){const h=Di(o);return Hi(o)?(h.path=`/styles/v1${h.path}/sprite${r}${a}`,this._makeAPIURL(h,this._customAccessToken||l)):(h.path+=`${r}${a}`,ns(h))}normalizeTileURL(o,r,a){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!Hi(o))return o;const l=Di(o);l.path=l.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${r||a&&"raster"!==l.authority&&512===a?"@2x":""}${Ro.supported?".webp":"$1"}`),"raster"===l.authority?l.path=`/${tn.RASTER_URL_PREFIX}${l.path}`:(l.path=l.path.replace(/^.+\/v4\//,"/"),l.path=`/${tn.TILE_URL_VERSION}${l.path}`);const h=this._customAccessToken||function(m){for(const _ of m){const x=_.match(/^access_token=(.*)$/);if(x)return x[1]}return null}(l.params)||tn.ACCESS_TOKEN;return tn.REQUIRE_ACCESS_TOKEN&&h&&this._skuToken&&l.params.push(`sku=${this._skuToken}`),this._makeAPIURL(l,h)}canonicalizeTileURL(o,r){const a=Di(o);if(!a.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!a.path.match(/\.[\w]+$/))return o;let l="mapbox://";a.path.match(/^\/raster\/v1\//)?l+=`raster/${a.path.replace(`/${tn.RASTER_URL_PREFIX}/`,"")}`:l+=`tiles/${a.path.replace(`/${tn.TILE_URL_VERSION}/`,"")}`;let h=a.params;return r&&(h=h.filter(m=>!m.match(/^access_token=/))),h.length&&(l+=`?${h.join("&")}`),l}canonicalizeTileset(o,r){const a=!!r&&Hi(r),l=[];for(const h of o.tiles||[])da(h)?l.push(this.canonicalizeTileURL(h,a)):l.push(h);return l}_makeAPIURL(o,r){const a="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",l=Di(tn.API_URL);if(o.protocol=l.protocol,o.authority=l.authority,"http"===o.protocol){const h=o.params.indexOf("secure");h>=0&&o.params.splice(h,1)}if("/"!==l.path&&(o.path=`${l.path}${o.path}`),!tn.REQUIRE_ACCESS_TOKEN)return ns(o);if(r=r||tn.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error(`An API access token is required to use Mapbox GL. ${a}`);if("s"===r[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${a}`)}return o.params=o.params.filter(h=>-1===h.indexOf("access_token")),o.params.push(`access_token=${r||""}`),ns(o)}},d.ResourceType=K,d.SegmentVector=cr,d.SourceCache=qo,d.StencilMode=Bm,d.StructArrayLayout1ui2=yo,d.StructArrayLayout2f1f2i16=pr,d.StructArrayLayout2i4=Dt,d.StructArrayLayout2ui4=to,d.StructArrayLayout3f12=Qt,d.StructArrayLayout3ui6=Yn,d.StructArrayLayout4i8=Ct,d.StructArrayLayout5f20=Us,d.Texture=Hu,d.Tile=iy,d.Transitionable=re,d.Uniform1f=pu,d.Uniform1i=class extends Ia{constructor(o,r){super(o,r),this.current=0}set(o){this.current!==o&&(this.current=o,this.gl.uniform1i(this.location,o))}},d.Uniform2f=class extends Ia{constructor(o,r){super(o,r),this.current=[0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]||(this.current=o,this.gl.uniform2f(this.location,o[0],o[1]))}},d.Uniform3f=class extends Ia{constructor(o,r){super(o,r),this.current=[0,0,0]}set(o){o[0]===this.current[0]&&o[1]===this.current[1]&&o[2]===this.current[2]||(this.current=o,this.gl.uniform3f(this.location,o[0],o[1],o[2]))}},d.Uniform4f=fu,d.UniformColor=Ug,d.UniformMatrix2f=class extends Ia{constructor(o,r){super(o,r),this.current=op}set(o){for(let r=0;r<4;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix2fv(this.location,!1,o);break}}},d.UniformMatrix3f=class extends Ia{constructor(o,r){super(o,r),this.current=Mv}set(o){for(let r=0;r<9;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix3fv(this.location,!1,o);break}}},d.UniformMatrix4f=class extends Ia{constructor(o,r){super(o,r),this.current=Sv}set(o){if(o[12]!==this.current[12]||o[0]!==this.current[0])return this.current=o,void this.gl.uniformMatrix4fv(this.location,!1,o);for(let r=1;r<16;r++)if(o[r]!==this.current[r]){this.current=o,this.gl.uniformMatrix4fv(this.location,!1,o);break}}},d.UnwrappedTileID=__,d.ValidationError=nt,d.VectorTileWorkerSource=class extends gn{constructor(o,r,a,l,h){super(),this.actor=o,this.layerIndex=r,this.availableImages=a,this.loadVectorData=h||xs,this.loading={},this.loaded={},this.deduped=new Do(o.scheduler),this.isSpriteLoaded=l,this.scheduler=o.scheduler}loadTile(o,r){const a=o.uid,l=o&&o.request,h=l&&l.collectResourceTiming,m=this.loading[a]=new Dc(o);m.abort=this.loadVectorData(o,(_,x)=>{const w=!this.loading[a];if(delete this.loading[a],w||_||!x)return m.status="done",w||(this.loaded[a]=m),r(_);const C=x.rawData,M={};x.expires&&(M.expires=x.expires),x.cacheControl&&(M.cacheControl=x.cacheControl),m.vectorTile=x.vectorTile||new wl.VectorTile(new bp(C));const I=()=>{m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,(P,F)=>{if(P||!F)return r(P);const z={};if(h){const U=ua(l);U.length>0&&(z.resourceTiming=JSON.parse(JSON.stringify(U)))}r(null,_r({rawTileData:C.slice(0)},F,M,z))})};this.isSpriteLoaded?I():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(I,{type:"parseTile",isSymbolTile:o.isSymbolTile,zoom:o.tileZoom}):I()}),this.loaded=this.loaded||{},this.loaded[a]=m})}reloadTile(o,r){const a=this.loaded,l=o.uid,h=this;if(a&&a[l]){const m=a[l];m.showCollisionBoxes=o.showCollisionBoxes,m.enableTerrain=!!o.enableTerrain,m.projection=o.projection,m.tileTransform=za(o.tileID.canonical,o.projection);const _=(x,w)=>{const C=m.reloadCallback;C&&(delete m.reloadCallback,m.parse(m.vectorTile,h.layerIndex,this.availableImages,h.actor,C)),r(x,w)};"parsing"===m.status?m.reloadCallback=_:"done"===m.status&&(m.vectorTile?m.parse(m.vectorTile,this.layerIndex,this.availableImages,this.actor,_):_())}}abortTile(o,r){const a=o.uid,l=this.loading[a];l&&(l.abort&&l.abort(),delete this.loading[a]),r()}removeTile(o,r){const a=this.loaded,l=o.uid;a&&a[l]&&delete a[l],r()}},d.WritingMode=Go,d.ZoomHistory=or,d.add=Kn,d.addDynamicAttributes=rd,d.adjoint=function(o,r){var a=r[0],l=r[1],h=r[2],m=r[3],_=r[4],x=r[5],w=r[6],C=r[7],M=r[8];return o[0]=_*M-x*C,o[1]=h*C-l*M,o[2]=l*x-h*_,o[3]=x*w-m*M,o[4]=a*M-h*w,o[5]=h*m-a*x,o[6]=m*C-_*w,o[7]=l*w-a*C,o[8]=a*_-l*m,o},d.asyncAll=Xo,d.bezier=sa,d.bindAll=Yo,d.boundsAttributes=Pm,d.bufferConvexPolygon=function(o,r){const a=[];for(let l=0;l<o.length;l++){const h=aa(l-1,-1,o.length-1),m=aa(l+1,-1,o.length-1),_=o[l],x=o[m],w=o[h].sub(_).unit(),C=x.sub(_).unit(),M=C.angleWithSep(w.x,w.y),I=w.add(C).unit().mult(-1*r/Math.sin(M/2));a.push(_.add(I))}return a},d.cacheEntryPossiblyAdded=function(o){J++,J>mn&&(o.getActor().send("enforceCacheSizeLimit",As),J=0)},d.calculateGlobeLabelMatrix=function(o,r){const{x:a,y:l}=o.point,h=Rp(a,l,o.worldSize/o._projectionScaler,0,0);return hc(h,h,td(Oa(r)))},d.calculateGlobeMatrix=function(o){const{x:r,y:a}=o.point,{lng:l,lat:h}=o._center;return Rp(r,a,o.worldSize,l,h)},d.calculateGlobeMercatorMatrix=function(o){const r=o.worldSize,a=o.point,l=Ri(1,o.center.lat)*r,h=o.pixelsPerMeter,m=r/(l/o.pixelsPerMeter),_=vo(new Float64Array(16));return yl(_,_,[a.x,a.y,0]),Hs(_,_,[m,m,h]),Float32Array.from(_)},d.circumferenceAtLatitude=Tf,d.clamp=Et,d.clearTileCache=function(o){const r=[];for(const a in jr)r.push(Ge.caches.delete(a)),delete jr[a];o&&Promise.all(r).catch(o).then(()=>o())},d.clipLine=xc,d.clone=function(o){var r=new bi(16);return r[0]=o[0],r[1]=o[1],r[2]=o[2],r[3]=o[3],r[4]=o[4],r[5]=o[5],r[6]=o[6],r[7]=o[7],r[8]=o[8],r[9]=o[9],r[10]=o[10],r[11]=o[11],r[12]=o[12],r[13]=o[13],r[14]=o[14],r[15]=o[15],r},d.clone$1=ji,d.collisionCircleLayout=E_,d.config=tn,d.conjugate=function(o,r){return o[0]=-r[0],o[1]=-r[1],o[2]=-r[2],o[3]=r[3],o},d.create=function(){var o=new bi(16);return bi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},d.create$1=sp,d.createExpression=Ki,d.createLayout=st,d.createStyleLayer=function(o){return"custom"===o.type?new Am(o):new ey[o.type](o)},d.cross=Lf,d.degToRad=Ft,d.distance=function(o,r){return Math.hypot(r[0]-o[0],r[1]-o[1],r[2]-o[2])},d.div=function(o,r,a){return o[0]=r[0]/a[0],o[1]=r[1]/a[1],o[2]=r[2]/a[2],o},d.dot=$o,d.ease=Wa,d.easeCubicInOut=Za,d.emitValidationErrors=Eh,d.endsWith=Ko,d.enforceCacheSizeLimit=function(o){for(const r in jr)Y(r),jr[r].then(a=>{a.keys().then(l=>{for(let h=0;h<l.length-o;h++)a.delete(l[h])})})},d.evaluateSizeForFeature=Zh,d.evaluateSizeForZoom=Iu,d.evaluateVariableOffset=U_,d.evented=G,d.exactEquals=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]&&o[3]===r[3]},d.exactEquals$1=function(o,r){return o[0]===r[0]&&o[1]===r[1]&&o[2]===r[2]},d.exported=zn,d.exported$1=Ro,d.extend=_r,d.extend$1=qi,d.fillExtrusionHeightLift=em,d.filterObject=la,d.fromMat4=function(o,r){return o[0]=r[0],o[1]=r[1],o[2]=r[2],o[3]=r[4],o[4]=r[5],o[5]=r[6],o[6]=r[8],o[7]=r[9],o[8]=r[10],o},d.fromQuat=function(o,r){var a=r[0],l=r[1],h=r[2],m=r[3],_=a+a,x=l+l,w=h+h,C=a*_,M=l*_,I=l*x,P=h*_,F=h*x,z=h*w,U=m*_,X=m*x,ee=m*w;return o[0]=1-I-z,o[1]=M+ee,o[2]=P-X,o[3]=0,o[4]=M-ee,o[5]=1-C-z,o[6]=F+U,o[7]=0,o[8]=P+X,o[9]=F-U,o[10]=1-C-I,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},d.fromRotation=function(o,r){var a=Math.sin(r),l=Math.cos(r);return o[0]=l,o[1]=a,o[2]=0,o[3]=-a,o[4]=l,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},d.fromScaling=function(o,r){return o[0]=r[0],o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=r[1],o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=r[2],o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o},d.furthestTileCorner=function(o){const r=Math.round((o+45+360)%360/90)%4;return $n[r]},d.getAABBPointSquareDist=function(o,r,a){let l=0;for(let h=0;h<2;++h){const m=a?a[h]:0;o[h]>m&&(l+=(o[h]-m)*(o[h]-m)),r[h]<m&&(l+=(m-r[h])*(m-r[h]))}return l},d.getAnchorAlignment=Mp,d.getAnchorJustification=j_,d.getBounds=function(o){let r=1/0,a=1/0,l=-1/0,h=-1/0;for(const m of o)r=Math.min(r,m.x),a=Math.min(a,m.y),l=Math.max(l,m.x),h=Math.max(h,m.y);return{min:new Ye(r,a),max:new Ye(l,h)}},d.getColumn=co,d.getGridMatrix=function(o,r,a){const[l,h]=r,m=.015625;return[0,(h[1]-l[1])*m,1<<o.z,(h[0]-l[0])/Cc[a],0,o.y,l[0],l[1],m]},d.getImage=_t,d.getJSON=function(o,r){return ge(_r(o,{type:"json"}),r)},d.getLatitudinalLod=function(o){const r=80.051129;o=Et(o,-80.051129,r)/r*90;const a=Math.pow(Math.abs(Math.sin(Ft(o))),3);return Math.round(a*(Cc.length-1))},d.getMapSessionAPI=lh,d.getPerformanceMeasurement=ua,d.getProjection=Tm,d.getRTLTextPluginStatus=ne,d.getReferrer=de,d.getTilePoint=function(o,{x:r,y:a},l=0){return new Ye(((r-l)*o.scale-o.x)*vt,(a*o.scale-o.y)*vt)},d.getTileVec3=function(o,r,a=0){return wu(((r.x-a)*o.scale-o.x)*vt,(r.y*o.scale-o.y)*vt,Df(r.z,r.y))},d.getVideo=function(o,r){const a=Ge.document.createElement("video");a.muted=!0,a.onloadstart=function(){r(null,a)};for(let l=0;l<o.length;l++){const h=Ge.document.createElement("source");et(o[l])||(a.crossOrigin="Anonymous"),h.src=o[l],a.appendChild(h)}return{cancel:()=>{}}},d.globeCenterToScreenPoint=function(o){const r=[0,0,0],a=vo(new Float64Array(16));return hc(a,o.pixelMatrix,o.globeMatrix),ci(r,r,a),new Ye(r[0],r[1])},d.globeECEFOrigin=function(o,r){const a=[0,0,0];return ci(a,a,ed(Oa(r.canonical))),ci(a,a,o),a},d.globeNormalizeECEF=ed,d.globePixelsToTileUnits=function(o,r){return vt/(512*Math.pow(2,o))*kp(Oa(r))},d.globePoleMatrixForTile=function(o,r,a){const l=vo(new Float64Array(16)),h=1<<o,m=360*(r/h-.5),_=a.point,x=a.worldSize/(a.tileSize*h);return yl(l,l,[_.x,_.y,-a.worldSize/Math.PI/2]),Hs(l,l,[x,x,x]),ap(l,l,Ft(-a._center.lat)),lp(l,l,Ft(-a._center.lng+m)),Float32Array.from(l)},d.globeTileBounds=Oa,d.globeTileLatLngCorners=ym,d.globeTiltAtLngLat=Fp,d.globeToMercatorTransition=vm,d.globeUseCustomAntiAliasing=function(o,r,a){const l=vm(a.zoom),h=o.style.map._antialias,m=!!r.extStandardDerivatives,_=r.extStandardDerivativesForceOff||o.terrain&&o.terrain.exaggeration()>0;return 0===l&&!h&&!_&&m},d.identity=vo,d.identity$1=up,d.invert=function(o,r){var a=r[0],l=r[1],h=r[2],m=r[3],_=r[4],x=r[5],w=r[6],C=r[7],M=r[8],I=r[9],P=r[10],F=r[11],z=r[12],U=r[13],X=r[14],ee=r[15],ce=a*x-l*_,se=a*w-h*_,pe=a*C-m*_,he=l*w-h*x,_e=l*C-m*x,Te=h*C-m*w,De=M*U-I*z,Pe=M*X-P*z,Be=M*ee-F*z,xe=I*X-P*U,Ae=I*ee-F*U,Ne=P*ee-F*X,Ue=ce*Ne-se*Ae+pe*xe+he*Be-_e*Pe+Te*De;return Ue?(o[0]=(x*Ne-w*Ae+C*xe)*(Ue=1/Ue),o[1]=(h*Ae-l*Ne-m*xe)*Ue,o[2]=(U*Te-X*_e+ee*he)*Ue,o[3]=(P*_e-I*Te-F*he)*Ue,o[4]=(w*Be-_*Ne-C*Pe)*Ue,o[5]=(a*Ne-h*Be+m*Pe)*Ue,o[6]=(X*pe-z*Te-ee*se)*Ue,o[7]=(M*Te-P*pe+F*se)*Ue,o[8]=(_*Ae-x*Be+C*De)*Ue,o[9]=(l*Be-a*Ae-m*De)*Ue,o[10]=(z*_e-U*pe+ee*ce)*Ue,o[11]=(I*pe-M*_e-F*ce)*Ue,o[12]=(x*Pe-_*xe-w*De)*Ue,o[13]=(a*xe-l*Pe+h*De)*Ue,o[14]=(U*se-z*he-X*ce)*Ue,o[15]=(M*he-I*se+P*ce)*Ue,o):null},d.isLngLatBehindGlobe=function(o,r){return Fp(o,r)>Math.PI/2*1.01},d.isMapAuthenticated=function(o){return Ms.has(o)},d.isMapboxURL=Hi,d.isSafariWithAntialiasingBug=function(o){const r=o.navigator?o.navigator.userAgent:null;return!!ca(o)&&r&&(r.match("Version/15.4")||r.match("Version/15.5")||r.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},d.latFromMercatorY=fr,d.len=Qg,d.length=dc,d.length$1=function(o){return Math.hypot(o[0],o[1],o[2],o[3])},d.loadVectorTile=xs,d.makeRequest=ge,d.mapValue=function(o,r,a,l,h){return Et((o-r)/(a-r)*(h-l)+l,l,h)},d.mercatorXfromLng=lc,d.mercatorYfromLat=yu,d.mercatorZfromAltitude=Ri,d.mul=Yg,d.mul$1=Of,d.multiply=hc,d.multiply$1=function(o,r,a){var l=r[0],h=r[1],m=r[2],_=r[3],x=r[4],w=r[5],C=r[6],M=r[7],I=r[8],P=a[0],F=a[1],z=a[2],U=a[3],X=a[4],ee=a[5],ce=a[6],se=a[7],pe=a[8];return o[0]=P*l+F*_+z*C,o[1]=P*h+F*x+z*M,o[2]=P*m+F*w+z*I,o[3]=U*l+X*_+ee*C,o[4]=U*h+X*x+ee*M,o[5]=U*m+X*w+ee*I,o[6]=ce*l+se*_+pe*C,o[7]=ce*h+se*x+pe*M,o[8]=ce*m+se*w+pe*I,o},d.multiply$2=Jg,d.nextPowerOfTwo=Ol,d.normalize=wi,d.normalize$1=function(o,r){var a=r[0],l=r[1],h=r[2],m=r[3],_=a*a+l*l+h*h+m*m;return _>0&&(_=1/Math.sqrt(_)),o[0]=a*_,o[1]=l*_,o[2]=h*_,o[3]=m*_,o},d.number=Ht,d.ortho=function(o,r,a,l,h,m,_){var x=1/(r-a),w=1/(l-h),C=1/(m-_);return o[0]=-2*x,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*w,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*C,o[11]=0,o[12]=(r+a)*x,o[13]=(h+l)*w,o[14]=(_+m)*C,o[15]=1,o},d.pbf=bp,d.perspective=function(o,r,a,l,h){var m,_=1/Math.tan(r/2);return o[0]=_/a,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=_,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,null!=h&&h!==1/0?(o[10]=(h+l)*(m=1/(l-h)),o[14]=2*h*l*m):(o[10]=-1,o[14]=-2*l),o},d.pick=function(o,r){const a={};for(let l=0;l<r.length;l++){const h=r[l];h in o&&(a[h]=o[h])}return a},d.plugin=Q,d.pointGeometry=Ye,d.polygonContainsPoint=_l,d.polygonIntersectsBox=ms,d.polygonIntersectsPolygon=Rv,d.polygonizeBounds=function(o,r,a=0,l=!0){const h=new Ye(a,a),m=o.sub(h),_=r.add(h),x=[m,new Ye(_.x,m.y),_,new Ye(m.x,_.y)];return l&&x.push(m.clone()),x},d.posAttributes=zu,d.postMapLoadEvent=jc,d.postTurnstileEvent=Uc,d.potpack=A_,d.prevPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.floor(Math.log(o)/Math.LN2))},d.radToDeg=Qr,d.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],d.registerForPluginStateChange=function(o){return o({pluginStatus:B,pluginURL:j}),G.on("pluginStateChange",o),o},d.removeAuthState=function(o){Ms.delete(o)},d.renderColorRamp=jf,d.resample=$g,d.rotateX=ap,d.rotateX$1=e_,d.rotateY=lp,d.rotateY$1=t_,d.rotateZ=function(o,r,a){var l=Math.sin(a),h=Math.cos(a),m=r[0],_=r[1],x=r[2],w=r[3],C=r[4],M=r[5],I=r[6],P=r[7];return r!==o&&(o[8]=r[8],o[9]=r[9],o[10]=r[10],o[11]=r[11],o[12]=r[12],o[13]=r[13],o[14]=r[14],o[15]=r[15]),o[0]=m*h+C*l,o[1]=_*h+M*l,o[2]=x*h+I*l,o[3]=w*h+P*l,o[4]=C*h-m*l,o[5]=M*h-_*l,o[6]=I*h-x*l,o[7]=P*h-w*l,o},d.rotateZ$1=function(o,r,a){a*=.5;var l=r[0],h=r[1],m=r[2],_=r[3],x=Math.sin(a),w=Math.cos(a);return o[0]=l*w+h*x,o[1]=h*w-l*x,o[2]=m*w+_*x,o[3]=_*w-m*x,o},d.scale=Hs,d.scale$1=zf,d.scale$2=qs,d.scaleAndAdd=cp,d.setCacheLimits=function(o,r){As=o,mn=r},d.setColumn=function(o,r,a){o[4*r+0]=a[0],o[4*r+1]=a[1],o[4*r+2]=a[2],o[4*r+3]=a[3]},d.setRTLTextPlugin=function(o,r,a=!1){if(B===D||B===A||B===k)throw new Error("setRTLTextPlugin cannot be called multiple times.");j=zn.resolveURL(o),B=D,L=r,Z(),a||W()},d.smoothstep=Ti,d.spec=ye,d.storeAuthState=function(o,r){r?Ms.add(o):Ms.delete(o)},d.sub=nr,d.subtract=Ff,d.symbolSize=im,d.tileAABB=function(o,r,a,l,h,m,_,x,w){if("globe"===w.name)return function q_(o,r,a){const l=r/o.worldSize,h=Number.MAX_VALUE,m=[-h,-h,-h],_=[h,h,h],x=vo(new Float64Array(16));if(Hs(x,x,[l,l,l]),hc(x,x,o.globeMatrix),a.z<=1){const xe=Oa(a).getCorners();for(let Ae=0;Ae<xe.length;Ae++)ci(xe[Ae],xe[Ae],x),Eu(_,_,xe[Ae]),Oh(m,m,xe[Ae]);return new xo(_,m)}const[w,C]=ym(a),M=new gl;M.setSouthWest([w[1],C[0]]),M.setNorthEast([C[1],w[0]]);const I=[Ci(M.getSouth(),M.getWest()),Ci(M.getSouth(),M.getEast()),Ci(M.getNorth(),M.getEast()),Ci(M.getNorth(),M.getWest())];for(let xe=0;xe<I.length;xe++)ci(I[xe],I[xe],x),Eu(_,_,I[xe]),Oh(m,m,I[xe]);if(M.contains(o.center)){m[2]=0;const xe=o.point,Ae=[xe.x*l,xe.y*l,0];return Eu(_,_,Ae),Oh(m,m,Ae),new xo(_,m)}const P=[x[12],x[13],x[14]],F=o.center.lng,z=Et(o.center.lat,-85.051129,fs),U=[lc(F),yu(z)],X=M.getCenter().lng,ee=Et(M.getCenter().lat,-85.051129,fs),ce=[lc(X),yu(ee)];let se=new Array(3),pe=0,he=U[0]-ce[0];const _e=U[1]-ce[1];if(he>.5?he-=1:he<-.5&&(he+=1),Math.abs(he)>Math.abs(_e))pe=he>=0?1:3,se=P;else{pe=_e>=0?0:2;const xe=[x[4],x[5],x[6]];let Ae;Ae=_e>=0?-Math.sin(Ft(M.getSouth()))*Ec:-Math.sin(Ft(M.getNorth()))*Ec,se=cp(se,P,xe,Ae)}const Te=I[pe],De=I[(pe+1)%4],Pe=new yx(Te,De,se),Be=[_m(Pe,0)||Te[0],_m(Pe,1)||Te[1],_m(Pe,2)||Te[2]];return _[2]=Math.min(Te[2],De[2]),Eu(_,_,Be),Oh(m,m,Be),new xo(_,m)}(o,r,new Hh(a,l,h));const C=za({z:a,x:l,y:h},w);return new xo([(m+C.x/C.scale)*r,r*(C.y/C.scale),_],[(m+C.x2/C.scale)*r,r*(C.y2/C.scale),x])},d.tileTransform=za,d.transformMat3=function(o,r,a){var l=r[0],h=r[1],m=r[2];return o[0]=l*a[0]+h*a[3]+m*a[6],o[1]=l*a[1]+h*a[4]+m*a[7],o[2]=l*a[2]+h*a[5]+m*a[8],o},d.transformMat4=ci,d.transformMat4$1=xr,d.transformQuat=zv,d.translate=yl,d.transpose=function(o,r){if(o===r){var a=r[1],l=r[2],h=r[5];o[1]=r[3],o[2]=r[6],o[3]=a,o[5]=r[7],o[6]=l,o[7]=h}else o[0]=r[0],o[1]=r[3],o[2]=r[6],o[3]=r[1],o[4]=r[4],o[5]=r[7],o[6]=r[2],o[7]=r[5],o[8]=r[8];return o},d.triggerPluginCompletionEvent=H,d.uniqueId=lo,d.updateGlobeVertexNormal=function(o,r,a,l,h){const m=5*r+2;o.float32[m+0]=a,o.float32[m+1]=l,o.float32[m+2]=h},d.validateCustomStyleLayer=function(o){const r=[],a=o.id;return void 0===a&&r.push({message:`layers.${a}: missing required property "id"`}),void 0===o.render&&r.push({message:`layers.${a}: missing required method "render"`}),o.renderingMode&&"2d"!==o.renderingMode&&"3d"!==o.renderingMode&&r.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),r},d.validateFilter=o=>vi(vh(o)),d.validateFog=o=>vi($d(o)),d.validateLayer=o=>vi(xh(o)),d.validateLight=o=>vi(ou(o)),d.validateSource=o=>vi(jd(o)),d.validateStyle=su,d.validateTerrain=o=>vi(bh(o)),d.values=kn,d.vectorTile=wl,d.version="2.9.1",d.warnOnce=rr,d.window=Ge,d.wrap=aa}),ah(0,function(d){function Ge(Y){if("number"==typeof Y||"boolean"==typeof Y||"string"==typeof Y||null==Y)return JSON.stringify(Y);if(Array.isArray(Y)){let V="[";for(const J of Y)V+=`${Ge(J)},`;return`${V}]`}let O="{";for(const V of Object.keys(Y).sort())O+=`${V}:${Ge(Y[V])},`;return`${O}}`}function Po(Y){let O="";for(const V of d.refProperties)O+=`/${Ge(Y[V])}`;return O}class Jr{constructor(O){this.keyCache={},O&&this.replace(O)}replace(O){this._layerConfigs={},this._layers={},this.update(O,[])}update(O,V){for(const K of O)this._layerConfigs[K.id]=K,(this._layers[K.id]=d.createStyleLayer(K)).compileFilter(),this.keyCache[K.id]&&delete this.keyCache[K.id];for(const K of V)delete this.keyCache[K],delete this._layerConfigs[K],delete this._layers[K];this.familiesBySource={};const J=function(K,fe){const de={};for(let me=0;me<K.length;me++){const we=fe&&fe[K[me].id]||Po(K[me]);fe&&(fe[K[me].id]=we);let Le=de[we];Le||(Le=de[we]=[]),Le.push(K[me])}const ge=[];for(const me in de)ge.push(de[me]);return ge}(d.values(this._layerConfigs),this.keyCache);for(const K of J){const fe=K.map(et=>this._layers[et.id]),de=fe[0];if("none"===de.visibility)continue;const ge=de.source||"";let me=this.familiesBySource[ge];me||(me=this.familiesBySource[ge]={});const we=de.sourceLayer||"_geojsonTileLayer";let Le=me[we];Le||(Le=me[we]=[]),Le.push(fe)}}}class Ye{loadTile(O,V){const{uid:J,encoding:K,rawImageData:fe,padding:de,buildQuadTree:ge}=O,me=d.window.ImageBitmap&&fe instanceof d.window.ImageBitmap?this.getImageData(fe,de):fe;V(null,new d.DEMData(J,me,K,de<1,ge))}getImageData(O,V){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(O.width,O.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=O.width,this.offscreenCanvas.height=O.height,this.offscreenCanvasContext.drawImage(O,0,0,O.width,O.height);const J=this.offscreenCanvasContext.getImageData(-V,-V,O.width+2*V,O.height+2*V);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),J}}var Lt=function Y(O,V){var J,K=O&&O.type;if("FeatureCollection"===K)for(J=0;J<O.features.length;J++)Y(O.features[J],V);else if("GeometryCollection"===K)for(J=0;J<O.geometries.length;J++)Y(O.geometries[J],V);else if("Feature"===K)Y(O.geometry,V);else if("Polygon"===K)hn(O.coordinates,V);else if("MultiPolygon"===K)for(J=0;J<O.coordinates.length;J++)hn(O.coordinates[J],V);return O};function hn(Y,O){if(0!==Y.length){ao(Y[0],O);for(var V=1;V<Y.length;V++)ao(Y[V],!O)}}function ao(Y,O){for(var V=0,J=0,K=0,fe=Y.length,de=fe-1;K<fe;de=K++){var ge=(Y[K][0]-Y[de][0])*(Y[de][1]+Y[K][1]),me=V+ge;J+=Math.abs(V)>=Math.abs(ge)?V-me+ge:ge-me+V,V=me}V+J>=0!=!!O&&Y.reverse()}const Ft=d.vectorTile.VectorTileFeature.prototype.toGeoJSON;class Qr{constructor(O){this._feature=O,this.extent=d.EXTENT,this.type=O.type,this.properties=O.tags,"id"in O&&!isNaN(O.id)&&(this.id=parseInt(O.id,10))}loadGeometry(){if(1===this._feature.type){const O=[];for(const V of this._feature.geometry)O.push([new d.pointGeometry(V[0],V[1])]);return O}{const O=[];for(const V of this._feature.geometry){const J=[];for(const K of V)J.push(new d.pointGeometry(K[0],K[1]));O.push(J)}return O}}toGeoJSON(O,V,J){return Ft.call(this,O,V,J)}}class $n{constructor(O){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=d.EXTENT,this.length=O.length,this._features=O}feature(O){return new Qr(this._features[O])}}var Za=d.vectorTile.VectorTileFeature,sa=Wa;function Wa(Y,O){this.options=O||{},this.features=Y,this.length=Y.length}function Et(Y,O){this.id="number"==typeof Y.id?Y.id:void 0,this.type=Y.type,this.rawGeometry=1===Y.type?[Y.geometry]:Y.geometry,this.properties=Y.tags,this.extent=O||4096}Wa.prototype.feature=function(Y){return new Et(this.features[Y],this.options.extent)},Et.prototype.loadGeometry=function(){var Y=this.rawGeometry;this.geometry=[];for(var O=0;O<Y.length;O++){for(var V=Y[O],J=[],K=0;K<V.length;K++)J.push(new d.pointGeometry(V[K][0],V[K][1]));this.geometry.push(J)}return this.geometry},Et.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var Y=this.geometry,O=1/0,V=-1/0,J=1/0,K=-1/0,fe=0;fe<Y.length;fe++)for(var de=Y[fe],ge=0;ge<de.length;ge++){var me=de[ge];O=Math.min(O,me.x),V=Math.max(V,me.x),J=Math.min(J,me.y),K=Math.max(K,me.y)}return[O,J,V,K]},Et.prototype.toGeoJSON=Za.prototype.toGeoJSON;var Ti=Xo,aa=sa;function Xo(Y){var O=new d.pbf;return function(V,J){for(var K in V.layers)J.writeMessage(3,kn,V.layers[K])}(Y,O),O.finish()}function kn(Y,O){var V;O.writeVarintField(15,Y.version||1),O.writeStringField(1,Y.name||""),O.writeVarintField(5,Y.extent||4096);var J={keys:[],values:[],keycache:{},valuecache:{}};for(V=0;V<Y.length;V++)J.feature=Y.feature(V),O.writeMessage(2,_r,J);var K=J.keys;for(V=0;V<K.length;V++)O.writeStringField(3,K[V]);var fe=J.values;for(V=0;V<fe.length;V++)O.writeMessage(4,Ui,fe[V])}function _r(Y,O){var V=Y.feature;void 0!==V.id&&O.writeVarintField(1,V.id),O.writeMessage(2,wd,Y),O.writeVarintField(3,V.type),O.writeMessage(4,Ol,V)}function wd(Y,O){var V=Y.feature,J=Y.keys,K=Y.values,fe=Y.keycache,de=Y.valuecache;for(var ge in V.properties){var me=V.properties[ge],we=fe[ge];if(null!==me){void 0===we&&(J.push(ge),fe[ge]=we=J.length-1),O.writeVarint(we);var Le=typeof me;"string"!==Le&&"boolean"!==Le&&"number"!==Le&&(me=JSON.stringify(me));var et=Le+":"+me,Re=de[et];void 0===Re&&(K.push(me),de[et]=Re=K.length-1),O.writeVarint(Re)}}}function lo(Y,O){return(O<<3)+(7&Y)}function Xa(Y){return Y<<1^Y>>31}function Ol(Y,O){for(var V=Y.loadGeometry(),J=Y.type,K=0,fe=0,de=V.length,ge=0;ge<de;ge++){var me=V[ge],we=1;1===J&&(we=me.length),O.writeVarint(lo(1,we));for(var Le=3===J?me.length-1:me.length,et=0;et<Le;et++){1===et&&1!==J&&O.writeVarint(lo(2,Le-1));var Re=me[et].x-K,gt=me[et].y-fe;O.writeVarint(Xa(Re)),O.writeVarint(Xa(gt)),K+=Re,fe+=gt}3===J&&O.writeVarint(lo(7,1))}}function Ui(Y,O){var V=typeof Y;"string"===V?O.writeStringField(1,Y):"boolean"===V?O.writeBooleanField(7,Y):"number"===V&&(Y%1!=0?O.writeDoubleField(3,Y):Y<0?O.writeSVarintField(6,Y):O.writeVarintField(5,Y))}function Yo(Y,O,V,J,K,fe){if(K-J<=V)return;const de=J+K>>1;Ko(Y,O,de,J,K,fe%2),Yo(Y,O,V,J,de-1,fe+1),Yo(Y,O,V,de+1,K,fe+1)}function Ko(Y,O,V,J,K,fe){for(;K>J;){if(K-J>600){const we=K-J+1,Le=V-J+1,et=Math.log(we),Re=.5*Math.exp(2*et/3),gt=.5*Math.sqrt(et*Re*(we-Re)/we)*(Le-we/2<0?-1:1);Ko(Y,O,V,Math.max(J,Math.floor(V-Le*Re/we+gt)),Math.min(K,Math.floor(V+(we-Le)*Re/we+gt)),fe)}const de=O[2*V+fe];let ge=J,me=K;for(Vt(Y,O,J,V),O[2*K+fe]>de&&Vt(Y,O,J,K);ge<me;){for(Vt(Y,O,ge,me),ge++,me--;O[2*ge+fe]<de;)ge++;for(;O[2*me+fe]>de;)me--}O[2*J+fe]===de?Vt(Y,O,J,me):(me++,Vt(Y,O,me,K)),me<=V&&(J=me+1),V<=me&&(K=me-1)}}function Vt(Y,O,V,J){la(Y,V,J),la(O,2*V,2*J),la(O,2*V+1,2*J+1)}function la(Y,O,V){const J=Y[O];Y[O]=Y[V],Y[V]=J}function ji(Y,O,V,J){const K=Y-V,fe=O-J;return K*K+fe*fe}Ti.fromVectorTileJs=Xo,Ti.fromGeojsonVt=function(Y,O){O=O||{};var V={};for(var J in Y)V[J]=new sa(Y[J].features,O),V[J].name=J,V[J].version=O.version,V[J].extent=O.extent;return Xo({layers:V})},Ti.GeoJSONWrapper=aa;const Ya=Y=>Y[0],rr=Y=>Y[1];class Ur{constructor(O,V=Ya,J=rr,K=64,fe=Float64Array){this.nodeSize=K,this.points=O;const de=O.length<65536?Uint16Array:Uint32Array,ge=this.ids=new de(O.length),me=this.coords=new fe(2*O.length);for(let we=0;we<O.length;we++)ge[we]=we,me[2*we]=V(O[we]),me[2*we+1]=J(O[we]);Yo(ge,me,K,0,ge.length-1,0)}range(O,V,J,K){return function(fe,de,ge,me,we,Le,et){const Re=[0,fe.length-1,0],gt=[];let yt,_t;for(;Re.length;){const dt=Re.pop(),zt=Re.pop(),an=Re.pop();if(zt-an<=et){for(let ye=an;ye<=zt;ye++)yt=de[2*ye],_t=de[2*ye+1],yt>=ge&&yt<=we&&_t>=me&&_t<=Le&&gt.push(fe[ye]);continue}const Bn=Math.floor((an+zt)/2);yt=de[2*Bn],_t=de[2*Bn+1],yt>=ge&&yt<=we&&_t>=me&&_t<=Le&&gt.push(fe[Bn]);const gn=(dt+1)%2;(0===dt?ge<=yt:me<=_t)&&(Re.push(an),Re.push(Bn-1),Re.push(gn)),(0===dt?we>=yt:Le>=_t)&&(Re.push(Bn+1),Re.push(zt),Re.push(gn))}return gt}(this.ids,this.coords,O,V,J,K,this.nodeSize)}within(O,V,J){return function(K,fe,de,ge,me,we){const Le=[0,K.length-1,0],et=[],Re=me*me;for(;Le.length;){const gt=Le.pop(),yt=Le.pop(),_t=Le.pop();if(yt-_t<=we){for(let gn=_t;gn<=yt;gn++)ji(fe[2*gn],fe[2*gn+1],de,ge)<=Re&&et.push(K[gn]);continue}const dt=Math.floor((_t+yt)/2),zt=fe[2*dt],an=fe[2*dt+1];ji(zt,an,de,ge)<=Re&&et.push(K[dt]);const Bn=(gt+1)%2;(0===gt?de-me<=zt:ge-me<=an)&&(Le.push(_t),Le.push(dt-1),Le.push(Bn)),(0===gt?de+me>=zt:ge+me>=an)&&(Le.push(dt+1),Le.push(yt),Le.push(Bn))}return et}(this.ids,this.coords,O,V,J,this.nodeSize)}}const $i={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Y=>Y},Gi=Math.fround||(Jo=new Float32Array(1),Y=>(Jo[0]=+Y,Jo[0]));var Jo;class Qo{constructor(O){this.options=ts(Object.create($i),O),this.trees=new Array(this.options.maxZoom+1)}load(O){const{log:V,minZoom:J,maxZoom:K,nodeSize:fe}=this.options;V&&console.time("total time");const de=`prepare ${O.length} points`;V&&console.time(de),this.points=O;let ge=[];for(let me=0;me<O.length;me++)O[me].geometry&&ge.push(Ka(O[me],me));this.trees[K+1]=new Ur(ge,ha,ko,fe,Float32Array),V&&console.timeEnd(de);for(let me=K;me>=J;me--){const we=+Date.now();ge=this._cluster(ge,me),this.trees[me]=new Ur(ge,ha,ko,fe,Float32Array),V&&console.log("z%d: %d clusters in %dms",me,ge.length,+Date.now()-we)}return V&&console.timeEnd("total time"),this}getClusters(O,V){let J=((O[0]+180)%360+360)%360-180;const K=Math.max(-90,Math.min(90,O[1]));let fe=180===O[2]?180:((O[2]+180)%360+360)%360-180;const de=Math.max(-90,Math.min(90,O[3]));if(O[2]-O[0]>=360)J=-180,fe=180;else if(J>fe){const Le=this.getClusters([J,K,180,de],V),et=this.getClusters([-180,K,fe,de],V);return Le.concat(et)}const ge=this.trees[this._limitZoom(V)],me=ge.range(ua(J),es(de),ua(fe),es(K)),we=[];for(const Le of me){const et=ge.points[Le];we.push(et.numPoints?co(et):this.points[et.index])}return we}getChildren(O){const V=this._getOriginId(O),J=this._getOriginZoom(O),K="No cluster with the specified id.",fe=this.trees[J];if(!fe)throw new Error(K);const de=fe.points[V];if(!de)throw new Error(K);const ge=this.options.radius/(this.options.extent*Math.pow(2,J-1)),me=fe.within(de.x,de.y,ge),we=[];for(const Le of me){const et=fe.points[Le];et.parentId===O&&we.push(et.numPoints?co(et):this.points[et.index])}if(0===we.length)throw new Error(K);return we}getLeaves(O,V,J){const K=[];return this._appendLeaves(K,O,V=V||10,J=J||0,0),K}getTile(O,V,J){const K=this.trees[this._limitZoom(O)],fe=Math.pow(2,O),{extent:de,radius:ge}=this.options,me=ge/de,we=(J-me)/fe,Le=(J+1+me)/fe,et={features:[]};return this._addTileFeatures(K.range((V-me)/fe,we,(V+1+me)/fe,Le),K.points,V,J,fe,et),0===V&&this._addTileFeatures(K.range(1-me/fe,we,1,Le),K.points,fe,J,fe,et),V===fe-1&&this._addTileFeatures(K.range(0,we,me/fe,Le),K.points,-1,J,fe,et),et.features.length?et:null}getClusterExpansionZoom(O){let V=this._getOriginZoom(O)-1;for(;V<=this.options.maxZoom;){const J=this.getChildren(O);if(V++,1!==J.length)break;O=J[0].properties.cluster_id}return V}_appendLeaves(O,V,J,K,fe){const de=this.getChildren(V);for(const ge of de){const me=ge.properties;if(me&&me.cluster?fe+me.point_count<=K?fe+=me.point_count:fe=this._appendLeaves(O,me.cluster_id,J,K,fe):fe<K?fe++:O.push(ge),O.length===J)break}return fe}_addTileFeatures(O,V,J,K,fe,de){for(const ge of O){const me=V[ge],we=me.numPoints;let Le,et,Re;if(we)Le=Nc(me),et=me.x,Re=me.y;else{const _t=this.points[me.index];Le=_t.properties,et=ua(_t.geometry.coordinates[0]),Re=es(_t.geometry.coordinates[1])}const gt={type:1,geometry:[[Math.round(this.options.extent*(et*fe-J)),Math.round(this.options.extent*(Re*fe-K))]],tags:Le};let yt;we?yt=me.id:this.options.generateId?yt=me.index:this.points[me.index].id&&(yt=this.points[me.index].id),void 0!==yt&&(gt.id=yt),de.features.push(gt)}}_limitZoom(O){return Math.max(this.options.minZoom,Math.min(+O,this.options.maxZoom+1))}_cluster(O,V){const J=[],{radius:K,extent:fe,reduce:de,minPoints:ge}=this.options,me=K/(fe*Math.pow(2,V));for(let we=0;we<O.length;we++){const Le=O[we];if(Le.zoom<=V)continue;Le.zoom=V;const et=this.trees[V+1],Re=et.within(Le.x,Le.y,me),gt=Le.numPoints||1;let yt=gt;for(const _t of Re){const dt=et.points[_t];dt.zoom>V&&(yt+=dt.numPoints||1)}if(yt>gt&&yt>=ge){let _t=Le.x*gt,dt=Le.y*gt,zt=de&&gt>1?this._map(Le,!0):null;const an=(we<<5)+(V+1)+this.points.length;for(const Bn of Re){const gn=et.points[Bn];if(gn.zoom<=V)continue;gn.zoom=V;const ye=gn.numPoints||1;_t+=gn.x*ye,dt+=gn.y*ye,gn.parentId=an,de&&(zt||(zt=this._map(Le,!0)),de(zt,this._map(gn)))}Le.parentId=an,J.push(ca(_t/yt,dt/yt,an,yt,zt))}else if(J.push(Le),yt>1)for(const _t of Re){const dt=et.points[_t];dt.zoom<=V||(dt.zoom=V,J.push(dt))}}return J}_getOriginId(O){return O-this.points.length>>5}_getOriginZoom(O){return(O-this.points.length)%32}_map(O,V){if(O.numPoints)return V?ts({},O.properties):O.properties;const J=this.points[O.index].properties,K=this.options.map(J);return V&&K===J?ts({},K):K}}function ca(Y,O,V,J,K){return{x:Gi(Y),y:Gi(O),zoom:1/0,id:V,parentId:-1,numPoints:J,properties:K}}function Ka(Y,O){const[V,J]=Y.geometry.coordinates;return{x:Gi(ua(V)),y:Gi(es(J)),zoom:1/0,index:O,parentId:-1}}function co(Y){return{type:"Feature",id:Y.id,properties:Nc(Y),geometry:{type:"Point",coordinates:[(O=Y.x,360*(O-.5)),en(Y.y)]}};var O}function Nc(Y){const O=Y.numPoints,V=O>=1e4?`${Math.round(O/1e3)}k`:O>=1e3?Math.round(O/100)/10+"k":O;return ts(ts({},Y.properties),{cluster:!0,cluster_id:Y.id,point_count:O,point_count_abbreviated:V})}function ua(Y){return Y/360+.5}function es(Y){const O=Math.sin(Y*Math.PI/180),V=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return V<0?0:V>1?1:V}function en(Y){const O=(180-360*Y)*Math.PI/180;return 360*Math.atan(Math.exp(O))/Math.PI-90}function ts(Y,O){for(const V in O)Y[V]=O[V];return Y}function ha(Y){return Y.x}function ko(Y){return Y.y}function zn(Y,O,V,J){for(var K,fe=J,de=V-O>>1,ge=V-O,me=Y[O],we=Y[O+1],Le=Y[V],et=Y[V+1],Re=O+3;Re<V;Re+=3){var gt=Ds(Y[Re],Y[Re+1],me,we,Le,et);if(gt>fe)K=Re,fe=gt;else if(gt===fe){var yt=Math.abs(Re-de);yt<ge&&(K=Re,ge=yt)}}fe>J&&(K-O>3&&zn(Y,O,K,J),Y[K+2]=fe,V-K>3&&zn(Y,K,V,J))}function Ds(Y,O,V,J,K,fe){var de=K-V,ge=fe-J;if(0!==de||0!==ge){var me=((Y-V)*de+(O-J)*ge)/(de*de+ge*ge);me>1?(V=K,J=fe):me>0&&(V+=de*me,J+=ge*me)}return(de=Y-V)*de+(ge=O-J)*ge}function tn(Y,O,V,J){var K={id:void 0===Y?null:Y,type:O,geometry:V,tags:J,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(fe){var de=fe.geometry,ge=fe.type;if("Point"===ge||"MultiPoint"===ge||"LineString"===ge)Ro(fe,de);else if("Polygon"===ge||"MultiLineString"===ge)for(var me=0;me<de.length;me++)Ro(fe,de[me]);else if("MultiPolygon"===ge)for(me=0;me<de.length;me++)for(var we=0;we<de[me].length;we++)Ro(fe,de[me][we])}(K),K}function Ro(Y,O){for(var V=0;V<O.length;V+=3)Y.minX=Math.min(Y.minX,O[V]),Y.minY=Math.min(Y.minY,O[V+1]),Y.maxX=Math.max(Y.maxX,O[V]),Y.maxY=Math.max(Y.maxY,O[V+1])}function Ss(Y,O,V,J){if(O.geometry){var K=O.geometry.coordinates,fe=O.geometry.type,de=Math.pow(V.tolerance/((1<<V.maxZoom)*V.extent),2),ge=[],me=O.id;if(V.promoteId?me=O.properties[V.promoteId]:V.generateId&&(me=J||0),"Point"===fe)uo(K,ge);else if("MultiPoint"===fe)for(var we=0;we<K.length;we++)uo(K[we],ge);else if("LineString"===fe)ir(K,ge,de,!1);else if("MultiLineString"===fe){if(V.lineMetrics){for(we=0;we<K.length;we++)ir(K[we],ge=[],de,!1),Y.push(tn(me,"LineString",ge,O.properties));return}Ja(K,ge,de,!1)}else if("Polygon"===fe)Ja(K,ge,de,!0);else{if("MultiPolygon"!==fe){if("GeometryCollection"===fe){for(we=0;we<O.geometry.geometries.length;we++)Ss(Y,{id:me,geometry:O.geometry.geometries[we],properties:O.properties},V,J);return}throw new Error("Input data is not a valid GeoJSON object.")}for(we=0;we<K.length;we++){var Le=[];Ja(K[we],Le,de,!0),ge.push(Le)}}Y.push(tn(me,fe,ge,O.properties))}}function uo(Y,O){O.push(zl(Y[0])),O.push(Vc(Y[1])),O.push(0)}function ir(Y,O,V,J){for(var K,fe,de=0,ge=0;ge<Y.length;ge++){var me=zl(Y[ge][0]),we=Vc(Y[ge][1]);O.push(me),O.push(we),O.push(0),ge>0&&(de+=J?(K*we-me*fe)/2:Math.sqrt(Math.pow(me-K,2)+Math.pow(we-fe,2))),K=me,fe=we}var Le=O.length-3;O[2]=1,zn(O,0,Le,V),O[Le+2]=1,O.size=Math.abs(de),O.start=0,O.end=O.size}function Ja(Y,O,V,J){for(var K=0;K<Y.length;K++){var fe=[];ir(Y[K],fe,V,J),O.push(fe)}}function zl(Y){return Y/360+.5}function Vc(Y){var O=Math.sin(Y*Math.PI/180),V=.5-.25*Math.log((1+O)/(1-O))/Math.PI;return V<0?0:V>1?1:V}function Or(Y,O,V,J,K,fe,de,ge){if(J/=O,fe>=(V/=O)&&de<J)return Y;if(de<V||fe>=J)return null;for(var me=[],we=0;we<Y.length;we++){var Le=Y[we],et=Le.geometry,Re=Le.type,gt=0===K?Le.minX:Le.minY,yt=0===K?Le.maxX:Le.maxY;if(gt>=V&&yt<J)me.push(Le);else if(!(yt<V||gt>=J)){var _t=[];if("Point"===Re||"MultiPoint"===Re)Hi(et,_t,V,J,K);else if("LineString"===Re)da(et,_t,V,J,K,!1,ge.lineMetrics);else if("MultiLineString"===Re)Di(et,_t,V,J,K,!1);else if("Polygon"===Re)Di(et,_t,V,J,K,!0);else if("MultiPolygon"===Re)for(var dt=0;dt<et.length;dt++){var zt=[];Di(et[dt],zt,V,J,K,!0),zt.length&&_t.push(zt)}if(_t.length){if(ge.lineMetrics&&"LineString"===Re){for(dt=0;dt<_t.length;dt++)me.push(tn(Le.id,Re,_t[dt],Le.tags));continue}"LineString"!==Re&&"MultiLineString"!==Re||(1===_t.length?(Re="LineString",_t=_t[0]):Re="MultiLineString"),"Point"!==Re&&"MultiPoint"!==Re||(Re=3===_t.length?"Point":"MultiPoint"),me.push(tn(Le.id,Re,_t,Le.tags))}}}return me.length?me:null}function Hi(Y,O,V,J,K){for(var fe=0;fe<Y.length;fe+=3){var de=Y[fe+K];de>=V&&de<=J&&(O.push(Y[fe]),O.push(Y[fe+1]),O.push(Y[fe+2]))}}function da(Y,O,V,J,K,fe,de){for(var ge,me,we=Qa(Y),Le=0===K?Bl:Nl,et=Y.start,Re=0;Re<Y.length-3;Re+=3){var gt=Y[Re],yt=Y[Re+1],_t=Y[Re+2],dt=Y[Re+3],zt=Y[Re+4],an=0===K?gt:yt,Bn=0===K?dt:zt,gn=!1;de&&(ge=Math.sqrt(Math.pow(gt-dt,2)+Math.pow(yt-zt,2))),an<V?Bn>V&&(me=Le(we,gt,yt,dt,zt,V),de&&(we.start=et+ge*me)):an>J?Bn<J&&(me=Le(we,gt,yt,dt,zt,J),de&&(we.start=et+ge*me)):ns(we,gt,yt,_t),Bn<V&&an>=V&&(me=Le(we,gt,yt,dt,zt,V),gn=!0),Bn>J&&an<=J&&(me=Le(we,gt,yt,dt,zt,J),gn=!0),!fe&&gn&&(de&&(we.end=et+ge*me),O.push(we),we=Qa(Y)),de&&(et+=ge)}var ye=Y.length-3;gt=Y[ye],yt=Y[ye+1],_t=Y[ye+2],(an=0===K?gt:yt)>=V&&an<=J&&ns(we,gt,yt,_t),ye=we.length-3,fe&&ye>=3&&(we[ye]!==we[0]||we[ye+1]!==we[1])&&ns(we,we[0],we[1],we[2]),we.length&&O.push(we)}function Qa(Y){var O=[];return O.size=Y.size,O.start=Y.start,O.end=Y.end,O}function Di(Y,O,V,J,K,fe){for(var de=0;de<Y.length;de++)da(Y[de],O,V,J,K,fe,!1)}function ns(Y,O,V,J){Y.push(O),Y.push(V),Y.push(J)}function Bl(Y,O,V,J,K,fe){var de=(fe-O)/(J-O);return Y.push(fe),Y.push(V+(K-V)*de),Y.push(1),de}function Nl(Y,O,V,J,K,fe){var de=(fe-V)/(K-V);return Y.push(O+(J-O)*de),Y.push(fe),Y.push(1),de}function Vl(Y,O){for(var V=[],J=0;J<Y.length;J++){var K,fe=Y[J],de=fe.type;if("Point"===de||"MultiPoint"===de||"LineString"===de)K=Uc(fe.geometry,O);else if("MultiLineString"===de||"Polygon"===de){K=[];for(var ge=0;ge<fe.geometry.length;ge++)K.push(Uc(fe.geometry[ge],O))}else if("MultiPolygon"===de)for(K=[],ge=0;ge<fe.geometry.length;ge++){for(var me=[],we=0;we<fe.geometry[ge].length;we++)me.push(Uc(fe.geometry[ge][we],O));K.push(me)}V.push(tn(fe.id,de,K,fe.tags))}return V}function Uc(Y,O){var V=[];V.size=Y.size,void 0!==Y.start&&(V.start=Y.start,V.end=Y.end);for(var J=0;J<Y.length;J+=3)V.push(Y[J]+O,Y[J+1],Y[J+2]);return V}function Ul(Y,O){if(Y.transformed)return Y;var V,J,K,fe=1<<Y.z,de=Y.x,ge=Y.y;for(V=0;V<Y.features.length;V++){var me=Y.features[V],we=me.geometry,Le=me.type;if(me.geometry=[],1===Le)for(J=0;J<we.length;J+=2)me.geometry.push(jc(we[J],we[J+1],O,fe,de,ge));else for(J=0;J<we.length;J++){var et=[];for(K=0;K<we[J].length;K+=2)et.push(jc(we[J][K],we[J][K+1],O,fe,de,ge));me.geometry.push(et)}}return Y.transformed=!0,Y}function jc(Y,O,V,J,K,fe){return[Math.round(V*(Y*J-K)),Math.round(V*(O*J-fe))]}function $c(Y,O,V,J,K){for(var fe=O===K.maxZoom?0:K.tolerance/((1<<O)*K.extent),de={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:V,y:J,z:O,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},ge=0;ge<Y.length;ge++){de.numFeatures++,lh(de,Y[ge],fe,K);var me=Y[ge].minX,we=Y[ge].minY,Le=Y[ge].maxX,et=Y[ge].maxY;me<de.minX&&(de.minX=me),we<de.minY&&(de.minY=we),Le>de.maxX&&(de.maxX=Le),et>de.maxY&&(de.maxY=et)}return de}function lh(Y,O,V,J){var K=O.geometry,fe=O.type,de=[];if("Point"===fe||"MultiPoint"===fe)for(var ge=0;ge<K.length;ge+=3)de.push(K[ge]),de.push(K[ge+1]),Y.numPoints++,Y.numSimplified++;else if("LineString"===fe)Ms(de,K,Y,V,!1,!1);else if("MultiLineString"===fe||"Polygon"===fe)for(ge=0;ge<K.length;ge++)Ms(de,K[ge],Y,V,"Polygon"===fe,0===ge);else if("MultiPolygon"===fe)for(var me=0;me<K.length;me++){var we=K[me];for(ge=0;ge<we.length;ge++)Ms(de,we[ge],Y,V,!0,0===ge)}if(de.length){var Le=O.tags||null;if("LineString"===fe&&J.lineMetrics){for(var et in Le={},O.tags)Le[et]=O.tags[et];Le.mapbox_clip_start=K.start/K.size,Le.mapbox_clip_end=K.end/K.size}var Re={geometry:de,type:"Polygon"===fe||"MultiPolygon"===fe?3:"LineString"===fe||"MultiLineString"===fe?2:1,tags:Le};null!==O.id&&(Re.id=O.id),Y.features.push(Re)}}function Ms(Y,O,V,J,K,fe){var de=J*J;if(J>0&&O.size<(K?de:J))V.numPoints+=O.length/3;else{for(var ge=[],me=0;me<O.length;me+=3)(0===J||O[me+2]>de)&&(V.numSimplified++,ge.push(O[me]),ge.push(O[me+1])),V.numPoints++;K&&function(we,Le){for(var et=0,Re=0,gt=we.length,yt=gt-2;Re<gt;yt=Re,Re+=2)et+=(we[Re]-we[yt])*(we[Re+1]+we[yt+1]);if(et>0===Le)for(Re=0,gt=we.length;Re<gt/2;Re+=2){var _t=we[Re],dt=we[Re+1];we[Re]=we[gt-2-Re],we[Re+1]=we[gt-1-Re],we[gt-2-Re]=_t,we[gt-1-Re]=dt}}(ge,fe),Y.push(ge)}}function sn(Y,O){var V=(O=this.options=function(K,fe){for(var de in fe)K[de]=fe[de];return K}(Object.create(this.options),O)).debug;if(V&&console.time("preprocess data"),O.maxZoom<0||O.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(O.promoteId&&O.generateId)throw new Error("promoteId and generateId cannot be used together.");var K,fe,de,ge,me,we,J=function(K,fe){var de=[];if("FeatureCollection"===K.type)for(var ge=0;ge<K.features.length;ge++)Ss(de,K.features[ge],fe,ge);else Ss(de,"Feature"===K.type?K:{geometry:K},fe);return de}(Y,O);this.tiles={},this.tileCoords=[],V&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",O.indexMaxZoom,O.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(K=J,fe=O,de=fe.buffer/fe.extent,ge=K,me=Or(K,1,-1-de,de,0,-1,2,fe),we=Or(K,1,1-de,2+de,0,-1,2,fe),(me||we)&&(ge=Or(K,1,-de,1+de,0,-1,2,fe)||[],me&&(ge=Vl(me,1).concat(ge)),we&&(ge=ge.concat(Vl(we,-1)))),J=ge).length&&this.splitTile(J,0,0,0),V&&(J.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function As(Y,O,V){return 32*((1<<Y)*V+O)+Y}function mn(Y,O){const V=Y.tileID.canonical;if(!this._geoJSONIndex)return O(null,null);const J=this._geoJSONIndex.getTile(V.z,V.x,V.y);if(!J)return O(null,null);const K=new $n(J.features);let fe=Ti(K);0===fe.byteOffset&&fe.byteLength===fe.buffer.byteLength||(fe=new Uint8Array(fe)),O(null,{vectorTile:K,rawData:fe.buffer})}sn.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},sn.prototype.splitTile=function(Y,O,V,J,K,fe,de){for(var ge=[Y,O,V,J],me=this.options,we=me.debug;ge.length;){J=ge.pop(),V=ge.pop(),O=ge.pop(),Y=ge.pop();var Le=1<<O,et=As(O,V,J),Re=this.tiles[et];if(!Re&&(we>1&&console.time("creation"),Re=this.tiles[et]=$c(Y,O,V,J,me),this.tileCoords.push({z:O,x:V,y:J}),we)){we>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",O,V,J,Re.numFeatures,Re.numPoints,Re.numSimplified),console.timeEnd("creation"));var gt="z"+O;this.stats[gt]=(this.stats[gt]||0)+1,this.total++}if(Re.source=Y,K){if(O===me.maxZoom||O===K)continue;var yt=1<<K-O;if(V!==Math.floor(fe/yt)||J!==Math.floor(de/yt))continue}else if(O===me.indexMaxZoom||Re.numPoints<=me.indexMaxPoints)continue;if(Re.source=null,0!==Y.length){we>1&&console.time("clipping");var _t,dt,zt,an,Bn,gn,ye=.5*me.buffer/me.extent,qi=.5-ye,Zn=.5+ye,ho=1+ye;_t=dt=zt=an=null,Bn=Or(Y,Le,V-ye,V+Zn,0,Re.minX,Re.maxX,me),gn=Or(Y,Le,V+qi,V+ho,0,Re.minX,Re.maxX,me),Y=null,Bn&&(_t=Or(Bn,Le,J-ye,J+Zn,1,Re.minY,Re.maxY,me),dt=Or(Bn,Le,J+qi,J+ho,1,Re.minY,Re.maxY,me),Bn=null),gn&&(zt=Or(gn,Le,J-ye,J+Zn,1,Re.minY,Re.maxY,me),an=Or(gn,Le,J+qi,J+ho,1,Re.minY,Re.maxY,me),gn=null),we>1&&console.timeEnd("clipping"),ge.push(_t||[],O+1,2*V,2*J),ge.push(dt||[],O+1,2*V,2*J+1),ge.push(zt||[],O+1,2*V+1,2*J),ge.push(an||[],O+1,2*V+1,2*J+1)}}},sn.prototype.getTile=function(Y,O,V){var J=this.options,K=J.extent,fe=J.debug;if(Y<0||Y>24)return null;var de=1<<Y,ge=As(Y,O=(O%de+de)%de,V);if(this.tiles[ge])return Ul(this.tiles[ge],K);fe>1&&console.log("drilling down to z%d-%d-%d",Y,O,V);for(var me,we=Y,Le=O,et=V;!me&&we>0;)we--,Le=Math.floor(Le/2),et=Math.floor(et/2),me=this.tiles[As(we,Le,et)];return me&&me.source?(fe>1&&console.log("found parent tile z%d-%d-%d",we,Le,et),fe>1&&console.time("drilling down"),this.splitTile(me.source,we,Le,et,Y,O,V),fe>1&&console.timeEnd("drilling down"),this.tiles[ge]?Ul(this.tiles[ge],K):null):null};class jr extends d.VectorTileWorkerSource{constructor(O,V,J,K,fe){super(O,V,J,K,mn),fe&&(this.loadGeoJSON=fe)}loadData(O,V){const J=O&&O.request,K=J&&J.collectResourceTiming;this.loadGeoJSON(O,(fe,de)=>{if(fe||!de)return V(fe);if("object"!=typeof de)return V(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));{Lt(de,!0);try{if(O.filter){const me=d.createExpression(O.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===me.result)throw new Error(me.value.map(Le=>`${Le.key}: ${Le.message}`).join(", "));const we=de.features.filter(Le=>me.value.evaluate({zoom:0},Le));de={type:"FeatureCollection",features:we}}this._geoJSONIndex=O.cluster?new Qo(function({superclusterOptions:me,clusterProperties:we}){if(!we||!me)return me;const Le={},et={},Re={accumulated:null,zoom:0},gt={properties:null},yt=Object.keys(we);for(const _t of yt){const[dt,zt]=we[_t],an=d.createExpression(zt),Bn=d.createExpression("string"==typeof dt?[dt,["accumulated"],["get",_t]]:dt);Le[_t]=an.value,et[_t]=Bn.value}return me.map=_t=>{gt.properties=_t;const dt={};for(const zt of yt)dt[zt]=Le[zt].evaluate(Re,gt);return dt},me.reduce=(_t,dt)=>{gt.properties=dt;for(const zt of yt)Re.accumulated=_t[zt],_t[zt]=et[zt].evaluate(Re,gt)},me}(O)).load(de.features):new sn(me=de,O.geojsonVtOptions)}catch(me){return V(me)}this.loaded={};const ge={};if(K){const me=d.getPerformanceMeasurement(J);me&&(ge.resourceTiming={},ge.resourceTiming[O.source]=JSON.parse(JSON.stringify(me)))}V(null,ge)}var me})}reloadTile(O,V){const J=this.loaded;return J&&J[O.uid]?super.reloadTile(O,V):this.loadTile(O,V)}loadGeoJSON(O,V){if(O.request)d.getJSON(O.request,V);else{if("string"!=typeof O.data)return V(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`));try{return V(null,JSON.parse(O.data))}catch(J){return V(new Error(`Input data given to '${O.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(O,V){try{V(null,this._geoJSONIndex.getClusterExpansionZoom(O.clusterId))}catch(J){V(J)}}getClusterChildren(O,V){try{V(null,this._geoJSONIndex.getChildren(O.clusterId))}catch(J){V(J)}}getClusterLeaves(O,V){try{V(null,this._geoJSONIndex.getLeaves(O.clusterId,O.limit,O.offset))}catch(J){V(J)}}}class jl{constructor(O){this.self=O,this.actor=new d.Actor(O,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=d.getProjection({name:"mercator"}),this.workerSourceTypes={vector:d.VectorTileWorkerSource,geojson:jr},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(V,J)=>{if(this.workerSourceTypes[V])throw new Error(`Worker source with name "${V}" already registered.`);this.workerSourceTypes[V]=J},this.self.registerRTLTextPlugin=V=>{if(d.plugin.isParsed())throw new Error("RTL text plugin already registered.");d.plugin.applyArabicShaping=V.applyArabicShaping,d.plugin.processBidirectionalText=V.processBidirectionalText,d.plugin.processStyledBidirectionalText=V.processStyledBidirectionalText}}clearCaches(O,V,J){delete this.layerIndexes[O],delete this.availableImages[O],delete this.workerSources[O],delete this.demWorkerSources[O],J()}checkIfReady(O,V,J){J()}setReferrer(O,V){this.referrer=V}spriteLoaded(O,V){this.isSpriteLoaded[O]=V;for(const J in this.workerSources[O]){const K=this.workerSources[O][J];for(const fe in K)K[fe]instanceof d.VectorTileWorkerSource&&(K[fe].isSpriteLoaded=V,K[fe].fire(new d.Event("isSpriteLoaded")))}}setImages(O,V,J){this.availableImages[O]=V;for(const K in this.workerSources[O]){const fe=this.workerSources[O][K];for(const de in fe)fe[de].availableImages=V}J()}enableTerrain(O,V,J){this.terrain=V,J()}setProjection(O,V){this.projections[O]=d.getProjection(V)}setLayers(O,V,J){this.getLayerIndex(O).replace(V),J()}updateLayers(O,V,J){this.getLayerIndex(O).update(V.layers,V.removedIds),J()}loadTile(O,V,J){const K=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;K.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,V.type,V.source).loadTile(K,J)}loadDEMTile(O,V,J){const K=this.enableTerrain?d.extend({buildQuadTree:this.terrain},V):V;this.getDEMWorkerSource(O,V.source).loadTile(K,J)}reloadTile(O,V,J){const K=this.enableTerrain?d.extend({enableTerrain:this.terrain},V):V;K.projection=this.projections[O]||this.defaultProjection,this.getWorkerSource(O,V.type,V.source).reloadTile(K,J)}abortTile(O,V,J){this.getWorkerSource(O,V.type,V.source).abortTile(V,J)}removeTile(O,V,J){this.getWorkerSource(O,V.type,V.source).removeTile(V,J)}removeSource(O,V,J){if(!this.workerSources[O]||!this.workerSources[O][V.type]||!this.workerSources[O][V.type][V.source])return;const K=this.workerSources[O][V.type][V.source];delete this.workerSources[O][V.type][V.source],void 0!==K.removeSource?K.removeSource(V,J):J()}loadWorkerSource(O,V,J){try{this.self.importScripts(V.url),J()}catch(K){J(K.toString())}}syncRTLPluginState(O,V,J){try{d.plugin.setState(V);const K=d.plugin.getPluginURL();if(d.plugin.isLoaded()&&!d.plugin.isParsed()&&null!=K){this.self.importScripts(K);const fe=d.plugin.isParsed();J(fe?void 0:new Error(`RTL Text Plugin failed to import scripts from ${K}`),fe)}}catch(K){J(K.toString())}}getAvailableImages(O){let V=this.availableImages[O];return V||(V=[]),V}getLayerIndex(O){let V=this.layerIndexes[O];return V||(V=this.layerIndexes[O]=new Jr),V}getWorkerSource(O,V,J){return this.workerSources[O]||(this.workerSources[O]={}),this.workerSources[O][V]||(this.workerSources[O][V]={}),this.workerSources[O][V][J]||(this.workerSources[O][V][J]=new this.workerSourceTypes[V]({send:(K,fe,de,ge,me,we)=>{this.actor.send(K,fe,de,O,me,we)},scheduler:this.actor.scheduler},this.getLayerIndex(O),this.getAvailableImages(O),this.isSpriteLoaded[O])),this.workerSources[O][V][J]}getDEMWorkerSource(O,V){return this.demWorkerSources[O]||(this.demWorkerSources[O]={}),this.demWorkerSources[O][V]||(this.demWorkerSources[O][V]=new Ye),this.demWorkerSources[O][V]}enforceCacheSizeLimit(O,V){d.enforceCacheSizeLimit(V)}getWorkerPerformanceMetrics(O,V,J){J(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new jl(self)),jl}),ah(0,function(d){function Ge(p,i){if(Array.isArray(p)){if(!Array.isArray(i)||p.length!==i.length)return!1;for(let u=0;u<p.length;u++)if(!Ge(p[u],i[u]))return!1;return!0}if("object"==typeof p&&null!==p&&null!==i){if("object"!=typeof i||Object.keys(p).length!==Object.keys(i).length)return!1;for(const u in p)if(!Ge(p[u],i[u]))return!1;return!0}return p===i}var Po=Jr;function Jr(p){return i=p,!("undefined"==typeof window||"undefined"==typeof document||!(Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray)||!Function.prototype||!Function.prototype.bind||!(Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions)||!("JSON"in window&&"parse"in JSON&&"stringify"in JSON)||!function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var g,v,b=new Blob([""],{type:"text/javascript"}),T=URL.createObjectURL(b);try{v=new Worker(T),g=!0}catch(D){g=!1}return v&&v.terminate(),URL.revokeObjectURL(T),g}()||!("Uint8ClampedArray"in window)||!ArrayBuffer.isView||!function(){var g=document.createElement("canvas");g.width=g.height=1;var v=g.getContext("2d");if(!v)return!1;var b=v.getImageData(0,0,1,1);return b&&b.width===g.width}()||(void 0===Ye[u=i&&i.failIfMajorPerformanceCaveat]&&(Ye[u]=function(g){var v,T,D,A,b=(T=g,D=document.createElement("canvas"),(A=Object.create(Jr.webGLContextAttributes)).failIfMajorPerformanceCaveat=T,D.getContext("webgl",A)||D.getContext("experimental-webgl",A));if(!b)return!1;try{v=b.createShader(b.VERTEX_SHADER)}catch(T){return!1}return!(!v||b.isContextLost())&&(b.shaderSource(v,"void main() {}"),b.compileShader(v),!0===b.getShaderParameter(v,b.COMPILE_STATUS))}(u)),!Ye[u]||document.documentMode));var i,u}var Ye={};function Lt(p,i,u){const g=d.window.document.createElement(p);return void 0!==i&&(g.className=i),u&&u.appendChild(g),g}function hn(p,i,u){const g=d.window.document.createElementNS("http://www.w3.org/2000/svg",p);for(const v of Object.keys(i))g.setAttributeNS(null,v,i[v]);return u&&u.appendChild(g),g}Jr.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const ao=d.window.document&&d.window.document.documentElement.style,Ft=ao&&void 0!==ao.userSelect?"userSelect":"WebkitUserSelect";let Qr;function $n(){ao&&Ft&&(Qr=ao[Ft],ao[Ft]="none")}function Za(){ao&&Ft&&(ao[Ft]=Qr)}function sa(p){p.preventDefault(),p.stopPropagation(),d.window.removeEventListener("click",sa,!0)}function Wa(){d.window.addEventListener("click",sa,!0),d.window.setTimeout(()=>{d.window.removeEventListener("click",sa,!0)},0)}function Et(p,i){const u=p.getBoundingClientRect();return Xo(p,u,i)}function Ti(p,i){const u=p.getBoundingClientRect(),g=[];for(let v=0;v<i.length;v++)g.push(Xo(p,u,i[v]));return g}function aa(p){return void 0!==d.window.InstallTrigger&&2===p.button&&p.ctrlKey&&d.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:p.button}function Xo(p,i,u){const g=p.offsetWidth===i.width?1:p.offsetWidth/i.width;return new d.pointGeometry((u.clientX-i.left)*g,(u.clientY-i.top)*g)}function kn(p,i){var u=i[0],g=i[1],v=i[2],b=i[3],T=u*b-v*g;return T?(p[0]=b*(T=1/T),p[1]=-g*T,p[2]=-v*T,p[3]=u*T,p):null}function _r(p){const{userImage:i}=p;return!!(i&&i.render&&i.render())&&(p.data.replace(new Uint8Array(i.data.buffer)),!0)}class wd extends d.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new d.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(i){if(this.loaded!==i&&(this.loaded=i,i)){for(const{ids:u,callback:g}of this.requestors)this._notify(u,g);this.requestors=[]}}hasImage(i){return!!this.getImage(i)}getImage(i){return this.images[i]}addImage(i,u){this._validate(i,u)&&(this.images[i]=u)}_validate(i,u){let g=!0;return this._validateStretch(u.stretchX,u.data&&u.data.width)||(this.fire(new d.ErrorEvent(new Error(`Image "${i}" has invalid "stretchX" value`))),g=!1),this._validateStretch(u.stretchY,u.data&&u.data.height)||(this.fire(new d.ErrorEvent(new Error(`Image "${i}" has invalid "stretchY" value`))),g=!1),this._validateContent(u.content,u)||(this.fire(new d.ErrorEvent(new Error(`Image "${i}" has invalid "content" value`))),g=!1),g}_validateStretch(i,u){if(!i)return!0;let g=0;for(const v of i){if(v[0]<g||v[1]<v[0]||u<v[1])return!1;g=v[1]}return!0}_validateContent(i,u){return!(i&&(4!==i.length||i[0]<0||u.data.width<i[0]||i[1]<0||u.data.height<i[1]||i[2]<0||u.data.width<i[2]||i[3]<0||u.data.height<i[3]||i[2]<i[0]||i[3]<i[1]))}updateImage(i,u){u.version=this.images[i].version+1,this.images[i]=u,this.updatedImages[i]=!0}removeImage(i){const u=this.images[i];delete this.images[i],delete this.patterns[i],u.userImage&&u.userImage.onRemove&&u.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(i,u){let g=!0;if(!this.isLoaded())for(const v of i)this.images[v]||(g=!1);this.isLoaded()||g?this._notify(i,u):this.requestors.push({ids:i,callback:u})}_notify(i,u){const g={};for(const v of i){this.images[v]||this.fire(new d.Event("styleimagemissing",{id:v}));const b=this.images[v];b?g[v]={data:b.data.clone(),pixelRatio:b.pixelRatio,sdf:b.sdf,version:b.version,stretchX:b.stretchX,stretchY:b.stretchY,content:b.content,hasRenderCallback:Boolean(b.userImage&&b.userImage.render)}:d.warnOnce(`Image "${v}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}u(null,g)}getPixelSize(){const{width:i,height:u}=this.atlasImage;return{width:i,height:u}}getPattern(i){const u=this.patterns[i],g=this.getImage(i);if(!g)return null;if(u&&u.position.version===g.version)return u.position;if(u)u.position.version=g.version;else{const v={w:g.data.width+2,h:g.data.height+2,x:0,y:0},b=new d.ImagePosition(v,g);this.patterns[i]={bin:v,position:b}}return this._updatePatternAtlas(),this.patterns[i].position}bind(i){const u=i.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new d.Texture(i,this.atlasImage,u.RGBA),this.atlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE)}_updatePatternAtlas(){const i=[];for(const b in this.patterns)i.push(this.patterns[b].bin);const{w:u,h:g}=d.potpack(i),v=this.atlasImage;v.resize({width:u||1,height:g||1});for(const b in this.patterns){const{bin:T}=this.patterns[b],D=T.x+1,A=T.y+1,k=this.images[b].data,L=k.width,B=k.height;d.RGBAImage.copy(k,v,{x:0,y:0},{x:D,y:A},{width:L,height:B}),d.RGBAImage.copy(k,v,{x:0,y:B-1},{x:D,y:A-1},{width:L,height:1}),d.RGBAImage.copy(k,v,{x:0,y:0},{x:D,y:A+B},{width:L,height:1}),d.RGBAImage.copy(k,v,{x:L-1,y:0},{x:D-1,y:A},{width:1,height:B}),d.RGBAImage.copy(k,v,{x:0,y:0},{x:D+L,y:A},{width:1,height:B})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(i){for(const u of i){if(this.callbackDispatchedThisFrame[u])continue;this.callbackDispatchedThisFrame[u]=!0;const g=this.images[u];_r(g)&&this.updateImage(u,g)}}}const lo=new d.Properties({anchor:new d.DataConstantProperty(d.spec.light.anchor),position:new class{constructor(){this.specification=d.spec.light.position}possiblyEvaluate(p,i){return function([u,g,v]){const b=d.degToRad(g+90),T=d.degToRad(v);return{x:u*Math.cos(b)*Math.sin(T),y:u*Math.sin(b)*Math.sin(T),z:u*Math.cos(T),azimuthal:g,polar:v}}(p.expression.evaluate(i))}interpolate(p,i,u){return{x:d.number(p.x,i.x,u),y:d.number(p.y,i.y,u),z:d.number(p.z,i.z,u),azimuthal:d.number(p.azimuthal,i.azimuthal,u),polar:d.number(p.polar,i.polar,u)}}},color:new d.DataConstantProperty(d.spec.light.color),intensity:new d.DataConstantProperty(d.spec.light.intensity)}),Xa="-transition";class Ol extends d.Evented{constructor(i){super(),this._transitionable=new d.Transitionable(lo),this.setLight(i),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,u={}){if(!this._validate(d.validateLight,i,u))for(const g in i){const v=i[g];d.endsWith(g,Xa)?this._transitionable.setTransition(g.slice(0,-Xa.length),v):this._transitionable.setValue(g,v)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,g){return(!g||!1!==g.validate)&&d.emitValidationErrors(this,i.call(d.validateStyle,d.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}const Ui=new d.Properties({source:new d.DataConstantProperty(d.spec.terrain.source),exaggeration:new d.DataConstantProperty(d.spec.terrain.exaggeration)}),Yo="-transition";class Ko extends d.Evented{constructor(i,u){super(),this._transitionable=new d.Transitionable(Ui),this.set(i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=u}get(){return this._transitionable.serialize()}set(i){for(const u in i){const g=i[u];d.endsWith(u,Yo)?this._transitionable.setTransition(u.slice(0,-Yo.length),g):this._transitionable.setValue(u,g)}}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}}function Vt(p,i,u,g){const v=d.smoothstep(45,65,u),[b,T]=la(p,g),D=d.length(i);let A=1-Math.min(1,Math.exp((D-b)/(T-b)*-6));return A*=A*A,A=Math.min(1,1.00747*A),A*v*p.alpha}function la(p,i){const u=.5/Math.tan(.5*i);return[p.range[0]+u,p.range[1]+u]}const ji=new d.Properties({range:new d.DataConstantProperty(d.spec.fog.range),color:new d.DataConstantProperty(d.spec.fog.color),"high-color":new d.DataConstantProperty(d.spec.fog["high-color"]),"space-color":new d.DataConstantProperty(d.spec.fog["space-color"]),"horizon-blend":new d.DataConstantProperty(d.spec.fog["horizon-blend"]),"star-intensity":new d.DataConstantProperty(d.spec.fog["star-intensity"])}),Ya="-transition";class rr extends d.Evented{constructor(i,u){super(),this._transitionable=new d.Transitionable(ji),this.set(i),this._transitioning=this._transitionable.untransitioned(),this._transform=u}get state(){const i=this._transform,u="globe"===i.projection.name,g=d.globeToMercatorTransition(i.zoom),v=this.properties.get("range"),b=[.5,3];return{range:u?[d.number(b[0],v[0],g),d.number(b[1],v[1],g)]:v,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,u={}){if(!this._validate(d.validateFog,i,u)){for(const g of Object.keys(d.spec.fog))i&&void 0===i[g]&&(i[g]=d.spec.fog[g].default);for(const g in i){const v=i[g];d.endsWith(g,Ya)?this._transitionable.setTransition(g.slice(0,-Ya.length),v):this._transitionable.setValue(g,v)}}}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const u=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:d.smoothstep(45,65,i))*u.a}getOpacityAtLatLng(i,u){return this._transform.projection.supportsFog?function(g,v,b){const T=d.MercatorCoordinate.fromLngLat(v),D=b.elevation?b.elevation.getAtPointOrZero(T):0,A=[T.x,T.y,D];return d.transformMat4(A,A,b.mercatorFogMatrix),Vt(g,A,b.pitch,b._fov)}(this.state,i,u):0}getFovAdjustedRange(i){return this._transform.projection.supportsFog?la(this.state,i):[0,1]}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,u,g){return(!g||!1!==g.validate)&&d.emitValidationErrors(this,i.call(d.validateStyle,d.extend({value:u,style:{glyphs:!0,sprite:!0},styleSpec:d.spec})))}}class Ur{constructor(i,u){this.workerPool=i,this.actors=[],this.currentActor=0,this.id=d.uniqueId();const g=this.workerPool.acquire(this.id);for(let v=0;v<g.length;v++){const b=new Ur.Actor(g[v],u,this.id);b.name=`Worker ${v}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(i,u,g){d.asyncAll(this.actors,(v,b)=>{v.send(i,u,b)},g=g||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(i=>{i.remove()}),this.actors=[],this.workerPool.release(this.id)}}function $i(p,i,u){return i*(d.EXTENT/(p.tileSize*Math.pow(2,u-p.tileID.overscaledZ)))}Ur.Actor=d.Actor;class Gi{constructor(i,u,g,v){this.screenBounds=i,this.cameraPoint=u,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=g,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,v)}static createFromScreenPoints(i,u){let g,v;if(i instanceof d.pointGeometry||"number"==typeof i[0]){const b=d.pointGeometry.convert(i);g=[d.pointGeometry.convert(i)],v=u.isPointAboveHorizon(b)}else{const b=d.pointGeometry.convert(i[0]),T=d.pointGeometry.convert(i[1]);g=[b,T],v=d.polygonizeBounds(b,T).every(D=>u.isPointAboveHorizon(D))}return new Gi(g,u.getCameraPoint(),v,u)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(i){return d.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],v=d.polygonizeBounds(u,g,0,!1);return this.cameraPoint.y>g.y&&(this.cameraPoint.x>u.x&&this.cameraPoint.x<g.x?v.splice(3,0,this.cameraPoint):this.cameraPoint.x>=g.x?v[2]=this.cameraPoint:this.cameraPoint.x<=u.x&&(v[3]=this.cameraPoint)),d.bufferConvexPolygon(v,i)}bufferedCameraGeometryGlobe(i){const u=this.screenBounds[0],g=1===this.screenBounds.length?this.screenBounds[0].add(new d.pointGeometry(1,1)):this.screenBounds[1],v=d.polygonizeBounds(u,g,i),b=this.cameraPoint.clone();switch(3*((b.y>u.y)+(b.y>g.y))+((b.x>u.x)+(b.x>g.x))){case 0:v[0]=b,v[4]=b.clone();break;case 1:v.splice(1,0,b);break;case 2:v[1]=b;break;case 3:v.splice(4,0,b);break;case 5:v.splice(2,0,b);break;case 6:v[3]=b;break;case 7:v.splice(3,0,b);break;case 8:v[2]=b}return v}containsTile(i,u,g,v=0){const b=i.queryPadding/u._projectionScaler+1,T=g?this._bufferedCameraMercator(b,u):this._bufferedScreenMercator(b,u);let D=i.tileID.wrap+(T.unwrapped?v:0);const A=T.polygon.map(ne=>d.getTilePoint(i.tileTransform,ne,D));if(!d.polygonIntersectsBox(A,0,0,d.EXTENT,d.EXTENT))return;D=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?v:0);const k=this.screenGeometryMercator.polygon.map(ne=>d.getTileVec3(i.tileTransform,ne,D)),L=k.map(ne=>new d.pointGeometry(ne[0],ne[1])),B=u.getFreeCameraOptions().position||new d.MercatorCoordinate(0,0,0),j=d.getTileVec3(i.tileTransform,B,D),H=k.map(ne=>{const W=d.sub(ne,ne,j);return d.normalize(W,W),new d.Ray(j,W)}),Z=$i(i,1,u.zoom)*u._projectionScaler;return{queryGeometry:this,tilespaceGeometry:L,tilespaceRays:H,bufferedTilespaceGeometry:A,bufferedTilespaceBounds:(G=d.getBounds(A),G.min.x=d.clamp(G.min.x,0,d.EXTENT),G.min.y=d.clamp(G.min.y,0,d.EXTENT),G.max.x=d.clamp(G.max.x,0,d.EXTENT),G.max.y=d.clamp(G.max.y,0,d.EXTENT),G),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:Z};var G}_bufferedScreenMercator(i,u){const g=ca(i);if(this._screenRaycastCache[g])return this._screenRaycastCache[g];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedScreenGeometry(i),u):{polygon:this.bufferedScreenGeometry(i).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._screenRaycastCache[g]=v,v}}_bufferedCameraMercator(i,u){const g=ca(i);if(this._cameraRaycastCache[g])return this._cameraRaycastCache[g];{let v;return v="globe"===u.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),u):{polygon:this.bufferedCameraGeometry(i).map(b=>u.pointCoordinate3D(b)),unwrapped:!0},this._cameraRaycastCache[g]=v,v}}_projectAndResample(i,u){const g=function(b,T){const D=d.multiply([],T.pixelMatrix,T.globeMatrix),A=[0,-d.GLOBE_RADIUS,0,1],k=[0,d.GLOBE_RADIUS,0,1],L=[0,0,0,1];d.transformMat4$1(A,A,D),d.transformMat4$1(k,k,D),d.transformMat4$1(L,L,D);const B=new d.pointGeometry(A[0]/A[3],A[1]/A[3]),j=new d.pointGeometry(k[0]/k[3],k[1]/k[3]),H=d.polygonContainsPoint(b,B)&&A[3]<L[3],Z=d.polygonContainsPoint(b,j)&&k[3]<L[3];if(!H&&!Z)return null;const G=function(ue,Ce,Se){for(let be=1;be<ue.length;be++){const Ve=Qo(Ce.pointCoordinate3D(ue[be-1]).x),ie=Qo(Ce.pointCoordinate3D(ue[be]).x);if(Se<0){if(Ve<ie)return{idx:be,t:-Ve/(ie-1-Ve)}}else if(ie<Ve)return{idx:be,t:(1-Ve)/(ie+1-Ve)}}return null}(b,T,H?-1:1);if(!G)return null;const{idx:ne,t:W}=G;let Q=ne>1?Jo(b.slice(0,ne),T):[],q=ne<b.length?Jo(b.slice(ne),T):[];Q=Q.map(ue=>new d.pointGeometry(Qo(ue.x),ue.y)),q=q.map(ue=>new d.pointGeometry(Qo(ue.x),ue.y));const le=[...Q];0===le.length&&le.push(q[q.length-1]);const te=d.number(le[le.length-1].y,(0===q.length?Q[0]:q[0]).y,W);let re;return re=H?[new d.pointGeometry(0,te),new d.pointGeometry(0,0),new d.pointGeometry(1,0),new d.pointGeometry(1,te)]:[new d.pointGeometry(1,te),new d.pointGeometry(1,1),new d.pointGeometry(0,1),new d.pointGeometry(0,te)],le.push(...re),0===q.length?le.push(Q[0]):le.push(...q),{polygon:le.map(ue=>new d.MercatorCoordinate(ue.x,ue.y)),unwrapped:!1}}(i,u);if(g)return g;const v=function(b,T){let D=!1,A=-1/0,k=0;for(let B=0;B<b.length-1;B++)b[B].x>A&&(A=b[B].x,k=B);for(let B=0;B<b.length-1;B++){const j=(k+B)%(b.length-1),H=b[j],Z=b[j+1];Math.abs(H.x-Z.x)>.5&&(H.x<Z.x?(H.x+=1,0===j&&(b[b.length-1].x+=1)):(Z.x+=1,j+1===b.length-1&&(b[0].x+=1)),D=!0)}const L=d.mercatorXfromLng(T.center.lng);return D&&L<Math.abs(L-1)&&b.forEach(B=>{B.x-=1}),{polygon:b,unwrapped:D}}(Jo(i,u).map(b=>new d.pointGeometry(Qo(b.x),b.y)),u);return{polygon:v.polygon.map(b=>new d.MercatorCoordinate(b.x,b.y)),unwrapped:v.unwrapped}}}function Jo(p,i){return d.resample(p,u=>{const g=i.pointCoordinate3D(u);u.x=g.x,u.y=g.y},1/256)}function Qo(p){return p<0?1+p%1:p%1}function ca(p){return 100*p|0}function Ka(p,i,u,g,v){const b=function(T,D){if(T)return v(T);if(D){const A=d.pick(d.extend(D,p),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);D.vector_layers&&(A.vectorLayers=D.vector_layers,A.vectorLayerIds=A.vectorLayers.map(k=>k.id)),D.language_options&&(A.languageOptions=D.language_options),D.language&&D.language[D.id]&&(A.language=D.language[D.id]),D.worldview_options&&(A.worldviewOptions=D.worldview_options),D.worldview?A.worldview=D.worldview[D.id]:D.worldview_default&&(A.worldview=D.worldview_default),A.tiles=i.canonicalizeTileset(A,p.url),v(null,A)}};return p.url?d.getJSON(i.transformRequest(i.normalizeSourceURL(p.url,null,u,g),d.ResourceType.Source),b):d.exported.frame(()=>b(null,p))}class co{constructor(i,u,g){this.bounds=d.LngLatBounds.convert(this.validateBounds(i)),this.minzoom=u||0,this.maxzoom=g||24}validateBounds(i){return Array.isArray(i)&&4===i.length?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}contains(i){const u=Math.pow(2,i.z),g=Math.floor(d.mercatorXfromLng(this.bounds.getWest())*u),v=Math.floor(d.mercatorYfromLat(this.bounds.getNorth())*u),b=Math.ceil(d.mercatorXfromLng(this.bounds.getEast())*u),T=Math.ceil(d.mercatorYfromLat(this.bounds.getSouth())*u);return i.x>=g&&i.x<b&&i.y>=v&&i.y<T}}class Nc{constructor(i,u,g){this.context=i;const v=i.gl;this.buffer=v.createBuffer(),this.dynamicDraw=Boolean(g),this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;this.context.unbindVAO(),this.bind(),u.bufferSubData(u.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const ua={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class es{constructor(i,u,g,v){this.length=u.length,this.attributes=g,this.itemSize=u.bytesPerElement,this.dynamicDraw=v,this.context=i;const b=i.gl;this.buffer=b.createBuffer(),i.bindVertexBuffer.set(this.buffer),b.bufferData(b.ARRAY_BUFFER,u.arrayBuffer,this.dynamicDraw?b.DYNAMIC_DRAW:b.STATIC_DRAW),this.dynamicDraw||u.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const u=this.context.gl;this.bind(),u.bufferSubData(u.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,u){for(let g=0;g<this.attributes.length;g++){const v=u.attributes[this.attributes[g].name];void 0!==v&&i.enableVertexAttribArray(v)}}setVertexAttribPointers(i,u,g){for(let v=0;v<this.attributes.length;v++){const b=this.attributes[v],T=u.attributes[b.name];void 0!==T&&i.vertexAttribPointer(T,b.components,i[ua[b.type]],!1,this.itemSize,b.offset+this.itemSize*(g||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class en{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class ts extends en{getDefault(){return d.Color.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class ha extends en{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class ko extends en{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class zn extends en{getDefault(){return[!0,!0,!0,!0]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Ds extends en{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class tn extends en{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class Ro extends en{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const u=this.current;(i.func!==u.func||i.ref!==u.ref||i.mask!==u.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class Ss extends en{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class uo extends en{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.STENCIL_TEST):u.disable(u.STENCIL_TEST),this.current=i,this.dirty=!1}}class ir extends en{getDefault(){return[0,1]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class Ja extends en{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.DEPTH_TEST):u.disable(u.DEPTH_TEST),this.current=i,this.dirty=!1}}class zl extends en{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Vc extends en{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.BLEND):u.disable(u.BLEND),this.current=i,this.dirty=!1}}class Or extends en{getDefault(){const i=this.gl;return[i.ONE,i.ZERO]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||this.dirty)&&(this.gl.blendFunc(i[0],i[1]),this.current=i,this.dirty=!1)}}class Hi extends en{getDefault(){return d.Color.transparent}set(i){const u=this.current;(i.r!==u.r||i.g!==u.g||i.b!==u.b||i.a!==u.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class da extends en{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquation(i),this.current=i,this.dirty=!1)}}class Qa extends en{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;i?u.enable(u.CULL_FACE):u.disable(u.CULL_FACE),this.current=i,this.dirty=!1}}class Di extends en{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class ns extends en{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}class Bl extends en{getDefault(){return null}set(i){(i!==this.current||this.dirty)&&(this.gl.useProgram(i),this.current=i,this.dirty=!1)}}class Nl extends en{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Vl extends en{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const u=this.current;(i[0]!==u[0]||i[1]!==u[1]||i[2]!==u[2]||i[3]!==u[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Uc extends en{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindFramebuffer(u.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class Ul extends en{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindRenderbuffer(u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class jc extends en{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindTexture(u.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class $c extends en{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.bindBuffer(u.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class lh extends en{getDefault(){return null}set(i){const u=this.gl;u.bindBuffer(u.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class Ms extends en{constructor(i){super(i),this.vao=i.extVertexArrayObject}getDefault(){return null}set(i){this.vao&&(i!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(i),this.current=i,this.dirty=!1)}}class sn extends en{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class As extends en{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class mn extends en{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const u=this.gl;u.pixelStorei(u.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class jr extends en{constructor(i,u){super(i),this.context=i,this.parent=u}getDefault(){return null}}class jl extends jr{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class Y extends jr{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const u=this.gl;u.framebufferRenderbuffer(u.FRAMEBUFFER,this.attachment(),u.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class O extends Y{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class V{constructor(i,u,g,v){this.context=i,this.width=u,this.height=g;const b=this.framebuffer=i.gl.createFramebuffer();this.colorAttachment=new jl(i,b),v&&(this.depthAttachment=new Y(i,b))}destroy(){const i=this.context.gl,u=this.colorAttachment.get();if(u&&i.deleteTexture(u),this.depthAttachment){const g=this.depthAttachment.get();g&&i.deleteRenderbuffer(g)}i.deleteFramebuffer(this.framebuffer)}}class J{constructor(i){this.gl=i,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new ts(this),this.clearDepth=new ha(this),this.clearStencil=new ko(this),this.colorMask=new zn(this),this.depthMask=new Ds(this),this.stencilMask=new tn(this),this.stencilFunc=new Ro(this),this.stencilOp=new Ss(this),this.stencilTest=new uo(this),this.depthRange=new ir(this),this.depthTest=new Ja(this),this.depthFunc=new zl(this),this.blend=new Vc(this),this.blendFunc=new Or(this),this.blendColor=new Hi(this),this.blendEquation=new da(this),this.cullFace=new Qa(this),this.cullFaceSide=new Di(this),this.frontFace=new ns(this),this.program=new Bl(this),this.activeTexture=new Nl(this),this.viewport=new Vl(this),this.bindFramebuffer=new Uc(this),this.bindRenderbuffer=new Ul(this),this.bindTexture=new jc(this),this.bindVertexBuffer=new $c(this),this.bindElementBuffer=new lh(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new Ms(this),this.pixelStoreUnpack=new sn(this),this.pixelStoreUnpackPremultiplyAlpha=new As(this),this.pixelStoreUnpackFlipY=new mn(this),this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extStandardDerivativesForceOff=!1,this.extTextureHalfFloat=i.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(i.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float")),this.extStandardDerivatives=i.getExtension("OES_standard_derivatives"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,u){return new Nc(this,i,u)}createVertexBuffer(i,u,g){return new es(this,i,u,g)}createRenderbuffer(i,u,g){const v=this.gl,b=v.createRenderbuffer();return this.bindRenderbuffer.set(b),v.renderbufferStorage(v.RENDERBUFFER,i,u,g),this.bindRenderbuffer.set(null),b}createFramebuffer(i,u,g){return new V(this,i,u,g)}clear({color:i,depth:u,stencil:g}){const v=this.gl;let b=0;i&&(b|=v.COLOR_BUFFER_BIT,this.clearColor.set(i),this.colorMask.set([!0,!0,!0,!0])),void 0!==u&&(b|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(u),this.depthMask.set(!0)),void 0!==g&&(b|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(g),this.stencilMask.set(255)),v.clear(b)}setCullFace(i){!1===i.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){Ge(i.blendFunction,d.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor)),this.colorMask.set(i.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class K extends d.Evented{constructor(i,u,g,v){super(),this.id=i,this.dispatcher=g,this.setEventedParent(v),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=d.extend({type:"raster"},u),d.extend(this,d.pick(u,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=Ka(this._options,this.map._requestManager,null,null,(i,u)=>{this._tileJSONRequest=null,this._loaded=!0,i?this.fire(new d.ErrorEvent(i)):u&&(d.extend(this,u),u.bounds&&(this.tileBounds=new co(u.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(u.tiles),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,u){const g=d.exported.devicePixelRatio>=2,v=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),g,this.tileSize);i.request=d.getImage(this.map._requestManager.transformRequest(v,d.ResourceType.Tile),(b,T,D,A)=>(delete i.request,i.aborted?(i.state="unloaded",u(null)):b?(i.state="errored",u(b)):T?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:D,expires:A}),i.setTexture(T,this.map.painter),i.state="loaded",d.cacheEntryPossiblyAdded(this.dispatcher),void u(null)):u(null)))}static loadTileData(i,u,g){i.setTexture(u,g)}static unloadTileData(i,u){i.texture&&u.saveTileTexture(i.texture)}abortTile(i,u){i.request&&(i.request.cancel(),delete i.request),u()}unloadTile(i,u){i.texture&&this.map.painter.saveTileTexture(i.texture),u()}hasTransition(){return!1}}let fe;function de(p,i,u,g,v,b,T,D){const A=[p,u,v,i,g,b,1,1,1],k=[T,D,1],L=d.adjoint([],A),[B,j,H]=d.transformMat3(k,k,d.transpose(L,L));return d.multiply$1(A,[B,0,0,0,j,0,0,0,H],A)}class ge extends d.Evented{constructor(i,u,g,v){super(),this.id=i,this.dispatcher=g,this.coordinates=u.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(v),this.options=u}load(i,u){this._loaded=u||!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this.url=this.options.url,d.getImage(this.map._requestManager.transformRequest(this.url,d.ResourceType.Image),(g,v)=>{if(this._loaded=!0,g)this.fire(new d.ErrorEvent(g));else if(v){const{HTMLImageElement:b}=d.window;this.image=v instanceof b?d.exported.getImageData(v):v,this.width=this.image.width,this.height=this.image.height,i&&(this.coordinates=i),this._finishLoading()}})}loaded(){return this._loaded}updateImage(i){return this.image&&i.url?(this.options.url=i.url,this.load(i.coordinates,this._loaded),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(i){this.map=i,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(i){this.coordinates=i,this._boundsArray=void 0;const u=i.map(d.MercatorCoordinate.fromLngLat);return this.tileID=function(g){let v=1/0,b=1/0,T=-1/0,D=-1/0;for(const B of g)v=Math.min(v,B.x),b=Math.min(b,B.y),T=Math.max(T,B.x),D=Math.max(D,B.y);const A=Math.max(T-v,D-b),k=Math.max(0,Math.floor(-Math.log(A)/Math.LN2)),L=Math.pow(2,k);return new d.CanonicalTileID(k,Math.floor((v+T)/2*L),Math.floor((b+D)/2*L))}(u),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(i){for(const A in this.tiles){const k=this.tiles[A];"loaded"!==k.state&&(k.state="loaded",k.texture=this.texture)}if(this._boundsArray)return;const u=d.tileTransform(this.tileID,this.map.transform.projection),[g,v,b,T]=this.coordinates.map(A=>{const k=u.projection.project(A[0],A[1]);return d.getTilePoint(u,k)._round()});this.perspectiveTransform=function(A,k,L,B,j,H,Z,G,ne,W){const Q=de(0,0,A,0,0,k,A,k),q=de(L,B,j,H,Z,G,ne,W);return d.multiply$1(q,d.adjoint(Q,Q),q),[q[6]/q[8]*A/d.EXTENT,q[7]/q[8]*k/d.EXTENT]}(this.width,this.height,g.x,g.y,v.x,v.y,T.x,T.y,b.x,b.y);const D=this._boundsArray=new d.StructArrayLayout4i8;D.emplaceBack(g.x,g.y,0,0),D.emplaceBack(v.x,v.y,d.EXTENT,0),D.emplaceBack(T.x,T.y,0,d.EXTENT),D.emplaceBack(b.x,b.y,d.EXTENT,d.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=i.createVertexBuffer(D,d.boundsAttributes.members),this.boundsSegments=d.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const i=this.map.painter.context,u=i.gl;this.texture?this.texture.update(this.image):(this.texture=new d.Texture(i,this.image,u.RGBA),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._prepareData(i)}loadTile(i,u){this.tileID&&this.tileID.equals(i.tileID.canonical)?(this.tiles[String(i.tileID.wrap)]=i,i.buckets={},u(null)):(i.state="errored",u(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const me={vector:class extends d.Evented{constructor(p,i,u,g){if(super(),this.id=p,this.dispatcher=u,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,d.extend(this,d.pick(i,["url","scheme","tileSize","promoteId"])),this._options=d.extend({type:"vector"},i),this._collectResourceTiming=i.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(g),this._tileWorkers={},this._deduped=new d.DedupedRequest}load(p){this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"}));const i=this.language||this.map._language,u=this.worldview||this.map._worldview;this._tileJSONRequest=Ka(this._options,this.map._requestManager,i,u,(g,v)=>{this._tileJSONRequest=null,this._loaded=!0,g?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code. Found: ${i}`),u&&2!==u.length&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${u}`),this.fire(new d.ErrorEvent(g))):v&&(d.extend(this,v),v.bounds&&(this.tileBounds=new co(v.bounds,this.minzoom,this.maxzoom)),d.postTurnstileEvent(v.tiles,this.map._requestManager._customAccessToken),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))),p&&p(g)})}loaded(){return this._loaded}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}onAdd(p){this.map=p,this.load()}setSourceProperty(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.load(()=>{const i=this.map.style._getSourceCaches(this.id);for(const u of i)u.clearTiles()})}setTiles(p){return this.setSourceProperty(()=>{this._options.tiles=p}),this}setUrl(p){return this.setSourceProperty(()=>{this.url=p,this._options.url=p}),this}_setLanguage(p){return p===this.language||this.setSourceProperty(()=>{this.language=p}),this}_setWorldview(p){return p===this.worldview?this:this.worldviewOptions&&p&&!this.worldviewOptions[p]?(console.warn(`Vector tile source "${this.id}" does not support worldview "${p}".`),this):(this.setSourceProperty(()=>{this.worldview=p}),this)}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return d.extend({},this._options)}loadTile(p,i){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),g={request:this.map._requestManager.transformRequest(u,d.ResourceType.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:p.isSymbolTile};if(g.request.collectResourceTiming=this._collectResourceTiming,p.actor&&"expired"!==p.state)"loading"===p.state?p.reloadCallback=i:p.request=p.actor.send("reloadTile",g,v.bind(this));else if(p.actor=this._tileWorkers[u]=this._tileWorkers[u]||this.dispatcher.getActor(),this.dispatcher.ready)p.request=p.actor.send("loadTile",g,v.bind(this),void 0,!0);else{const b=d.loadVectorTile.call({deduped:this._deduped},g,(T,D)=>{T||!D?v.call(this,T):(g.data={cacheControl:D.cacheControl,expires:D.expires,rawData:D.rawData.slice(0)},p.actor&&p.actor.send("loadTile",g,v.bind(this),void 0,!0))},!0);p.request={cancel:b}}function v(b,T){return delete p.request,p.aborted?i(null):b&&404!==b.status?i(b):(T&&T.resourceTiming&&(p.resourceTiming=T.resourceTiming),this.map._refreshExpiredTiles&&T&&p.setExpiryData(T),p.loadVectorData(T,this.map.painter),d.cacheEntryPossiblyAdded(this.dispatcher),i(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id})}unloadTile(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:K,"raster-dem":class extends K{constructor(p,i,u,g){super(p,i,u,g),this.type="raster-dem",this.maxzoom=22,this._options=d.extend({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(p,i){const u=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function g(v,b){v&&(p.state="errored",i(v)),b&&(p.dem=b,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",i(null))}p.request=d.getImage(this.map._requestManager.transformRequest(u,d.ResourceType.Tile),function(v,b,T,D){if(delete p.request,p.aborted)p.state="unloaded",i(null);else if(v)p.state="errored",i(v);else if(b){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:T,expires:D});const A=d.window.ImageBitmap&&b instanceof d.window.ImageBitmap&&(null==fe&&(fe=d.window.OffscreenCanvas&&new d.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof d.window.createImageBitmap),fe),k=1-(b.width-d.prevPowerOfTwo(b.width))/2;k<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const L=A?b:d.exported.getImageData(b,k),B={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:L,encoding:this.encoding,padding:k};p.actor&&"expired"!==p.state||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",B,g.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(p){const i=p.canonical,u=Math.pow(2,i.z),g=(i.x-1+u)%u,v=0===i.x?p.wrap-1:p.wrap,b=(i.x+1+u)%u,T=i.x+1===u?p.wrap+1:p.wrap,D={};return D[new d.OverscaledTileID(p.overscaledZ,v,i.z,g,i.y).key]={backfilled:!1},D[new d.OverscaledTileID(p.overscaledZ,T,i.z,b,i.y).key]={backfilled:!1},i.y>0&&(D[new d.OverscaledTileID(p.overscaledZ,v,i.z,g,i.y-1).key]={backfilled:!1},D[new d.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},D[new d.OverscaledTileID(p.overscaledZ,T,i.z,b,i.y-1).key]={backfilled:!1}),i.y+1<u&&(D[new d.OverscaledTileID(p.overscaledZ,v,i.z,g,i.y+1).key]={backfilled:!1},D[new d.OverscaledTileID(p.overscaledZ,p.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},D[new d.OverscaledTileID(p.overscaledZ,T,i.z,b,i.y+1).key]={backfilled:!1}),D}unloadTile(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded"}},geojson:class extends d.Evented{constructor(p,i,u,g){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=u.getActor(),this.setEventedParent(g),this._data=i.data,this._options=d.extend({},i),this._collectResourceTiming=i.collectResourceTiming,void 0!==i.maxzoom&&(this.maxzoom=i.maxzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const v=d.EXTENT/this.tileSize;this.workerOptions=d.extend({source:this.id,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(void 0!==i.buffer?i.buffer:128)*v,tolerance:(void 0!==i.tolerance?i.tolerance:.375)*v,extent:d.EXTENT,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:void 0!==i.clusterMaxZoom?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:d.EXTENT,radius:(void 0!==i.clusterRadius?i.clusterRadius:50)*v,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter},i.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}getClusterExpansionZoom(p,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},i),this}getClusterChildren(p,i){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},i),this}getClusterLeaves(p,i,u,g){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:i,offset:u},g),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new d.Event("dataloading",{dataType:"source"})),this._loaded=!1;const p=d.extend({},this.workerOptions),i=this._data;"string"==typeof i?(p.request=this.map._requestManager.transformRequest(d.exported.resolveURL(i),d.ResourceType.Source),p.request.collectResourceTiming=this._collectResourceTiming):p.data=JSON.stringify(i),this._pendingLoad=this.actor.send(`${this.type}.loadData`,p,(u,g)=>{if(this._loaded=!0,this._pendingLoad=null,u)this.fire(new d.ErrorEvent(u));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&g&&g.resourceTiming&&g.resourceTiming[this.id]&&(v.resourceTiming=g.resourceTiming[this.id]),this.fire(new d.Event("data",v)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(p,i){const u=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(u,{type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:d.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(g,v)=>(delete p.request,p.unloadVectorData(),p.aborted?i(null):g?i(g):(p.loadVectorData(v,this.map.painter,"reloadTile"===u),i(null))),void 0,"loadTile"===u)}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return d.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends ge{constructor(p,i,u,g){super(p,i,u,g),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const i of p.urls)this.urls.push(this.map._requestManager.transformRequest(i,d.ResourceType.Source).url);d.getVideo(this.urls,(i,u)=>{this._loaded=!0,i?this.fire(new d.ErrorEvent(i)):u&&(this.video=u,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const i=this.video.seekable;p<i.start(0)||p>i.end(0)?this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const p=this.map.painter.context,i=p.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new d.Texture(p,this.video,i.RGBA),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:ge,canvas:class extends ge{constructor(p,i,u,g){super(p,i,u,g),i.coordinates?Array.isArray(i.coordinates)&&4===i.coordinates.length&&!i.coordinates.some(v=>!Array.isArray(v)||2!==v.length||v.some(b=>"number"!=typeof b))||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "coordinates"'))),i.animate&&"boolean"!=typeof i.animate&&this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),i.canvas?"string"==typeof i.canvas||i.canvas instanceof d.window.HTMLCanvasElement||this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new d.ErrorEvent(new d.ValidationError(`sources.${p}`,null,'missing required property "canvas"'))),this.options=i,this.animate=void 0===i.animate||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof d.window.HTMLCanvasElement?this.options.canvas:d.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new d.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||0===Object.keys(this.tiles).length)return;const i=this.map.painter.context;this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new d.Texture(i,this.canvas,i.gl.RGBA,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends d.Evented{constructor(p,i,u,g){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=u,this._implementation=i,this.setEventedParent(g),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new d.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new d.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new co(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.coveringTiles=this._coveringTiles.bind(this),d.extend(this,d.pick(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return d.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new d.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this._map=p,this._loaded=!1,this.fire(new d.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:i,y:u,z:g}=p.canonical;return this._implementation.hasTile({x:i,y:u,z:g})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,i){const{x:u,y:g,z:v}=p.tileID.canonical,b=new d.window.AbortController,T=this._implementation.loadTile({x:u,y:g,z:v},{signal:b.signal});if(!T)return this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",i(null);T.cancel=()=>b.abort(),p.request=T.then(function(D){return delete p.request,p.aborted?(p.state="unloaded",i(null)):D?(A=D)instanceof d.window.ImageData||A instanceof d.window.ImageBitmap||A instanceof d.window.HTMLCanvasElement?(this.loadTileData(p,D),p.state="loaded",void i(null)):(p.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",i(null));var A}.bind(this)).catch(D=>{20!==D.code&&(p.state="errored",i(D))})}loadTileData(p,i){K.loadTileData(p,i,this._map.painter)}unloadTileData(p){K.unloadTileData(p,this._map.painter)}prepareTile(p){if(!this._implementation.prepareTile)return null;const{x:i,y:u,z:g}=p.tileID.canonical,v=this._implementation.prepareTile({x:i,y:u,z:g});return v?(this.loadTileData(p,v),p.state="loaded",v):null}unloadTile(p,i){if(this.unloadTileData(p),this._implementation.unloadTile){const{x:u,y:g,z:v}=p.tileID.canonical;this._implementation.unloadTile({x:u,y:g,z:v})}i()}abortTile(p,i){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),i()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_update(){this.fire(new d.Event("data",{dataType:"source",sourceDataType:"content"}))}}},we=function(p,i,u,g){const v=new me[i.type](p,i,u,g);if(v.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${v.id}`);return d.bindAll(["load","abort","unload","serialize","prepare"],v),v};function Le(p,i){const u=d.identity([]);return d.scale(u,u,[.5*p.width,.5*-p.height,1]),d.translate(u,u,[1,-1,0]),d.multiply(u,u,p.calculateProjMatrix(i.toUnwrapped())),Float32Array.from(u)}function et(p,i,u,g,v,b,T,D=!1){const A=p.tilesIn(g,T,D);A.sort(gt);const k=[];for(const B of A)k.push({wrappedTileID:B.tile.tileID.wrapped().key,queryResults:B.tile.queryRenderedFeatures(i,u,p._state,B,v,b,Le(p.transform,B.tile.tileID),D)});const L=function(B){const j={},H={};for(const Z of B){const G=Z.queryResults,ne=Z.wrappedTileID,W=H[ne]=H[ne]||{};for(const Q in G){const q=G[Q],le=W[Q]=W[Q]||{},te=j[Q]=j[Q]||[];for(const re of q)le[re.featureIndex]||(le[re.featureIndex]=!0,te.push(re))}}return j}(k);for(const B in L)L[B].forEach(j=>{const H=j.feature,Z=H.layer;Z&&"background"!==Z.type&&"sky"!==Z.type&&(H.source=Z.source,Z["source-layer"]&&(H.sourceLayer=Z["source-layer"]),H.state=void 0!==H.id?p.getFeatureState(Z["source-layer"],H.id):{})});return L}function Re(p,i){const u=p.getRenderableIds().map(b=>p.getTileByID(b)),g=[],v={};for(let b=0;b<u.length;b++){const T=u[b],D=T.tileID.canonical.key;v[D]||(v[D]=!0,T.querySourceFeatures(g,i))}return g}function gt(p,i){const u=p.tileID,g=i.tileID;return u.overscaledZ-g.overscaledZ||u.canonical.y-g.canonical.y||u.wrap-g.wrap||u.canonical.x-g.canonical.x}function yt(){return null!=Sa.workerClass?new Sa.workerClass:new d.window.Worker(Sa.workerUrl)}const _t="mapboxgl_preloaded_worker_pool";class dt{constructor(){this.active={}}acquire(i){if(!this.workers)for(this.workers=[];this.workers.length<dt.workerCount;)this.workers.push(new yt);return this.active[i]=!0,this.workers.slice()}release(i){delete this.active[i],0===this.numActive()&&(this.workers.forEach(u=>{u.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[_t]}numActive(){return Object.keys(this.active).length}}let zt;function an(){return zt||(zt=new dt),zt}function Bn(p,i){const u={};for(const g in p)"ref"!==g&&(u[g]=p[g]);return d.refProperties.forEach(g=>{g in i&&(u[g]=i[g])}),u}function gn(p){p=p.slice();const i=Object.create(null);for(let u=0;u<p.length;u++)i[p[u].id]=p[u];for(let u=0;u<p.length;u++)"ref"in p[u]&&(p[u]=Bn(p[u],i[p[u].ref]));return p}dt.workerCount=2;const ye={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qi(p,i,u){u.push({command:ye.addSource,args:[p,i[p]]})}function Zn(p,i,u){i.push({command:ye.removeSource,args:[p]}),u[p]=!0}function ho(p,i,u,g){Zn(p,u,g),qi(p,i,u)}function Si(p,i,u){let g;for(g in p[u])if(p[u].hasOwnProperty(g)&&"data"!==g&&!Ge(p[u][g],i[u][g]))return!1;for(g in i[u])if(i[u].hasOwnProperty(g)&&"data"!==g&&!Ge(p[u][g],i[u][g]))return!1;return!0}function qt(p,i,u,g,v,b){let T;for(T in i=i||{},p=p||{})p.hasOwnProperty(T)&&(Ge(p[T],i[T])||u.push({command:b,args:[g,T,i[T],v]}));for(T in i)i.hasOwnProperty(T)&&!p.hasOwnProperty(T)&&(Ge(p[T],i[T])||u.push({command:b,args:[g,T,i[T],v]}))}function ch(p){return p.id}function df(p,i){return p[i.id]=i,p}class Gc{constructor(i,u){this.reset(i,u)}reset(i,u){this.points=i||[],this._distances=[0];for(let g=1;g<this.points.length;g++)this._distances[g]=this._distances[g-1]+this.points[g].dist(this.points[g-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(u||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(1===this.points.length)return this.points[0];i=d.clamp(i,0,1);let u=1,g=this._distances[u];const v=i*this.paddedLength+this.padding;for(;g<v&&u<this._distances.length;)g=this._distances[++u];const b=u-1,T=this._distances[b],D=g-T,A=D>0?(v-T)/D:0;return this.points[b].mult(1-A).add(this.points[u].mult(A))}}class ke{constructor(i,u,g){const v=this.boxCells=[],b=this.circleCells=[];this.xCellCount=Math.ceil(i/g),this.yCellCount=Math.ceil(u/g);for(let T=0;T<this.xCellCount*this.yCellCount;T++)v.push([]),b.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=u,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/u,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,u,g,v,b){this._forEachCell(u,g,v,b,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(u),this.bboxes.push(g),this.bboxes.push(v),this.bboxes.push(b)}insertCircle(i,u,g,v){this._forEachCell(u-v,g-v,u+v,g+v,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(u),this.circles.push(g),this.circles.push(v)}_insertBoxCell(i,u,g,v,b,T){this.boxCells[b].push(T)}_insertCircleCell(i,u,g,v,b,T){this.circleCells[b].push(T)}_query(i,u,g,v,b,T){if(g<0||i>this.width||v<0||u>this.height)return!b&&[];const D=[];if(i<=0&&u<=0&&this.width<=g&&this.height<=v){if(b)return!0;for(let A=0;A<this.boxKeys.length;A++)D.push({key:this.boxKeys[A],x1:this.bboxes[4*A],y1:this.bboxes[4*A+1],x2:this.bboxes[4*A+2],y2:this.bboxes[4*A+3]});for(let A=0;A<this.circleKeys.length;A++){const k=this.circles[3*A],L=this.circles[3*A+1],B=this.circles[3*A+2];D.push({key:this.circleKeys[A],x1:k-B,y1:L-B,x2:k+B,y2:L+B})}return T?D.filter(T):D}return this._forEachCell(i,u,g,v,this._queryCell,D,{hitTest:b,seenUids:{box:{},circle:{}}},T),b?D.length>0:D}_queryCircle(i,u,g,v,b){const T=i-g,D=i+g,A=u-g,k=u+g;if(D<0||T>this.width||k<0||A>this.height)return!v&&[];const L=[];return this._forEachCell(T,A,D,k,this._queryCellCircle,L,{hitTest:v,circle:{x:i,y:u,radius:g},seenUids:{box:{},circle:{}}},b),v?L.length>0:L}query(i,u,g,v,b){return this._query(i,u,g,v,!1,b)}hitTest(i,u,g,v,b){return this._query(i,u,g,v,!0,b)}hitTestCircle(i,u,g,v){return this._queryCircle(i,u,g,!0,v)}_queryCell(i,u,g,v,b,T,D,A){const k=D.seenUids,L=this.boxCells[b];if(null!==L){const j=this.bboxes;for(const H of L)if(!k.box[H]){k.box[H]=!0;const Z=4*H;if(i<=j[Z+2]&&u<=j[Z+3]&&g>=j[Z+0]&&v>=j[Z+1]&&(!A||A(this.boxKeys[H]))){if(D.hitTest)return T.push(!0),!0;T.push({key:this.boxKeys[H],x1:j[Z],y1:j[Z+1],x2:j[Z+2],y2:j[Z+3]})}}}const B=this.circleCells[b];if(null!==B){const j=this.circles;for(const H of B)if(!k.circle[H]){k.circle[H]=!0;const Z=3*H;if(this._circleAndRectCollide(j[Z],j[Z+1],j[Z+2],i,u,g,v)&&(!A||A(this.circleKeys[H]))){if(D.hitTest)return T.push(!0),!0;{const G=j[Z],ne=j[Z+1],W=j[Z+2];T.push({key:this.circleKeys[H],x1:G-W,y1:ne-W,x2:G+W,y2:ne+W})}}}}}_queryCellCircle(i,u,g,v,b,T,D,A){const k=D.circle,L=D.seenUids,B=this.boxCells[b];if(null!==B){const H=this.bboxes;for(const Z of B)if(!L.box[Z]){L.box[Z]=!0;const G=4*Z;if(this._circleAndRectCollide(k.x,k.y,k.radius,H[G+0],H[G+1],H[G+2],H[G+3])&&(!A||A(this.boxKeys[Z])))return T.push(!0),!0}}const j=this.circleCells[b];if(null!==j){const H=this.circles;for(const Z of j)if(!L.circle[Z]){L.circle[Z]=!0;const G=3*Z;if(this._circlesCollide(H[G],H[G+1],H[G+2],k.x,k.y,k.radius)&&(!A||A(this.circleKeys[Z])))return T.push(!0),!0}}}_forEachCell(i,u,g,v,b,T,D,A){const k=this._convertToXCellCoord(i),L=this._convertToYCellCoord(u),B=this._convertToXCellCoord(g),j=this._convertToYCellCoord(v);for(let H=k;H<=B;H++)for(let Z=L;Z<=j;Z++)if(b.call(this,i,u,g,v,this.xCellCount*Z+H,T,D,A))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,u,g,v,b,T){const D=v-i,A=b-u,k=g+T;return k*k>D*D+A*A}_circleAndRectCollide(i,u,g,v,b,T,D){const A=(T-v)/2,k=Math.abs(i-(v+A));if(k>A+g)return!1;const L=(D-b)/2,B=Math.abs(u-(b+L));if(B>L+g)return!1;if(k<=A||B<=L)return!0;const j=k-A,H=B-L;return j*j+H*H<=g*g}}const Jt=Math.tan(85*Math.PI/180);function wt(p,i,u,g,v,b,T){const D=d.create();if(u)if("globe"===b.name){const A=d.calculateGlobeLabelMatrix(v,i);d.multiply(D,D,A)}else{const A=kn([],T);D[0]=A[0],D[1]=A[1],D[4]=A[2],D[5]=A[3],g||d.rotateZ(D,D,v.angle)}else d.multiply(D,v.labelPlaneMatrix,p);return D}function Mi(p,i,u,g,v,b,T){const D=wt(p,i,u,g,v,b,T);return"globe"===b.name&&u||(D[2]=D[6]=D[10]=D[14]=0),D}function Is(p,i,u,g,v,b,T){if(u){if("globe"===b.name){const D=wt(p,i,u,g,v,b,T);return d.invert(D,D),d.multiply(D,p,D),D}{const D=d.clone(p),A=d.identity([]);return A[0]=T[0],A[1]=T[1],A[4]=T[2],A[5]=T[3],d.multiply(D,D,A),g||d.rotateZ(D,D,-v.angle),D}}return v.glCoordMatrix}function It(p,i,u=0){const g=[p.x,p.y,u,1];u?d.transformMat4$1(g,g,i):Cn(g,g,i);const v=g[3];return{point:[g[0]/v,g[1]/v,g[2]/v],signedDistanceFromCamera:v}}function rs(p,i){const u=[p[0],p[1],p[2],1];d.transformMat4$1(u,u,i);const g=u[3];return{point:[u[0]/g,u[1]/g,u[2]/g],signedDistanceFromCamera:g}}function pa(p,i){return Math.min(.5+p/i*.5,1.5)}function Ps(p,i){const u=p[0]/p[3],g=p[1]/p[3];return u>=-i[0]&&u<=i[0]&&g>=-i[1]&&g<=i[1]}function mi(p,i,u,g,v,b,T,D,A,k){const L=u.transform,B=g?p.textSizeData:p.iconSizeData,j=d.evaluateSizeForZoom(B,u.transform.zoom),H="globe"===L.projection.name,Z=[256/u.width*2+1,256/u.height*2+1],G=g?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;G.clear();let ne=null;H&&(ne=g?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const W=p.lineVertexArray,Q=g?p.text.placedSymbolArray:p.icon.placedSymbolArray,q=u.transform.width/u.transform.height;let le=!1;for(let te=0;te<Q.length;te++){const re=Q.get(te);if(re.writingMode!==d.WritingMode.vertical||le||0!==te&&Q.get(te-1).writingMode===d.WritingMode.horizontal||(le=!0),(re.hidden||re.writingMode===d.WritingMode.vertical)&&!le){Er(re.numGlyphs,G);continue}le=!1;const ue=new d.pointGeometry(re.tileAnchorX,re.tileAnchorY),Ce=A?A(ue):[0,0,0],Se=L.projection.projectTilePoint(ue.x,ue.y,k.canonical),be=[Se.x+Ce[0],Se.y+Ce[1],Se.z+Ce[2]],Ve=[...be,1];if(d.transformMat4$1(Ve,Ve,i),!Ps(Ve,Z)){Er(re.numGlyphs,G);continue}const ie=pa(u.transform.cameraToCenterDistance,Ve[3]),ve=d.evaluateSizeForFeature(B,j,re),Ie=T?ve/ie:ve*ie,Ze=It(new d.pointGeometry(be[0],be[1]),v,be[2]);if(Ze.signedDistanceFromCamera<=0){Er(re.numGlyphs,G);continue}let Me={};const it=T?null:A,He=Tt(re,Ie,!1,D,i,v,b,p.glyphOffsetArray,W,G,ne,Ze.point,ue,Me,q,it,L.projection,k,T);le=He.useVertical,it&&He.needsFlipping&&(Me={}),(He.notEnoughRoom||le||He.needsFlipping&&Tt(re,Ie,!0,D,i,v,b,p.glyphOffsetArray,W,G,ne,Ze.point,ue,Me,q,it,L.projection,k,T).notEnoughRoom)&&Er(re.numGlyphs,G)}g?(p.text.dynamicLayoutVertexBuffer.updateData(G),ne&&p.text.globeExtVertexBuffer.updateData(ne)):(p.icon.dynamicLayoutVertexBuffer.updateData(G),ne&&p.icon.globeExtVertexBuffer.updateData(ne))}function Gn(p,i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G){const ne=D.glyphStartIndex+D.numGlyphs,W=D.lineStartIndex,Q=D.lineStartIndex+D.lineLength,q=i.getoffsetX(D.glyphStartIndex),le=i.getoffsetX(ne-1),te=Ai(p*q,u,g,v,b,T,D.segment,W,Q,A,k,L,B,j,!0,H,Z,G);if(!te)return null;const re=Ai(p*le,u,g,v,b,T,D.segment,W,Q,A,k,L,B,j,!0,H,Z,G);return re?{first:te,last:re}:null}function Ed(p,i,u,g){return p.writingMode===d.WritingMode.horizontal&&Math.abs(u.y-i.y)>Math.abs(u.x-i.x)*g?{useVertical:!0}:p.writingMode===d.WritingMode.vertical?i.y<u.y?{needsFlipping:!0}:null:0!==p.flipState&&function(v,b,T){const D=(b.x-v.x)*T;return 0===D||Math.abs((b.y-v.y)/D)>Jt}(i,u,g)?1===p.flipState?{needsFlipping:!0}:null:i.x>u.x?{needsFlipping:!0}:null}function Tt(p,i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G,ne,W,Q){const q=i/24,le=p.lineOffsetX*q,te=p.lineOffsetY*q;let re;if(p.numGlyphs>1){const ue=p.glyphStartIndex+p.numGlyphs,Ce=p.lineStartIndex,Se=p.lineStartIndex+p.lineLength,be=Gn(q,D,le,te,u,B,j,p,A,b,H,G,!1,ne,W,Q);if(!be)return{notEnoughRoom:!0};const Ve=rs(be.first.point,T).point,ie=rs(be.last.point,T).point,ve=new d.pointGeometry(Ve[0],Ve[1]),Ie=new d.pointGeometry(ie[0],ie[1]);if(g&&!u){const Ze=Ed(p,ve,Ie,Z);if(p.flipState=Ze&&Ze.needsFlipping?1:2,Ze)return Ze}re=[be.first];for(let Ze=p.glyphStartIndex+1;Ze<ue-1;Ze++)re.push(Ai(q*D.getoffsetX(Ze),le,te,u,B,j,p.segment,Ce,Se,A,b,H,G,!1,!1,ne,W,Q));re.push(be.last)}else{if(g&&!u){const Ce=It(j,v).point,Se=p.lineStartIndex+p.segment+1,be=new d.pointGeometry(A.getx(Se),A.gety(Se)),Ve=It(be,v),ie=Ve.signedDistanceFromCamera>0?Ve.point:tl(j,be,Ce,1,v,void 0,ne,W.canonical),ve=Ed(p,new d.pointGeometry(Ce[0],Ce[1]),new d.pointGeometry(ie[0],ie[1]),Z);if(p.flipState=ve&&ve.needsFlipping?1:2,ve)return ve}const ue=Ai(q*D.getoffsetX(p.glyphStartIndex),le,te,u,B,j,p.segment,p.lineStartIndex,p.lineStartIndex+p.lineLength,A,b,H,G,!1,!1,ne,W,Q);if(!ue)return{notEnoughRoom:!0};re=[ue]}if(L)for(const ue of re)d.updateGlobeVertexNormal(L,k.length+0,ue.up[0],ue.up[1],ue.up[2]),d.updateGlobeVertexNormal(L,k.length+1,ue.up[0],ue.up[1],ue.up[2]),d.updateGlobeVertexNormal(L,k.length+2,ue.up[0],ue.up[1],ue.up[2]),d.updateGlobeVertexNormal(L,k.length+3,ue.up[0],ue.up[1],ue.up[2]),d.addDynamicAttributes(k,ue.point[0],ue.point[1],ue.point[2],ue.angle);else for(const ue of re)d.addDynamicAttributes(k,ue.point[0],ue.point[1],ue.point[2],ue.angle);return{}}function el(p,i,u,g,v){const b=g.projectTilePoint(p.x,p.y,i);if(!v)return It(b,u,b.z);const T=v(p);return It(new d.pointGeometry(b.x+T[0],b.y+T[1]),u,b.z+T[2])}function tl(p,i,u,g,v,b,T,D){const A=el(p.add(p.sub(i)._unit()),D,v,T,b).point,k=d.sub([],u,A);return d.scaleAndAdd([],u,k,g/d.length(k))}function Ai(p,i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G,ne,W){const Q=g?p-i:p+i;let q=Q>0?1:-1,le=0;g&&(q*=-1,le=Math.PI),q<0&&(le+=Math.PI);let te=q>0?D+T:D+T+1,re=v,ue=v,Ce=0,Se=0;const be=Math.abs(Q),Ve=[],ie=[];let ve=b;const Ie=()=>{const ht=te-q;return 0===Ce?b:new d.pointGeometry(k.getx(ht),k.gety(ht))},Ze=()=>tl(Ie(),ve,ue,be-Ce+1,L,j,G,ne.canonical);for(;Ce+Se<=be;){if(te+=q,te<D||te>=A)return null;if(ue=re,Ve.push(re),H&&ie.push(ve||Ie()),re=B[te],void 0===re){ve=new d.pointGeometry(k.getx(te),k.gety(te));const ht=el(ve,ne.canonical,L,G,j);re=ht.signedDistanceFromCamera>0?B[te]=ht.point:Ze()}else ve=null;Ce+=Se,Se=d.distance(ue,re)}ve=ve||new d.pointGeometry(k.getx(te),k.gety(te));const Me=Ie();Z&&j&&(B[te]=re=void 0===B[te]?re:Ze(),Se=d.distance(ue,re));const it=(be-Ce)/Se,He=ve.sub(Me).mult(it)._add(Me),Ke=d.sub([],re,ue),We=d.scaleAndAdd([],ue,Ke,it);let Xe=[0,0,1],st=Ke[0],qe=Ke[1];if(W&&(Xe=G.upVector(ne.canonical,He.x,He.y),0!==Xe[0]||0!==Xe[1]||1!==Xe[2])){const ht=[1,0,0],Ct=[0,1,0];ht[0]=Xe[2],ht[1]=0,ht[2]=-Xe[0],d.cross(Ct,Xe,ht),d.normalize(ht,ht),d.normalize(Ct,Ct),st=d.dot(Ke,ht),qe=d.dot(Ke,Ct)}if(u){const ht=d.cross([],Xe,Ke);d.normalize(ht,ht),d.scaleAndAdd(We,We,ht,u*q)}const Dt=le+Math.atan2(qe,st);return Ve.push(We),H&&ie.push(He),{point:We,angle:Dt,path:Ve,tilePath:ie,up:Xe}}const uh=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function Er(p,i){for(let u=0;u<p;u++){const g=i.length;i.resize(g+4),i.float32.set(uh,4*g)}}function Cn(p,i,u){const g=i[0],v=i[1];return p[0]=u[0]*g+u[4]*v+u[12],p[1]=u[1]*g+u[5]*v+u[13],p[3]=u[3]*g+u[7]*v+u[15],p}const lr=100;class Cd{constructor(i,u,g=new ke(i.width+200,i.height+200,25),v=new ke(i.width+200,i.height+200,25)){this.transform=i,this.grid=g,this.ignoredGrid=v,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+lr,this.screenBottomBoundary=i.height+lr,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=u}placeCollisionBox(i,u,g,v,b,T,D,A){let k=g.projectedAnchorX,L=g.projectedAnchorY,B=g.projectedAnchorZ;const j=g.elevation,H=g.tileID;if(j&&H){const te=i.getProjection().upVector(H.canonical,g.tileAnchorX,g.tileAnchorY),re=i.getProjection().upVectorScale(H.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;k+=te[0]*j*re,L+=te[1]*j*re,B+=te[2]*j*re}const Z=this.projectAndGetPerspectiveRatio(D,[k,L,B],g.tileID,"globe"===i.projection.name||!!j||this.transform.pitch>0,i.getProjection()),G=T*Z.perspectiveRatio,ne=(g.x1*u+v.x-g.padding)*G+Z.point.x,W=(g.y1*u+v.y-g.padding)*G+Z.point.y,Q=(g.x2*u+v.x+g.padding)*G+Z.point.x,q=(g.y2*u+v.y+g.padding)*G+Z.point.y,le=Z.perspectiveRatio<=.55||Z.occluded;return!this.isInsideGrid(ne,W,Q,q)||!b&&this.grid.hitTest(ne,W,Q,q,A)||le?{box:[],offscreen:!1,occluded:Z.occluded}:{box:[ne,W,Q,q],offscreen:this.isOffscreen(ne,W,Q,q),occluded:!1}}placeCollisionCircles(i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G){const ne=[],W=this.transform.elevation,Q=W?W.getAtTileOffsetFunc(G,this.transform.center.lat,this.transform.worldSize,i.getProjection()):Me=>[0,0,0],q=new d.pointGeometry(g.tileAnchorX,g.tileAnchorY),le=i.getProjection().projectTilePoint(g.tileAnchorX,g.tileAnchorY,G.canonical),te=Q(q),re=[le.x+te[0],le.y+te[1],le.z+te[2]],ue="globe"===i.projection.name,Ce=this.projectAndGetPerspectiveRatio(D,[re[0],re[1],re[2]],G,ue||!!W||this.transform.pitch>0,i.getProjection()),{perspectiveRatio:Se}=Ce,be=(B?T/Se:T*Se)/d.ONE_EM,Ve=It(new d.pointGeometry(re[0],re[1]),A,re[2]).point,ie=Ce.signedDistanceFromCamera>0?Gn(be,b,g.lineOffsetX*be,g.lineOffsetY*be,!1,Ve,q,g,v,A,{},W&&!B?Q:null,B&&!!W,i.getProjection(),G,B):null;let ve=!1,Ie=!1,Ze=!0;if(ie&&!Ce.occluded){const Me=.5*H*Se+Z,it=new d.pointGeometry(-100,-100),He=new d.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),Ke=new Gc,We=ie.first,Xe=ie.last;let st=[];for(let ht=We.path.length-1;ht>=1;ht--)st.push(We.path[ht]);for(let ht=1;ht<Xe.path.length;ht++)st.push(Xe.path[ht]);const qe=2.5*Me;if(k){const ht=st.map(W&&!ue?(Ct,_n)=>{const Rn=Q(_n<We.path.length-1?We.tilePath[We.path.length-1-_n]:Xe.tilePath[_n-We.path.length+2]);return Ct[2]=Rn[2],rs(Ct,k)}:Ct=>rs(Ct,k));st=ht.some(Ct=>Ct.signedDistanceFromCamera<=0)?[]:ht.map(Ct=>Ct.point)}let Dt=[];if(st.length>0){const ht=st.map(Sn=>new d.pointGeometry(Sn[0],Sn[1]));let Ct=1/0,_n=-1/0,Rn=1/0,Xn=-1/0;for(let Sn=0;Sn<ht.length;Sn++)Ct=Math.min(Ct,ht[Sn].x),Rn=Math.min(Rn,ht[Sn].y),_n=Math.max(_n,ht[Sn].x),Xn=Math.max(Xn,ht[Sn].y);Dt=Ct>=it.x&&_n<=He.x&&Rn>=it.y&&Xn<=He.y?[ht]:_n<it.x||Ct>He.x||Xn<it.y||Rn>He.y?[]:d.clipLine([ht],it.x,it.y,He.x,He.y)}for(const ht of Dt){Ke.reset(ht,.25*Me);let Ct=0;Ct=Ke.length<=.5*Me?1:Math.ceil(Ke.paddedLength/qe)+1;for(let _n=0;_n<Ct;_n++){const Rn=_n/Math.max(Ct-1,1),Xn=Ke.lerp(Rn),Sn=Xn.x+lr,Ir=Xn.y+lr;ne.push(Sn,Ir,Me,0);const ds=Sn-Me,Vn=Ir-Me,Mn=Sn+Me,An=Ir+Me;if(Ze=Ze&&this.isOffscreen(ds,Vn,Mn,An),Ie=Ie||this.isInsideGrid(ds,Vn,Mn,An),!u&&this.grid.hitTestCircle(Sn,Ir,Me,j)&&(ve=!0,!L))return{circles:[],offscreen:!1,collisionDetected:ve,occluded:!1}}}}return{circles:!L&&ve||!Ie?[]:ne,offscreen:Ze,collisionDetected:ve,occluded:Ce.occluded}}queryRenderedSymbols(i){if(0===i.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const u=[];let g=1/0,v=1/0,b=-1/0,T=-1/0;for(const L of i){const B=new d.pointGeometry(L.x+lr,L.y+lr);g=Math.min(g,B.x),v=Math.min(v,B.y),b=Math.max(b,B.x),T=Math.max(T,B.y),u.push(B)}const D=this.grid.query(g,v,b,T).concat(this.ignoredGrid.query(g,v,b,T)),A={},k={};for(const L of D){const B=L.key;if(void 0===A[B.bucketInstanceId]&&(A[B.bucketInstanceId]={}),A[B.bucketInstanceId][B.featureIndex])continue;const j=[new d.pointGeometry(L.x1,L.y1),new d.pointGeometry(L.x2,L.y1),new d.pointGeometry(L.x2,L.y2),new d.pointGeometry(L.x1,L.y2)];d.polygonIntersectsPolygon(u,j)&&(A[B.bucketInstanceId][B.featureIndex]=!0,void 0===k[B.bucketInstanceId]&&(k[B.bucketInstanceId]=[]),k[B.bucketInstanceId].push(B.featureIndex))}return k}insertCollisionBox(i,u,g,v,b){(u?this.ignoredGrid:this.grid).insert({bucketInstanceId:g,featureIndex:v,collisionGroupID:b},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,u,g,v,b){const T=u?this.ignoredGrid:this.grid,D={bucketInstanceId:g,featureIndex:v,collisionGroupID:b};for(let A=0;A<i.length;A+=4)T.insertCircle(D,i[A],i[A+1],i[A+2])}projectAndGetPerspectiveRatio(i,u,g,v,b){const T=[u[0],u[1],u[2],1];let D=!1;if(u[2]||this.transform.pitch>0){d.transformMat4$1(T,T,i);const A="globe"===b.name;this.fogState&&g&&!A&&(D=function(k,L,B,j,H,Z){const G=Z.calculateFogTileMatrix(H),ne=[L,B,j];return d.transformMat4(ne,ne,G),Vt(k,ne,Z.pitch,Z._fov)}(this.fogState,u[0],u[1],u[2],g.toUnwrapped(),this.transform)>.9)}else Cn(T,T,i);return{point:new d.pointGeometry((T[0]/T[3]+1)/2*this.transform.width+lr,(-T[1]/T[3]+1)/2*this.transform.height+lr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(b)/T[3]*.5,1.5),signedDistanceFromCamera:T[3],occluded:v&&T[2]>T[3]||D}}isOffscreen(i,u,g,v){return g<lr||i>=this.screenRightBoundary||v<lr||u>this.screenBottomBoundary}isInsideGrid(i,u,g,v){return g>=0&&i<this.gridRightBoundary&&v>=0&&u<this.gridBottomBoundary}getViewportMatrix(){const i=d.identity([]);return d.translate(i,i,[-100,-100,0]),i}}function ei(p,i,u){const g=i.createTileMatrix(p,p.worldSize,u.toUnwrapped());return d.multiply(new Float32Array(16),p.projMatrix,g)}function hr(p,i,u){if(i.projection.name===u.projection.name)return p.projMatrix;const g=u.clone();return g.setProjection(i.projection),ei(g,i.getProjection(),p)}function Hc(p,i,u){return i.name===u.projection.name?p.projMatrix:ei(u,i,p)}class $l{constructor(i,u,g,v){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?u:-u))):v&&g?1:0,this.placed=g}isHidden(){return 0===this.opacity&&!this.placed}}class Qn{constructor(i,u,g,v,b,T=!1){this.text=new $l(i?i.text:null,u,g,b),this.icon=new $l(i?i.icon:null,u,v,b),this.clipped=T}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class nl{constructor(i,u,g,v=!1){this.text=i,this.icon=u,this.skipFade=g,this.clipped=v}}class Tn{constructor(){this.invProjMatrix=d.create(),this.viewportMatrix=d.create(),this.circles=[]}}class qc{constructor(i,u,g,v,b){this.bucketInstanceId=i,this.featureIndex=u,this.sourceLayerIndex=g,this.bucketIndex=v,this.tileID=b}}class $r{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const u=++this.maxGroupID;this.collisionGroups[i]={ID:u,predicate:g=>g.collisionGroupID===u}}return this.collisionGroups[i]}}function is(p,i,u,g,v){const{horizontalAlign:b,verticalAlign:T}=d.getAnchorAlignment(p),D=-(b-.5)*i,A=-(T-.5)*u,k=d.evaluateVariableOffset(p,g);return new d.pointGeometry(D+k[0]*v,A+k[1]*v)}function bn(p,i,u,g,v){const b=new d.pointGeometry(p,i);return u&&b._rotate(g?v:-v),b}class Zi{constructor(i,u,g,v,b){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Cd(this.transform,b),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=u,this.retainedQueryData={},this.collisionGroups=new $r(g),this.collisionCircleArrays={},this.prevPlacement=v,v&&(v.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,u,g,v){const b=g.getBucket(u),T=g.latestFeatureIndex;if(!b||!T||u.id!==b.layerIds[0])return;const D=b.layers[0].layout,A=g.collisionBoxArray,k=Math.pow(2,this.transform.zoom-g.tileID.overscaledZ),L=g.tileSize/d.EXTENT,B=g.tileID.toUnwrapped();this.transform.setProjection(b.projection);const j=(H=g.tileID,Z=b.getProjection(),G=this.transform,Z.name===this.projection?G.calculateProjMatrix(H.toUnwrapped()):ei(G,Z,H));var H,Z,G;const ne="map"===D.get("text-pitch-alignment"),W="map"===D.get("text-rotation-alignment");u.compileFilter();const Q=u.dynamicFilter(),q=u.dynamicFilterNeedsFeature(),le=this.transform.calculatePixelsToTileUnitsMatrix(g),te=Mi(j,g.tileID.canonical,ne,W,this.transform,b.getProjection(),le);let re=null;if(ne){const Se=Is(j,g.tileID.canonical,ne,W,this.transform,b.getProjection(),le);re=d.multiply([],this.transform.labelPlaneMatrix,Se)}let ue=null;Q&&g.latestFeatureIndex&&(ue={unwrappedTileID:B,dynamicFilter:Q,dynamicFilterNeedsFeature:q,featureIndex:g.latestFeatureIndex}),this.retainedQueryData[b.bucketInstanceId]=new qc(b.bucketInstanceId,T,b.sourceLayerIndex,b.index,g.tileID);const Ce={bucket:b,layout:D,posMatrix:j,textLabelPlaneMatrix:te,labelToScreenMatrix:re,clippingData:ue,scale:k,textPixelRatio:L,holdingForFade:g.holdingForFade(),collisionBoxArray:A,partiallyEvaluatedTextSize:d.evaluateSizeForZoom(b.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:d.evaluateSizeForZoom(b.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(b.sourceID)};if(v)for(const Se of b.sortKeyRanges){const{sortKey:be,symbolInstanceStart:Ve,symbolInstanceEnd:ie}=Se;i.push({sortKey:be,symbolInstanceStart:Ve,symbolInstanceEnd:ie,parameters:Ce})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:b.symbolInstances.length,parameters:Ce})}attemptAnchorPlacement(i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G,ne,W,Q){const q=[j.textOffset0,j.textOffset1],le=is(i,g,v,q,b),te=this.collisionIndex.placeCollisionBox(Z,b,u,bn(le.x,le.y,T,D,this.transform.angle),B,A,k,L.predicate);if((!ne||0!==this.collisionIndex.placeCollisionBox(Z,Z.getSymbolInstanceIconSize(Q,this.transform.zoom,H),ne,bn(le.x,le.y,T,D,this.transform.angle),B,A,k,L.predicate).box.length)&&te.box.length>0){let re;return this.prevPlacement&&this.prevPlacement.variableOffsets[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID]&&this.prevPlacement.placements[j.crossTileID].text&&(re=this.prevPlacement.variableOffsets[j.crossTileID].anchor),this.variableOffsets[j.crossTileID]={textOffset:q,width:g,height:v,anchor:i,textScale:b,prevAnchor:re},this.markUsedJustification(Z,i,j,G),Z.allowVerticalPlacement&&(this.markUsedOrientation(Z,G,j),this.placedOrientations[j.crossTileID]=G),{shift:le,placedGlyphBoxes:te}}}placeLayerBucketPart(i,u,g,v){const{bucket:b,layout:T,posMatrix:D,textLabelPlaneMatrix:A,labelToScreenMatrix:k,clippingData:L,textPixelRatio:B,holdingForFade:j,collisionBoxArray:H,partiallyEvaluatedTextSize:Z,partiallyEvaluatedIconSize:G,collisionGroup:ne}=i.parameters,W=T.get("text-optional"),Q=T.get("icon-optional"),q=T.get("text-allow-overlap"),le=T.get("icon-allow-overlap"),te="map"===T.get("text-rotation-alignment"),re="map"===T.get("text-pitch-alignment"),ue="none"!==T.get("icon-text-fit"),Ce="viewport-y"===T.get("symbol-z-order");this.transform.setProjection(b.projection);let Se=q&&(le||!b.hasIconData()||Q),be=le&&(q||!b.hasTextData()||W);!b.collisionArrays&&H&&b.deserializeCollisionBoxes(H),g&&v&&b.updateCollisionDebugBuffers(this.transform.zoom,H);const Ve=(ie,ve,Ie)=>{if(L){const Mn={zoom:this.transform.zoom,pitch:this.transform.pitch};let An=null;if(L.dynamicFilterNeedsFeature){const ln=this.retainedQueryData[b.bucketInstanceId];An=L.featureIndex.loadFeature({featureIndex:ie.featureIndex,bucketIndex:ln.bucketIndex,sourceLayerIndex:ln.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,L.dynamicFilter)(Mn,An,this.retainedQueryData[b.bucketInstanceId].tileID.canonical,new d.pointGeometry(ie.tileAnchorX,ie.tileAnchorY),this.transform.calculateDistanceTileData(L.unwrappedTileID)))return this.placements[ie.crossTileID]=new nl(!1,!1,!1,!0),void(u[ie.crossTileID]=!0)}if(u[ie.crossTileID])return;if(j)return void(this.placements[ie.crossTileID]=new nl(!1,!1,!1));let Ze=!1,Me=!1,it=!0,He=!1,Ke=!1,We=null,Xe={box:null,offscreen:null,occluded:null},st={box:null,offscreen:null,occluded:null},qe=null,Dt=null,ht=null,Ct=0,_n=0,Rn=0;Ie.textFeatureIndex?Ct=Ie.textFeatureIndex:ie.useRuntimeCollisionCircles&&(Ct=ie.featureIndex),Ie.verticalTextFeatureIndex&&(_n=Ie.verticalTextFeatureIndex);const Xn=Mn=>{Mn.tileID=this.retainedQueryData[b.bucketInstanceId].tileID,(this.transform.elevation||Mn.elevation)&&(Mn.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[b.bucketInstanceId].tileID,Mn.tileAnchorX,Mn.tileAnchorY):0)},Sn=Ie.textBox;if(Sn){Xn(Sn);const Mn=ln=>{let pr=d.WritingMode.horizontal;if(b.allowVerticalPlacement&&!ln&&this.prevPlacement){const Un=this.prevPlacement.placedOrientations[ie.crossTileID];Un&&(this.placedOrientations[ie.crossTileID]=Un,pr=Un,this.markUsedOrientation(b,pr,ie))}return pr},An=(ln,pr)=>{if(b.allowVerticalPlacement&&ie.numVerticalGlyphVertices>0&&Ie.verticalTextBox){for(const Un of b.writingModes)if(Un===d.WritingMode.vertical?(Xe=pr(),st=Xe):Xe=ln(),Xe&&Xe.box&&Xe.box.length)break}else Xe=ln()};if(T.get("text-variable-anchor")){let ln=T.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[ie.crossTileID]){const Qt=this.prevPlacement.variableOffsets[ie.crossTileID];ln.indexOf(Qt.anchor)>0&&(ln=ln.filter(Yn=>Yn!==Qt.anchor),ln.unshift(Qt.anchor))}const pr=(Qt,Yn,Vo)=>{const xi=b.getSymbolInstanceTextSize(Z,ie,this.transform.zoom,ve),Ma=(Qt.x2-Qt.x1)*xi+2*Qt.padding,Aa=(Qt.y2-Qt.y1)*xi+2*Qt.padding,Us=ue&&!le?Yn:null;Us&&Xn(Us);let li={box:[],offscreen:!1,occluded:!1};const to=q?2*ln.length:ln.length;for(let yo=0;yo<to;++yo){const Dr=this.attemptAnchorPlacement(ln[yo%ln.length],Qt,Ma,Aa,xi,te,re,B,D,ne,yo>=ln.length,ie,ve,b,Vo,Us,Z,G);if(Dr&&(li=Dr.placedGlyphBoxes,li&&li.box&&li.box.length)){Ze=!0,We=Dr.shift;break}}return li};An(()=>pr(Sn,Ie.iconBox,d.WritingMode.horizontal),()=>{const Qt=Ie.verticalTextBox;return Qt&&Xn(Qt),b.allowVerticalPlacement&&!(Xe&&Xe.box&&Xe.box.length)&&ie.numVerticalGlyphVertices>0&&Qt?pr(Qt,Ie.verticalIconBox,d.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),Xe&&(Ze=Xe.box,it=Xe.offscreen,He=Xe.occluded);const Un=Mn(Xe&&Xe.box);if(!Ze&&this.prevPlacement){const Qt=this.prevPlacement.variableOffsets[ie.crossTileID];Qt&&(this.variableOffsets[ie.crossTileID]=Qt,this.markUsedJustification(b,Qt.anchor,ie,Un))}}else{const ln=(pr,Un)=>{const Qt=b.getSymbolInstanceTextSize(Z,ie,this.transform.zoom,ve),Yn=this.collisionIndex.placeCollisionBox(b,Qt,pr,new d.pointGeometry(0,0),q,B,D,ne.predicate);return Yn&&Yn.box&&Yn.box.length&&(this.markUsedOrientation(b,Un,ie),this.placedOrientations[ie.crossTileID]=Un),Yn};An(()=>ln(Sn,d.WritingMode.horizontal),()=>{const pr=Ie.verticalTextBox;return b.allowVerticalPlacement&&ie.numVerticalGlyphVertices>0&&pr?(Xn(pr),ln(pr,d.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),Mn(Xe&&Xe.box&&Xe.box.length)}}if(qe=Xe,Ze=qe&&qe.box&&qe.box.length>0,it=qe&&qe.offscreen,He=qe&&qe.occluded,ie.useRuntimeCollisionCircles){const Mn=b.text.placedSymbolArray.get(ie.centerJustifiedTextSymbolIndex>=0?ie.centerJustifiedTextSymbolIndex:ie.verticalPlacedTextSymbolIndex),An=d.evaluateSizeForFeature(b.textSizeData,Z,Mn),ln=T.get("text-padding");Dt=this.collisionIndex.placeCollisionCircles(b,q,Mn,b.lineVertexArray,b.glyphOffsetArray,An,D,A,k,g,re,ne.predicate,ie.collisionCircleDiameter*An/d.ONE_EM,ln,this.retainedQueryData[b.bucketInstanceId].tileID),Ze=q||Dt.circles.length>0&&!Dt.collisionDetected,it=it&&Dt.offscreen,He=Dt.occluded}if(Ie.iconFeatureIndex&&(Rn=Ie.iconFeatureIndex),Ie.iconBox){const Mn=An=>{Xn(An);const ln=ue&&We?bn(We.x,We.y,te,re,this.transform.angle):new d.pointGeometry(0,0),pr=b.getSymbolInstanceIconSize(G,this.transform.zoom,ve);return this.collisionIndex.placeCollisionBox(b,pr,An,ln,le,B,D,ne.predicate)};st&&st.box&&st.box.length&&Ie.verticalIconBox?(ht=Mn(Ie.verticalIconBox),Me=ht.box.length>0):(ht=Mn(Ie.iconBox),Me=ht.box.length>0),it=it&&ht.offscreen,Ke=ht.occluded}const Ir=W||0===ie.numHorizontalGlyphVertices&&0===ie.numVerticalGlyphVertices,ds=Q||0===ie.numIconVertices;if(Ir||ds?ds?Ir||(Me=Me&&Ze):Ze=Me&&Ze:Me=Ze=Me&&Ze,Ze&&qe&&qe.box&&this.collisionIndex.insertCollisionBox(qe.box,T.get("text-ignore-placement"),b.bucketInstanceId,st&&st.box&&_n?_n:Ct,ne.ID),Me&&ht&&this.collisionIndex.insertCollisionBox(ht.box,T.get("icon-ignore-placement"),b.bucketInstanceId,Rn,ne.ID),Dt&&(Ze&&this.collisionIndex.insertCollisionCircles(Dt.circles,T.get("text-ignore-placement"),b.bucketInstanceId,Ct,ne.ID),g)){const Mn=b.bucketInstanceId;let An=this.collisionCircleArrays[Mn];void 0===An&&(An=this.collisionCircleArrays[Mn]=new Tn);for(let ln=0;ln<Dt.circles.length;ln+=4)An.circles.push(Dt.circles[ln+0]),An.circles.push(Dt.circles[ln+1]),An.circles.push(Dt.circles[ln+2]),An.circles.push(Dt.collisionDetected?1:0)}const Vn="globe"!==b.projection.name;Se=Se&&(Vn||!He),be=be&&(Vn||!Ke),this.placements[ie.crossTileID]=new nl(Ze||Se,Me||be,it||b.justReloaded),u[ie.crossTileID]=!0};if(Ce){const ie=b.getSortedSymbolIndexes(this.transform.angle);for(let ve=ie.length-1;ve>=0;--ve){const Ie=ie[ve];Ve(b.symbolInstances.get(Ie),Ie,b.collisionArrays[Ie])}}else for(let ie=i.symbolInstanceStart;ie<i.symbolInstanceEnd;ie++)Ve(b.symbolInstances.get(ie),ie,b.collisionArrays[ie]);if(g&&b.bucketInstanceId in this.collisionCircleArrays){const ie=this.collisionCircleArrays[b.bucketInstanceId];d.invert(ie.invProjMatrix,D),ie.viewportMatrix=this.collisionIndex.getViewportMatrix()}b.justReloaded=!1}markUsedJustification(i,u,g,v){let b;b=v===d.WritingMode.vertical?g.verticalPlacedTextSymbolIndex:{left:g.leftJustifiedTextSymbolIndex,center:g.centerJustifiedTextSymbolIndex,right:g.rightJustifiedTextSymbolIndex}[d.getAnchorJustification(u)];const T=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex,g.verticalPlacedTextSymbolIndex];for(const D of T)D>=0&&(i.text.placedSymbolArray.get(D).crossTileID=b>=0&&D!==b?0:g.crossTileID)}markUsedOrientation(i,u,g){const v=u===d.WritingMode.horizontal||u===d.WritingMode.horizontalOnly?u:0,b=u===d.WritingMode.vertical?u:0,T=[g.leftJustifiedTextSymbolIndex,g.centerJustifiedTextSymbolIndex,g.rightJustifiedTextSymbolIndex];for(const D of T)i.text.placedSymbolArray.get(D).placedOrientation=v;g.verticalPlacedTextSymbolIndex&&(i.text.placedSymbolArray.get(g.verticalPlacedTextSymbolIndex).placedOrientation=b)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const u=this.prevPlacement;let g=!1;this.prevZoomAdjustment=u?u.zoomAdjustment(this.transform.zoom):0;const v=u?u.symbolFadeChange(i):1,b=u?u.opacities:{},T=u?u.variableOffsets:{},D=u?u.placedOrientations:{};for(const A in this.placements){const k=this.placements[A],L=b[A];L?(this.opacities[A]=new Qn(L,v,k.text,k.icon,null,k.clipped),g=g||k.text!==L.text.placed||k.icon!==L.icon.placed):(this.opacities[A]=new Qn(null,v,k.text,k.icon,k.skipFade,k.clipped),g=g||k.text||k.icon)}for(const A in b){const k=b[A];if(!this.opacities[A]){const L=new Qn(k,v,!1,!1);L.isHidden()||(this.opacities[A]=L,g=g||k.text.placed||k.icon.placed)}}for(const A in T)this.variableOffsets[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.variableOffsets[A]=T[A]);for(const A in D)this.placedOrientations[A]||!this.opacities[A]||this.opacities[A].isHidden()||(this.placedOrientations[A]=D[A]);g?this.lastPlacementChangeTime=i:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=u?u.lastPlacementChangeTime:i)}updateLayerOpacities(i,u){const g={};for(const v of u){const b=v.getBucket(i);b&&v.latestFeatureIndex&&i.id===b.layerIds[0]&&this.updateBucketOpacities(b,g,v.collisionBoxArray)}}updateBucketOpacities(i,u,g){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const v=i.layers[0].layout,b=!!i.layers[0].dynamicFilter(),T=new Qn(null,0,!1,!1,!0),D=v.get("text-allow-overlap"),A=v.get("icon-allow-overlap"),k=v.get("text-variable-anchor"),L="map"===v.get("text-rotation-alignment"),B="map"===v.get("text-pitch-alignment"),j="none"!==v.get("icon-text-fit"),H=new Qn(null,0,D&&(A||!i.hasIconData()||v.get("icon-optional")),A&&(D||!i.hasTextData()||v.get("text-optional")),!0);!i.collisionArrays&&g&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(g);const Z=(ne,W,Q)=>{for(let q=0;q<W/4;q++)ne.opacityVertexArray.emplaceBack(Q)};let G=0;for(let ne=0;ne<i.symbolInstances.length;ne++){const W=i.symbolInstances.get(ne),{numHorizontalGlyphVertices:Q,numVerticalGlyphVertices:q,crossTileID:le}=W;let te=this.opacities[le];u[le]?te=T:te||(te=H,this.opacities[le]=te),u[le]=!0;const re=Q>0||q>0,ue=W.numIconVertices>0,Ce=this.placedOrientations[W.crossTileID],Se=Ce===d.WritingMode.vertical,be=Ce===d.WritingMode.horizontal||Ce===d.WritingMode.horizontalOnly;if(!re&&!ue||te.isHidden()||G++,re){const Ve=Oo(te.text);Z(i.text,Q,Se?ks:Ve),Z(i.text,q,be?ks:Ve);const ie=te.text.isHidden();[W.rightJustifiedTextSymbolIndex,W.centerJustifiedTextSymbolIndex,W.leftJustifiedTextSymbolIndex].forEach(Ze=>{Ze>=0&&(i.text.placedSymbolArray.get(Ze).hidden=ie||Se?1:0)}),W.verticalPlacedTextSymbolIndex>=0&&(i.text.placedSymbolArray.get(W.verticalPlacedTextSymbolIndex).hidden=ie||be?1:0);const ve=this.variableOffsets[W.crossTileID];ve&&this.markUsedJustification(i,ve.anchor,W,Ce);const Ie=this.placedOrientations[W.crossTileID];Ie&&(this.markUsedJustification(i,"left",W,Ie),this.markUsedOrientation(i,Ie,W))}if(ue){const Ve=Oo(te.icon);W.placedIconSymbolIndex>=0&&(Z(i.icon,W.numIconVertices,Se?ks:Ve),i.icon.placedSymbolArray.get(W.placedIconSymbolIndex).hidden=te.icon.isHidden()),W.verticalPlacedIconSymbolIndex>=0&&(Z(i.icon,W.numVerticalIconVertices,be?ks:Ve),i.icon.placedSymbolArray.get(W.verticalPlacedIconSymbolIndex).hidden=te.icon.isHidden())}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const Ve=i.collisionArrays[ne];if(Ve){let ie=new d.pointGeometry(0,0),ve=!0;if(Ve.textBox||Ve.verticalTextBox){if(k){const Ze=this.variableOffsets[le];Ze?(ie=is(Ze.anchor,Ze.width,Ze.height,Ze.textOffset,Ze.textScale),L&&ie._rotate(B?this.transform.angle:-this.transform.angle)):ve=!1}b&&(ve=!te.clipped),Ve.textBox&&Fo(i.textCollisionBox.collisionVertexArray,te.text.placed,!ve||Se,ie.x,ie.y),Ve.verticalTextBox&&Fo(i.textCollisionBox.collisionVertexArray,te.text.placed,!ve||be,ie.x,ie.y)}const Ie=ve&&Boolean(!be&&Ve.verticalIconBox);Ve.iconBox&&Fo(i.iconCollisionBox.collisionVertexArray,te.icon.placed,Ie,j?ie.x:0,j?ie.y:0),Ve.verticalIconBox&&Fo(i.iconCollisionBox.collisionVertexArray,te.icon.placed,!Ie,j?ie.x:0,j?ie.y:0)}}}if(i.fullyClipped=0===G,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ne=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ne.invProjMatrix,i.placementViewportMatrix=ne.viewportMatrix,i.collisionCircleArray=ne.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return 0===this.fadeDuration?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,u){const g=this.zoomAtLastRecencyCheck===u?1-this.zoomAdjustment(u):1;return this.zoomAtLastRecencyCheck=u,this.commitTime+this.fadeDuration*g>i}setStale(){this.stale=!0}}function Fo(p,i,u,g,v){p.emplaceBack(i?1:0,u?1:0,g||0,v||0),p.emplaceBack(i?1:0,u?1:0,g||0,v||0),p.emplaceBack(i?1:0,u?1:0,g||0,v||0),p.emplaceBack(i?1:0,u?1:0,g||0,v||0)}const rl=Math.pow(2,25),Td=Math.pow(2,24),po=Math.pow(2,17),Lo=Math.pow(2,16),pf=Math.pow(2,9),ti=Math.pow(2,8),il=Math.pow(2,1);function Oo(p){if(0===p.opacity&&!p.placed)return 0;if(1===p.opacity&&p.placed)return 4294967295;const i=p.placed?1:0,u=Math.floor(127*p.opacity);return u*rl+i*Td+u*po+i*Lo+u*pf+i*ti+u*il+i}const ks=0;class os{constructor(i){this._sortAcrossTiles="viewport-y"!==i.layout.get("symbol-z-order")&&void 0!==i.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(i,u,g,v,b){const T=this._bucketParts;for(;this._currentTileIndex<i.length;)if(u.getBucketParts(T,v,i[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,b())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,T.sort((D,A)=>D.sortKey-A.sortKey));this._currentPartIndex<T.length;){const D=T[this._currentPartIndex];if(u.placeLayerBucketPart(D,this._seenCrossTileIDs,g,0===D.symbolInstanceStart),this._currentPartIndex++,b())return!0}return!1}}class gi{constructor(i,u,g,v,b,T,D,A){this.placement=new Zi(i,b,T,D,A),this._currentPlacementIndex=u.length-1,this._forceFullPlacement=g,this._showCollisionBoxes=v,this._done=!1}isDone(){return this._done}continuePlacement(i,u,g){const v=d.exported.now(),b=()=>{const T=d.exported.now()-v;return!this._forceFullPlacement&&T>2};for(;this._currentPlacementIndex>=0;){const T=u[i[this._currentPlacementIndex]],D=this.placement.collisionIndex.transform.zoom;if("symbol"===T.type&&(!T.minzoom||T.minzoom<=D)&&(!T.maxzoom||T.maxzoom>D)){if(this._inProgressLayer||(this._inProgressLayer=new os(T)),this._inProgressLayer.continuePlacement(g[T.source],this.placement,this._showCollisionBoxes,T,b))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Zc=512/d.EXTENT/2;class Dd{constructor(i,u,g){this.tileID=i,this.indexedSymbolInstances={},this.bucketInstanceId=g;for(let v=0;v<u.length;v++){const b=u.get(v),T=b.key;this.indexedSymbolInstances[T]||(this.indexedSymbolInstances[T]=[]),this.indexedSymbolInstances[T].push({crossTileID:b.crossTileID,coord:this.getScaledCoordinates(b,i)})}}getScaledCoordinates(i,u){const g=Zc/Math.pow(2,u.canonical.z-this.tileID.canonical.z);return{x:Math.floor((u.canonical.x*d.EXTENT+i.tileAnchorX)*g),y:Math.floor((u.canonical.y*d.EXTENT+i.tileAnchorY)*g)}}findMatches(i,u,g){const v=this.tileID.canonical.z<u.canonical.z?1:Math.pow(2,this.tileID.canonical.z-u.canonical.z);for(let b=0;b<i.length;b++){const T=i.get(b);if(T.crossTileID)continue;const D=this.indexedSymbolInstances[T.key];if(!D)continue;const A=this.getScaledCoordinates(T,u);for(const k of D)if(Math.abs(k.coord.x-A.x)<=v&&Math.abs(k.coord.y-A.y)<=v&&!g[k.crossTileID]){g[k.crossTileID]=!0,T.crossTileID=k.crossTileID;break}}}}class St{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Gr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const u=Math.round((i-this.lng)/360);if(0!==u)for(const g in this.indexes){const v=this.indexes[g],b={};for(const T in v){const D=v[T];D.tileID=D.tileID.unwrapTo(D.tileID.wrap+u),b[D.tileID.key]=D}this.indexes[g]=b}this.lng=i}addBucket(i,u,g){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===u.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let b=0;b<u.symbolInstances.length;b++)u.symbolInstances.get(b).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]={});const v=this.usedCrossTileIDs[i.overscaledZ];for(const b in this.indexes){const T=this.indexes[b];if(Number(b)>i.overscaledZ)for(const D in T){const A=T[D];A.tileID.isChildOf(i)&&A.findMatches(u.symbolInstances,i,v)}else{const D=T[i.scaledTo(Number(b)).key];D&&D.findMatches(u.symbolInstances,i,v)}}for(let b=0;b<u.symbolInstances.length;b++){const T=u.symbolInstances.get(b);T.crossTileID||(T.crossTileID=g.generate(),v[T.crossTileID]=!0)}return void 0===this.indexes[i.overscaledZ]&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new Dd(i,u.symbolInstances,u.bucketInstanceId),!0}removeBucketCrossTileIDs(i,u){for(const g in u.indexedSymbolInstances)for(const v of u.indexedSymbolInstances[g])delete this.usedCrossTileIDs[i][v.crossTileID]}removeStaleBuckets(i){let u=!1;for(const g in this.indexes){const v=this.indexes[g];for(const b in v)i[v[b].bucketInstanceId]||(this.removeBucketCrossTileIDs(g,v[b]),delete v[b],u=!0)}return u}}class zr{constructor(){this.layerIndexes={},this.crossTileIDs=new St,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,u,g,v){let b=this.layerIndexes[i.id];void 0===b&&(b=this.layerIndexes[i.id]=new Gr);let T=!1;const D={};"globe"!==v.name&&b.handleWrapJump(g);for(const A of u){const k=A.getBucket(i);k&&i.id===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),b.addBucket(A.tileID,k,this.crossTileIDs)&&(T=!0),D[k.bucketInstanceId]=!0)}return b.removeStaleBuckets(D)&&(T=!0),T}pruneUnusedLayers(i){const u={};i.forEach(g=>{u[g]=!0});for(const g in this.layerIndexes)u[g]||delete this.layerIndexes[g]}}const Wi=(p,i)=>d.emitValidationErrors(p,i&&i.filter(u=>"source.canvas"!==u.identifier)),fa=d.pick(ye,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),Ii=d.pick(ye,["setCenter","setZoom","setBearing","setPitch"]),Wc={version:8,layers:[],sources:{}},Gl={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class ni extends d.Evented{constructor(i,u={}){super(),this.map=i,this.dispatcher=new Ur(an(),this),this.imageManager=new wd,this.imageManager.setEventedParent(this),this.glyphManager=new d.GlyphManager(i._requestManager,u.localFontFamily?d.LocalGlyphMode.all:u.localIdeographFontFamily?d.LocalGlyphMode.ideographs:d.LocalGlyphMode.none,u.localFontFamily||u.localIdeographFontFamily),this.lineAtlas=new d.LineAtlas(256,512),this.crossTileSymbolIndex=new zr,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new d.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",d.getReferrer());const g=this;this._rtlTextPluginCallback=ni.registerForPluginStateChange(v=>{g.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:v.pluginStatus,pluginURL:v.pluginURL},(b,T)=>{if(d.triggerPluginCompletionEvent(b),T&&T.every(D=>D))for(const D in g._sourceCaches){const A=g._sourceCaches[D],k=A.getSource().type;"vector"!==k&&"geojson"!==k||A.reload()}})}),this.on("data",v=>{if("source"!==v.dataType||"metadata"!==v.sourceDataType)return;const b=this.getSource(v.sourceId);if(b&&b.vectorLayerIds)for(const T in this._layers){const D=this._layers[T];D.source===b.id&&this._validateLayer(D)}})}loadURL(i,u={}){this.fire(new d.Event("dataloading",{dataType:"style"}));const g="boolean"==typeof u.validate?u.validate:!d.isMapboxURL(i);i=this.map._requestManager.normalizeStyleURL(i,u.accessToken);const v=this.map._requestManager.transformRequest(i,d.ResourceType.Style);this._request=d.getJSON(v,(b,T)=>{this._request=null,b?this.fire(new d.ErrorEvent(b)):T&&this._load(T,g)})}loadJSON(i,u={}){this.fire(new d.Event("dataloading",{dataType:"style"})),this._request=d.exported.frame(()=>{this._request=null,this._load(i,!1!==u.validate)})}loadEmpty(){this.fire(new d.Event("dataloading",{dataType:"style"})),this._load(Wc,!1)}_updateLayerCount(i,u){const g=u?1:-1;i.is3D()&&(this._num3DLayers+=g),"circle"===i.type&&(this._numCircleLayers+=g),"symbol"===i.type&&(this._numSymbolLayers+=g)}_load(i,u){if(u&&Wi(this,d.validateStyle(i)))return;this._loaded=!0,this.stylesheet=d.clone$1(i),this._updateMapProjection();for(const v in i.sources)this.addSource(v,i.sources[v],{validate:!1});this._changed=!1,i.sprite?this._loadSprite(i.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(i.glyphs);const g=gn(this.stylesheet.layers);this._order=g.map(v=>v.id),this._layers={},this._serializedLayers={};for(let v of g)v=d.createStyleLayer(v),v.setEventedParent(this,{layer:{id:v.id}}),this._layers[v.id]=v,this._serializedLayers[v.id]=v.serialize(),this._updateLayerCount(v,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ol(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new d.Event("data",{dataType:"style"})),this.fire(new d.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(i){this._spriteRequest=function(u,g,v){let b,T,D;const A=d.exported.devicePixelRatio>1?"@2x":"";let k=d.getJSON(g.transformRequest(g.normalizeSpriteURL(u,A,".json"),d.ResourceType.SpriteJSON),(j,H)=>{k=null,D||(D=j,b=H,B())}),L=d.getImage(g.transformRequest(g.normalizeSpriteURL(u,A,".png"),d.ResourceType.SpriteImage),(j,H)=>{L=null,D||(D=j,T=H,B())});function B(){if(D)v(D);else if(b&&T){const j=d.exported.getImageData(T),H={};for(const Z in b){const{width:G,height:ne,x:W,y:Q,sdf:q,pixelRatio:le,stretchX:te,stretchY:re,content:ue}=b[Z],Ce=new d.RGBAImage({width:G,height:ne});d.RGBAImage.copy(j,Ce,{x:W,y:Q},{x:0,y:0},{width:G,height:ne}),H[Z]={data:Ce,pixelRatio:le,sdf:q,stretchX:te,stretchY:re,content:ue}}v(null,H)}}return{cancel(){k&&(k.cancel(),k=null),L&&(L.cancel(),L=null)}}}(i,this.map._requestManager,(u,g)=>{if(this._spriteRequest=null,u)this.fire(new d.ErrorEvent(u));else if(g)for(const v in g)this.imageManager.addImage(v,g[v]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new d.Event("data",{dataType:"style"}))})}_validateLayer(i){const u=this.getSource(i.source);if(!u)return;const g=i.sourceLayer;g&&("geojson"===u.type||u.vectorLayerIds&&-1===u.vectorLayerIds.indexOf(g))&&this.fire(new d.ErrorEvent(new Error(`Source layer "${g}" does not exist on source "${u.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(i){const u=[];for(const g of i){const v=this._layers[g];"custom"!==v.type&&u.push(v.serialize())}return u}hasTransitions(){if(this.light&&this.light.hasTransition()||this.fog&&this.fog.hasTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(i){return!!this.terrain&&Gl[i.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(i){if(!this._loaded)return;const u=this._changed;if(this._changed){const v=Object.keys(this._updatedLayers),b=Object.keys(this._removedLayers);(v.length||b.length)&&this._updateWorkerLayers(v,b);for(const T in this._updatedSources){const D=this._updatedSources[T];"reload"===D?this._reloadSource(T):"clear"===D&&this._clearSource(T)}this._updateTilesForChangedImages();for(const T in this._updatedPaintProps)this._layers[T].updateTransitions(i);this.light.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this._resetUpdates()}const g={};for(const v in this._sourceCaches){const b=this._sourceCaches[v];g[v]=b.used,b.used=!1}for(const v of this._order){const b=this._layers[v];if(b.recalculate(i,this._availableImages),!b.isHidden(i.zoom)){const D=this._getLayerSourceCache(b);D&&(D.used=!0)}const T=this.map.painter;if(T){const D=b.getProgramIds();if(!D)continue;const A=b.getProgramConfiguration(i.zoom);for(const k of D)T.useProgram(k,A)}}for(const v in g){const b=this._sourceCaches[v];g[v]!==b.used&&b.getSource().fire(new d.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:b.getSource().id}))}this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),u&&this.fire(new d.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const i=Object.keys(this._changedImages);if(i.length){for(const u in this._sourceCaches)this._sourceCaches[u].reloadTilesForDependencies(["icons","patterns"],i);this._changedImages={}}}_updateWorkerLayers(i,u){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(i),removedIds:u})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(i){if(this._checkLoaded(),Wi(this,d.validateStyle(i)))return!1;(i=d.clone$1(i)).layers=gn(i.layers);const u=function(v,b){if(!v)return[{command:ye.setStyle,args:[b]}];let T=[];try{if(!Ge(v.version,b.version))return[{command:ye.setStyle,args:[b]}];Ge(v.center,b.center)||T.push({command:ye.setCenter,args:[b.center]}),Ge(v.zoom,b.zoom)||T.push({command:ye.setZoom,args:[b.zoom]}),Ge(v.bearing,b.bearing)||T.push({command:ye.setBearing,args:[b.bearing]}),Ge(v.pitch,b.pitch)||T.push({command:ye.setPitch,args:[b.pitch]}),Ge(v.sprite,b.sprite)||T.push({command:ye.setSprite,args:[b.sprite]}),Ge(v.glyphs,b.glyphs)||T.push({command:ye.setGlyphs,args:[b.glyphs]}),Ge(v.transition,b.transition)||T.push({command:ye.setTransition,args:[b.transition]}),Ge(v.light,b.light)||T.push({command:ye.setLight,args:[b.light]}),Ge(v.fog,b.fog)||T.push({command:ye.setFog,args:[b.fog]}),Ge(v.projection,b.projection)||T.push({command:ye.setProjection,args:[b.projection]});const D={},A=[];!function(B,j,H,Z){let G;for(G in j=j||{},B=B||{})B.hasOwnProperty(G)&&(j.hasOwnProperty(G)||Zn(G,H,Z));for(G in j)j.hasOwnProperty(G)&&(B.hasOwnProperty(G)?Ge(B[G],j[G])||("geojson"===B[G].type&&"geojson"===j[G].type&&Si(B,j,G)?H.push({command:ye.setGeoJSONSourceData,args:[G,j[G].data]}):ho(G,j,H,Z)):qi(G,j,H))}(v.sources,b.sources,A,D);const k=[];v.layers&&v.layers.forEach(B=>{B.source&&D[B.source]?T.push({command:ye.removeLayer,args:[B.id]}):k.push(B)});let L=v.terrain;L&&D[L.source]&&(T.push({command:ye.setTerrain,args:[void 0]}),L=void 0),T=T.concat(A),Ge(L,b.terrain)||T.push({command:ye.setTerrain,args:[b.terrain]}),function(B,j,H){j=j||[];const Z=(B=B||[]).map(ch),G=j.map(ch),ne=B.reduce(df,{}),W=j.reduce(df,{}),Q=Z.slice(),q=Object.create(null);let le,te,re,ue,Ce,Se,be;for(le=0,te=0;le<Z.length;le++)re=Z[le],W.hasOwnProperty(re)?te++:(H.push({command:ye.removeLayer,args:[re]}),Q.splice(Q.indexOf(re,te),1));for(le=0,te=0;le<G.length;le++)re=G[G.length-1-le],Q[Q.length-1-le]!==re&&(ne.hasOwnProperty(re)?(H.push({command:ye.removeLayer,args:[re]}),Q.splice(Q.lastIndexOf(re,Q.length-te),1)):te++,Se=Q[Q.length-le],H.push({command:ye.addLayer,args:[W[re],Se]}),Q.splice(Q.length-le,0,re),q[re]=!0);for(le=0;le<G.length;le++)if(re=G[le],ue=ne[re],Ce=W[re],!q[re]&&!Ge(ue,Ce))if(Ge(ue.source,Ce.source)&&Ge(ue["source-layer"],Ce["source-layer"])&&Ge(ue.type,Ce.type)){for(be in qt(ue.layout,Ce.layout,H,re,null,ye.setLayoutProperty),qt(ue.paint,Ce.paint,H,re,null,ye.setPaintProperty),Ge(ue.filter,Ce.filter)||H.push({command:ye.setFilter,args:[re,Ce.filter]}),Ge(ue.minzoom,Ce.minzoom)&&Ge(ue.maxzoom,Ce.maxzoom)||H.push({command:ye.setLayerZoomRange,args:[re,Ce.minzoom,Ce.maxzoom]}),ue)ue.hasOwnProperty(be)&&"layout"!==be&&"paint"!==be&&"filter"!==be&&"metadata"!==be&&"minzoom"!==be&&"maxzoom"!==be&&(0===be.indexOf("paint.")?qt(ue[be],Ce[be],H,re,be.slice(6),ye.setPaintProperty):Ge(ue[be],Ce[be])||H.push({command:ye.setLayerProperty,args:[re,be,Ce[be]]}));for(be in Ce)Ce.hasOwnProperty(be)&&!ue.hasOwnProperty(be)&&"layout"!==be&&"paint"!==be&&"filter"!==be&&"metadata"!==be&&"minzoom"!==be&&"maxzoom"!==be&&(0===be.indexOf("paint.")?qt(ue[be],Ce[be],H,re,be.slice(6),ye.setPaintProperty):Ge(ue[be],Ce[be])||H.push({command:ye.setLayerProperty,args:[re,be,Ce[be]]}))}else H.push({command:ye.removeLayer,args:[re]}),Se=Q[Q.lastIndexOf(re)+1],H.push({command:ye.addLayer,args:[Ce,Se]})}(k,b.layers,T)}catch(D){console.warn("Unable to compute style diff:",D),T=[{command:ye.setStyle,args:[b]}]}return T}(this.serialize(),i).filter(v=>!(v.command in Ii));if(0===u.length)return!1;const g=u.filter(v=>!(v.command in fa));if(g.length>0)throw new Error(`Unimplemented: ${g.map(v=>v.command).join(", ")}.`);return u.forEach(v=>{"setTransition"!==v.command&&this[v.command].apply(this,v.args)}),this.stylesheet=i,this._updateMapProjection(),!0}addImage(i,u){return this.getImage(i)?this.fire(new d.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(i,u),this._afterImageUpdated(i),this)}updateImage(i,u){this.imageManager.updateImage(i,u)}getImage(i){return this.imageManager.getImage(i)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i),this._afterImageUpdated(i),this):this.fire(new d.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(i){this._availableImages=this.imageManager.listImages(),this._changedImages[i]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new d.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(i,u,g={}){if(this._checkLoaded(),void 0!==this.getSource(i))throw new Error("There is already a source with this ID");if(!u.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(u).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(u.type)>=0&&this._validate(d.validateSource,`sources.${i}`,u,null,g))return;this.map&&this.map._collectResourceTiming&&(u.collectResourceTiming=!0);const v=we(i,u,this.dispatcher,this);v.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i),source:v.serialize(),sourceId:i}));const b=T=>{const D=(T?"symbol:":"other:")+i,A=this._sourceCaches[D]=new d.SourceCache(D,v,T);(T?this._symbolSourceCaches:this._otherSourceCaches)[i]=A,A.style=this,A.onAdd(this.map)};b(!1),"vector"!==u.type&&"geojson"!==u.type||b(!0),v.onAdd&&v.onAdd(this.map),this._changed=!0}removeSource(i){this._checkLoaded();const u=this.getSource(i);if(!u)throw new Error("There is no source with this ID");for(const v in this._layers)if(this._layers[v].source===i)return this.fire(new d.ErrorEvent(new Error(`Source "${i}" cannot be removed while layer "${v}" is using it.`)));if(this.terrain&&this.terrain.get().source===i)return this.fire(new d.ErrorEvent(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));const g=this._getSourceCaches(i);for(const v of g)delete this._sourceCaches[v.id],delete this._updatedSources[v.id],v.fire(new d.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:v.getSource().id})),v.setEventedParent(null),v.clearTiles();return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],u.setEventedParent(null),u.onRemove&&u.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(i,u){this._checkLoaded(),this.getSource(i).setData(u),this._changed=!0}getSource(i){const u=this._getSourceCache(i);return u&&u.getSource()}addLayer(i,u,g={}){this._checkLoaded();const v=i.id;if(this.getLayer(v))return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${v}" already exists on this map`)));let b;if("custom"===i.type){if(Wi(this,d.validateCustomStyleLayer(i)))return;b=d.createStyleLayer(i)}else{if("object"==typeof i.source&&(this.addSource(v,i.source),i=d.clone$1(i),i=d.extend(i,{source:v})),this._validate(d.validateLayer,`layers.${v}`,i,{arrayIndex:-1},g))return;b=d.createStyleLayer(i),this._validateLayer(b),b.setEventedParent(this,{layer:{id:v}}),this._serializedLayers[b.id]=b.serialize(),this._updateLayerCount(b,!0)}const T=u?this._order.indexOf(u):this._order.length;if(u&&-1===T)return void this.fire(new d.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`)));this._order.splice(T,0,v),this._layerOrderChanged=!0,this._layers[v]=b;const D=this._getLayerSourceCache(b);if(this._removedLayers[v]&&b.source&&D&&"custom"!==b.type){const A=this._removedLayers[v];delete this._removedLayers[v],A.type!==b.type?this._updatedSources[b.source]="clear":(this._updatedSources[b.source]="reload",D.pause())}this._updateLayer(b),b.onAdd&&b.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(i,u){if(this._checkLoaded(),this._changed=!0,!this._layers[i])return void this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be moved.`)));if(i===u)return;const g=this._order.indexOf(i);this._order.splice(g,1);const v=u?this._order.indexOf(u):this._order.length;u&&-1===v?this.fire(new d.ErrorEvent(new Error(`Layer with id "${u}" does not exist on this map.`))):(this._order.splice(v,0,i),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(i){this._checkLoaded();const u=this._layers[i];if(!u)return void this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be removed.`)));u.setEventedParent(null),this._updateLayerCount(u,!1);const g=this._order.indexOf(i);this._order.splice(g,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[i]=u,delete this._layers[i],delete this._serializedLayers[i],delete this._updatedLayers[i],delete this._updatedPaintProps[i],u.onRemove&&u.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(i){return this._layers[i]}hasLayer(i){return i in this._layers}hasLayerType(i){for(const u in this._layers)if(this._layers[u].type===i)return!0;return!1}setLayerZoomRange(i,u,g){this._checkLoaded();const v=this.getLayer(i);v?v.minzoom===u&&v.maxzoom===g||(null!=u&&(v.minzoom=u),null!=g&&(v.maxzoom=g),this._updateLayer(v)):this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(i,u,g={}){this._checkLoaded();const v=this.getLayer(i);if(v){if(!Ge(v.filter,u))return null==u?(v.filter=void 0,void this._updateLayer(v)):void(this._validate(d.validateFilter,`layers.${v.id}.filter`,u,{layerType:v.type},g)||(v.filter=d.clone$1(u),this._updateLayer(v)))}else this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be filtered.`)))}getFilter(i){const u=this.getLayer(i);return u&&d.clone$1(u.filter)}setLayoutProperty(i,u,g,v={}){this._checkLoaded();const b=this.getLayer(i);b?Ge(b.getLayoutProperty(u),g)||(b.setLayoutProperty(u,g,v),this._updateLayer(b)):this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(i,u){const g=this.getLayer(i);if(g)return g.getLayoutProperty(u);this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style.`)))}setPaintProperty(i,u,g,v={}){this._checkLoaded();const b=this.getLayer(i);b?Ge(b.getPaintProperty(u),g)||(b.setPaintProperty(u,g,v)&&this._updateLayer(b),this._changed=!0,this._updatedPaintProps[i]=!0):this.fire(new d.ErrorEvent(new Error(`The layer '${i}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(i,u){const g=this.getLayer(i);return g&&g.getPaintProperty(u)}setFeatureState(i,u){this._checkLoaded();const g=i.source,v=i.sourceLayer,b=this.getSource(g);if(!b)return void this.fire(new d.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const T=b.type;if("geojson"===T&&v)return void this.fire(new d.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===T&&!v)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===i.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided.")));const D=this._getSourceCaches(g);for(const A of D)A.setFeatureState(v,i.id,u)}removeFeatureState(i,u){this._checkLoaded();const g=i.source,v=this.getSource(g);if(!v)return void this.fire(new d.ErrorEvent(new Error(`The source '${g}' does not exist in the map's style.`)));const b=v.type,T="vector"===b?i.sourceLayer:void 0;if("vector"===b&&!T)return void this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(u&&"string"!=typeof i.id&&"number"!=typeof i.id)return void this.fire(new d.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const D=this._getSourceCaches(g);for(const A of D)A.removeFeatureState(T,i.id,u)}getFeatureState(i){this._checkLoaded();const u=i.source,g=i.sourceLayer,v=this.getSource(u);if(v){if("vector"!==v.type||g)return void 0===i.id&&this.fire(new d.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(u)[0].getFeatureState(g,i.id);this.fire(new d.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new d.ErrorEvent(new Error(`The source '${u}' does not exist in the map's style.`)))}getTransition(){return d.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const i={};for(const u in this._sourceCaches){const g=this._sourceCaches[u].getSource();i[g.id]||(i[g.id]=g.serialize())}return d.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:i,layers:this._serializeLayers(this._order)},u=>void 0!==u)}_updateLayer(i){this._updatedLayers[i.id]=!0;const u=this._getLayerSourceCache(i);i.source&&!this._updatedSources[i.source]&&u&&"raster"!==u.getSource().type&&(this._updatedSources[i.source]="reload",u.pause()),this._changed=!0,i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const u=T=>"fill-extrusion"===this._layers[T].type,g={},v=[];for(let T=this._order.length-1;T>=0;T--){const D=this._order[T];if(u(D)){g[D]=T;for(const A of i){const k=A[D];if(k)for(const L of k)v.push(L)}}}v.sort((T,D)=>D.intersectionZ-T.intersectionZ);const b=[];for(let T=this._order.length-1;T>=0;T--){const D=this._order[T];if(u(D))for(let A=v.length-1;A>=0;A--){const k=v[A].feature;if(g[k.layer.id]<T)break;b.push(k),v.pop()}else for(const A of i){const k=A[D];if(k)for(const L of k)b.push(L.feature)}}return b}queryRenderedFeatures(i,u,g){u&&u.filter&&this._validate(d.validateFilter,"queryRenderedFeatures.filter",u.filter,null,u);const v={};if(u&&u.layers){if(!Array.isArray(u.layers))return this.fire(new d.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const A of u.layers){const k=this._layers[A];if(!k)return this.fire(new d.ErrorEvent(new Error(`The layer '${A}' does not exist in the map's style and cannot be queried for features.`))),[];v[k.source]=!0}}const b=[];u.availableImages=this._availableImages;const T=u&&u.layers?u.layers.some(A=>{const k=this.getLayer(A);return k&&k.is3D()}):this.has3DLayers(),D=Gi.createFromScreenPoints(i,g);for(const A in this._sourceCaches){const k=this._sourceCaches[A].getSource().id;u.layers&&!v[k]||b.push(et(this._sourceCaches[A],this._layers,this._serializedLayers,D,u,g,T,!!this.map._showQueryGeometry))}return this.placement&&b.push(function(A,k,L,B,j,H,Z){const G={},ne=H.queryRenderedSymbols(B),W=[];for(const Q of Object.keys(ne).map(Number))W.push(Z[Q]);W.sort(gt);for(const Q of W){const q=Q.featureIndex.lookupSymbolFeatures(ne[Q.bucketInstanceId],k,Q.bucketIndex,Q.sourceLayerIndex,j.filter,j.layers,j.availableImages,A);for(const le in q){const te=G[le]=G[le]||[],re=q[le];re.sort((ue,Ce)=>{const Se=Q.featureSortOrder;if(Se){const be=Se.indexOf(ue.featureIndex);return Se.indexOf(Ce.featureIndex)-be}return Ce.featureIndex-ue.featureIndex});for(const ue of re)te.push(ue)}}for(const Q in G)G[Q].forEach(q=>{const le=q.feature,te=L(A[Q]).getFeatureState(le.layer["source-layer"],le.id);le.source=le.layer.source,le.layer["source-layer"]&&(le.sourceLayer=le.layer["source-layer"]),le.state=te});return G}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),D.screenGeometry,u,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(b)}querySourceFeatures(i,u){u&&u.filter&&this._validate(d.validateFilter,"querySourceFeatures.filter",u.filter,null,u);const g=this._getSourceCaches(i);let v=[];for(const b of g)v=v.concat(Re(b,u));return v}addSourceType(i,u,g){return ni.getSourceType(i)?g(new Error(`A source type called "${i}" already exists.`)):(ni.setSourceType(i,u),u.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:u.workerSourceURL},g):g(null,null))}getLight(){return this.light.getLight()}setLight(i,u={}){this._checkLoaded();const g=this.light.getLight();let v=!1;for(const T in i)if(!Ge(i[T],g[T])){v=!0;break}if(!v)return;const b=this._setTransitionParameters({duration:300,delay:0});this.light.setLight(i,u),this.light.updateTransitions(b)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(i,u=1){if(this._checkLoaded(),!i)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===u){if("object"==typeof i.source){const g="terrain-dem-src";this.addSource(g,i.source),i=d.clone$1(i),i=d.extend(i,{source:g})}if(this._validate(d.validateTerrain,"terrain",i))return}if(!this.terrain||this.terrain&&u!==this.terrain.drapeRenderMode)this._createTerrain(i,u);else{const g=this.terrain,v=g.get();for(const b of Object.keys(d.spec.terrain))!i.hasOwnProperty(b)&&d.spec.terrain[b].default&&(i[b]=d.spec.terrain[b].default);for(const b in i)if(!Ge(i[b],v[b])){g.set(i),this.stylesheet.terrain=i;const T=this._setTransitionParameters({duration:0});g.updateTransitions(T);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const u=this.fog=new rr(i,this.map.transform);this.stylesheet.fog=i;const g=this._setTransitionParameters({duration:0});u.updateTransitions(g)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const i of this.map._markers)i._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const u=this.fog,g=u.get();0===Object.keys(i).length&&u.set(i);for(const v in i)if(!Ge(i[v],g[v])){u.set(i),this.stylesheet.fog=i;const b=this._setTransitionParameters({duration:0});u.updateTransitions(b);break}}else this._createFog(i);this._markersNeedUpdate=!0}_setTransitionParameters(i){return{now:d.exported.now(),transition:d.extend(i,this.stylesheet.transition)}}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const i=this._order.filter(g=>this.isLayerDraped(this._layers[g])),u=this._order.filter(g=>!this.isLayerDraped(this._layers[g]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...u)}_createTerrain(i,u){const g=this.terrain=new Ko(i,u);this.stylesheet.terrain=i,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const v=this._setTransitionParameters({duration:0});g.updateTransitions(v)}_force3DLayerUpdate(){for(const i in this._layers){const u=this._layers[i];"fill-extrusion"===u.type&&this._updateLayer(u)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const u=this._layers[i];"symbol"===u.type&&this._updateLayer(u)}}_validate(i,u,g,v,b={}){return(!b||!1!==b.validate)&&Wi(this,i.call(d.validateStyle,d.extend({key:u,style:this.serialize(),value:g,styleSpec:d.spec},v)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),d.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._layers)this._layers[i].setEventedParent(null);for(const i in this._sourceCaches)this._sourceCaches[i].clearTiles(),this._sourceCaches[i].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(i){const u=this._getSourceCaches(i);for(const g of u)g.clearTiles()}_reloadSource(i){const u=this._getSourceCaches(i);for(const g of u)g.resume(),g.reload()}_updateSources(i){for(const u in this._sourceCaches)this._sourceCaches[u].update(i)}_generateCollisionBoxes(){for(const i in this._sourceCaches){const u=this._sourceCaches[i];u.resume(),u.reload()}}_updatePlacement(i,u,g,v,b=!1){let T=!1,D=!1;const A={};for(const k of this._order){const L=this._layers[k];if("symbol"!==L.type)continue;if(!A[L.source]){const j=this._getLayerSourceCache(L);if(!j)continue;A[L.source]=j.getRenderableIds(!0).map(H=>j.getTileByID(H)).sort((H,Z)=>Z.tileID.overscaledZ-H.tileID.overscaledZ||(H.tileID.isLessThan(Z.tileID)?-1:1))}const B=this.crossTileSymbolIndex.addLayer(L,A[L.source],i.center.lng,i.projection);T=T||B}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),b=b||this._layerOrderChanged||0===g,this._layerOrderChanged&&this.fire(new d.Event("neworder")),(b||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(d.exported.now(),i.zoom))&&(this.pauseablePlacement=new gi(i,this._order,b,u,g,v,this.placement,this.fog&&i.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,A),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(d.exported.now()),D=!0),T&&this.pauseablePlacement.placement.setStale()),D||T)for(const k of this._order){const L=this._layers[k];"symbol"===L.type&&this.placement.updateLayerOpacities(L,A[L.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(d.exported.now())}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}getImages(i,u,g){this.imageManager.getImages(u.icons,g),this._updateTilesForChangedImages();const v=b=>{b&&b.setDependencies(u.tileID.key,u.type,u.icons)};v(this._otherSourceCaches[u.source]),v(this._symbolSourceCaches[u.source])}getGlyphs(i,u,g){this.glyphManager.getGlyphs(u.stacks,g)}getResource(i,u,g){return d.makeRequest(u,g)}_getSourceCache(i){return this._otherSourceCaches[i]}_getLayerSourceCache(i){return"symbol"===i.type?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}_getSourceCaches(i){const u=[];return this._otherSourceCaches[i]&&u.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&u.push(this._symbolSourceCaches[i]),u}_isSourceCacheLoaded(i){const u=this._getSourceCaches(i);return 0===u.length?(this.fire(new d.ErrorEvent(new Error(`There is no source with ID '${i}'`))),!1):u.every(g=>g.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ni.getSourceType=function(p){return me[p]},ni.setSourceType=function(p,i){me[p]=i},ni.registerForPluginStateChange=d.registerForPluginStateChange;var ol="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0",ss="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let yr={},as={};yr=Pt("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),as=Pt("#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump float u_fog_temporal_offset;varying vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const ri=Pt("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),lt=ol,Ut="\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif";var Nn={background:Pt("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:Pt("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:Pt("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:Pt("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Pt("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {gl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:Pt("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Pt("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:Pt("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:Pt("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:Pt("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:Pt("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:Pt("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:Pt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:Pt("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:Pt("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:Pt("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Pt("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:Pt("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nhighp vec4 out_color=texture2D(u_gradient_image,v_uv.xy);\n#else\nvec4 out_color=color;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float start=v_uv[2];highp float end=v_uv[3];highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=(start+(v_uv.x)*(end-start));if (trim_end > trim_start) {if (line_progress <=trim_end && line_progress >=trim_start) {out_color=vec4(0,0,0,0);}}\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nattribute highp vec4 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec4 v_uv;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float a_clip_start=a_packed[2];highp float a_clip_end=a_packed[3];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec4(a_uv_x,a_split_index*texel_height-half_texel_height,a_clip_start,a_clip_end);\n#else\nv_uv=vec4(a_uv_x,0.0,a_clip_start,a_clip_end);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:Pt("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:Pt("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:Pt("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetProjected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetProjected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:Pt("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);vec4 offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);\n#else\nvec4 offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);\n#endif\nvec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:Pt("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_projected_pos;attribute float a_fade_opacity;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_globe_anchor;attribute vec3 a_globe_normal;\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(a_globe_anchor+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(tile_anchor,0)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz+h,mercator_pos,u_zoom_transition);vec4 projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);gl_Position=mix(u_coord_matrix*vec4(projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#else\ngl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));\n#endif\nfloat gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:Pt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:Pt("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:Pt("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ss),skyboxGradient:Pt("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",ss),skyboxCapture:Pt("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Pt("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {\n#ifdef CUSTOM_ANTIALIASING\nvec2 uv=gl_FragCoord.xy/u_viewport;highp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);vec3 dir=normalize(ray_dir);vec3 closest_point=dot(u_globe_pos,dir)*dir;float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture2D(u_image0,v_pos0);vec4 color=vec4(raster.rgb*antialias,raster.a*antialias);\n#else\nvec4 color=texture2D(u_image0,v_pos0);\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nglobe_pos+=up_vector.xyz*height;vec4 globe=u_globe_matrix*vec4(globe_pos,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}"),globeAtmosphere:Pt("uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec3 u_start_color;uniform vec4 u_color;uniform vec4 u_space_color;uniform vec4 u_high_color;uniform float u_star_intensity;uniform float u_star_size;uniform float u_star_density;uniform float u_horizon_angle;uniform mat4 u_rotation_matrix;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;highp float random(highp vec3 p) {p=fract(p*vec3(23.2342,97.1231,91.2342));p+=dot(p.zxy,p.yxz+123.1234);return fract(p.x*p.y);}float stars(vec3 p,float scale,vec2 offset) {vec2 uv_scale=(u_viewport/u_star_size)*scale;vec3 position=vec3(p.xy*uv_scale+offset*u_viewport,p.z);vec3 q=fract(position)-0.5;vec3 id=floor(position);float random_visibility=step(random(id),u_star_density);float circle=smoothstep(0.5+u_star_intensity,0.5,length(q));return circle*random_visibility;}void main() {highp vec3 dir=normalize(v_ray_dir);\n#ifdef PROJECTION_GLOBE_VIEW\nfloat globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {discard;return;}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(dot(dir,horizon_dir)),0.0);\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;float closest_point_to_center=length(closest_point-u_globe_pos);float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));float horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nfloat horizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c =mix(color_stop_2,c2,t);float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);vec2 uv=gl_FragCoord.xy/u_viewport-0.5;float aspect_ratio=u_viewport.x/u_viewport.y;vec4 uv_dir=vec4(normalize(vec3(uv.x*aspect_ratio,uv.y,1.0)),1.0);uv_dir=u_rotation_matrix*uv_dir;vec3 n=abs(uv_dir.xyz);vec2 uv_remap=(n.x > n.y && n.x > n.z) ? uv_dir.yz/uv_dir.x:\n(n.y > n.x && n.y > n.z) ? uv_dir.zx/uv_dir.y:\nuv_dir.xy/uv_dir.z;uv_remap.x/=aspect_ratio;vec3 D=vec3(uv_remap,1.0);highp float star_field=0.0;if (u_star_intensity > 0.0) {star_field+=stars(D,1.2,vec2(0.0,0.0));star_field+=stars(D,1.0,vec2(1.0,0.0));star_field+=stars(D,0.8,vec2(0.0,1.0));star_field+=stars(D,0.6,vec2(1.0,1.0));star_field*=(1.0-pow(t,0.25+(1.0-u_high_color.a)*0.75));c+=star_field*alpha_2;}c=dither(c,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=vec4(c,a);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;varying highp vec3 v_ray_dir;varying highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}")};function Pt(p,i,u){const g=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,v=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,b=i.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),T=p.match(v),D=i.match(v),A=ol.match(v);let k=D?D.concat(T):T;u||(yr.staticUniforms&&(k=yr.staticUniforms.concat(k)),as.staticUniforms&&(k=as.staticUniforms.concat(k))),k&&(k=k.concat(A));const L={};return{fragmentSource:p=p.replace(g,(B,j,H,Z,G)=>(L[G]=!0,"define"===j?`\n#ifndef HAS_UNIFORM_u_${G}\nvarying ${H} ${Z} ${G};\n#else\nuniform ${H} ${Z} u_${G};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${G}\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`)),vertexSource:i=i.replace(g,(B,j,H,Z,G)=>{const ne="float"===Z?"vec2":"vec4",W=G.match(/color/)?"color":ne;return L[G]?"define"===j?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${H} ${ne} a_${G};\nvarying ${H} ${Z} ${G};\n#else\nuniform ${H} ${Z} u_${G};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = a_${G};\n#else\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${G} = unpack_mix_${W}(a_${G}, u_${G}_t);\n#else\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`:"define"===j?`\n#ifndef HAS_UNIFORM_u_${G}\nuniform lowp float u_${G}_t;\nattribute ${H} ${ne} a_${G};\n#else\nuniform ${H} ${Z} u_${G};\n#endif\n`:"vec4"===W?`\n#ifndef HAS_UNIFORM_u_${G}\n    ${H} ${Z} ${G} = a_${G};\n#else\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${G}\n    ${H} ${Z} ${G} = unpack_mix_${W}(a_${G}, u_${G}_t);\n#else\n    ${H} ${Z} ${G} = u_${G};\n#endif\n`}),staticAttributes:b,staticUniforms:k}}class Rs{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(i,u,g,v,b,T,D,A,k){this.context=i;let L=this.boundPaintVertexBuffers.length!==v.length;for(let B=0;!L&&B<v.length;B++)this.boundPaintVertexBuffers[B]!==v[B]&&(L=!0);i.extVertexArrayObject&&this.vao&&this.boundProgram===u&&this.boundLayoutVertexBuffer===g&&!L&&this.boundIndexBuffer===b&&this.boundVertexOffset===T&&this.boundDynamicVertexBuffer===D&&this.boundDynamicVertexBuffer2===A&&this.boundDynamicVertexBuffer3===k?(i.bindVertexArrayOES.set(this.vao),D&&D.bind(),b&&b.dynamicDraw&&b.bind(),A&&A.bind(),k&&k.bind()):this.freshBind(u,g,v,b,T,D,A,k)}freshBind(i,u,g,v,b,T,D,A){let k;const L=i.numAttributes,B=this.context,j=B.gl;if(B.extVertexArrayObject)this.vao&&this.destroy(),this.vao=B.extVertexArrayObject.createVertexArrayOES(),B.bindVertexArrayOES.set(this.vao),k=0,this.boundProgram=i,this.boundLayoutVertexBuffer=u,this.boundPaintVertexBuffers=g,this.boundIndexBuffer=v,this.boundVertexOffset=b,this.boundDynamicVertexBuffer=T,this.boundDynamicVertexBuffer2=D,this.boundDynamicVertexBuffer3=A;else{k=B.currentNumAttributes||0;for(let H=L;H<k;H++)j.disableVertexAttribArray(H)}u.enableAttributes(j,i);for(const H of g)H.enableAttributes(j,i);T&&T.enableAttributes(j,i),D&&D.enableAttributes(j,i),A&&A.enableAttributes(j,i),u.bind(),u.setVertexAttribPointers(j,i,b);for(const H of g)H.bind(),H.setVertexAttribPointers(j,i,b);T&&(T.bind(),T.setVertexAttribPointers(j,i,b)),v&&v.bind(),D&&(D.bind(),D.setVertexAttribPointers(j,i,b)),A&&(A.bind(),A.setVertexAttribPointers(j,i,b)),B.currentNumAttributes=L}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function vr(p,i){const u=Math.pow(2,i.canonical.z),g=i.canonical.y;return[new d.MercatorCoordinate(0,g/u).toLngLat().lat,new d.MercatorCoordinate(0,(g+1)/u).toLngLat().lat]}function Fs(p,i,u,g,v,b,T){const D=p.context,A=D.gl,k=u.fbo;if(!k)return;p.prepareDrawTile();const L=p.useProgram("hillshade");D.activeTexture.set(A.TEXTURE0),A.bindTexture(A.TEXTURE_2D,k.colorAttachment.get());const B=((G,ne,W,Q)=>{const q=W.paint.get("hillshade-shadow-color"),le=W.paint.get("hillshade-highlight-color"),te=W.paint.get("hillshade-accent-color");let re=W.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===W.paint.get("hillshade-illumination-anchor")&&(re-=G.transform.angle);const ue=!G.options.moving;return{u_matrix:Q||G.transform.calculateProjMatrix(ne.tileID.toUnwrapped(),ue),u_image:0,u_latrange:vr(0,ne.tileID),u_light:[W.paint.get("hillshade-exaggeration"),re],u_shadow:q,u_highlight:le,u_accent:te}})(p,u,g,p.terrain?i.projMatrix:null);p.prepareDrawProgram(D,L,i.toUnwrapped());const{tileBoundsBuffer:j,tileBoundsIndexBuffer:H,tileBoundsSegments:Z}=p.getTileBoundsBuffers(u);L.draw(D,A.TRIANGLES,v,b,T,d.CullFaceMode.disabled,B,g.id,j,H,Z)}function er(p,i,u){if(!i.needsDEMTextureUpload)return;const g=p.context,v=g.gl;g.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||p.getTileTexture(u.stride);const b=u.getPixels();i.demTexture?i.demTexture.update(b,{premultiply:!1}):i.demTexture=new d.Texture(g,b,v.RGBA,{premultiply:!1}),i.needsDEMTextureUpload=!1}function Ls(p,i,u,g,v,b){const T=p.context,D=T.gl;if(!i.dem)return;const A=i.dem;if(T.activeTexture.set(D.TEXTURE1),er(p,i,A),!i.demTexture)return;i.demTexture.bind(D.NEAREST,D.CLAMP_TO_EDGE);const k=A.dim;T.activeTexture.set(D.TEXTURE0);let L=i.fbo;if(!L){const Z=new d.Texture(T,{width:k,height:k,data:null},D.RGBA);Z.bind(D.LINEAR,D.CLAMP_TO_EDGE),L=i.fbo=T.createFramebuffer(k,k,!0),L.colorAttachment.set(Z.texture)}T.bindFramebuffer.set(L.framebuffer),T.viewport.set([0,0,k,k]);const{tileBoundsBuffer:B,tileBoundsIndexBuffer:j,tileBoundsSegments:H}=p.getMercatorTileBoundsBuffers();p.useProgram("hillshadePrepare").draw(T,D.TRIANGLES,g,v,b,d.CullFaceMode.disabled,((Z,G)=>{const ne=G.stride,W=d.create();return d.ortho(W,0,d.EXTENT,-d.EXTENT,0,0,1),d.translate(W,W,[0,-d.EXTENT,0]),{u_matrix:W,u_image:1,u_dimension:[ne,ne],u_zoom:Z.overscaledZ,u_unpack:G.unpackVector}})(i.tileID,A),u.id,B,j,H),i.needsHillshadePrepare=!1}const ls=(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_image0:new d.Uniform1i(p,i.u_image0),u_skirt_height:new d.Uniform1f(p,i.u_skirt_height)}),Bt=(p,i)=>({u_matrix:p,u_image0:0,u_skirt_height:i}),Ht=(p,i,u,g,v,b,T,D,A,k,L,B,j,H)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(g),u_merc_matrix:u,u_zoom_transition:v,u_merc_center:b,u_image0:0,u_frustum_tl:T,u_frustum_tr:D,u_frustum_br:A,u_frustum_bl:k,u_globe_pos:L,u_globe_radius:B,u_viewport:j,u_grid_matrix:H?Float32Array.from(H):new Float32Array(9)});function zo(p,i){return null!=p&&null!=i&&!(!p.hasData()||!i.hasData())&&null!=p.demTexture&&null!=i.demTexture&&p.tileID.key!==i.tileID.key}const cs=new class{constructor(){this.operations={}}newMorphing(p,i,u,g,v){if(p in this.operations){const b=this.operations[p];b.to.tileID.key!==u.tileID.key&&(b.queued=u)}else this.operations[p]={startTime:g,phase:0,duration:v,from:i,to:u,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const i=this.operations[p];return{from:i.from,to:i.to,phase:i.phase}}update(p){for(const i in this.operations){const u=this.operations[i];for(u.phase=(p-u.startTime)/u.duration;u.phase>=1||!this._validOp(u);)if(!this._nextOp(u,p)){delete this.operations[i];break}}}_nextOp(p,i){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=i,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},Bo={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function ii(p,i){const u=1<<p.z;return!i&&(0===p.x||p.x===u-1)||0===p.y||p.y===u-1}const us=p=>({u_matrix:p});function Os(p,i,u,g,v){if(v>0){const b=d.exported.now(),T=(b-p.timeAdded)/v,D=i?(b-i.timeAdded)/v:-1,A=u.getSource(),k=g.coveringZoomLevel({tileSize:A.tileSize,roundZoom:A.roundZoom}),L=!i||Math.abs(i.tileID.overscaledZ-k)>Math.abs(p.tileID.overscaledZ-k),B=L&&p.refreshedUponExpiration?1:d.clamp(L?T:1-D,0,1);return p.refreshedUponExpiration&&T>=1&&(p.refreshedUponExpiration=!1),i?{opacity:1,mix:1-B}:{opacity:B,mix:0}}return{opacity:1,mix:0}}class fo extends d.SourceCache{constructor(i){const u={type:"raster-dem",maxzoom:i.transform.maxZoom},g=new Ur(an(),null),v=we("mock-dem",u,g,i.style);super("mock-dem",v,!1),v.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,u){i.state="loaded",u(null)}}class Hn extends d.SourceCache{constructor(i){const u=we("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},new Ur(an(),null),i.style);super("proxy",u,!1),u.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,u,g){if(i.freezeTileCoverage)return;this.transform=i;const v=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((b,T)=>{if(b[T.key]="",!this._tiles[T.key]){const D=new d.Tile(T,this._source.tileSize*T.overscaleFactor(),i.tileZoom);D.state="loaded",this._tiles[T.key]=D}return b},{});for(const b in this._tiles)b in v||(this.freeFBO(b),this._tiles[b].unloadVectorData(),delete this._tiles[b])}freeFBO(i){const u=this.proxyCachedFBO[i];if(void 0!==u){const g=Object.values(u);this.renderCachePool.push(...g),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach(i=>i.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Xc extends d.OverscaledTileID{constructor(i,u,g){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=u,this.projMatrix=g}}class hh extends d.Elevation{constructor(i,u){super(),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[g,v,b]=function(A){const k=new d.StructArrayLayout4i8,L=new d.StructArrayLayout3ui6,B=131;k.reserve(17161),L.reserve(33800);const j=d.EXTENT/128,H=d.EXTENT+j/2,Z=H+j;for(let ne=-j;ne<Z;ne+=j)for(let W=-j;W<Z;W+=j){const Q=W<0||W>H||ne<0||ne>H?24575:0,q=d.clamp(Math.round(W),0,d.EXTENT),le=d.clamp(Math.round(ne),0,d.EXTENT);k.emplaceBack(q+Q,le,q,le)}const G=(ne,W)=>{const Q=W*B+ne;L.emplaceBack(Q+1,Q,Q+B),L.emplaceBack(Q+B,Q+B+1,Q+1)};for(let ne=1;ne<129;ne++)for(let W=1;W<129;W++)G(W,ne);return[0,129].forEach(ne=>{for(let W=0;W<130;W++)G(W,ne),G(ne,W)}),[k,L,32768]}(),T=i.context;this.gridBuffer=T.createVertexBuffer(g,d.boundsAttributes.members),this.gridIndexBuffer=T.createIndexBuffer(v),this.gridSegments=d.SegmentVector.simpleSegment(0,0,g.length,v.length),this.gridNoSkirtSegments=d.SegmentVector.simpleSegment(0,0,g.length,b),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new Hn(u.map),this.orthoMatrix=d.create(),d.ortho(this.orthoMatrix,0,d.EXTENT,0,d.EXTENT,0,1);const D=T.gl;this._overlapStencilMode=new d.StencilMode({func:D.GEQUAL,mask:255},0,255,D.KEEP,D.KEEP,D.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=u,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new fo(u.map)}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),i.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=i,this._checkRenderCacheEfficiency()}update(i,u,g){if(i&&i.terrain){this._style!==i&&(this.style=i),this.enabled=!0;const v=i.terrain.properties;this.sourceCache=0===i.terrain.drapeRenderMode?this._mockSourceCache:i._getSourceCache(v.get("source")),this._exaggeration=v.get("exaggeration");const b=()=>{this.sourceCache.used&&d.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const T=this.getScaledDemTileSize();this.sourceCache.update(u,T,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,b(),this._initializing=!0),b(),u.updateElevation(!g),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(u),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const i=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==i.efficiency&&d.warnOnce(`Terrain render cache efficiency is not optimal (${i.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${i.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(i){i.coord&&"source"===i.dataType?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):"style"===i.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._sourceCaches)this._style._sourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(i=>i.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const u=this.proxySourceCache,g=this.painter.transform;this._initializing&&(this._initializing=0===g._centerAltitude&&-1===this.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(g.center),-1),this._emptyDEMTextureDirty=!this._initializing);const v=this.proxyCoords=u.getIds().map(A=>{const k=u.getTileByID(A).tileID;return k.projMatrix=g.calculateProjMatrix(k.toUnwrapped()),k});(function(A,k){const L=k.transform.pointCoordinate(k.transform.getCameraPoint()),B=new d.pointGeometry(L.x,L.y);A.sort((j,H)=>{if(H.overscaledZ-j.overscaledZ)return H.overscaledZ-j.overscaledZ;const Z=new d.pointGeometry(j.canonical.x+(1<<j.canonical.z)*j.wrap,j.canonical.y),G=new d.pointGeometry(H.canonical.x+(1<<H.canonical.z)*H.wrap,H.canonical.y),ne=B.mult(1<<j.canonical.z);return ne.x-=.5,ne.y-=.5,ne.distSqr(Z)-ne.distSqr(G)})})(v,this.painter),this._previousZoom=g.zoom;const b=this.proxyToSource||{};this.proxyToSource={},v.forEach(A=>{this.proxyToSource[A.key]={}}),this.terrainTileForTile={};const T=this._style._sourceCaches;for(const A in T){const k=T[A];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,i[A],b),k.usedForTerrain))continue;const L=i[A];k.getSource().reparseOverscaled&&this._assignTerrainTiles(L)}this.proxiedCoords[u.id]=v.map(A=>new Xc(A,A.key,this.orthoMatrix)),this._assignTerrainTiles(v),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(b),this.renderingToTexture=!1,this._updateTimestamp=d.exported.now();const D={};this._visibleDemTiles=[];for(const A of this.proxyCoords){const k=this.terrainTileForTile[A.key];if(!k)continue;const L=k.tileID.key;L in D||(this._visibleDemTiles.push(k),D[L]=L)}}_assignTerrainTiles(i){this._initializing||i.forEach(u=>{if(this.terrainTileForTile[u.key])return;const g=this._findTileCoveringTileID(u,this.sourceCache);g&&(this.terrainTileForTile[u.key]=g)})}_prepareDEMTextures(){const i=this.painter.context,u=i.gl;for(const g in this.terrainTileForTile){const v=this.terrainTileForTile[g],b=v.dem;!b||v.demTexture&&!v.needsDEMTextureUpload||(i.activeTexture.set(u.TEXTURE1),er(this.painter,v,b))}}_prepareDemTileUniforms(i,u,g,v){if(!u||null==u.demTexture)return!1;const b=i.tileID.canonical,T=Math.pow(2,u.tileID.canonical.z-b.z),D=v||"";return g[`u_dem_tl${D}`]=[b.x*T%1,b.y*T%1],g[`u_dem_scale${D}`]=T,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const i=this.painter.context,u=i.gl;if(!this._emptyDepthBufferTexture){const g=new d.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new d.Texture(i,g,u.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let i=0;const u=this._visibleDemTiles.reduce((g,v)=>{if(!v.dem)return g;const b=v.dem.tree.minimums[0];return b>0&&i++,g+b},0);return i?u/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,u=i.gl;i.activeTexture.set(u.TEXTURE2);const g=this._getLoadedAreaMinimum(),v=new d.RGBAImage({width:1,height:1},new Uint8Array(d.DEMData.pack(g,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let b=this._emptyDEMTexture;return b?b.update(v,{premultiply:!1}):b=this._emptyDEMTexture=new d.Texture(i,v,u.RGBA,{premultiply:!1}),b}setupElevationDraw(i,u,g){const v=this.painter.context,b=v.gl,T=(D=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:d.DEMData.getUnpackVector(D),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var D;T.u_dem_size=this.sourceCache.getSource().tileSize,T.u_exaggeration=this.exaggeration();const A=this.painter.transform,k=A.projection,L=i.tileID.canonical;T.u_tile_tl_up=k.upVector(L,0,0),T.u_tile_tr_up=k.upVector(L,d.EXTENT,0),T.u_tile_br_up=k.upVector(L,d.EXTENT,d.EXTENT),T.u_tile_bl_up=k.upVector(L,0,d.EXTENT),T.u_tile_up_scale=g&&g.useDenormalizedUpVectorScale?d.GLOBE_METERS_TO_ECEF:k.upVectorScale(L,A.center.lat,A.worldSize).metersToTile;let B=null,j=null,H=1;if(g&&g.morphing&&this._useVertexMorphing){const Z=g.morphing.srcDemTile,G=g.morphing.dstDemTile;H=g.morphing.phase,Z&&G&&(this._prepareDemTileUniforms(i,Z,T,"_prev")&&(j=Z),this._prepareDemTileUniforms(i,G,T)&&(B=G))}if(j&&B?(v.activeTexture.set(b.TEXTURE2),B.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),v.activeTexture.set(b.TEXTURE4),j.demTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE,b.NEAREST),T.u_dem_lerp=H):(B=this.terrainTileForTile[i.tileID.key],v.activeTexture.set(b.TEXTURE2),(this._prepareDemTileUniforms(i,B,T)?B.demTexture:this.emptyDEMTexture).bind(b.NEAREST,b.CLAMP_TO_EDGE)),v.activeTexture.set(b.TEXTURE3),g&&g.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),this._depthFBO&&(T.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(b.NEAREST,b.CLAMP_TO_EDGE),T.u_depth_size_inv=[1,1]),g&&g.useMeterToDem&&B){const Z=(1<<B.tileID.canonical.z)*d.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;T.u_meter_to_dem=Z}g&&g.labelPlaneMatrixInv&&(T.u_label_plane_matrix_inv=g.labelPlaneMatrixInv),u.setTerrainUniformValues(v,T)}renderToBackBuffer(i){const u=this.painter,g=this.painter.context;0!==i.length&&(g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),u.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(v,b,T,D,A){if("globe"===v.transform.projection.name)!function(k,L,B,j,H){const Z=k.context,G=Z.gl;let ne,W;const Q=k.options.showTerrainWireframe?2:0,q=k.transform,le=d.globeUseCustomAntiAliasing(k,Z,q),te=(ie,ve)=>{if(W===ie)return;const Ie=[Bo[ie],"PROJECTION_GLOBE_VIEW"];le&&Ie.push("CUSTOM_ANTIALIASING"),ve&&Ie.push(Bo[Q]),ne=k.useProgram("globeRaster",null,Ie),W=ie},re=k.colorModeForRenderPass(),ue=new d.DepthMode(G.LEQUAL,d.DepthMode.ReadWrite,k.depthRangeFor3D);cs.update(H);const Ce=d.calculateGlobeMercatorMatrix(q),Se=[d.mercatorXfromLng(q.center.lng),d.mercatorYfromLat(q.center.lat)],be=k.globeSharedBuffers,Ve=[q.width*d.exported.devicePixelRatio,q.height*d.exported.devicePixelRatio];if((Q?[!1,!0]:[!1]).forEach(ie=>{W=-1;const ve=ie?G.LINES:G.TRIANGLES;for(const Ie of j){const Ze=B.getTile(Ie),Me=d.StencilMode.disabled,it=L.prevTerrainTileForTile[Ie.key],He=L.terrainTileForTile[Ie.key];zo(it,He)&&cs.newMorphing(Ie.key,it,He,H,250),Z.activeTexture.set(G.TEXTURE0),Ze.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);const Ke=cs.getMorphValuesForProxy(Ie.key),We=Ke?1:0,Xe={useDenormalizedUpVectorScale:!0};Ke&&d.extend$1(Xe,{morphing:{srcDemTile:Ke.from,dstDemTile:Ke.to,phase:d.easeCubicInOut(Ke.phase)}});const st=Float32Array.from(q.globeMatrix),qe=d.globeTileLatLngCorners(Ie.canonical),Dt=d.getLatitudinalLod((qe[0][0]+qe[1][0])/2),ht=d.getGridMatrix(Ie.canonical,qe,Dt),Ct=d.globeNormalizeECEF(d.globeTileBounds(Ie.canonical)),_n=Ht(q.projMatrix,st,Ce,Ct,d.globeToMercatorTransition(q.zoom),Se,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,Ve,ht);if(te(We,ie),L.setupElevationDraw(Ze,ne,Xe),k.prepareDrawProgram(Z,ne,Ie.toUnwrapped()),be){const[Rn,Xn,Sn]=ie?be.getWirefameBuffers(k.context,Dt):be.getGridBuffers(Dt);ne.draw(Z,ve,ue,Me,re,d.CullFaceMode.backCCW,_n,"globe_raster",Rn,Xn,Sn)}}}),be){const ie=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];le&&ie.push("CUSTOM_ANTIALIASING"),ne=k.useProgram("globeRaster",null,ie);for(const ve of j){const{x:Ie,y:Ze,z:Me}=ve.canonical,it=0===Ze,He=Ze===(1<<Me)-1,[Ke,We,Xe,st]=be.getPoleBuffers(Me);if(st&&(it||He)){const qe=B.getTile(ve);Z.activeTexture.set(G.TEXTURE0),qe.texture.bind(G.LINEAR,G.CLAMP_TO_EDGE);let Dt=d.globePoleMatrixForTile(Me,Ie,q);const ht=d.globeNormalizeECEF(d.globeTileBounds(ve.canonical)),Ct=(_n,Rn)=>_n.draw(Z,G.TRIANGLES,ue,d.StencilMode.disabled,re,d.CullFaceMode.disabled,Ht(q.projMatrix,Dt,Dt,ht,0,Se,q.frustumCorners.TL,q.frustumCorners.TR,q.frustumCorners.BR,q.frustumCorners.BL,q.globeCenterInViewSpace,q.globeRadius,Ve),"globe_pole_raster",Rn,Xe,st);L.setupElevationDraw(qe,ne,{}),k.prepareDrawProgram(Z,ne,ve.toUnwrapped()),it&&Ct(ne,Ke),He&&(Dt=d.scale(d.create(),Dt,[1,-1,1]),Ct(ne,We))}}}}(v,b,T,D,A);else{const k=v.context,L=k.gl;let B,j;const H=v.options.showTerrainWireframe?2:0,Z=(q,le)=>{if(j===q)return;const te=[Bo[q]];le&&te.push(Bo[H]),B=v.useProgram("terrainRaster",null,te),j=q},G=v.colorModeForRenderPass(),ne=new d.DepthMode(L.LEQUAL,d.DepthMode.ReadWrite,v.depthRangeFor3D);cs.update(A);const W=v.transform,Q=6*Math.pow(1.5,22-W.zoom)*b.exaggeration();(H?[!1,!0]:[!1]).forEach(q=>{j=-1;const le=q?L.LINES:L.TRIANGLES,[te,re]=q?b.getWirefameBuffer():[b.gridIndexBuffer,b.gridSegments];for(const ue of D){const Ce=T.getTile(ue),Se=d.StencilMode.disabled,be=b.prevTerrainTileForTile[ue.key],Ve=b.terrainTileForTile[ue.key];zo(be,Ve)&&cs.newMorphing(ue.key,be,Ve,A,250),k.activeTexture.set(L.TEXTURE0),Ce.texture.bind(L.LINEAR,L.CLAMP_TO_EDGE,L.LINEAR_MIPMAP_NEAREST);const ie=cs.getMorphValuesForProxy(ue.key),ve=ie?1:0;let Ie;ie&&(Ie={morphing:{srcDemTile:ie.from,dstDemTile:ie.to,phase:d.easeCubicInOut(ie.phase)}});const Ze=Bt(ue.projMatrix,ii(ue.canonical,W.renderWorldCopies)?Q/10:Q);Z(ve,q),b.setupElevationDraw(Ce,B,Ie),v.prepareDrawProgram(k,B,ue.toUnwrapped()),B.draw(k,le,ne,Se,G,d.CullFaceMode.backCCW,Ze,"terrain_raster",b.gridBuffer,te,re)}})}}(u,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,u.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(0===this._drapedRenderBatches.length)return i+1;this.renderingToTexture=!0;const u=this.painter,g=this.painter.context,v=this.proxySourceCache,b=this.proxiedCoords[v.id],T=this._drapedRenderBatches.shift(),D=[],A=u.style.order;let k=0;for(const L of b){const B=v.getTileByID(L.proxyTileKey),j=v.proxyCachedFBO[L.key]?v.proxyCachedFBO[L.key][i]:void 0,H=void 0!==j?v.renderCache[j]:this.pool[k++],Z=void 0!==j;if(B.texture=H.tex,Z&&!H.dirty){D.push(B.tileID);continue}let G;g.bindFramebuffer.set(H.fb.framebuffer),this.renderedToTile=!1,H.dirty&&(g.clear({color:d.Color.transparent,stencil:0}),H.dirty=!1);for(let ne=T.start;ne<=T.end;++ne){const W=u.style._layers[A[ne]];if(W.isHidden(u.transform.zoom))continue;const Q=u.style._getLayerSourceCache(W),q=Q?this.proxyToSource[L.key][Q.id]:[L];if(!q)continue;const le=q;g.viewport.set([0,0,H.fb.width,H.fb.height]),G!==(Q?Q.id:null)&&(this._setupStencil(H,q,W,Q),G=Q?Q.id:null),u.renderLayer(u,Q,W,le)}this.renderedToTile?(H.dirty=!0,D.push(B.tileID)):Z||--k,5===k&&(k=0,this.renderToBackBuffer(D))}return this.renderToBackBuffer(D),this.renderingToTexture=!1,g.bindFramebuffer.set(null),g.viewport.set([0,0,u.width,u.height]),T.end+1}postRender(){}renderCacheEfficiency(i){const u=i.order.length;if(0===u)return{efficiency:100};let g,v=0,b=0,T=!1;for(let D=0;D<u;++D){const A=i._layers[i.order[D]];this._style.isLayerDraped(A)?(T&&++v,++b):T||(T=!0,g=A.id)}return 0===b?{efficiency:100}:{efficiency:100*(1-v/b),firstUndrapedLayer:g}}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter(u=>u.dem).forEach(u=>{i=Math.min(i,u.dem.tree.minimums[0])}),0===i?i:(i-30)*this._exaggeration}raycast(i,u,g){if(!this._visibleDemTiles)return null;const v=this._visibleDemTiles.filter(b=>b.dem).map(b=>{const T=b.tileID,D=Math.pow(2,T.overscaledZ),{x:A,y:k}=T.canonical,L=A/D,B=(A+1)/D,j=k/D,H=(k+1)/D;return{minx:L,miny:j,maxx:B,maxy:H,t:b.dem.tree.raycastRoot(L,j,B,H,i,u,g),tile:b}});v.sort((b,T)=>(null!==b.t?b.t:Number.MAX_VALUE)-(null!==T.t?T.t:Number.MAX_VALUE));for(const b of v){if(null==b.t)return null;const T=b.tile.dem.tree.raycast(b.minx,b.miny,b.maxx,b.maxy,i,u,g);if(null!=T)return T}return null}_createFBO(){const i=this.painter.context,u=i.gl,g=this.drapeBufferSize;i.activeTexture.set(u.TEXTURE0);const v=new d.Texture(i,{width:g[0],height:g[1],data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE);const b=i.createFramebuffer(g[0],g[1],!1);return b.colorAttachment.set(v.texture),b.depthAttachment=new O(i,b.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,g[0],g[1]),this._stencilRef=0,b.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):b.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&!i.extTextureFilterAnisotropicForceOff&&u.texParameterf(u.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:b,tex:v,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const i in this._style._sourceCaches)if(this._style._sourceCaches[i].hasTransition())return!0;return this._style.order.some(i=>{const u=this._style._layers[i],g=u.isHidden(this.painter.transform.zoom),v=u.getCrossfadeParameters(),b=!!v&&1!==v.t,T=u.hasTransition();return"custom"!==u.type&&!g&&(b||T)})}_clearRasterFadeFromRenderCache(){let i=!1;for(const u in this._style._sourceCaches)if(this._style._sourceCaches[u]._source instanceof K){i=!0;break}if(i)for(let u=0;u<this._style.order.length;++u){const g=this._style._layers[this._style.order[u]],v=g.isHidden(this.painter.transform.zoom),b=this._style._getLayerSourceCache(g);if("raster"!==g.type||v||!b)continue;const T=g.paint.get("raster-fade-duration");for(const D of this.proxyCoords){const A=this.proxyToSource[D.key][b.id];if(A)for(const k of A){const L=Os(b.getTile(k),b.findLoadedParent(k,0),b,this.painter.transform,T);(1!==L.opacity||0!==L.mix)&&this._clearRenderCacheForTile(b.id,k)}}}}_setupDrapedRenderBatches(){const i=this._style.order,u=i.length;if(0===u)return;const g=[];let v,b=0,T=this._style._layers[i[b]];for(;!this._style.isLayerDraped(T)&&T.isHidden(this.painter.transform.zoom)&&++b<u;)T=this._style._layers[i[b]];for(;b<u;++b){const D=this._style._layers[i[b]];D.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(D)?void 0===v&&(v=b):void 0!==v&&(g.push({start:v,end:b-1}),v=void 0))}void 0!==v&&g.push({start:v,end:b-1}),this._drapedRenderBatches=g}_setupRenderCache(i){const u=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,u.renderCache.length>u.renderCachePool.length){const T=Object.values(u.proxyCachedFBO);u.proxyCachedFBO={};for(let D=0;D<T.length;++D){const A=Object.values(T[D]);u.renderCachePool.push(...A)}}return}this._clearRasterFadeFromRenderCache();const g=this.proxyCoords,v=this._tilesDirty;for(let T=g.length-1;T>=0;T--){const D=g[T];if(u.getTileByID(D.key),void 0!==u.proxyCachedFBO[D.key]){const A=i[D.key],k=this.proxyToSource[D.key];let L=0;for(const B in k){const j=k[B],H=A[B];if(!H||H.length!==j.length||j.some((Z,G)=>Z!==H[G]||v[B]&&v[B].hasOwnProperty(Z.key))){L=-1;break}++L}for(const B in u.proxyCachedFBO[D.key])u.renderCache[u.proxyCachedFBO[D.key][B]].dirty=L<0||L!==Object.values(A).length}}const b=[...this._drapedRenderBatches];b.sort((T,D)=>D.end-D.start-(T.end-T.start));for(const T of b)for(const D of g){if(u.proxyCachedFBO[D.key])continue;let A=u.renderCachePool.pop();void 0===A&&u.renderCache.length<50&&(A=u.renderCache.length,u.renderCache.push(this._createFBO())),void 0!==A&&(u.proxyCachedFBO[D.key]={},u.proxyCachedFBO[D.key][T.start]=A,u.renderCache[A].dirty=!0)}this._tilesDirty={}}_setupStencil(i,u,g,v){if(!v||!this._sourceTilesOverlap[v.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const b=this.painter.context,T=b.gl;if(u.length<=1)return void(this._overlapStencilType=!1);let D;if(g.isTileClipped())D=u.length,this._overlapStencilMode.test={func:T.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(u[0].overscaledZ>u[u.length-1].overscaledZ))return void(this._overlapStencilType=!1);D=1,this._overlapStencilMode.test={func:T.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+D>255&&(b.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=D,this._overlapStencilMode.ref=this._stencilRef,g.isTileClipped()&&this._renderTileClippingMasks(u,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):d.StencilMode.disabled}_renderTileClippingMasks(i,u){const g=this.painter,v=this.painter.context,b=v.gl;g._tileClippingMaskIDs={},v.setColorMode(d.ColorMode.disabled),v.setDepthMode(d.DepthMode.disabled);const T=g.useProgram("clippingMask");for(const D of i){const A=g._tileClippingMaskIDs[D.key]=--u;T.draw(v,b.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:b.ALWAYS,mask:0},A,255,b.KEEP,b.KEEP,b.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,us(D.projMatrix),"$clipping",g.tileExtentBuffer,g.quadTriangleIndexBuffer,g.tileExtentSegments)}}pointCoordinate(i){const u=this.painter.transform;if(i.x<0||i.x>u.width||i.y<0||i.y>u.height)return null;const g=[i.x,i.y,1,1];d.transformMat4$1(g,g,u.pixelMatrixInverse),d.scale$1(g,g,1/g[3]),g[0]/=u.worldSize,g[1]/=u.worldSize;const v=u._camera.position,b=d.mercatorZfromAltitude(1,u.center.lat),T=[v[0],v[1],v[2]/b,0],D=d.subtract([],g.slice(0,3),T);d.normalize(D,D);const A=this.raycast(T,D,this._exaggeration);return null!==A&&A?(d.scaleAndAdd(T,T,D,A),T[3]=T[2],T[2]*=b,T):null}drawDepth(){const i=this.painter,u=i.context,g=this.proxySourceCache,v=Math.ceil(i.width),b=Math.ceil(i.height);if(!this._depthFBO||this._depthFBO.width===v&&this._depthFBO.height===b||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const T=u.gl,D=u.createFramebuffer(v,b,!0);u.activeTexture.set(T.TEXTURE0);const A=new d.Texture(u,{width:v,height:b,data:null},T.RGBA);A.bind(T.NEAREST,T.CLAMP_TO_EDGE),D.colorAttachment.set(A.texture);const k=u.createRenderbuffer(u.gl.DEPTH_COMPONENT16,v,b);D.depthAttachment.set(k),this._depthFBO=D,this._depthTexture=A}u.bindFramebuffer.set(this._depthFBO.framebuffer),u.viewport.set([0,0,v,b]),function(T,D,A,k){if("globe"===T.transform.projection.name)return;const L=T.context,B=L.gl;L.clear({depth:1});const j=T.useProgram("terrainDepth"),H=new d.DepthMode(B.LESS,d.DepthMode.ReadWrite,T.depthRangeFor3D);for(const Z of k){const G=A.getTile(Z),ne=Bt(Z.projMatrix,0);D.setupElevationDraw(G,j),j.draw(L,B.TRIANGLES,H,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.backCCW,ne,"terrain_depth",D.gridBuffer,D.gridIndexBuffer,D.gridNoSkirtSegments)}}(i,this,g,this.proxyCoords)}_setupProxiedCoordsForOrtho(i,u,g){if(i.getSource()instanceof ge)return this._setupProxiedCoordsForImageSource(i,u,g);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const v=this.proxiedCoords[i.id]=[],b=this.proxyCoords;for(let D=0;D<b.length;D++){const A=b[D],k=this._findTileCoveringTileID(A,i);if(k){const L=this._createProxiedId(A,k,g[A.key]&&g[A.key][i.id]);v.push(L),this.proxyToSource[A.key][i.id]=[L]}}let T=!1;for(let D=0;D<u.length;D++){const A=i.getTile(u[D]);if(!A||!A.hasData())continue;const k=this._findTileCoveringTileID(A.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==A.tileID.canonical.z){const L=this.proxyToSource[k.tileID.key][i.id],B=this._createProxiedId(k.tileID,A,g[k.tileID.key]&&g[k.tileID.key][i.id]);L?L.splice(L.length-1,0,B):this.proxyToSource[k.tileID.key][i.id]=[B],v.push(B),T=!0}}this._sourceTilesOverlap[i.id]=T}_setupProxiedCoordsForImageSource(i,u,g){if(!i.getSource().loaded())return;const v=this.proxiedCoords[i.id]=[],b=this.proxyCoords,T=i.getSource(),D=new d.pointGeometry(T.tileID.x,T.tileID.y)._div(1<<T.tileID.z),A=T.coordinates.map(d.MercatorCoordinate.fromLngLat).reduce((L,B)=>(L.min.x=Math.min(L.min.x,B.x-D.x),L.min.y=Math.min(L.min.y,B.y-D.y),L.max.x=Math.max(L.max.x,B.x-D.x),L.max.y=Math.max(L.max.y,B.y-D.y),L),{min:new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new d.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(L,B)=>{const j=L.wrap+L.canonical.x/(1<<L.canonical.z),H=L.canonical.y/(1<<L.canonical.z),Z=d.EXTENT/(1<<L.canonical.z),G=B.wrap+B.canonical.x/(1<<B.canonical.z),ne=B.canonical.y/(1<<B.canonical.z);return j+Z<G+A.min.x||j>G+A.max.x||H+Z<ne+A.min.y||H>ne+A.max.y};for(let L=0;L<b.length;L++){const B=b[L];for(let j=0;j<u.length;j++){const H=i.getTile(u[j]);if(!H||!H.hasData()||k(B,H.tileID))continue;const Z=this._createProxiedId(B,H,g[B.key]&&g[B.key][i.id]),G=this.proxyToSource[B.key][i.id];G?G.push(Z):this.proxyToSource[B.key][i.id]=[Z],v.push(Z)}}}_createProxiedId(i,u,g){let v=this.orthoMatrix;if(g){const b=g.find(T=>T.key===u.tileID.key);if(b)return b}if(u.tileID.key!==i.key){const b=i.canonical.z-u.tileID.canonical.z;let T,D,A;v=d.create();const k=u.tileID.wrap-i.wrap<<i.overscaledZ;b>0?(T=d.EXTENT>>b,D=T*((u.tileID.canonical.x<<b)-i.canonical.x+k),A=T*((u.tileID.canonical.y<<b)-i.canonical.y)):(T=d.EXTENT<<-b,D=d.EXTENT*(u.tileID.canonical.x-(i.canonical.x+k<<-b)),A=d.EXTENT*(u.tileID.canonical.y-(i.canonical.y<<-b))),d.ortho(v,0,T,0,T,0,1),d.translate(v,v,[D,A,0])}return new Xc(u.tileID,i.key,v)}_findTileCoveringTileID(i,u){let g=u.getTile(i);if(g&&g.hasData())return g;const v=this._findCoveringTileCache[u.id],b=v[i.key];if(g=b?u.getTileByID(b):null,g&&g.hasData()||null===b)return g;let T=g?g.tileID:i,D=T.overscaledZ;const A=u.getSource().minzoom,k=[];if(!b){const B=u.getSource().maxzoom;if(i.canonical.z>=B){const j=i.canonical.z-B;u.getSource().reparseOverscaled?(D=Math.max(i.canonical.z+2,u.transform.tileZoom),T=new d.OverscaledTileID(D,i.wrap,B,i.canonical.x>>j,i.canonical.y>>j)):0!==j&&(D=B,T=new d.OverscaledTileID(D,i.wrap,B,i.canonical.x>>j,i.canonical.y>>j))}T.key!==i.key&&(k.push(T.key),g=u.getTile(T))}const L=B=>{k.forEach(j=>{v[j]=B}),k.length=0};for(D-=1;D>=A&&(!g||!g.hasData());D--){g&&L(g.tileID.key);const B=T.calculateScaledKey(D);if(g=u.getTileByID(B),g&&g.hasData())break;const j=v[B];if(null===j)break;void 0===j?k.push(B):g=u.getTileByID(j)}return L(g?g.tileID.key:null),g&&g.hasData()?g:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,u){let g=this._tilesDirty[i];g||(g=this._tilesDirty[i]={}),g[u.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const i=function(u){let g=0;const v=new d.StructArrayLayout2ui4,b=131;for(let T=1;T<129;T++){for(let D=1;D<129;D++)g=T*b+D,v.emplaceBack(g,g+1),v.emplaceBack(g,g+b),v.emplaceBack(g+1,g+b),128===T&&v.emplaceBack(g+b,g+b+1);v.emplaceBack(g+1,g+1+b)}return v}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(i),this.wireframeSegments=d.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,i.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Pi(p){const i=[];for(let u=0;u<p.length;u++){if(null===p[u])continue;const g=p[u].split(" ");i.push(g.pop())}return i}class _i{static cacheKey(i,u,g){let v=`${i}${g?g.cacheKey:""}`;for(const b of u)v+=`/${b}`;return v}constructor(i,u,g,v,b,T){const D=i.gl;this.program=D.createProgram();const A=Pi(g.staticAttributes),k=v?v.getBinderAttributes():[],L=A.concat(k),B=g.staticUniforms?Pi(g.staticUniforms):[],j=v?v.getBinderUniforms():[],H=B.concat(j),Z=[];for(const te of H)Z.indexOf(te)<0&&Z.push(te);let G=v?v.defines():[];G=G.concat(T.map(te=>`#define ${te}`));const ne=G.concat(i.extStandardDerivatives?"#extension GL_OES_standard_derivatives : enable\n".concat(Ut):Ut,Ut,lt,ri.fragmentSource,as.fragmentSource,g.fragmentSource).join("\n"),W=G.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",lt,ri.vertexSource,as.vertexSource,yr.vertexSource,g.vertexSource).join("\n"),Q=D.createShader(D.FRAGMENT_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(Q,ne),D.compileShader(Q),D.attachShader(this.program,Q);const q=D.createShader(D.VERTEX_SHADER);if(D.isContextLost())return void(this.failedToCreate=!0);D.shaderSource(q,W),D.compileShader(q),D.attachShader(this.program,q),this.attributes={};const le={};this.numAttributes=L.length;for(let te=0;te<this.numAttributes;te++)L[te]&&(D.bindAttribLocation(this.program,te,L[te]),this.attributes[L[te]]=te);D.linkProgram(this.program),D.deleteShader(q),D.deleteShader(Q);for(let te=0;te<Z.length;te++){const re=Z[te];if(re&&!le[re]){const ue=D.getUniformLocation(this.program,re);ue&&(le[re]=ue)}}var te,re;this.fixedUniforms=b(i,le),this.binderUniforms=v?v.getUniforms(i,le):[],-1!==T.indexOf("TERRAIN")&&(this.terrainUniforms={u_dem:new d.Uniform1i(te=i,(re=le).u_dem),u_dem_prev:new d.Uniform1i(te,re.u_dem_prev),u_dem_unpack:new d.Uniform4f(te,re.u_dem_unpack),u_dem_tl:new d.Uniform2f(te,re.u_dem_tl),u_dem_scale:new d.Uniform1f(te,re.u_dem_scale),u_dem_tl_prev:new d.Uniform2f(te,re.u_dem_tl_prev),u_dem_scale_prev:new d.Uniform1f(te,re.u_dem_scale_prev),u_dem_size:new d.Uniform1f(te,re.u_dem_size),u_dem_lerp:new d.Uniform1f(te,re.u_dem_lerp),u_exaggeration:new d.Uniform1f(te,re.u_exaggeration),u_depth:new d.Uniform1i(te,re.u_depth),u_depth_size_inv:new d.Uniform2f(te,re.u_depth_size_inv),u_meter_to_dem:new d.Uniform1f(te,re.u_meter_to_dem),u_label_plane_matrix_inv:new d.UniformMatrix4f(te,re.u_label_plane_matrix_inv),u_tile_tl_up:new d.Uniform3f(te,re.u_tile_tl_up),u_tile_tr_up:new d.Uniform3f(te,re.u_tile_tr_up),u_tile_br_up:new d.Uniform3f(te,re.u_tile_br_up),u_tile_bl_up:new d.Uniform3f(te,re.u_tile_bl_up),u_tile_up_scale:new d.Uniform1f(te,re.u_tile_up_scale)}),-1!==T.indexOf("FOG")&&(this.fogUniforms=((te,re)=>({u_fog_matrix:new d.UniformMatrix4f(te,re.u_fog_matrix),u_fog_range:new d.Uniform2f(te,re.u_fog_range),u_fog_color:new d.Uniform4f(te,re.u_fog_color),u_fog_horizon_blend:new d.Uniform1f(te,re.u_fog_horizon_blend),u_fog_temporal_offset:new d.Uniform1f(te,re.u_fog_temporal_offset),u_frustum_tl:new d.Uniform3f(te,re.u_frustum_tl),u_frustum_tr:new d.Uniform3f(te,re.u_frustum_tr),u_frustum_br:new d.Uniform3f(te,re.u_frustum_br),u_frustum_bl:new d.Uniform3f(te,re.u_frustum_bl),u_globe_pos:new d.Uniform3f(te,re.u_globe_pos),u_globe_radius:new d.Uniform1f(te,re.u_globe_radius),u_globe_transition:new d.Uniform1f(te,re.u_globe_transition),u_is_globe:new d.Uniform1i(te,re.u_is_globe),u_viewport:new d.Uniform2f(te,re.u_viewport)}))(i,le))}setTerrainUniformValues(i,u){if(!this.terrainUniforms)return;const g=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in u)g[v].set(u[v])}}setFogUniformValues(i,u){if(!this.fogUniforms)return;const g=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const v in u)g[v].location&&g[v].set(u[v])}}draw(i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G,ne,W){const Q=i.gl;if(this.failedToCreate)return;i.program.set(this.program),i.setDepthMode(g),i.setStencilMode(v),i.setColorMode(b),i.setCullFace(T);for(const le of Object.keys(this.fixedUniforms))this.fixedUniforms[le].set(D[le]);Z&&Z.setUniforms(i,this.binderUniforms,j,{zoom:H});const q={[Q.LINES]:2,[Q.TRIANGLES]:3,[Q.LINE_STRIP]:1}[u];for(const le of B.get()){const te=le.vaos||(le.vaos={});(te[A]||(te[A]=new Rs)).bind(i,this,k,Z?Z.getPaintVertexBuffers():[],L,le.vertexOffset,G,ne,W),Q.drawElements(u,le.primitiveLength*q,Q.UNSIGNED_SHORT,le.primitiveOffset*q*2)}}}function Hl(p,i,u){const g=1/$i(u,1,i.transform.tileZoom),v=Math.pow(2,u.tileID.overscaledZ),b=u.tileSize*Math.pow(2,i.transform.tileZoom)/v,T=b*(u.tileID.canonical.x+u.tileID.wrap*v),D=b*u.tileID.canonical.y;return{u_image:0,u_texsize:u.imageAtlasTexture.size,u_scale:[g,p.fromScale,p.toScale],u_fade:p.t,u_pixel_coord_upper:[T>>16,D>>16],u_pixel_coord_lower:[65535&T,65535&D]}}const ql=d.create(),Zl=(p,i,u,g,v,b,T,D,A)=>{const k=i.style.light,L=k.properties.get("position"),B=[L.x,L.y,L.z],j=d.create$1();"viewport"===k.properties.get("anchor")&&(d.fromRotation(j,-i.transform.angle),d.transformMat3(B,B,j));const H=k.properties.get("color"),Z=i.transform,G={u_matrix:p,u_lightpos:B,u_lightintensity:k.properties.get("intensity"),u_lightcolor:[H.r,H.g,H.b],u_vertical_gradient:+u,u_opacity:g,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:ql,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===Z.projection.name&&(G.u_tile_id=[v.canonical.x,v.canonical.y,1<<v.canonical.z],G.u_zoom_transition=T,G.u_inv_rot_matrix=A,G.u_merc_center=D,G.u_up_dir=Z.projection.upVector(new d.CanonicalTileID(0,0,0),D[0]*d.EXTENT,D[1]*d.EXTENT),G.u_height_lift=b),G},oi=(p,i,u,g,v,b,T,D,A,k,L)=>{const B=Zl(p,i,u,g,v,D,A,k,L),j={u_height_factor:-Math.pow(2,v.overscaledZ)/T.tileSize/8};return d.extend(B,Hl(b,i,T),j)},sl=p=>({u_matrix:p}),Sd=(p,i,u,g)=>d.extend(sl(p),Hl(u,i,g)),Yc=(p,i)=>({u_matrix:p,u_world:i}),dh=(p,i,u,g,v)=>d.extend(Sd(p,i,u,g),{u_world:v}),hs=d.create(),Md=(p,i,u,g,v,b)=>{const T=p.transform,D="globe"===T.projection.name;let A;if("map"===b.paint.get("circle-pitch-alignment"))if(D){const L=d.globePixelsToTileUnits(T.zoom,i.canonical)*T._projectionScaler;A=Float32Array.from([L,0,0,L])}else A=T.calculatePixelsToTileUnitsMatrix(u);else A=new Float32Array([T.pixelsToGLUnits[0],0,0,T.pixelsToGLUnits[1]]);const k={u_camera_to_center_distance:T.cameraToCenterDistance,u_matrix:p.translatePosMatrix(i.projMatrix,u,b.paint.get("circle-translate"),b.paint.get("circle-translate-anchor")),u_device_pixel_ratio:d.exported.devicePixelRatio,u_extrude_scale:A,u_inv_rot_matrix:hs,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(D){k.u_inv_rot_matrix=g,k.u_merc_center=v,k.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],k.u_zoom_transition=d.globeToMercatorTransition(T.zoom);const L=v[0]*d.EXTENT,B=v[1]*d.EXTENT;k.u_up_dir=T.projection.upVector(new d.CanonicalTileID(0,0,0),L,B)}return k},ff=p=>{const i=[];return"map"===p.paint.get("circle-pitch-alignment")&&i.push("PITCH_WITH_MAP"),"map"===p.paint.get("circle-pitch-scale")&&i.push("SCALE_WITH_MAP"),i},Ad=(p,i,u,g)=>{const v=d.EXTENT/u.tileSize;return{u_matrix:p,u_camera_to_center_distance:i.getCameraToCenterDistance(g),u_extrude_scale:[i.pixelsToGLUnits[0]/v,i.pixelsToGLUnits[1]/v]}},Id=(p,i,u=1)=>({u_matrix:p,u_color:i,u_overlay:0,u_overlay_scale:u}),Pd=d.create(),Ig=(p,i,u,g,v,b,T)=>{const D=p.transform,A="globe"===D.projection.name,k=A?d.globePixelsToTileUnits(D.zoom,i.canonical)*D._projectionScaler:$i(u,1,b),L={u_matrix:i.projMatrix,u_extrude_scale:k,u_intensity:T,u_inv_rot_matrix:Pd,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(A){L.u_inv_rot_matrix=g,L.u_merc_center=v,L.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],L.u_zoom_transition=d.globeToMercatorTransition(D.zoom);const B=v[0]*d.EXTENT,j=v[1]*d.EXTENT;L.u_up_dir=D.projection.upVector(new d.CanonicalTileID(0,0,0),B,j)}return L},kd=(p,i,u,g,v,b,T,D)=>{const A=p.transform,k=A.calculatePixelsToTileUnitsMatrix(i),L={u_matrix:mf(p,i,u,v),u_pixels_to_tile_units:k,u_device_pixel_ratio:T,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:b,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0,u_trim_offset:D};if(ph(u)){const B=Kc(i,p.transform);L.u_texsize=i.lineAtlasTexture.size,L.u_scale=[B,g.fromScale,g.toScale],L.u_mix=g.t}return L},Pg=(p,i,u,g,v,b)=>{const T=p.transform,D=Kc(i,T);return{u_matrix:mf(p,i,u,v),u_texsize:i.imageAtlasTexture.size,u_pixels_to_tile_units:T.calculatePixelsToTileUnitsMatrix(i),u_device_pixel_ratio:b,u_image:0,u_scale:[D,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/T.pixelsToGLUnits[0],1/T.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Kc(p,i){return 1/$i(p,1,i.tileZoom)}function mf(p,i,u,g){return p.translatePosMatrix(g||i.tileID.projMatrix,i,u.paint.get("line-translate"),u.paint.get("line-translate-anchor"))}function ph(p){const i=p.paint.get("line-dasharray").value;return i.value||"constant"!==i.kind}const kg=(p,i,u,g,v,b)=>{return{u_matrix:p,u_tl_parent:i,u_scale_parent:u,u_fade_t:g.mix,u_opacity:g.opacity*v.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:v.paint.get("raster-brightness-min"),u_brightness_high:v.paint.get("raster-brightness-max"),u_saturation_factor:(D=v.paint.get("raster-saturation"),D>0?1-1/(1.001-D):-D),u_contrast_factor:(T=v.paint.get("raster-contrast"),T>0?1/(1-T):1+T),u_spin_weights:Rd(v.paint.get("raster-hue-rotate")),u_perspective_transform:b};var T,D};function Rd(p){p*=Math.PI/180;const i=Math.sin(p),u=Math.cos(p);return[(2*u+1)/3,(-Math.sqrt(3)*i-u+1)/3,(Math.sqrt(3)*i-u+1)/3]}const fh=d.create(),ma=(p,i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G)=>{const ne=v.transform,W={u_is_size_zoom_constant:+("constant"===p||"source"===p),u_is_size_feature_constant:+("constant"===p||"camera"===p),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ne.cameraToCenterDistance,u_rotate_symbol:+u,u_aspect_ratio:ne.width/ne.height,u_fade_change:v.options.fadeDuration?v.symbolFadeChange:1,u_matrix:b,u_label_plane_matrix:T,u_coord_matrix:D,u_is_text:+A,u_pitch_with_map:+g,u_texsize:k,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:fh,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:fh,u_up_vector:[0,-1,0]};return"globe"===G.name&&(W.u_tile_id=[L.canonical.x,L.canonical.y,1<<L.canonical.z],W.u_zoom_transition=B,W.u_inv_rot_matrix=H,W.u_merc_center=j,W.u_camera_forward=ne._camera.forward(),W.u_ecef_origin=d.globeECEFOrigin(ne.globeMatrix,L.toUnwrapped()),W.u_tile_matrix=Float32Array.from(ne.globeMatrix),W.u_up_vector=Z),W},gf=(p,i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G,ne)=>d.extend(ma(p,i,u,g,v,b,T,D,A,k,B,j,H,Z,G,ne),{u_gamma_scale:g?v.transform.cameraToCenterDistance*Math.cos(v.terrain?0:v.transform._pitch):1,u_device_pixel_ratio:d.exported.devicePixelRatio,u_is_halo:+L}),_f=(p,i,u,g,v,b,T,D,A,k,L,B,j,H,Z,G)=>d.extend(gf(p,i,u,g,v,b,T,D,!0,A,!0,L,B,j,H,Z,G),{u_texsize_icon:k,u_texture_icon:1}),yf=(p,i,u)=>({u_matrix:p,u_opacity:i,u_color:u}),Xi=(p,i,u,g,v,b)=>d.extend(function(T,D,A,k){const L=A.imageManager.getPattern(T.from.toString()),B=A.imageManager.getPattern(T.to.toString()),{width:j,height:H}=A.imageManager.getPixelSize(),Z=Math.pow(2,k.tileID.overscaledZ),G=k.tileSize*Math.pow(2,A.transform.tileZoom)/Z,ne=G*(k.tileID.canonical.x+k.tileID.wrap*Z),W=G*k.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:L.tl,u_pattern_br_a:L.br,u_pattern_tl_b:B.tl,u_pattern_br_b:B.br,u_texsize:[j,H],u_mix:D.t,u_pattern_size_a:L.displaySize,u_pattern_size_b:B.displaySize,u_scale_a:D.fromScale,u_scale_b:D.toScale,u_tile_units_to_pixels:1/$i(k,1,A.transform.tileZoom),u_pixel_coord_upper:[ne>>16,W>>16],u_pixel_coord_lower:[65535&ne,65535&W]}}(g,b,u,v),{u_matrix:p,u_opacity:i}),vf={fillExtrusion:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_lightpos:new d.Uniform3f(p,i.u_lightpos),u_lightintensity:new d.Uniform1f(p,i.u_lightintensity),u_lightcolor:new d.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new d.Uniform1f(p,i.u_vertical_gradient),u_opacity:new d.Uniform1f(p,i.u_opacity),u_tile_id:new d.Uniform3f(p,i.u_tile_id),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_up_dir:new d.Uniform3f(p,i.u_up_dir),u_height_lift:new d.Uniform1f(p,i.u_height_lift)}),fillExtrusionPattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_lightpos:new d.Uniform3f(p,i.u_lightpos),u_lightintensity:new d.Uniform1f(p,i.u_lightintensity),u_lightcolor:new d.Uniform3f(p,i.u_lightcolor),u_vertical_gradient:new d.Uniform1f(p,i.u_vertical_gradient),u_height_factor:new d.Uniform1f(p,i.u_height_factor),u_tile_id:new d.Uniform3f(p,i.u_tile_id),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_up_dir:new d.Uniform3f(p,i.u_up_dir),u_height_lift:new d.Uniform1f(p,i.u_height_lift),u_image:new d.Uniform1i(p,i.u_image),u_texsize:new d.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,i.u_scale),u_fade:new d.Uniform1f(p,i.u_fade),u_opacity:new d.Uniform1f(p,i.u_opacity)}),fill:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix)}),fillPattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_image:new d.Uniform1i(p,i.u_image),u_texsize:new d.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,i.u_scale),u_fade:new d.Uniform1f(p,i.u_fade)}),fillOutline:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_world:new d.Uniform2f(p,i.u_world)}),fillOutlinePattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_world:new d.Uniform2f(p,i.u_world),u_image:new d.Uniform1i(p,i.u_image),u_texsize:new d.Uniform2f(p,i.u_texsize),u_pixel_coord_upper:new d.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,i.u_pixel_coord_lower),u_scale:new d.Uniform3f(p,i.u_scale),u_fade:new d.Uniform1f(p,i.u_fade)}),circle:(p,i)=>({u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new d.UniformMatrix2f(p,i.u_extrude_scale),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_inv_rot_matrix:new d.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_tile_id:new d.Uniform3f(p,i.u_tile_id),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_up_dir:new d.Uniform3f(p,i.u_up_dir)}),collisionBox:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_extrude_scale:new d.Uniform2f(p,i.u_extrude_scale)}),collisionCircle:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_inv_matrix:new d.UniformMatrix4f(p,i.u_inv_matrix),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_viewport_size:new d.Uniform2f(p,i.u_viewport_size)}),debug:(p,i)=>({u_color:new d.UniformColor(p,i.u_color),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_overlay:new d.Uniform1i(p,i.u_overlay),u_overlay_scale:new d.Uniform1f(p,i.u_overlay_scale)}),clippingMask:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix)}),heatmap:(p,i)=>({u_extrude_scale:new d.Uniform1f(p,i.u_extrude_scale),u_intensity:new d.Uniform1f(p,i.u_intensity),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_inv_rot_matrix:new d.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_tile_id:new d.Uniform3f(p,i.u_tile_id),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_up_dir:new d.Uniform3f(p,i.u_up_dir)}),heatmapTexture:(p,i)=>({u_image:new d.Uniform1i(p,i.u_image),u_color_ramp:new d.Uniform1i(p,i.u_color_ramp),u_opacity:new d.Uniform1f(p,i.u_opacity)}),hillshade:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_image:new d.Uniform1i(p,i.u_image),u_latrange:new d.Uniform2f(p,i.u_latrange),u_light:new d.Uniform2f(p,i.u_light),u_shadow:new d.UniformColor(p,i.u_shadow),u_highlight:new d.UniformColor(p,i.u_highlight),u_accent:new d.UniformColor(p,i.u_accent)}),hillshadePrepare:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_image:new d.Uniform1i(p,i.u_image),u_dimension:new d.Uniform2f(p,i.u_dimension),u_zoom:new d.Uniform1f(p,i.u_zoom),u_unpack:new d.Uniform4f(p,i.u_unpack)}),line:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_pixels_to_tile_units:new d.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_units_to_pixels:new d.Uniform2f(p,i.u_units_to_pixels),u_dash_image:new d.Uniform1i(p,i.u_dash_image),u_gradient_image:new d.Uniform1i(p,i.u_gradient_image),u_image_height:new d.Uniform1f(p,i.u_image_height),u_texsize:new d.Uniform2f(p,i.u_texsize),u_scale:new d.Uniform3f(p,i.u_scale),u_mix:new d.Uniform1f(p,i.u_mix),u_alpha_discard_threshold:new d.Uniform1f(p,i.u_alpha_discard_threshold),u_trim_offset:new d.Uniform2f(p,i.u_trim_offset)}),linePattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_texsize:new d.Uniform2f(p,i.u_texsize),u_pixels_to_tile_units:new d.UniformMatrix2f(p,i.u_pixels_to_tile_units),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_image:new d.Uniform1i(p,i.u_image),u_units_to_pixels:new d.Uniform2f(p,i.u_units_to_pixels),u_scale:new d.Uniform3f(p,i.u_scale),u_fade:new d.Uniform1f(p,i.u_fade),u_alpha_discard_threshold:new d.Uniform1f(p,i.u_alpha_discard_threshold)}),raster:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_tl_parent:new d.Uniform2f(p,i.u_tl_parent),u_scale_parent:new d.Uniform1f(p,i.u_scale_parent),u_fade_t:new d.Uniform1f(p,i.u_fade_t),u_opacity:new d.Uniform1f(p,i.u_opacity),u_image0:new d.Uniform1i(p,i.u_image0),u_image1:new d.Uniform1i(p,i.u_image1),u_brightness_low:new d.Uniform1f(p,i.u_brightness_low),u_brightness_high:new d.Uniform1f(p,i.u_brightness_high),u_saturation_factor:new d.Uniform1f(p,i.u_saturation_factor),u_contrast_factor:new d.Uniform1f(p,i.u_contrast_factor),u_spin_weights:new d.Uniform3f(p,i.u_spin_weights),u_perspective_transform:new d.Uniform2f(p,i.u_perspective_transform)}),symbolIcon:(p,i)=>({u_is_size_zoom_constant:new d.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,i.u_size_t),u_size:new d.Uniform1f(p,i.u_size),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new d.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,i.u_fade_change),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new d.Uniform1i(p,i.u_is_text),u_pitch_with_map:new d.Uniform1i(p,i.u_pitch_with_map),u_texsize:new d.Uniform2f(p,i.u_texsize),u_tile_id:new d.Uniform3f(p,i.u_tile_id),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_camera_forward:new d.Uniform3f(p,i.u_camera_forward),u_tile_matrix:new d.UniformMatrix4f(p,i.u_tile_matrix),u_up_vector:new d.Uniform3f(p,i.u_up_vector),u_ecef_origin:new d.Uniform3f(p,i.u_ecef_origin),u_texture:new d.Uniform1i(p,i.u_texture)}),symbolSDF:(p,i)=>({u_is_size_zoom_constant:new d.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,i.u_size_t),u_size:new d.Uniform1f(p,i.u_size),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new d.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,i.u_fade_change),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new d.Uniform1i(p,i.u_is_text),u_pitch_with_map:new d.Uniform1i(p,i.u_pitch_with_map),u_texsize:new d.Uniform2f(p,i.u_texsize),u_texture:new d.Uniform1i(p,i.u_texture),u_gamma_scale:new d.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_tile_id:new d.Uniform3f(p,i.u_tile_id),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_inv_rot_matrix:new d.UniformMatrix4f(p,i.u_inv_rot_matrix),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_camera_forward:new d.Uniform3f(p,i.u_camera_forward),u_tile_matrix:new d.UniformMatrix4f(p,i.u_tile_matrix),u_up_vector:new d.Uniform3f(p,i.u_up_vector),u_ecef_origin:new d.Uniform3f(p,i.u_ecef_origin),u_is_halo:new d.Uniform1i(p,i.u_is_halo)}),symbolTextAndIcon:(p,i)=>({u_is_size_zoom_constant:new d.Uniform1i(p,i.u_is_size_zoom_constant),u_is_size_feature_constant:new d.Uniform1i(p,i.u_is_size_feature_constant),u_size_t:new d.Uniform1f(p,i.u_size_t),u_size:new d.Uniform1f(p,i.u_size),u_camera_to_center_distance:new d.Uniform1f(p,i.u_camera_to_center_distance),u_rotate_symbol:new d.Uniform1i(p,i.u_rotate_symbol),u_aspect_ratio:new d.Uniform1f(p,i.u_aspect_ratio),u_fade_change:new d.Uniform1f(p,i.u_fade_change),u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_label_plane_matrix:new d.UniformMatrix4f(p,i.u_label_plane_matrix),u_coord_matrix:new d.UniformMatrix4f(p,i.u_coord_matrix),u_is_text:new d.Uniform1i(p,i.u_is_text),u_pitch_with_map:new d.Uniform1i(p,i.u_pitch_with_map),u_texsize:new d.Uniform2f(p,i.u_texsize),u_texsize_icon:new d.Uniform2f(p,i.u_texsize_icon),u_texture:new d.Uniform1i(p,i.u_texture),u_texture_icon:new d.Uniform1i(p,i.u_texture_icon),u_gamma_scale:new d.Uniform1f(p,i.u_gamma_scale),u_device_pixel_ratio:new d.Uniform1f(p,i.u_device_pixel_ratio),u_is_halo:new d.Uniform1i(p,i.u_is_halo)}),background:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_opacity:new d.Uniform1f(p,i.u_opacity),u_color:new d.UniformColor(p,i.u_color)}),backgroundPattern:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_opacity:new d.Uniform1f(p,i.u_opacity),u_image:new d.Uniform1i(p,i.u_image),u_pattern_tl_a:new d.Uniform2f(p,i.u_pattern_tl_a),u_pattern_br_a:new d.Uniform2f(p,i.u_pattern_br_a),u_pattern_tl_b:new d.Uniform2f(p,i.u_pattern_tl_b),u_pattern_br_b:new d.Uniform2f(p,i.u_pattern_br_b),u_texsize:new d.Uniform2f(p,i.u_texsize),u_mix:new d.Uniform1f(p,i.u_mix),u_pattern_size_a:new d.Uniform2f(p,i.u_pattern_size_a),u_pattern_size_b:new d.Uniform2f(p,i.u_pattern_size_b),u_scale_a:new d.Uniform1f(p,i.u_scale_a),u_scale_b:new d.Uniform1f(p,i.u_scale_b),u_pixel_coord_upper:new d.Uniform2f(p,i.u_pixel_coord_upper),u_pixel_coord_lower:new d.Uniform2f(p,i.u_pixel_coord_lower),u_tile_units_to_pixels:new d.Uniform1f(p,i.u_tile_units_to_pixels)}),terrainRaster:ls,terrainDepth:ls,skybox:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_sun_direction:new d.Uniform3f(p,i.u_sun_direction),u_cubemap:new d.Uniform1i(p,i.u_cubemap),u_opacity:new d.Uniform1f(p,i.u_opacity),u_temporal_offset:new d.Uniform1f(p,i.u_temporal_offset)}),skyboxGradient:(p,i)=>({u_matrix:new d.UniformMatrix4f(p,i.u_matrix),u_color_ramp:new d.Uniform1i(p,i.u_color_ramp),u_center_direction:new d.Uniform3f(p,i.u_center_direction),u_radius:new d.Uniform1f(p,i.u_radius),u_opacity:new d.Uniform1f(p,i.u_opacity),u_temporal_offset:new d.Uniform1f(p,i.u_temporal_offset)}),skyboxCapture:(p,i)=>({u_matrix_3f:new d.UniformMatrix3f(p,i.u_matrix_3f),u_sun_direction:new d.Uniform3f(p,i.u_sun_direction),u_sun_intensity:new d.Uniform1f(p,i.u_sun_intensity),u_color_tint_r:new d.Uniform4f(p,i.u_color_tint_r),u_color_tint_m:new d.Uniform4f(p,i.u_color_tint_m),u_luminance:new d.Uniform1f(p,i.u_luminance)}),globeRaster:(p,i)=>({u_proj_matrix:new d.UniformMatrix4f(p,i.u_proj_matrix),u_globe_matrix:new d.UniformMatrix4f(p,i.u_globe_matrix),u_normalize_matrix:new d.UniformMatrix4f(p,i.u_normalize_matrix),u_merc_matrix:new d.UniformMatrix4f(p,i.u_merc_matrix),u_zoom_transition:new d.Uniform1f(p,i.u_zoom_transition),u_merc_center:new d.Uniform2f(p,i.u_merc_center),u_image0:new d.Uniform1i(p,i.u_image0),u_grid_matrix:new d.UniformMatrix3f(p,i.u_grid_matrix),u_frustum_tl:new d.Uniform3f(p,i.u_frustum_tl),u_frustum_tr:new d.Uniform3f(p,i.u_frustum_tr),u_frustum_br:new d.Uniform3f(p,i.u_frustum_br),u_frustum_bl:new d.Uniform3f(p,i.u_frustum_bl),u_globe_pos:new d.Uniform3f(p,i.u_globe_pos),u_globe_radius:new d.Uniform1f(p,i.u_globe_radius),u_viewport:new d.Uniform2f(p,i.u_viewport)}),globeAtmosphere:(p,i)=>({u_frustum_tl:new d.Uniform3f(p,i.u_frustum_tl),u_frustum_tr:new d.Uniform3f(p,i.u_frustum_tr),u_frustum_br:new d.Uniform3f(p,i.u_frustum_br),u_frustum_bl:new d.Uniform3f(p,i.u_frustum_bl),u_horizon:new d.Uniform1f(p,i.u_horizon),u_transition:new d.Uniform1f(p,i.u_transition),u_fadeout_range:new d.Uniform1f(p,i.u_fadeout_range),u_color:new d.Uniform4f(p,i.u_color),u_high_color:new d.Uniform4f(p,i.u_high_color),u_space_color:new d.Uniform4f(p,i.u_space_color),u_star_intensity:new d.Uniform1f(p,i.u_star_intensity),u_star_density:new d.Uniform1f(p,i.u_star_density),u_star_size:new d.Uniform1f(p,i.u_star_size),u_temporal_offset:new d.Uniform1f(p,i.u_temporal_offset),u_horizon_angle:new d.Uniform1f(p,i.u_horizon_angle),u_rotation_matrix:new d.UniformMatrix4f(p,i.u_rotation_matrix)})};let si;function mh(p,i,u,g,v,b,T){const D=p.context,A=D.gl,k=p.transform,L=p.useProgram("collisionBox"),B=[];let j=0,H=0;for(let le=0;le<g.length;le++){const te=g[le],re=i.getTile(te),ue=re.getBucket(u);if(!ue)continue;const Ce=hr(te,ue,k);let Se=Ce;0===v[0]&&0===v[1]||(Se=p.translatePosMatrix(Ce,re,v,b));const be=T?ue.textCollisionBox:ue.iconCollisionBox,Ve=ue.collisionCircleArray;if(Ve.length>0){const ie=d.create(),ve=Se;d.mul(ie,ue.placementInvProjMatrix,k.glCoordMatrix),d.mul(ie,ie,ue.placementViewportMatrix),B.push({circleArray:Ve,circleOffset:H,transform:ve,invTransform:ie,projection:ue.getProjection()}),j+=Ve.length/4,H=j}be&&(p.terrain&&p.terrain.setupElevationDraw(re,L),L.draw(D,A.LINES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,Ad(Se,k,re,ue.getProjection()),u.id,be.layoutVertexBuffer,be.indexBuffer,be.segments,null,k.zoom,null,be.collisionVertexBuffer,be.collisionVertexBufferExt))}if(!T||!B.length)return;const Z=p.useProgram("collisionCircle"),G=new d.StructArrayLayout2f1f2i16;G.resize(4*j),G._trim();let ne=0;for(const le of B)for(let te=0;te<le.circleArray.length/4;te++){const re=4*te,ue=le.circleArray[re+0],Ce=le.circleArray[re+1],Se=le.circleArray[re+2],be=le.circleArray[re+3];G.emplace(ne++,ue,Ce,Se,be,0),G.emplace(ne++,ue,Ce,Se,be,1),G.emplace(ne++,ue,Ce,Se,be,2),G.emplace(ne++,ue,Ce,Se,be,3)}(!si||si.length<2*j)&&(si=function(le){const te=2*le,re=new d.StructArrayLayout3ui6;re.resize(te),re._trim();for(let ue=0;ue<te;ue++){const Ce=6*ue;re.uint16[Ce+0]=4*ue+0,re.uint16[Ce+1]=4*ue+1,re.uint16[Ce+2]=4*ue+2,re.uint16[Ce+3]=4*ue+2,re.uint16[Ce+4]=4*ue+3,re.uint16[Ce+5]=4*ue+0}return re}(j));const W=D.createIndexBuffer(si,!0),Q=D.createVertexBuffer(G,d.collisionCircleLayout.members,!0);for(const le of B){const te={u_matrix:le.transform,u_inv_matrix:le.invTransform,u_camera_to_center_distance:(q=k).getCameraToCenterDistance(le.projection),u_viewport_size:[q.width,q.height]};Z.draw(D,A.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,p.colorModeForRenderPass(),d.CullFaceMode.disabled,te,u.id,Q,W,d.SegmentVector.simpleSegment(0,2*le.circleOffset,le.circleArray.length,le.circleArray.length/2),null,k.zoom)}var q;Q.destroy(),W.destroy()}const Fd=d.create();function xf(p,i,u,g,v,b){const{horizontalAlign:T,verticalAlign:D}=d.getAnchorAlignment(p),A=-(T-.5)*i,k=-(D-.5)*u,L=d.evaluateVariableOffset(p,g);return new d.pointGeometry((A/v+L[0])*b,(k/v+L[1])*b)}function Ld(p,i,u,g,v,b,T,D,A,k,L){const B=p.text.placedSymbolArray,j=p.text.dynamicLayoutVertexArray,H=p.icon.dynamicLayoutVertexArray,Z={},G=Hc(D,p.getProjection(),b),ne=b.elevation,W=p.getProjection().upVectorScale(D.canonical,b.center.lat,b.worldSize);j.clear();for(let Q=0;Q<B.length;Q++){const q=B.get(Q),le=p.allowVerticalPlacement&&!q.placedOrientation,te=q.hidden||!q.crossTileID||le?null:g[q.crossTileID];if(te){const re=new d.pointGeometry(q.tileAnchorX,q.tileAnchorY),ue=p.getProjection().upVector(D.canonical,re.x,re.y),Ce=ne?ne.getAtTileOffset(D,re.x,re.y):0,Se=rs([q.projectedAnchorX+Ce*ue[0]*W.metersToTile,q.projectedAnchorY+Ce*ue[1]*W.metersToTile,q.projectedAnchorZ+Ce*ue[2]*W.metersToTile],u?G:T),be=pa(b.getCameraToCenterDistance(p.getProjection()),Se.signedDistanceFromCamera);let Ve=v.evaluateSizeForFeature(p.textSizeData,k,q)*be/d.ONE_EM;u&&(Ve*=p.tilePixelRatio/A);const{width:ie,height:ve,anchor:Ie,textOffset:Ze,textScale:Me}=te,it=xf(Ie,ie,ve,Ze,Me,Ve);let He;if(u){const We=re.add(it),{x:Xe,y:st,z:qe}=p.getProjection().projectTilePoint(We.x,We.y,D.canonical);He=rs([Xe+Ce*ue[0]*W.metersToTile,st+Ce*ue[1]*W.metersToTile,qe+Ce*ue[2]*W.metersToTile],T).point}else{const We=i?it.rotate(-b.angle):it;He=[Se.point[0]+We.x,Se.point[1]+We.y,0]}const Ke=p.allowVerticalPlacement&&q.placedOrientation===d.WritingMode.vertical?Math.PI/2:0;for(let We=0;We<q.numGlyphs;We++)d.addDynamicAttributes(j,He[0],He[1],He[2],Ke);L&&q.associatedIconIndex>=0&&(Z[q.associatedIconIndex]={shiftedAnchor:He,angle:Ke})}else Er(q.numGlyphs,j)}if(L){H.clear();const Q=p.icon.placedSymbolArray;for(let q=0;q<Q.length;q++){const le=Q.get(q);if(le.hidden)Er(le.numGlyphs,H);else{const te=Z[q];if(te)for(let re=0;re<le.numGlyphs;re++)d.addDynamicAttributes(H,te.shiftedAnchor[0],te.shiftedAnchor[1],te.shiftedAnchor[2],te.angle);else Er(le.numGlyphs,H)}}p.icon.dynamicLayoutVertexBuffer.updateData(H)}p.text.dynamicLayoutVertexBuffer.updateData(j)}function Jc(p,i,u){return u.iconsInText&&i?"symbolTextAndIcon":p?"symbolSDF":"symbolIcon"}function Qc(p,i,u,g,v,b,T,D,A,k,L,B){const j=p.context,H=j.gl,Z=p.transform,G="map"===D,ne="map"===A,W=G&&"point"!==u.layout.get("symbol-placement"),Q=G&&!ne&&!W,q=void 0!==u.layout.get("symbol-sort-key").constantOr(1);let le=!1;const te=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),re=[d.mercatorXfromLng(Z.center.lng),d.mercatorYfromLat(Z.center.lat)],ue=u.layout.get("text-variable-anchor"),Ce="globe"===Z.projection.name,Se=[],be=[0,-1,0];let Ve=be;!Ce&&!Z.mercatorFromTransition||G||(Ve=function(ie){const ve=ie._camera.getWorldToCamera(ie.worldSize,1),Ie=d.multiply([],ve,ie.globeMatrix);d.invert(Ie,Ie);const Ze=[0,0,0],Me=[0,1,0,0];return d.transformMat4$1(Me,Me,Ie),Ze[0]=Me[0],Ze[1]=Me[1],Ze[2]=Me[2],d.normalize(Ze,Ze),Ze}(Z));for(const ie of g){const ve=i.getTile(ie),Ie=ve.getBucket(u);if(!Ie||"mercator"===Ie.projection.name&&Ce)continue;const Ze=v?Ie.text:Ie.icon;if(!Ze||Ie.fullyClipped||!Ze.segments.get().length)continue;const Me=Ze.programConfigurations.get(u.id),it=v||Ie.sdfIcons,He=v?Ie.textSizeData:Ie.iconSizeData,Ke=ne||0!==Z.pitch,We=d.evaluateSizeForZoom(He,Z.zoom);let Xe,st,qe,Dt,ht=[0,0],Ct=null;if(v){if(st=ve.glyphAtlasTexture,qe=H.LINEAR,Xe=ve.glyphAtlasTexture.size,Ie.iconsInText){ht=ve.imageAtlasTexture.size,Ct=ve.imageAtlasTexture;const li="composite"===He.kind||"camera"===He.kind;Dt=Ke||p.options.rotating||p.options.zooming||li?H.LINEAR:H.NEAREST}}else{const li=1!==u.layout.get("icon-size").constantOr(0)||Ie.iconsNeedLinear;st=ve.imageAtlasTexture,qe=it||p.options.rotating||p.options.zooming||li||Ke?H.LINEAR:H.NEAREST,Xe=ve.imageAtlasTexture.size}const _n="globe"===Ie.projection.name,Rn=_n?Ve:be,Xn=_n?d.globeToMercatorTransition(Z.zoom):0,Sn=Hc(ie,Ie.getProjection(),Z),Ir=Z.calculatePixelsToTileUnitsMatrix(ve),ds=wt(Sn,ve.tileID.canonical,ne,G,Z,Ie.getProjection(),Ir),Vn=p.terrain&&ne&&W?d.invert(d.create(),ds):Fd,Mn=Is(Sn,ve.tileID.canonical,ne,G,Z,Ie.getProjection(),Ir),An=ue&&Ie.hasTextData(),ln="none"!==u.layout.get("icon-text-fit")&&An&&Ie.hasIconData();if(W){const li=Z.elevation,to=li?li.getAtTileOffsetFunc(ie,Z.center.lat,Z.worldSize,Ie.getProjection()):Dr=>[0,0,0],yo=Mi(Sn,ve.tileID.canonical,ne,G,Z,Ie.getProjection(),Ir);mi(Ie,Sn,p,v,yo,Mn,ne,k,to,ie)}const pr=W||v&&ue||ln,Un=p.translatePosMatrix(Sn,ve,b,T),Qt=pr?Fd:ds,Yn=p.translatePosMatrix(Mn,ve,b,T,!0),Vo=Ie.getProjection().createInversionMatrix(Z,ie.canonical),xi=[];p.terrain&&ne&&xi.push("PITCH_WITH_MAP_TERRAIN"),_n&&xi.push("PROJECTION_GLOBE_VIEW"),pr&&xi.push("PROJECTED_POS_ON_VIEWPORT");const Ma=it&&0!==u.paint.get(v?"text-halo-width":"icon-halo-width").constantOr(1);let Aa;Aa=it?Ie.iconsInText?_f(He.kind,We,Q,ne,p,Un,Qt,Yn,Xe,ht,ie,Xn,re,Vo,Rn,Ie.getProjection()):gf(He.kind,We,Q,ne,p,Un,Qt,Yn,v,Xe,!0,ie,Xn,re,Vo,Rn,Ie.getProjection()):ma(He.kind,We,Q,ne,p,Un,Qt,Yn,v,Xe,ie,Xn,re,Vo,Rn,Ie.getProjection());const Us={program:p.useProgram(Jc(it,v,Ie),Me,xi),buffers:Ze,uniformValues:Aa,atlasTexture:st,atlasTextureIcon:Ct,atlasInterpolation:qe,atlasInterpolationIcon:Dt,isSDF:it,hasHalo:Ma,tile:ve,labelPlaneMatrixInv:Vn};if(q&&Ie.canOverlap){le=!0;const li=Ze.segments.get();for(const to of li)Se.push({segments:new d.SegmentVector([to]),sortKey:to.sortKey,state:Us})}else Se.push({segments:Ze.segments,sortKey:0,state:Us})}le&&Se.sort((ie,ve)=>ie.sortKey-ve.sortKey);for(const ie of Se){const ve=ie.state;if(p.terrain&&p.terrain.setupElevationDraw(ve.tile,ve.program,{useDepthForOcclusion:!Ce,labelPlaneMatrixInv:ve.labelPlaneMatrixInv}),j.activeTexture.set(H.TEXTURE0),ve.atlasTexture.bind(ve.atlasInterpolation,H.CLAMP_TO_EDGE),ve.atlasTextureIcon&&(j.activeTexture.set(H.TEXTURE1),ve.atlasTextureIcon&&ve.atlasTextureIcon.bind(ve.atlasInterpolationIcon,H.CLAMP_TO_EDGE)),ve.isSDF){const Ie=ve.uniformValues;ve.hasHalo&&(Ie.u_is_halo=1,Wl(ve.buffers,ie.segments,u,p,ve.program,te,L,B,Ie)),Ie.u_is_halo=0}Wl(ve.buffers,ie.segments,u,p,ve.program,te,L,B,ve.uniformValues)}}function Wl(p,i,u,g,v,b,T,D,A){const k=g.context;v.draw(k,k.gl.TRIANGLES,b,T,D,d.CullFaceMode.disabled,A,u.id,p.layoutVertexBuffer,p.indexBuffer,i,u.paint,g.transform.zoom,p.programConfigurations.get(u.id),p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.globeExtVertexBuffer)}function gh(p,i,u,g,v,b,T){const D=p.context.gl,A=u.paint.get("fill-pattern"),k=A&&A.constantOr(1),L=u.getCrossfadeParameters();let B,j,H,Z,G;T?(j=k&&!u.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",B=D.LINES):(j=k?"fillPattern":"fill",B=D.TRIANGLES);for(const ne of g){const W=i.getTile(ne);if(k&&!W.patternsLoaded())continue;const Q=W.getBucket(u);if(!Q)continue;p.prepareDrawTile();const q=Q.programConfigurations.get(u.id),le=p.useProgram(j,q);k&&(p.context.activeTexture.set(D.TEXTURE0),W.imageAtlasTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),q.updatePaintBuffers(L));const te=A.constantOr(null);if(te&&W.imageAtlas){const ue=W.imageAtlas,Ce=ue.patternPositions[te.to.toString()],Se=ue.patternPositions[te.from.toString()];Ce&&Se&&q.setConstantPatternPositions(Ce,Se)}const re=p.translatePosMatrix(ne.projMatrix,W,u.paint.get("fill-translate"),u.paint.get("fill-translate-anchor"));if(T){Z=Q.indexBuffer2,G=Q.segments2;const ue=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[D.drawingBufferWidth,D.drawingBufferHeight];H="fillOutlinePattern"===j&&k?dh(re,p,L,W,ue):Yc(re,ue)}else Z=Q.indexBuffer,G=Q.segments,H=k?Sd(re,p,L,W):sl(re);p.prepareDrawProgram(p.context,le,ne.toUnwrapped()),le.draw(p.context,B,v,p.stencilModeForClipping(ne),b,d.CullFaceMode.disabled,H,u.id,Q.layoutVertexBuffer,Z,G,u.paint,p.transform.zoom,q)}}function ai(p,i,u,g,v,b,T){const D=p.context,A=D.gl,k=p.transform,L=u.paint.get("fill-extrusion-pattern"),B=L.constantOr(1),j=u.getCrossfadeParameters(),H=u.paint.get("fill-extrusion-opacity"),Z="globe"===k.projection.name?d.fillExtrusionHeightLift():0,G="globe"===k.projection.name,ne=G?d.globeToMercatorTransition(k.zoom):0,W=[d.mercatorXfromLng(k.center.lng),d.mercatorYfromLat(k.center.lat)],Q=[];G&&Q.push("PROJECTION_GLOBE_VIEW");for(const q of g){const le=i.getTile(q),te=le.getBucket(u);if(!te||te.projection.name!==k.projection.name)continue;const re=te.programConfigurations.get(u.id),ue=p.useProgram(B?"fillExtrusionPattern":"fillExtrusion",re,Q);if(p.terrain){const ve=p.terrain;if(p.style.terrainSetForDrapingOnly())ve.setupElevationDraw(le,ue,{useMeterToDem:!0});else{if(!te.enableTerrain)continue;if(ve.setupElevationDraw(le,ue,{useMeterToDem:!0}),Xl(D,i,q,te,u,ve),!te.centroidVertexBuffer){const Ie=ue.attributes.a_centroid_pos;void 0!==Ie&&A.vertexAttrib2f(Ie,0,0)}}}B&&(p.context.activeTexture.set(A.TEXTURE0),le.imageAtlasTexture.bind(A.LINEAR,A.CLAMP_TO_EDGE),re.updatePaintBuffers(j));const Ce=L.constantOr(null);if(Ce&&le.imageAtlas){const ve=le.imageAtlas,Ie=ve.patternPositions[Ce.to.toString()],Ze=ve.patternPositions[Ce.from.toString()];Ie&&Ze&&re.setConstantPatternPositions(Ie,Ze)}const Se=p.translatePosMatrix(q.projMatrix,le,u.paint.get("fill-extrusion-translate"),u.paint.get("fill-extrusion-translate-anchor")),be=k.projection.createInversionMatrix(k,q.canonical),Ve=u.paint.get("fill-extrusion-vertical-gradient"),ie=B?oi(Se,p,Ve,H,q,j,le,Z,ne,W,be):Zl(Se,p,Ve,H,q,Z,ne,W,be);p.prepareDrawProgram(D,ue,q.toUnwrapped()),ue.draw(D,D.gl.TRIANGLES,v,b,T,d.CullFaceMode.backCCW,ie,u.id,te.layoutVertexBuffer,te.indexBuffer,te.segments,u.paint,p.transform.zoom,re,p.terrain?te.centroidVertexBuffer:null,G?te.layoutVertexExtBuffer:null)}}function Xl(p,i,u,g,v,b){const T=[W=>{let Q=W.canonical.x-1,q=W.wrap;return Q<0&&(Q=(1<<W.canonical.z)-1,q--),new d.OverscaledTileID(W.overscaledZ,q,W.canonical.z,Q,W.canonical.y)},W=>{let Q=W.canonical.x+1,q=W.wrap;return Q===1<<W.canonical.z&&(Q=0,q++),new d.OverscaledTileID(W.overscaledZ,q,W.canonical.z,Q,W.canonical.y)},W=>new d.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,(0===W.canonical.y?1<<W.canonical.z:W.canonical.y)-1),W=>new d.OverscaledTileID(W.overscaledZ,W.wrap,W.canonical.z,W.canonical.x,W.canonical.y===(1<<W.canonical.z)-1?0:W.canonical.y+1)],D=W=>{const Q=i.getSource().minzoom,q=te=>{const re=i.getTileByID(te);if(re&&re.hasData())return re.getBucket(v)},le=[0,-1,1];for(const te of le){if(W.overscaledZ+te<Q)continue;const re=q(W.calculateScaledKey(W.overscaledZ+te));if(re)return re}},A=[0,0,0],k=(W,Q)=>(A[0]=Math.min(W.min.y,Q.min.y),A[1]=Math.max(W.max.y,Q.max.y),A[2]=d.EXTENT-Q.min.x>W.max.x?Q.min.x-d.EXTENT:W.max.x,A),L=(W,Q)=>(A[0]=Math.min(W.min.x,Q.min.x),A[1]=Math.max(W.max.x,Q.max.x),A[2]=d.EXTENT-Q.min.y>W.max.y?Q.min.y-d.EXTENT:W.max.y,A),B=[(W,Q)=>k(W,Q),(W,Q)=>k(Q,W),(W,Q)=>L(W,Q),(W,Q)=>L(Q,W)],j=new d.pointGeometry(0,0);let H,Z,G;const ne=(W,Q,q,le,te)=>{const re=[[le?q:W,le?W:q,0],[le?q:Q,le?Q:q,0]],ue=te<0?d.EXTENT+te:te,Ce=[le?ue:(W+Q)/2,le?(W+Q)/2:ue,0];return 0===q&&te<0||0!==q&&te>0?b.getForTilePoints(G,[Ce],!0,Z):re.push(Ce),b.getForTilePoints(u,re,!0,H),Math.max(re[0][2],re[1][2],Ce[2])/b.exaggeration()};for(let W=0;W<4;W++){const Q=(W<2?1:5)-W,q=g.borders[W];if(0===q.length)continue;const le=G=T[W](u),te=D(le);if(!(te&&te instanceof d.FillExtrusionBucket&&te.enableTerrain)||g.borderDoneWithNeighborZ[W]===te.canonical.z&&te.borderDoneWithNeighborZ[Q]===g.canonical.z||(Z=b.findDEMTileFor(le),!Z||!Z.dem))continue;if(!H){const Se=b.findDEMTileFor(u);if(!Se||!Se.dem)return;H=Se}const re=te.borders[Q];let ue=0;const Ce=te.borderDoneWithNeighborZ[Q]!==g.canonical.z;if(g.canonical.z===te.canonical.z){for(let Se=0;Se<q.length;Se++){const be=g.featuresOnBorder[q[Se]],Ve=be.borders[W];let ie;for(;ue<re.length&&(ie=te.featuresOnBorder[re[ue]],!(ie.borders[Q][1]>Ve[0]+3));)Ce&&te.encodeCentroid(void 0,ie,!1),ue++;if(ie&&ue<re.length){const ve=ue;let Ie=0;for(;!(ie.borders[Q][0]>Ve[1]-3)&&(Ie++,++ue!==re.length);)ie=te.featuresOnBorder[re[ue]];if(ie=te.featuresOnBorder[re[ve]],be.intersectsCount()>1||ie.intersectsCount()>1||1!==Ie){1!==Ie&&(ue=ve),g.encodeCentroid(void 0,be,!1),Ce&&te.encodeCentroid(void 0,ie,!1);continue}const Ze=B[W](be,ie),Me=W%2?d.EXTENT-1:0;j.x=ne(Ze[0],Math.min(d.EXTENT-1,Ze[1]),Me,W<2,Ze[2]),j.y=0,g.encodeCentroid(j,be,!1),Ce&&te.encodeCentroid(j,ie,!1)}else g.encodeCentroid(void 0,be,!1)}g.borderDoneWithNeighborZ[W]=te.canonical.z,g.needsCentroidUpdate=!0,Ce&&(te.borderDoneWithNeighborZ[Q]=g.canonical.z,te.needsCentroidUpdate=!0)}else{for(const Se of q)g.encodeCentroid(void 0,g.featuresOnBorder[Se],!1);if(Ce){for(const Se of re)te.encodeCentroid(void 0,te.featuresOnBorder[Se],!1);te.borderDoneWithNeighborZ[Q]=g.canonical.z,te.needsCentroidUpdate=!0}g.borderDoneWithNeighborZ[W]=te.canonical.z,g.needsCentroidUpdate=!0}}(g.needsCentroidUpdate||!g.centroidVertexBuffer&&0!==g.centroidVertexArray.length)&&g.uploadCentroid(p)}const ga=new d.Color(1,0,0,1),_a=new d.Color(0,1,0,1),Od=new d.Color(0,0,1,1),al=new d.Color(1,0,1,1),zs=new d.Color(0,1,1,1);function _h(p,i,u,g){on(p,0,i+u/2,p.transform.width,u,g)}function ll(p,i,u,g){on(p,i-u/2,0,u,p.transform.height,g)}function on(p,i,u,g,v,b){const T=p.context,D=T.gl;D.enable(D.SCISSOR_TEST),D.scissor(i*d.exported.devicePixelRatio,u*d.exported.devicePixelRatio,g*d.exported.devicePixelRatio,v*d.exported.devicePixelRatio),T.clear({color:b}),D.disable(D.SCISSOR_TEST)}function Wn(p,i,u){const g=p.context,v=g.gl,b="globe"===p.transform.projection.name,T=u.projMatrix,D=p.useProgram("debug",null,b?["PROJECTION_GLOBE_VIEW"]:null),A=i.getTileByID(u.key);p.terrain&&p.terrain.setupElevationDraw(A,D);const k=d.DepthMode.disabled,L=d.StencilMode.disabled,B=p.colorModeForRenderPass(),j="$debug";g.activeTexture.set(v.TEXTURE0),p.emptyTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),b?A._makeGlobeTileDebugBuffers(p.context,p.transform.projection):A._makeDebugTileBoundsBuffers(p.context,p.transform.projection);const H=A._tileDebugBuffer||p.debugBuffer,Z=A._tileDebugIndexBuffer||p.debugIndexBuffer,G=A._tileDebugSegments||p.debugSegments;D.draw(g,v.LINE_STRIP,k,L,B,d.CullFaceMode.disabled,Id(T,d.Color.red),j,H,Z,G,null,null,null,A._globeTileDebugBorderBuffer);const ne=A.latestRawTileData,W=Math.floor((ne&&ne.byteLength||0)/1024),Q=i.getTile(u).tileSize,q=512/Math.min(Q,512)*(u.overscaledZ/p.transform.zoom)*.5;let le=u.canonical.toString();u.overscaledZ!==u.canonical.z&&(le+=` => ${u.overscaledZ}`),function(Ce,Se){Ce.initDebugOverlayCanvas();const be=Ce.debugOverlayCanvas,Ve=Ce.context.gl,ie=Ce.debugOverlayCanvas.getContext("2d");ie.clearRect(0,0,be.width,be.height),ie.shadowColor="white",ie.shadowBlur=2,ie.lineWidth=1.5,ie.strokeStyle="white",ie.textBaseline="top",ie.font="bold 36px Open Sans, sans-serif",ie.fillText(Se,5,5),ie.strokeText(Se,5,5),Ce.debugOverlayTexture.update(be),Ce.debugOverlayTexture.bind(Ve.LINEAR,Ve.CLAMP_TO_EDGE)}(p,`${le} ${W}kb`);const te=A._tileDebugTextBuffer||p.debugBuffer,re=A._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,ue=A._tileDebugTextSegments||p.debugSegments;D.draw(g,v.TRIANGLES,k,L,d.ColorMode.alphaBlended,d.CullFaceMode.disabled,Id(T,d.Color.transparent,q),j,te,re,ue,null,null,null,A._globeTileDebugTextBuffer)}const zd=d.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Bd}=zd;function wn(p,i,u,g){p.emplaceBack(i,u,g)}class Nd{constructor(i){this.vertexArray=new d.StructArrayLayout3f12,this.indices=new d.StructArrayLayout3ui6,wn(this.vertexArray,-1,-1,1),wn(this.vertexArray,1,-1,1),wn(this.vertexArray,-1,1,1),wn(this.vertexArray,1,1,1),wn(this.vertexArray,-1,-1,-1),wn(this.vertexArray,1,-1,-1),wn(this.vertexArray,-1,1,-1),wn(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Bd),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=d.SegmentVector.simpleSegment(0,0,36,12)}}function Yl(p,i,u,g,v,b){const T=p.gl,D=i.paint.get("sky-atmosphere-color"),A=i.paint.get("sky-atmosphere-halo-color"),k=i.paint.get("sky-atmosphere-sun-intensity"),L={u_matrix_3f:d.fromMat4(d.create$1(),g),u_sun_direction:v,u_sun_intensity:k,u_color_tint_r:[(Z=D).r,Z.g,Z.b,Z.a],u_color_tint_m:[(G=A).r,G.g,G.b,G.a],u_luminance:5e-5};var Z,G;T.framebufferTexture2D(T.FRAMEBUFFER,T.COLOR_ATTACHMENT0,T.TEXTURE_CUBE_MAP_POSITIVE_X+b,i.skyboxTexture,0),u.draw(p,T.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,d.ColorMode.unblended,d.CullFaceMode.frontCW,L,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Kl=d.createLayout([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Yi{constructor(i){const u=new d.StructArrayLayout5f20;u.emplaceBack(-1,1,1,0,0),u.emplaceBack(1,1,1,1,0),u.emplaceBack(1,-1,1,1,1),u.emplaceBack(-1,-1,1,0,1);const g=new d.StructArrayLayout3ui6;g.emplaceBack(0,1,2),g.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(u,Kl.members),this.indexBuffer=i.createIndexBuffer(g),this.segments=d.SegmentVector.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const eu={symbol:function(p,i,u,g,v){if("translucent"!==p.renderPass)return;const b=d.StencilMode.disabled,T=p.colorModeForRenderPass();u.layout.get("text-variable-anchor")&&function(D,A,k,L,B,j,H){const Z=A.transform,G="map"===B,ne="map"===j;for(const W of D){const Q=L.getTile(W),q=Q.getBucket(k);if(!q||!q.text||!q.text.segments.get().length)continue;const le=d.evaluateSizeForZoom(q.textSizeData,Z.zoom),te=Hc(W,q.getProjection(),Z),re=Z.calculatePixelsToTileUnitsMatrix(Q),ue=wt(te,Q.tileID.canonical,ne,G,Z,q.getProjection(),re),Ce="none"!==k.layout.get("icon-text-fit")&&q.hasIconData();if(le){const Se=Math.pow(2,Z.zoom-Q.tileID.overscaledZ);Ld(q,G,ne,H,d.symbolSize,Z,ue,W,Se,le,Ce)}}}(g,p,u,i,u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),v),0!==u.paint.get("icon-opacity").constantOr(1)&&Qc(p,i,u,g,!1,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),u.layout.get("icon-rotation-alignment"),u.layout.get("icon-pitch-alignment"),u.layout.get("icon-keep-upright"),b,T),0!==u.paint.get("text-opacity").constantOr(1)&&Qc(p,i,u,g,!0,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),u.layout.get("text-rotation-alignment"),u.layout.get("text-pitch-alignment"),u.layout.get("text-keep-upright"),b,T),i.map.showCollisionBoxes&&(mh(p,i,u,g,u.paint.get("text-translate"),u.paint.get("text-translate-anchor"),!0),mh(p,i,u,g,u.paint.get("icon-translate"),u.paint.get("icon-translate-anchor"),!1))},circle:function(p,i,u,g){if("translucent"!==p.renderPass)return;const v=u.paint.get("circle-opacity"),b=u.paint.get("circle-stroke-width"),T=u.paint.get("circle-stroke-opacity"),D=void 0!==u.layout.get("circle-sort-key").constantOr(1);if(0===v.constantOr(1)&&(0===b.constantOr(1)||0===T.constantOr(1)))return;const A=p.context,k=A.gl,L=p.transform,B=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),j=d.StencilMode.disabled,H=p.colorModeForRenderPass(),Z="globe"===L.projection.name,G=[d.mercatorXfromLng(L.center.lng),d.mercatorYfromLat(L.center.lat)],ne=[];for(let Q=0;Q<g.length;Q++){const q=g[Q],le=i.getTile(q),te=le.getBucket(u);if(!te||te.projection.name!==L.projection.name)continue;const re=te.programConfigurations.get(u.id),ue=ff(u);Z&&ue.push("PROJECTION_GLOBE_VIEW");const Ce=p.useProgram("circle",re,ue),Se=te.layoutVertexBuffer,be=te.globeExtVertexBuffer,Ve=te.indexBuffer,ie=L.projection.createInversionMatrix(L,q.canonical),ve={programConfiguration:re,program:Ce,layoutVertexBuffer:Se,globeExtVertexBuffer:be,indexBuffer:Ve,uniformValues:Md(p,q,le,ie,G,u),tile:le};if(D){const Ie=te.segments.get();for(const Ze of Ie)ne.push({segments:new d.SegmentVector([Ze]),sortKey:Ze.sortKey,state:ve})}else ne.push({segments:te.segments,sortKey:0,state:ve})}D&&ne.sort((Q,q)=>Q.sortKey-q.sortKey);const W={useDepthForOcclusion:!Z};for(const Q of ne){const{programConfiguration:q,program:le,layoutVertexBuffer:te,globeExtVertexBuffer:re,indexBuffer:ue,uniformValues:Ce,tile:Se}=Q.state,be=Q.segments;p.terrain&&p.terrain.setupElevationDraw(Se,le,W),p.prepareDrawProgram(A,le,Se.tileID.toUnwrapped()),le.draw(A,k.TRIANGLES,B,j,H,d.CullFaceMode.disabled,Ce,u.id,te,ue,be,u.paint,L.zoom,q,Z?re:null)}},heatmap:function(p,i,u,g){if(0!==u.paint.get("heatmap-opacity"))if("offscreen"===p.renderPass){const v=p.context,b=v.gl,T=d.StencilMode.disabled,D=new d.ColorMode([b.ONE,b.ONE],d.Color.transparent,[!0,!0,!0,!0]);(function(H,Z,G,ne){const W=H.gl,Q=Z.width*ne,q=Z.height*ne;H.activeTexture.set(W.TEXTURE1),H.viewport.set([0,0,Q,q]);let le=G.heatmapFbo;if(!le||le&&(le.width!==Q||le.height!==q)){le&&le.destroy();const te=W.createTexture();W.bindTexture(W.TEXTURE_2D,te),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_S,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_WRAP_T,W.CLAMP_TO_EDGE),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MIN_FILTER,W.LINEAR),W.texParameteri(W.TEXTURE_2D,W.TEXTURE_MAG_FILTER,W.LINEAR),le=G.heatmapFbo=H.createFramebuffer(Q,q,!1),function(re,ue,Ce,Se,be,Ve){const ie=re.gl;ie.texImage2D(ie.TEXTURE_2D,0,ie.RGBA,be,Ve,0,ie.RGBA,re.extRenderToTextureHalfFloat?re.extTextureHalfFloat.HALF_FLOAT_OES:ie.UNSIGNED_BYTE,null),Se.colorAttachment.set(Ce)}(H,0,te,le,Q,q)}else W.bindTexture(W.TEXTURE_2D,le.colorAttachment.get()),H.bindFramebuffer.set(le.framebuffer)})(v,p,u,"globe"===p.transform.projection.name?.5:.25),v.clear({color:d.Color.transparent});const A=p.transform,k="globe"===A.projection.name,L=k?["PROJECTION_GLOBE_VIEW"]:null,B=k?d.CullFaceMode.frontCCW:d.CullFaceMode.disabled,j=[d.mercatorXfromLng(A.center.lng),d.mercatorYfromLat(A.center.lat)];for(let H=0;H<g.length;H++){const Z=g[H];if(i.hasRenderableParent(Z))continue;const G=i.getTile(Z),ne=G.getBucket(u);if(!ne||ne.projection.name!==A.projection.name)continue;const W=ne.programConfigurations.get(u.id),Q=p.useProgram("heatmap",W,L),{zoom:q}=p.transform;p.terrain&&p.terrain.setupElevationDraw(G,Q),p.prepareDrawProgram(v,Q,Z.toUnwrapped());const le=A.projection.createInversionMatrix(A,Z.canonical);Q.draw(v,b.TRIANGLES,d.DepthMode.disabled,T,D,B,Ig(p,Z,G,le,j,q,u.paint.get("heatmap-intensity")),u.id,ne.layoutVertexBuffer,ne.indexBuffer,ne.segments,u.paint,p.transform.zoom,W,k?ne.globeExtVertexBuffer:null)}v.viewport.set([0,0,p.width,p.height])}else"translucent"===p.renderPass&&(p.context.setColorMode(p.colorModeForRenderPass()),function(v,b){const T=v.context,D=T.gl,A=b.heatmapFbo;if(!A)return;T.activeTexture.set(D.TEXTURE0),D.bindTexture(D.TEXTURE_2D,A.colorAttachment.get()),T.activeTexture.set(D.TEXTURE1);let k=b.colorRampTexture;k||(k=b.colorRampTexture=new d.Texture(T,b.colorRamp,D.RGBA)),k.bind(D.LINEAR,D.CLAMP_TO_EDGE),v.useProgram("heatmapTexture").draw(T,D.TRIANGLES,d.DepthMode.disabled,d.StencilMode.disabled,v.colorModeForRenderPass(),d.CullFaceMode.disabled,{u_image:0,u_color_ramp:1,u_opacity:b.paint.get("heatmap-opacity")},b.id,v.viewportBuffer,v.quadTriangleIndexBuffer,v.viewportSegments,b.paint,v.transform.zoom)}(p,u))},line:function(p,i,u,g){if("translucent"!==p.renderPass)return;const v=u.paint.get("line-opacity"),b=u.paint.get("line-width");if(0===v.constantOr(1)||0===b.constantOr(1))return;const T=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),D=p.colorModeForRenderPass(),A=p.terrain&&p.terrain.renderingToTexture?1:d.exported.devicePixelRatio,k=u.paint.get("line-dasharray"),L=k.constantOr(1),B=u.layout.get("line-cap"),j=u.paint.get("line-pattern"),H=j.constantOr(1),Z=u.paint.get("line-gradient"),G=u.getCrossfadeParameters(),ne=H?"linePattern":"line",W=p.context,Q=W.gl,q=(te=>{const re=[];ph(te)&&re.push("RENDER_LINE_DASH"),te.paint.get("line-gradient")&&re.push("RENDER_LINE_GRADIENT");const ue=te.paint.get("line-trim-offset");0===ue[0]&&0===ue[1]||re.push("RENDER_LINE_TRIM_OFFSET");const Ce=te.paint.get("line-pattern").constantOr(1),Se=1!==te.paint.get("line-opacity").constantOr(1);return!Ce&&Se&&re.push("RENDER_LINE_ALPHA_DISCARD"),re})(u);let le=q.includes("RENDER_LINE_ALPHA_DISCARD");p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(le=!1);for(const te of g){const re=i.getTile(te);if(H&&!re.patternsLoaded())continue;const ue=re.getBucket(u);if(!ue)continue;p.prepareDrawTile();const Ce=ue.programConfigurations.get(u.id),Se=p.useProgram(ne,Ce,q),be=j.constantOr(null);if(be&&re.imageAtlas){const He=re.imageAtlas,Ke=He.patternPositions[be.to.toString()],We=He.patternPositions[be.from.toString()];Ke&&We&&Ce.setConstantPatternPositions(Ke,We)}const Ve=k.constantOr(null),ie=B.constantOr(null);if(!H&&Ve&&ie&&re.lineAtlas){const He=re.lineAtlas,Ke=He.getDash(Ve.to,ie),We=He.getDash(Ve.from,ie);Ke&&We&&Ce.setConstantPatternPositions(Ke,We)}let[ve,Ie]=u.paint.get("line-trim-offset");("round"===ie||"square"===ie)&&ve!==Ie&&(0===ve&&(ve-=1),1===Ie&&(Ie+=1));const Ze=p.terrain?te.projMatrix:null,Me=H?Pg(p,re,u,G,Ze,A):kd(p,re,u,G,Ze,ue.lineClipsArray.length,A,[ve,Ie]);if(Z){const He=ue.gradients[u.id];let Ke=He.texture;if(u.gradientVersion!==He.version){let We=256;if(u.stepInterpolant){const Xe=i.getSource().maxzoom,st=te.canonical.z===Xe?Math.ceil(1<<p.transform.maxZoom-te.canonical.z):1;We=d.clamp(d.nextPowerOfTwo(ue.maxLineLength/d.EXTENT*1024*st),256,W.maxTextureSize)}He.gradient=d.renderColorRamp({expression:u.gradientExpression(),evaluationKey:"lineProgress",resolution:We,image:He.gradient||void 0,clips:ue.lineClipsArray}),He.texture?He.texture.update(He.gradient):He.texture=new d.Texture(W,He.gradient,Q.RGBA),He.version=u.gradientVersion,Ke=He.texture}W.activeTexture.set(Q.TEXTURE1),Ke.bind(u.stepInterpolant?Q.NEAREST:Q.LINEAR,Q.CLAMP_TO_EDGE)}L&&(W.activeTexture.set(Q.TEXTURE0),re.lineAtlasTexture.bind(Q.LINEAR,Q.REPEAT),Ce.updatePaintBuffers(G)),H&&(W.activeTexture.set(Q.TEXTURE0),re.imageAtlasTexture.bind(Q.LINEAR,Q.CLAMP_TO_EDGE),Ce.updatePaintBuffers(G)),p.prepareDrawProgram(W,Se,te.toUnwrapped());const it=He=>{Se.draw(W,Q.TRIANGLES,T,He,D,d.CullFaceMode.disabled,Me,u.id,ue.layoutVertexBuffer,ue.indexBuffer,ue.segments,u.paint,p.transform.zoom,Ce,ue.layoutVertexBuffer2)};if(le){const He=p.stencilModeForClipping(te).ref;0===He&&p.terrain&&W.clear({stencil:0});const Ke={func:Q.EQUAL,mask:255};Me.u_alpha_discard_threshold=.8,it(new d.StencilMode(Ke,He,255,Q.KEEP,Q.KEEP,Q.INVERT)),Me.u_alpha_discard_threshold=0,it(new d.StencilMode(Ke,He,255,Q.KEEP,Q.KEEP,Q.KEEP))}else it(p.stencilModeForClipping(te))}le&&(p.resetStencilClippingMasks(),p.terrain&&W.clear({stencil:0}))},fill:function(p,i,u,g){const v=u.paint.get("fill-color"),b=u.paint.get("fill-opacity");if(0===b.constantOr(1))return;const T=p.colorModeForRenderPass(),D=u.paint.get("fill-pattern"),A=p.opaquePassEnabledForLayer()&&!D.constantOr(1)&&1===v.constantOr(d.Color.transparent).a&&1===b.constantOr(0)?"opaque":"translucent";if(p.renderPass===A){const k=p.depthModeForSublayer(1,"opaque"===p.renderPass?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly);gh(p,i,u,g,k,T,!1)}if("translucent"===p.renderPass&&u.paint.get("fill-antialias")){const k=p.depthModeForSublayer(u.getPaintProperty("fill-outline-color")?2:0,d.DepthMode.ReadOnly);gh(p,i,u,g,k,T,!0)}},"fill-extrusion":function(p,i,u,g){const v=u.paint.get("fill-extrusion-opacity");if(0!==v&&"translucent"===p.renderPass){const b=new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D);if(1!==v||u.paint.get("fill-extrusion-pattern").constantOr(1))ai(p,i,u,g,b,d.StencilMode.disabled,d.ColorMode.disabled),ai(p,i,u,g,b,p.stencilModeFor3D(),p.colorModeForRenderPass()),p.resetStencilClippingMasks();else{const T=p.colorModeForRenderPass();ai(p,i,u,g,b,d.StencilMode.disabled,T)}}},hillshade:function(p,i,u,g){if("offscreen"!==p.renderPass&&"translucent"!==p.renderPass)return;const v=p.context,b=p.depthModeForSublayer(0,d.DepthMode.ReadOnly),T=p.colorModeForRenderPass(),D=p.terrain&&p.terrain.renderingToTexture,[A,k]="translucent"!==p.renderPass||D?[{},g]:p.stencilConfigForOverlap(g);for(const L of k){const B=i.getTile(L);if(B.needsHillshadePrepare&&"offscreen"===p.renderPass)Ls(p,B,u,b,d.StencilMode.disabled,T);else if("translucent"===p.renderPass){const j=D&&p.terrain?p.terrain.stencilModeForRTTOverlap(L):A[L.overscaledZ];Fs(p,L,B,u,b,j,T)}}v.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,i,u,g,v,b){if("translucent"!==p.renderPass||0===u.paint.get("raster-opacity")||!g.length)return;const T=p.context,D=T.gl,A=i.getSource(),k=p.useProgram("raster"),L=p.colorModeForRenderPass(),B=p.terrain&&p.terrain.renderingToTexture,[j,H]=A instanceof ge||B?[{},g]:p.stencilConfigForOverlap(g),Z=H[H.length-1].overscaledZ,G=!p.options.moving;for(const ne of H){const W=B?d.DepthMode.disabled:p.depthModeForSublayer(ne.overscaledZ-Z,1===u.paint.get("raster-opacity")?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly,D.LESS),Q=ne.toUnwrapped(),q=i.getTile(ne);if(B&&(!q||!q.hasData()))continue;const le=B?ne.projMatrix:p.transform.calculateProjMatrix(Q,G),te=p.terrain&&B?p.terrain.stencilModeForRTTOverlap(ne):j[ne.overscaledZ],re=b?0:u.paint.get("raster-fade-duration");q.registerFadeDuration(re);const ue=i.findLoadedParent(ne,0),Ce=Os(q,ue,i,p.transform,re);let Se,be;p.terrain&&p.terrain.prepareDrawTile();const Ve="nearest"===u.paint.get("raster-resampling")?D.NEAREST:D.LINEAR;T.activeTexture.set(D.TEXTURE0),q.texture.bind(Ve,D.CLAMP_TO_EDGE),T.activeTexture.set(D.TEXTURE1),ue?(ue.texture.bind(Ve,D.CLAMP_TO_EDGE),Se=Math.pow(2,ue.tileID.overscaledZ-q.tileID.overscaledZ),be=[q.tileID.canonical.x*Se%1,q.tileID.canonical.y*Se%1]):q.texture.bind(Ve,D.CLAMP_TO_EDGE);const ie=kg(le,be||[0,0],Se||1,Ce,u,A instanceof ge?A.perspectiveTransform:[0,0]);if(p.prepareDrawProgram(T,k,Q),A instanceof ge)A.boundsBuffer&&A.boundsSegments&&k.draw(T,D.TRIANGLES,W,d.StencilMode.disabled,L,d.CullFaceMode.disabled,ie,u.id,A.boundsBuffer,p.quadTriangleIndexBuffer,A.boundsSegments);else{const{tileBoundsBuffer:ve,tileBoundsIndexBuffer:Ie,tileBoundsSegments:Ze}=p.getTileBoundsBuffers(q);k.draw(T,D.TRIANGLES,W,te,L,d.CullFaceMode.disabled,ie,u.id,ve,Ie,Ze)}}p.resetStencilClippingMasks()},background:function(p,i,u,g){const v=u.paint.get("background-color"),b=u.paint.get("background-opacity");if(0===b)return;const T=p.context,D=T.gl,A=p.transform,k=A.tileSize,L=u.paint.get("background-pattern");if(p.isPatternMissing(L))return;const B=!L&&1===v.a&&1===b&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==B)return;const j=d.StencilMode.disabled,H=p.depthModeForSublayer(0,"opaque"===B?d.DepthMode.ReadWrite:d.DepthMode.ReadOnly),Z=p.colorModeForRenderPass(),G=p.useProgram(L?"backgroundPattern":"background");let ne,W=g;W||(ne=p.getBackgroundTiles(),W=Object.values(ne).map(q=>q.tileID)),L&&(T.activeTexture.set(D.TEXTURE0),p.imageManager.bind(p.context));const Q=u.getCrossfadeParameters();for(const q of W){const le=q.toUnwrapped(),te=g?q.projMatrix:p.transform.calculateProjMatrix(le);p.prepareDrawTile();const re=i?i.getTile(q):ne?ne[q.key]:new d.Tile(q,k,A.zoom,p),ue=L?Xi(te,b,p,L,{tileID:q,tileSize:k},Q):yf(te,b,v);p.prepareDrawProgram(T,G,le);const{tileBoundsBuffer:Ce,tileBoundsIndexBuffer:Se,tileBoundsSegments:be}=p.getTileBoundsBuffers(re);G.draw(T,D.TRIANGLES,H,j,Z,d.CullFaceMode.disabled,ue,u.id,Ce,Se,be)}},sky:function(p,i,u){const g=p.transform,v="mercator"===g.projection.name||"globe"===g.projection.name?1:d.smoothstep(7,8,g.zoom),b=u.paint.get("sky-opacity")*v;if(0===b)return;const T=p.context,D=u.paint.get("sky-type"),A=new d.DepthMode(T.gl.LEQUAL,d.DepthMode.ReadOnly,[0,1]),k=p.frameCounter/1e3%1;"atmosphere"===D?"offscreen"===p.renderPass?u.needsSkyboxCapture(p)&&(function(L,B,j,H){const Z=L.context,G=Z.gl;let ne=B.skyboxFbo;if(!ne){ne=B.skyboxFbo=Z.createFramebuffer(32,32,!1),B.skyboxGeometry=new Nd(Z),B.skyboxTexture=Z.gl.createTexture(),G.bindTexture(G.TEXTURE_CUBE_MAP,B.skyboxTexture),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_S,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_WRAP_T,G.CLAMP_TO_EDGE),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MIN_FILTER,G.LINEAR),G.texParameteri(G.TEXTURE_CUBE_MAP,G.TEXTURE_MAG_FILTER,G.LINEAR);for(let le=0;le<6;++le)G.texImage2D(G.TEXTURE_CUBE_MAP_POSITIVE_X+le,0,G.RGBA,32,32,0,G.RGBA,G.UNSIGNED_BYTE,null)}Z.bindFramebuffer.set(ne.framebuffer),Z.viewport.set([0,0,32,32]);const W=B.getCenter(L,!0),Q=L.useProgram("skyboxCapture"),q=new Float64Array(16);d.identity(q),d.rotateY(q,q,.5*-Math.PI),Yl(Z,B,Q,q,W,0),d.identity(q),d.rotateY(q,q,.5*Math.PI),Yl(Z,B,Q,q,W,1),d.identity(q),d.rotateX(q,q,.5*-Math.PI),Yl(Z,B,Q,q,W,2),d.identity(q),d.rotateX(q,q,.5*Math.PI),Yl(Z,B,Q,q,W,3),d.identity(q),Yl(Z,B,Q,q,W,4),d.identity(q),d.rotateY(q,q,Math.PI),Yl(Z,B,Q,q,W,5),Z.viewport.set([0,0,L.width,L.height])}(p,u),u.markSkyboxValid(p)):"sky"===p.renderPass&&function(L,B,j,H,Z){const G=L.context,ne=G.gl,W=L.transform,Q=L.useProgram("skybox");G.activeTexture.set(ne.TEXTURE0),ne.bindTexture(ne.TEXTURE_CUBE_MAP,B.skyboxTexture);const q={u_matrix:W.skyboxMatrix,u_sun_direction:B.getCenter(L,!1),u_cubemap:0,u_opacity:H,u_temporal_offset:Z};L.prepareDrawProgram(G,Q),Q.draw(G,ne.TRIANGLES,j,d.StencilMode.disabled,L.colorModeForRenderPass(),d.CullFaceMode.backCW,q,"skybox",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(p,u,A,b,k):"gradient"===D&&"sky"===p.renderPass&&function(L,B,j,H,Z){const G=L.context,ne=G.gl,W=L.transform,Q=L.useProgram("skyboxGradient");B.skyboxGeometry||(B.skyboxGeometry=new Nd(G)),G.activeTexture.set(ne.TEXTURE0);let q=B.colorRampTexture;q||(q=B.colorRampTexture=new d.Texture(G,B.colorRamp,ne.RGBA)),q.bind(ne.LINEAR,ne.CLAMP_TO_EDGE);const le=(te=W.skyboxMatrix,re=B.getCenter(L,!1),ue=B.paint.get("sky-gradient-radius"),Ce=H,Se=Z,{u_matrix:te,u_color_ramp:0,u_center_direction:re,u_radius:d.degToRad(ue),u_opacity:Ce,u_temporal_offset:Se});var te,re,ue,Ce,Se;L.prepareDrawProgram(G,Q),Q.draw(G,ne.TRIANGLES,j,d.StencilMode.disabled,L.colorModeForRenderPass(),d.CullFaceMode.backCW,le,"skyboxGradient",B.skyboxGeometry.vertexBuffer,B.skyboxGeometry.indexBuffer,B.skyboxGeometry.segment)}(p,u,A,b,k)},debug:function(p,i,u){for(let g=0;g<u.length;g++)Wn(p,i,u[g])},custom:function(p,i,u){const g=p.context,v=u.implementation;if(p.transform.projection.unsupportedLayers&&p.transform.projection.unsupportedLayers.includes("custom"))d.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===p.renderPass){const b=v.prerender;b&&(p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),b.call(v,g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState())}else if("translucent"===p.renderPass){p.setCustomLayerDefaults(),g.setColorMode(p.colorModeForRenderPass()),g.setStencilMode(d.StencilMode.disabled);const b="3d"===v.renderingMode?new d.DepthMode(p.context.gl.LEQUAL,d.DepthMode.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,d.DepthMode.ReadOnly);g.setDepthMode(b),v.render(g.gl,p.transform.customLayerMatrix()),g.setDirty(),p.setBaseState(),g.bindFramebuffer.set(null)}}};class cl{constructor(i,u){this.context=new J(i),this.transform=u,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=d.SourceCache.maxUnderzooming+d.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new zr,this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={}}updateTerrain(i,u){const g=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(g||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new hh(this,i));const v=this._terrain;this.transform.elevation=g?v:null,v.update(i,this.transform,u)}_updateFog(i){const u=i.fog;if(!u||"globe"===this.transform.projection.name||u.getOpacity(this.transform.pitch)<1||u.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[g,v]=u.getFovAdjustedRange(this.transform._fov);if(g>v)return void(this.transform.fogCullDistSq=null);const b=g+.78*(v-g);this.transform.fogCullDistSq=b*b}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(i,u){if(this.width=i*d.exported.devicePixelRatio,this.height=u*d.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const g of this.style.order)this.style._layers[g].resize()}setup(){const i=this.context,u=new d.StructArrayLayout2i4;u.emplaceBack(0,0),u.emplaceBack(d.EXTENT,0),u.emplaceBack(0,d.EXTENT),u.emplaceBack(d.EXTENT,d.EXTENT),this.tileExtentBuffer=i.createVertexBuffer(u,d.posAttributes.members),this.tileExtentSegments=d.SegmentVector.simpleSegment(0,0,4,2);const g=new d.StructArrayLayout2i4;g.emplaceBack(0,0),g.emplaceBack(d.EXTENT,0),g.emplaceBack(0,d.EXTENT),g.emplaceBack(d.EXTENT,d.EXTENT),this.debugBuffer=i.createVertexBuffer(g,d.posAttributes.members),this.debugSegments=d.SegmentVector.simpleSegment(0,0,4,5);const v=new d.StructArrayLayout2i4;v.emplaceBack(-1,-1),v.emplaceBack(1,-1),v.emplaceBack(-1,1),v.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(v,d.posAttributes.members),this.viewportSegments=d.SegmentVector.simpleSegment(0,0,4,2);const b=new d.StructArrayLayout4i8;b.emplaceBack(0,0,0,0),b.emplaceBack(d.EXTENT,0,d.EXTENT,0),b.emplaceBack(0,d.EXTENT,0,d.EXTENT),b.emplaceBack(d.EXTENT,d.EXTENT,d.EXTENT,d.EXTENT),this.mercatorBoundsBuffer=i.createVertexBuffer(b,d.boundsAttributes.members),this.mercatorBoundsSegments=d.SegmentVector.simpleSegment(0,0,4,2);const T=new d.StructArrayLayout3ui6;T.emplaceBack(0,1,2),T.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(T);const D=new d.StructArrayLayout1ui2;for(const k of[0,1,3,2,0])D.emplaceBack(k);this.debugIndexBuffer=i.createIndexBuffer(D),this.emptyTexture=new d.Texture(i,new d.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA),this.identityMat=d.create();const A=this.context.gl;this.stencilClearMode=new d.StencilMode({func:A.ALWAYS,mask:0},0,255,A.ZERO,A.ZERO,A.ZERO),this.loadTimeStamps.push(d.window.performance.now()),this.atmosphereBuffer=new Yi(this.context)}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context,u=i.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.useProgram("clippingMask").draw(i,u.TRIANGLES,d.DepthMode.disabled,this.stencilClearMode,d.ColorMode.disabled,d.CullFaceMode.disabled,us(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,u,g){if(!u||this.currentStencilSource===u.id||!i.isTileClipped()||!g||0===g.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let D=!1;for(const A of g)if(void 0===this._tileClippingMaskIDs[A.key]){D=!0;break}if(!D)return}this.currentStencilSource=u.id;const v=this.context,b=v.gl;this.nextStencilID+g.length>256&&this.clearStencil(),v.setColorMode(d.ColorMode.disabled),v.setDepthMode(d.DepthMode.disabled);const T=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(const D of g){const A=u.getTile(D),k=this._tileClippingMaskIDs[D.key]=this.nextStencilID++,{tileBoundsBuffer:L,tileBoundsIndexBuffer:B,tileBoundsSegments:j}=this.getTileBoundsBuffers(A);T.draw(v,b.TRIANGLES,d.DepthMode.disabled,new d.StencilMode({func:b.ALWAYS,mask:0},k,255,b.KEEP,b.KEEP,b.REPLACE),d.ColorMode.disabled,d.CullFaceMode.disabled,us(D.projMatrix),"$clipping",L,B,j)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,u=this.context.gl;return new d.StencilMode({func:u.NOTEQUAL,mask:255},i,255,u.KEEP,u.KEEP,u.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const u=this.context.gl;return new d.StencilMode({func:u.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,u.KEEP,u.KEEP,u.REPLACE)}stencilConfigForOverlap(i){const u=this.context.gl,g=i.sort((T,D)=>D.overscaledZ-T.overscaledZ),v=g[g.length-1].overscaledZ,b=g[0].overscaledZ-v+1;if(b>1){this.currentStencilSource=void 0,this.nextStencilID+b>256&&this.clearStencil();const T={};for(let D=0;D<b;D++)T[D+v]=new d.StencilMode({func:u.GEQUAL,mask:255},D+this.nextStencilID,255,u.KEEP,u.KEEP,u.REPLACE);return this.nextStencilID+=b,[T,g]}return[{[v]:d.StencilMode.disabled},g]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new d.ColorMode([i.CONSTANT_COLOR,i.ONE],new d.Color(.125,.125,.125,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?d.ColorMode.unblended:d.ColorMode.alphaBlended}depthModeForSublayer(i,u,g){if(!this.opaquePassEnabledForLayer())return d.DepthMode.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new d.DepthMode(g||this.context.gl.LEQUAL,u,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(i,u){this.style=i,this.options=u,this.lineAtlas=i.lineAtlas,this.imageManager=i.imageManager,this.glyphManager=i.glyphManager,this.symbolFadeChange=i.placement.symbolFadeChange(d.exported.now()),this.imageManager.beginFrame();const g=this.style.order,v=this.style._sourceCaches;for(const A in v){const k=v[A];k.used&&k.prepare(this.context)}const b={},T={},D={};for(const A in v){const k=v[A];b[A]=k.getVisibleCoordinates(),T[A]=b[A].slice().reverse(),D[A]=k.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let A=0;A<g.length;A++)if(this.style._layers[g[A]].is3D()){this.opaquePassCutoff=A;break}if(this.terrain&&(this.terrain.updateTileBinding(D),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new d.GlobeSharedBuffers(this.context)),d.isMapAuthenticated(this.context.gl)){this.renderPass="offscreen";for(const A of g){const k=this.style._layers[A],L=i._getLayerSourceCache(k);if(!k.hasOffscreenPass()||k.isHidden(this.transform.zoom))continue;const B=L?T[L.id]:void 0;("custom"===k.type||k.isSky()||B&&B.length)&&this.renderLayer(this,L,k,B)}if(this.depthRangeFor3D=[0,1-(i.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]),this.context.clear({color:u.showOverdrawInspector?d.Color.black:d.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=u.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){const A=this.style._layers[g[this.currentLayer]],k=i._getLayerSourceCache(A);if(A.isSky())continue;const L=k?T[k.id]:void 0;this._renderTileClippingMasks(A,k,L),this.renderLayer(this,k,A,L)}if(this.style.fog&&this.transform.projection.supportsFog&&function(A,k){const L=A.context,B=L.gl,j=A.transform,H=new d.DepthMode(B.LEQUAL,d.DepthMode.ReadOnly,[0,1]),Z=A.useProgram("globeAtmosphere",null,"globe"===j.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"]),G=d.globeToMercatorTransition(j.zoom),ne=k.properties.get("color").toArray01(),W=k.properties.get("high-color").toArray01(),Q=k.properties.get("space-color").toArray01PremultipliedAlpha(),q=d.identity$1([]);d.rotateY$1(q,q,-d.degToRad(j._center.lng)),d.rotateX$1(q,q,d.degToRad(j._center.lat)),d.rotateZ$1(q,q,j.angle),d.rotateX$1(q,q,-j._pitch);const le=d.fromQuat(new Float32Array(16),q),te=d.mapValue(k.properties.get("star-intensity"),0,1,0,.25),ue=d.mapValue(k.properties.get("horizon-blend"),0,1,5e-4,.25),Ce=d.globeUseCustomAntiAliasing(A,L,j)&&5e-4===ue?j.worldSize/(2*Math.PI*1.025)-1:j.globeRadius,Se=A.frameCounter/1e3%1,be=d.length(j.globeCenterInViewSpace),Ve=Math.sqrt(Math.pow(be,2)-Math.pow(Ce,2)),ie=Math.acos(Ve/be),ve={u_frustum_tl:j.frustumCorners.TL,u_frustum_tr:j.frustumCorners.TR,u_frustum_br:j.frustumCorners.BR,u_frustum_bl:j.frustumCorners.BL,u_horizon:j.frustumCorners.horizon,u_transition:G,u_fadeout_range:ue,u_color:ne,u_high_color:W,u_space_color:Q,u_star_intensity:te,u_star_size:5*d.exported.devicePixelRatio,u_star_density:0,u_temporal_offset:Se,u_horizon_angle:ie,u_rotation_matrix:le};A.prepareDrawProgram(L,Z);const Ie=A.atmosphereBuffer;Ie&&Z.draw(L,B.TRIANGLES,H,d.StencilMode.disabled,d.ColorMode.alphaBlended,d.CullFaceMode.backCW,ve,"skybox",Ie.vertexBuffer,Ie.indexBuffer,Ie.segments)}(this,this.style.fog),this.renderPass="sky",(d.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){const A=this.style._layers[g[this.currentLayer]],k=i._getLayerSourceCache(A);A.isSky()&&this.renderLayer(this,k,A,k?T[k.id]:void 0)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;){const A=this.style._layers[g[this.currentLayer]],k=i._getLayerSourceCache(A);if(A.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(A)){if(A.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const L=k?("symbol"===A.type?D:T)[k.id]:void 0;this._renderTileClippingMasks(A,k,k?b[k.id]:void 0),this.renderLayer(this,k,A,L),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let A=null;d.values(this.style._layers).forEach(k=>{const L=i._getLayerSourceCache(k);L&&!k.isHidden(this.transform.zoom)&&(!A||A.getSource().maxzoom<L.getSource().maxzoom)&&(A=L)}),A&&this.options.showTileBoundaries&&eu.debug(this,A,A.getVisibleCoordinates())}this.options.showPadding&&function(A){const k=A.transform.padding;_h(A,A.transform.height-(k.top||0),3,ga),_h(A,k.bottom||0,3,_a),ll(A,k.left||0,3,Od),ll(A,A.transform.width-(k.right||0),3,al);const L=A.transform.centerPoint;var B,j,H,Z;on(B=A,(j=L.x)-1,(H=A.transform.height-L.y)-10,2,20,Z=zs),on(B,j-10,H-1,20,2,Z)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(d.window.performance.now()),this.saveCanvasCopy())}}renderLayer(i,u,g,v){g.isHidden(this.transform.zoom)||("background"===g.type||"sky"===g.type||"custom"===g.type||v&&v.length)&&(this.id=g.id,this.gpuTimingStart(g),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(g.type)||eu[g.type](i,u,g,v,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const u=this.context.extTimerQuery;let g=this.gpuTimers[i.id];g||(g=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:u.createQueryEXT()}),g.calls++,u.beginQueryEXT(u.TIME_ELAPSED_EXT,g.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,u=i.createQueryEXT();this.deferredRenderGpuTimeQueries.push(u),i.beginQueryEXT(i.TIME_ELAPSED_EXT,u)}}gpuTimingDeferredRenderEnd(){if(!this.options.gpuTimingDeferredRender)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const i=this.context.extTimerQuery;i.endQueryEXT(i.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const u={};for(const g in i){const v=i[g],b=this.context.extTimerQuery,T=b.getQueryObjectEXT(v.query,b.QUERY_RESULT_EXT)/1e6;b.deleteQueryEXT(v.query),u[g]=T}return u}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const u=this.context.extTimerQuery;let g=0;for(const v of i)g+=u.getQueryObjectEXT(v,u.QUERY_RESULT_EXT)/1e6,u.deleteQueryEXT(v);return g}translatePosMatrix(i,u,g,v,b){if(!g[0]&&!g[1])return i;const T=b?"map"===v?this.transform.angle:0:"viewport"===v?-this.transform.angle:0;if(T){const k=Math.sin(T),L=Math.cos(T);g=[g[0]*L-g[1]*k,g[0]*k+g[1]*L]}const D=[b?g[0]:$i(u,g[0],this.transform.zoom),b?g[1]:$i(u,g[1],this.transform.zoom),0],A=new Float32Array(16);return d.translate(A,i,D),A}saveTileTexture(i){const u=this._tileTextures[i.size[0]];u?u.push(i):this._tileTextures[i.size[0]]=[i]}getTileTexture(i){const u=this._tileTextures[i];return u&&u.length>0?u.pop():null}isPatternMissing(i){if(!i)return!1;if(!i.from||!i.to)return!0;const u=this.imageManager.getPattern(i.from.toString()),g=this.imageManager.getPattern(i.to.toString());return!u||!g}currentGlobalDefines(){const i=this.terrain&&this.terrain.renderingToTexture,u=this.style&&this.style.fog,g=[];return this.terrain&&!this.terrain.renderingToTexture&&g.push("TERRAIN"),u&&!i&&0!==u.getOpacity(this.transform.pitch)&&g.push("FOG"),i&&g.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&g.push("OVERDRAW_INSPECTOR"),g}useProgram(i,u,g){this.cache=this.cache||{};const v=g||[],b=this.currentGlobalDefines().concat(v),T=_i.cacheKey(i,b,u);return this.cache[T]||(this.cache[T]=new _i(this.context,i,Nn[i],u,vf[i],b)),this.cache[T]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=d.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new d.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this.atmosphereBuffer&&this.atmosphereBuffer.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(i,u,g){if(this.terrain&&this.terrain.renderingToTexture)return;const v=this.style.fog;if(v){const b=v.getOpacity(this.transform.pitch),T=((D,A,k,L,B,j,H,Z,G,ne,W)=>{const Q=D.transform,q=A.properties.get("color").toArray01();q[3]=L;const le=D.frameCounter/1e3%1;return{u_fog_matrix:k?Q.calculateFogTileMatrix(k):D.identityMat,u_fog_range:A.getFovAdjustedRange(Q._fov),u_fog_color:q,u_fog_horizon_blend:A.properties.get("horizon-blend"),u_fog_temporal_offset:le,u_frustum_tl:B,u_frustum_tr:j,u_frustum_br:H,u_frustum_bl:Z,u_globe_pos:G,u_globe_radius:ne,u_viewport:W,u_globe_transition:d.globeToMercatorTransition(Q.zoom),u_is_globe:+("globe"===Q.projection.name)}})(this,v,g,b,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*d.exported.devicePixelRatio,this.transform.height*d.exported.devicePixelRatio]);u.setFogUniformValues(i,T)}}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const i=this.context.gl,u=i.createTexture();return i.bindTexture(i.TEXTURE_2D,u),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),u}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&0!==i.getOpacity(this.transform.pitch)}getBackgroundTiles(){const i=this._backgroundTiles,u=this._backgroundTiles={},g=this.transform.coveringTiles({tileSize:512});for(const v of g)u[v.key]=i[v.key]||new d.Tile(v,512,this.transform.tileZoom,this);return u}clearBackgroundTiles(){this._backgroundTiles={}}}class Ki{constructor(i=0,u=0,g=0,v=0){if(isNaN(i)||i<0||isNaN(u)||u<0||isNaN(g)||g<0||isNaN(v)||v<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=u,this.left=g,this.right=v}interpolate(i,u,g){return null!=u.top&&null!=i.top&&(this.top=d.number(i.top,u.top,g)),null!=u.bottom&&null!=i.bottom&&(this.bottom=d.number(i.bottom,u.bottom,g)),null!=u.left&&null!=i.left&&(this.left=d.number(i.left,u.left,g)),null!=u.right&&null!=i.right&&(this.right=d.number(i.right,u.right,g)),this}getCenter(i,u){const g=d.clamp((this.left+i-this.right)/2,0,i),v=d.clamp((this.top+u-this.bottom)/2,0,u);return new d.pointGeometry(g,v)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new Ki(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Hr(p,i){const u=d.getColumn(p,3);d.fromQuat(p,i),d.setColumn(p,3,u)}function ul(p,i){const u=d.identity$1([]);return d.rotateZ$1(u,u,-i),d.rotateX$1(u,u,-p),u}function hl(p,i){const u=[p[0],p[1],0],g=[i[0],i[1],0];if(d.length(u)>=1e-15){const T=d.normalize([],u);d.scale$2(g,T,d.dot(g,T)),i[0]=g[0],i[1]=g[1]}const v=d.cross([],i,p);if(d.len(v)<1e-15)return null;const b=Math.atan2(-v[1],v[0]);return ul(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),b)}class Jl{constructor(i,u){this.position=i,this.orientation=u}get position(){return this._position}set position(i){if(i){const u=i instanceof d.MercatorCoordinate?i:new d.MercatorCoordinate(i[0],i[1],i[2]);this._renderWorldCopies&&(u.x=d.wrap(u.x,0,1)),this._position=u}else this._position=null}lookAtPoint(i,u){if(this.orientation=null,!this.position)return;const g=this._elevation?this._elevation.getAtPointOrZero(d.MercatorCoordinate.fromLngLat(i)):0,v=this.position,b=d.MercatorCoordinate.fromLngLat(i,g),T=[b.x-v.x,b.y-v.y,b.z-v.z];u||(u=[0,0,1]),u[2]=Math.abs(u[2]),this.orientation=hl(T,u)}setPitchBearing(i,u){this.orientation=ul(d.degToRad(i),d.degToRad(-u))}}class ki{constructor(i,u){this._transform=d.identity([]),this.orientation=u,this.position=i}get mercatorPosition(){const i=this.position;return new d.MercatorCoordinate(i[0],i[1],i[2])}get position(){const i=d.getColumn(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var u;i&&d.setColumn(this._transform,3,[(u=i)[0],u[1],u[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||d.identity$1([]),i&&Hr(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),u=this.right();return{bearing:Math.atan2(-u[1],u[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,u){this._orientation=ul(i,u),Hr(this._transform,this._orientation)}forward(){const i=d.getColumn(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=d.getColumn(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=d.getColumn(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,u){const g=new Float64Array(16);return d.invert(g,this.getWorldToCamera(i,u)),g}getWorldToCameraPosition(i,u,g){const v=this.position;d.scale$2(v,v,-i);const b=new Float64Array(16);return d.fromScaling(b,[g,g,g]),d.translate(b,b,v),b[10]*=u,b}getWorldToCamera(i,u){const g=new Float64Array(16),v=new Float64Array(4),b=this.position;return d.conjugate(v,this._orientation),d.scale$2(b,b,-i),d.fromQuat(g,v),d.translate(g,g,b),g[1]*=-1,g[5]*=-1,g[9]*=-1,g[13]*=-1,g[8]*=u,g[9]*=u,g[10]*=u,g[11]*=u,g}getCameraToClipPerspective(i,u,g,v){const b=new Float64Array(16);return d.perspective(b,i,u,g,v),b}getDistanceToElevation(i){const u=0===i?0:d.mercatorZfromAltitude(i,this.position[1]),g=this.forward();return(u-this.position[2])/g[2]}clone(){return new ki([...this.position],[...this.orientation])}}function nt(p,i){const u=Mt(p.projection,p.zoom,p.width,p.height),g=function(b,T,D,A,k){const L=new d.LngLat(D.lng-180*Bs,D.lat),B=new d.LngLat(D.lng+180*Bs,D.lat),j=b.project(L.lng,L.lat),H=b.project(B.lng,B.lat),Z=-Math.atan2(H.y-j.y,H.x-j.x),G=d.MercatorCoordinate.fromLngLat(D);G.y=d.clamp(G.y,-.999975,.999975);const ne=G.toLngLat(),W=b.project(ne.lng,ne.lat),Q=d.MercatorCoordinate.fromLngLat(ne);Q.x+=Bs;const q=Q.toLngLat(),le=b.project(q.lng,q.lat),te=ya(le.x-W.x,le.y-W.y,Z),re=d.MercatorCoordinate.fromLngLat(ne);re.y+=Bs;const ue=re.toLngLat(),Ce=b.project(ue.lng,ue.lat),Se=ya(Ce.x-W.x,Ce.y-W.y,Z),be=Math.abs(te.x)/Math.abs(Se.y),Ve=d.identity([]);d.rotateZ(Ve,Ve,-Z*(1-(k?0:A)));const ie=d.identity([]);return d.scale(ie,ie,[1,1-(1-be)*A,1]),ie[4]=-Se.x/Se.y*A,d.rotateZ(ie,ie,Z),d.multiply(ie,Ve,ie),ie}(p.projection,0,p.center,u,i),v=yi(p);return d.scale(g,g,[v,v,1]),g}function yi(p){const i=p.projection,u=Mt(p.projection,p.zoom,p.width,p.height),g=Vd(i,p.center),v=Vd(i,d.LngLat.convert(i.center));return Math.pow(2,g*u+(1-u)*v)}function Mt(p,i,u,g,v=1/0){const b=p.range;if(!b)return 0;const T=Math.min(v,Math.max(u,g)),D=Math.log(T/1024)/Math.LN2;return d.smoothstep(b[0]+D,b[1]+D,i)}const Bs=1/4e4;function Vd(p,i){const u=d.clamp(i.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),g=new d.LngLat(i.lng-180*Bs,u),v=new d.LngLat(i.lng+180*Bs,u),b=p.project(g.lng,u),T=p.project(v.lng,u),D=d.MercatorCoordinate.fromLngLat(g),A=d.MercatorCoordinate.fromLngLat(v),k=T.x-b.x,L=T.y-b.y,B=A.x-D.x,j=A.y-D.y,H=Math.sqrt((B*B+j*j)/(k*k+L*L));return Math.log(H)/Math.LN2}function ya(p,i,u){const g=Math.cos(u),v=Math.sin(u);return{x:p*g-i*v,y:p*v+i*g}}class tu{constructor(i,u,g,v,b,T,D){this.tileSize=512,this._renderWorldCopies=void 0===b||b,this._minZoom=i||0,this._maxZoom=u||22,this._minPitch=null==g?0:g,this._maxPitch=null==v?60:v,this.setProjection(T),this.setMaxBounds(D),this.width=0,this.height=0,this._center=new d.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new Ki,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new ki,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._horizonShift=.1}clone(){const i=new tu(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(i){const u=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||u)&&this._updateCameraOnTerrain(),(i||u)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return d.pick(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const u=this.projection?this.getProjection():void 0;this.projection=d.getProjection(this.projectionOptions);const g=!Ge(u,this.getProjection());return g&&this._calcMatrices(),g}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(i){void 0===i?i=!0:null===i&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return d.mercatorZfromAltitude(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new d.pointGeometry(this.width,this.height)}get bearing(){return d.wrap(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const u=-i*Math.PI/180;var g,v,b,T,D,A,k,L,B,j;this.angle!==u&&(this._unmodified=!1,this.angle=u,this._calcMatrices(),this.rotationMatrix=(g=new d.ARRAY_TYPE(4),d.ARRAY_TYPE!=Float32Array&&(g[1]=0,g[2]=0),g[0]=1,g[3]=1,g),v=this.rotationMatrix,T=this.angle,D=(b=this.rotationMatrix)[0],A=b[1],k=b[2],L=b[3],B=Math.sin(T),j=Math.cos(T),v[0]=D*j+k*B,v[1]=A*j+L*B,v[2]=D*-B+k*j,v[3]=A*-B+L*j)}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const u=d.clamp(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==u&&(this._unmodified=!1,this._pitch=u,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=i/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const u=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==u&&(this._unmodified=!1,this._setZoom(u),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const i=this._elevation;this._centerAltitude=i.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=i.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){void 0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,u=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],g=this.horizonLineFromTop();let v=0,b=0;for(let T=0;T<u.length;T++){const D=new d.pointGeometry(u[T][0]*this.width,g+u[T][1]*(this.height-g)),A=i.pointCoordinate(D);if(!A)continue;const k=1/Math.hypot(A[0]-this._camera.position[0],A[1]-this._camera.position[1]);v+=A[3]*k,b+=k}return 0===b?NaN:v/b}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const i=this._seaLevelZoom,u=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),g=this.pixelsPerMeter/this.worldSize*u,v=this._mercatorZfromZoom(i),b=this._mercatorZfromZoom(this._maxZoom),T=Math.max(v-g,b);this._setZoom(this._zoomFromMercatorZ(T))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const u=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let g;g=i.z<this._camera.position[2]?[u.x,u.y,u.z]:[i.x,i.y,i.z];const v=d.length(d.sub([],this._camera.position,g));return d.clamp(this._zoomFromMercatorZ(v),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let u=!1;if(i.orientation&&!d.exactEquals(i.orientation,this._camera.orientation)&&(u=this._setCameraOrientation(i.orientation)),i.position){const g=[i.position.x,i.position.y,i.position.z];d.exactEquals$1(g,this._camera.position)||(this._setCameraPosition(g),u=!0)}u&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,u=new Jl;return u.position=new d.MercatorCoordinate(i[0],i[1],i[2]),u.orientation=this._camera.orientation,u._elevation=this.elevation,u._renderWorldCopies=this.renderWorldCopies,u}_setCameraOrientation(i){if(!d.length$1(i))return!1;d.normalize$1(i,i);const u=d.transformQuat([],[0,0,-1],i),g=d.transformQuat([],[0,-1,0],i);if(g[2]<0)return!1;const v=hl(u,g);return!!v&&(this._camera.orientation=v,!0)}_setCameraPosition(i){const u=this.zoomScale(this.minZoom)*this.tileSize,g=this.zoomScale(this.maxZoom)*this.tileSize,v=this.cameraToCenterDistance;i[2]=d.clamp(i[2],v/g,v/u),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,u,g){this._unmodified=!1,this._edgeInsets.interpolate(i,u,g),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const u=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,u)}getVisibleUnwrappedCoordinates(i){const u=[new d.UnwrappedTileID(0,i)];if(this.renderWorldCopies){const g=this.pointCoordinate(new d.pointGeometry(0,0)),v=this.pointCoordinate(new d.pointGeometry(this.width,0)),b=this.pointCoordinate(new d.pointGeometry(this.width,this.height)),T=this.pointCoordinate(new d.pointGeometry(0,this.height)),D=Math.floor(Math.min(g.x,v.x,b.x,T.x)),A=Math.floor(Math.max(g.x,v.x,b.x,T.x)),k=1;for(let L=D-k;L<=A+k;L++)0!==L&&u.push(new d.UnwrappedTileID(L,i))}return u}coveringTiles(i){let u=this.coveringZoomLevel(i);const g=u,v=this.elevation&&!i.isTerrainDEM,b="mercator"===this.projection.name;if(void 0!==i.minzoom&&u<i.minzoom)return[];void 0!==i.maxzoom&&u>i.maxzoom&&(u=i.maxzoom);const T=this.locationCoordinate(this.center),D=this.center.lat,A=1<<u,k=[A*T.x,A*T.y,0],L="globe"===this.projection.name,B=!L,j=d.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,u,B),H=L?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),Z=A*d.mercatorZfromAltitude(1,this.center.lat),G=this._camera.position[2]/d.mercatorZfromAltitude(1,this.center.lat),ne=[A*H.x,A*H.y,G*(B?1:Z)],W=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),Q=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?u:0,q=i.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,le=i.isTerrainDEM?-q:this._elevation?this._elevation.getMinElevationBelowMSL():0,te=this.projection.isReprojectedInTileSpace?yi(this):1,re=Me=>{const He=new d.MercatorCoordinate(Me.x+25e-6,Me.y,Me.z),Ke=new d.MercatorCoordinate(Me.x,Me.y+25e-6,Me.z),We=Me.toLngLat(),Xe=He.toLngLat(),st=Ke.toLngLat(),qe=this.locationCoordinate(We),Dt=this.locationCoordinate(Xe),ht=this.locationCoordinate(st),Ct=Math.hypot(Dt.x-qe.x,Dt.y-qe.y),_n=Math.hypot(ht.x-qe.x,ht.y-qe.y);return Math.sqrt(Ct*_n)*te/25e-6},ue=Me=>{const it=q,He=le;return{aabb:d.tileAABB(this,A,0,0,0,Me,He,it,this.projection),zoom:0,x:0,y:0,minZ:He,maxZ:it,wrap:Me,fullyVisible:!1}},Ce=[];let Se=[];const be=u,Ve=i.reparseOverscaled?g:u,ie=Me=>Me*Me,ve=ie((G-this._centerAltitude)*Z),Ie=Me=>{if(!this._elevation||!Me.tileID||!b)return;const it=this._elevation.getMinMaxForTile(Me.tileID),He=Me.aabb;it?(He.min[2]=it.min,He.max[2]=it.max,He.center[2]=(He.min[2]+He.max[2])/2):(Me.shouldSplit=Ze(Me),Me.shouldSplit||(He.min[2]=He.max[2]=He.center[2]=this._centerAltitude))},Ze=Me=>{if(Me.zoom<Q)return!0;if(Me.zoom===be)return!1;if(null!=Me.shouldSplit)return Me.shouldSplit;const it=Me.aabb.distanceX(ne),He=Me.aabb.distanceY(ne);let Ke=ve,We=1;if(L){Ke=ie(Me.aabb.distanceZ(ne));const st=Math.pow(2,Me.zoom),qe=d.latFromMercatorY((Me.y+1)/st),Dt=d.latFromMercatorY(Me.y/st),ht=Math.min(Math.max(D,qe),Dt),Ct=d.circumferenceAtLatitude(ht)/d.circumferenceAtLatitude(D);if(We=ht===D?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Ct/this._mercatorScaleRatio),this.zoom<=d.GLOBE_ZOOM_THRESHOLD_MIN&&Me.zoom===be-1&&Ct>=.9)return!0}else if(v&&(Ke=ie(Me.aabb.distanceZ(ne)*Z)),this.projection.isReprojectedInTileSpace&&g<=5){const st=Math.pow(2,Me.zoom),qe=re(new d.MercatorCoordinate((Me.x+.5)/st,(Me.y+.5)/st));We=qe>.85?1:qe}const Xe=it*it+He*He+Ke;return Xe<ie((1<<be-Me.zoom)*W*We*((st,qe)=>{if(qe*ie(.707)<st)return 1;const Dt=Math.sqrt(qe/st);return Dt/(1.4144271570014144+(Math.pow(1.1,Dt-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(Ke,ve),Xe))};if(this.renderWorldCopies)for(let Me=1;Me<=3;Me++)Ce.push(ue(-Me)),Ce.push(ue(Me));for(Ce.push(ue(0));Ce.length>0;){const Me=Ce.pop(),it=Me.x,He=Me.y;let Ke=Me.fullyVisible;if(!Ke){const We=Me.aabb.intersects(j);if(0===We)continue;Ke=2===We}if(Me.zoom!==be&&Ze(Me))for(let We=0;We<4;We++){const Xe=(it<<1)+We%2,st=(He<<1)+(We>>1),qe={aabb:b?Me.aabb.quadrant(We):d.tileAABB(this,A,Me.zoom+1,Xe,st,Me.wrap,Me.minZ,Me.maxZ,this.projection),zoom:Me.zoom+1,x:Xe,y:st,wrap:Me.wrap,fullyVisible:Ke,tileID:void 0,shouldSplit:void 0,minZ:Me.minZ,maxZ:Me.maxZ};v&&!L&&(qe.tileID=new d.OverscaledTileID(Me.zoom+1===be?Ve:Me.zoom+1,Me.wrap,Me.zoom+1,Xe,st),Ie(qe)),Ce.push(qe)}else{const We=Me.zoom===be?Ve:Me.zoom;if(i.minzoom&&i.minzoom>We)continue;const Xe=k[0]-(.5+it+(Me.wrap<<Me.zoom))*(1<<u-Me.zoom),st=k[1]-.5-He,qe=Me.tileID?Me.tileID:new d.OverscaledTileID(We,Me.wrap,Me.zoom,it,He);Se.push({tileID:qe,distanceSq:Xe*Xe+st*st})}}if(this.fogCullDistSq){const Me=this.fogCullDistSq,it=this.horizonLineFromTop();Se=Se.filter(He=>{const Ke=[0,0,0,1],We=[d.EXTENT,d.EXTENT,0,1],Xe=this.calculateFogTileMatrix(He.tileID.toUnwrapped());d.transformMat4$1(Ke,Ke,Xe),d.transformMat4$1(We,We,Xe);const st=d.getAABBPointSquareDist(Ke,We);if(0===st)return!0;let qe=!1;const Dt=this._elevation;if(Dt&&st>Me&&0!==it){const ht=this.calculateProjMatrix(He.tileID.toUnwrapped());let Ct;i.isTerrainDEM||(Ct=Dt.getMinMaxForTile(He.tileID)),Ct||(Ct={min:le,max:q});const _n=d.furthestTileCorner(this.rotation),Rn=[_n[0]*d.EXTENT,_n[1]*d.EXTENT,Ct.max];d.transformMat4(Rn,Rn,ht),qe=(1-Rn[1])*this.height*.5<it}return st<Me||qe})}return Se.sort((Me,it)=>Me.distanceSq-it.distanceSq).map(Me=>Me.tileID)}resize(i,u){this.width=i,this.height=u,this.pixelsToGLUnits=[2/i,-2/u],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log(i)/Math.LN2}project(i){const u=d.clamp(i.lat,-d.MAX_MERCATOR_LATITUDE,d.MAX_MERCATOR_LATITUDE),g=this.projection.project(i.lng,u);return new d.pointGeometry(g.x*this.worldSize,g.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(i,u){let g,v;const b=this.centerPoint;if("globe"===this.projection.name){const D=this.worldSize;g=(u.x-b.x)/D,v=(u.y-b.y)/D}else{const D=this.pointCoordinate(u),A=this.pointCoordinate(b);g=D.x-A.x,v=D.y-A.y}const T=this.locationCoordinate(i);this.setLocation(new d.MercatorCoordinate(T.x-g,T.y-v))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i){return this.projection.locationPoint(this,i)}locationPoint3D(i){return this.projection.locationPoint(this,i,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i){return this.coordinateLocation(this.pointCoordinate3D(i))}locationCoordinate(i,u){const g=u?d.mercatorZfromAltitude(u,i.lat):void 0,v=this.projection.project(i.lng,i.lat);return new d.MercatorCoordinate(v.x,v.y,g)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,u){const g=null!=u?u:this._centerAltitude,v=[i.x,i.y,0,1],b=[i.x,i.y,1,1];d.transformMat4$1(v,v,this.pixelMatrixInverse),d.transformMat4$1(b,b,this.pixelMatrixInverse);const T=b[3];d.scale$1(v,v,1/v[3]),d.scale$1(b,b,1/T);const D=v[2],A=b[2];return{p0:v,p1:b,t:D===A?0:(g-D)/(A-D)}}screenPointToMercatorRay(i){const u=[i.x,i.y,0,1],g=[i.x,i.y,1,1];return d.transformMat4$1(u,u,this.pixelMatrixInverse),d.transformMat4$1(g,g,this.pixelMatrixInverse),d.scale$1(u,u,1/u[3]),d.scale$1(g,g,1/g[3]),u[2]=d.mercatorZfromAltitude(u[2],this._center.lat)*this.worldSize,g[2]=d.mercatorZfromAltitude(g[2],this._center.lat)*this.worldSize,d.scale$1(u,u,1/this.worldSize),d.scale$1(g,g,1/this.worldSize),new d.Ray([u[0],u[1],u[2]],d.normalize([],d.sub([],g,u)))}rayIntersectionCoordinate(i){const{p0:u,p1:g,t:v}=i,b=d.mercatorZfromAltitude(u[2],this._center.lat),T=d.mercatorZfromAltitude(g[2],this._center.lat);return new d.MercatorCoordinate(d.number(u[0],g[0],v)/this.worldSize,d.number(u[1],g[1],v)/this.worldSize,d.number(b,T,v))}pointCoordinate(i,u=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,u)}pointCoordinate3D(i){if(!this.elevation)return this.pointCoordinate(i);let u=this.projection.pointCoordinate3D(this,i.x,i.y);if(u)return new d.MercatorCoordinate(u[0],u[1],u[2]);let g=0,v=this.horizonLineFromTop();if(i.y>v)return this.pointCoordinate(i);const b=.02*v,T=i.clone();for(let D=0;D<10&&v-g>b;D++){T.y=d.number(g,v,.66);const A=this.projection.pointCoordinate3D(this,T.x,T.y);A?(v=T.y,u=A):g=T.y}return u?new d.MercatorCoordinate(u[0],u[1],u[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}_coordinatePoint(i,u){const g=u&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,v=[i.x*this.worldSize,i.y*this.worldSize,g+i.toAltitude(),1];return d.transformMat4$1(v,v,this.pixelMatrix),v[3]>0?new d.pointGeometry(v[0]/v[3],v[1]/v[3]):new d.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(i,u){const g=new d.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),v=new d.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),b=new d.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),T=new d.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let D=this.pointCoordinate(g,i),A=this.pointCoordinate(v,i);const k=this.pointCoordinate(b,u),L=this.pointCoordinate(T,u),B=(j,H)=>(H.y-j.y)/(H.x-j.x);return D.y>1&&A.y>=0?D=new d.MercatorCoordinate((1-L.y)/B(L,D)+L.x,1):D.y<0&&A.y<=1&&(D=new d.MercatorCoordinate(-L.y/B(L,D)+L.x,0)),A.y>1&&D.y>=0?A=new d.MercatorCoordinate((1-k.y)/B(k,A)+k.x,1):A.y<0&&D.y<=1&&(A=new d.MercatorCoordinate(-k.y/B(k,A)+k.x,0)),(new d.LngLatBounds).extend(this.coordinateLocation(D)).extend(this.coordinateLocation(A)).extend(this.coordinateLocation(L)).extend(this.coordinateLocation(k))}_getBounds3D(){const i=this.elevation;if(!i.visibleDemTiles.length)return this._getBounds(0,0);const u=i.visibleDemTiles.reduce((g,v)=>{if(v.dem){const b=v.dem.tree;g.min=Math.min(g.min,b.minimums[0]),g.max=Math.max(g.max,b.maximums[0])}return g},{min:Number.MAX_VALUE,max:0});return this._getBounds(u.min*i.exaggeration(),u.max*i.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(i=!0){const u=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,g=this.height/2-u*(1-this._horizonShift);return i?Math.max(0,g):g}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-d.MAX_MERCATOR_LATITUDE,this.maxLat=d.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=d.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=d.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=d.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=d.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,u){return this.projection.createTileMatrix(this,u,i)}calculateDistanceTileData(i){const u=i.key,g=this._distanceTileDataCache;if(g[u])return g[u];const v=i.canonical,b=1/this.height,T=this.cameraWorldSize/this.zoomScale(v.z),D=(v.x+Math.pow(2,v.z)*i.wrap)*T,A=v.y*T,k=this.point,L=this.angle,B=Math.sin(-L),j=-Math.cos(-L);return g[u]={bearing:[B,j],center:[(k.x-D)*b,(k.y-A)*b],scale:T/d.EXTENT*b},g[u]}calculateFogTileMatrix(i){const u=i.key,g=this._fogTileMatrixCache;if(g[u])return g[u];const v=this.projection.createTileMatrix(this,this.cameraWorldSize,i);return d.multiply(v,this.worldToFogMatrix,v),g[u]=new Float32Array(v),g[u]}calculateProjMatrix(i,u=!1){const g=i.key,v=u?this._alignedProjMatrixCache:this._projMatrixCache;if(v[g])return v[g];const b=this.calculatePosMatrix(i,this.worldSize);return d.multiply(b,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:u?this.alignedProjMatrix:this.projMatrix,b),v[g]=new Float32Array(b),v[g]}calculatePixelsToTileUnitsMatrix(i){const u=i.tileID.key,g=this._pixelsToTileUnitsCache;if(g[u])return g[u];const v=function(b,T){const{scale:D}=b.tileTransform,A=D*d.EXTENT/(b.tileSize*Math.pow(2,T.zoom-b.tileID.overscaledZ+b.tileID.canonical.z));return k=new Float32Array(4),j=(L=T.inverseAdjustmentMatrix)[1],H=L[2],Z=L[3],ne=(B=[A,A])[1],k[0]=L[0]*(G=B[0]),k[1]=j*G,k[2]=H*ne,k[3]=Z*ne,k;var k,L,B,j,H,Z,G,ne}(i,this);return g[u]=v,g[u]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const i=this._elevation;this._updateCameraState();const u=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=this._camera.forward(),b=d.mercatorZfromAltitude(1,this._center.lat);g[2]/=b,v[2]/=b,d.normalize(v,v);const T=i.raycast(g,v,i.exaggeration());if(T){const D=d.scaleAndAdd([],g,v,T),A=new d.MercatorCoordinate(D[0],D[1],d.mercatorZfromAltitude(D[2],d.latFromMercatorY(D[1]))),k=(A.z+d.length([A.x-g[0],A.y-g[1],A.z-g[2]*b]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=A.toAltitude(),this._center=this.coordinateLocation(A),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const i=this._elevation;this._updateCameraState();const u=d.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,g=this._computeCameraPosition(u),v=i.getAtPointOrZero(new d.MercatorCoordinate(...g)),b=this._minimumHeightOverTerrain()*Math.cos(d.degToRad(this._maxPitch)),T=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*v;if(T<b){const D=this.locationCoordinate(this._center,this._centerAltitude),A=[D.x-g[0],D.y-g[1],D.z-g[2]],k=d.length(A);A[2]-=(b-T)/this._projectionScaler;const L=d.length(A);if(0===L)return;d.scale$2(A,A,k/L*this._projectionScaler),this._camera.position=[D.x-A[0],D.y-A[1],D.z*this._projectionScaler-A[2]],this._camera.orientation=hl(A,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const B=this.center;return B.lat=d.clamp(B.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(B.lng=d.clamp(B.lng,this.minLng,this.maxLng)),this.center=B,void(this._constraining=!1)}const i=this._unmodified,{x:u,y:g}=this.point;let v=0,b=u,T=g;const D=this.width/2,A=this.height/2,k=this.worldMinY*this.scale,L=this.worldMaxY*this.scale;if(g-A<k&&(T=k+A),g+A>L&&(T=L-A),L-k<this.height&&(v=Math.max(v,this.height/(L-k)),T=(L+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const B=this.worldMinX*this.scale,j=this.worldMaxX*this.scale,H=this.worldSize/2-(B+j)/2;b=(u+H+this.worldSize)%this.worldSize-H,b-D<B&&(b=B+D),b+D>j&&(b=j-D),j-B<this.width&&(v=Math.max(v,this.width/(j-B)),b=(j+B)/2)}b===u&&T===g||(this.center=this.unproject(new d.pointGeometry(b,T))),v&&(this.zoom+=this.scaleZoom(v)),this._constrainCameraAltitude(),this._unmodified=i,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,u=this.pixelsPerMeter;if("globe"===this.projection.name){const te=d.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,re=d.mercatorZfromAltitude(1,d.GLOBE_SCALE_MATCH_LATITUDE)*this.worldSize;this._mercatorScaleRatio=te/re}const g=Mt(this.projection,this.zoom,this.width,this.height,1024);this._projectionScaler=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,g),this.cameraToCenterDistance=this.getCameraToCenterDistance(this.projection),this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?u:1),b=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);b[8]=2*-i.x/this.width,b[9]=2*i.y/this.height;let T=d.mul([],b,v);if(this.projection.isReprojectedInTileSpace){const te=this.locationCoordinate(this.center),re=d.identity([]);d.translate(re,re,[te.x*this.worldSize,te.y*this.worldSize,0]),d.multiply(re,re,nt(this)),d.translate(re,re,[-te.x*this.worldSize,-te.y*this.worldSize,0]),d.multiply(T,T,re),this.inverseAdjustmentMatrix=function(ue){const Ce=nt(ue,!0);return kn([],[Ce[0],Ce[1],Ce[4],Ce[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=d.scale([],T,[this.worldSize,this.worldSize,this.worldSize/u,1]),this.projMatrix=T,this.invProjMatrix=d.invert(new Float64Array(16),this.projMatrix);const D=d.invert([],b);this.frustumCorners=d.FrustumCorners.fromInvProjectionMatrix(D,this.horizonLineFromTop(),this.height);const A=new Float32Array(16);d.identity(A),d.scale(A,A,[1,-1,1]),d.rotateX(A,A,this._pitch),d.rotateZ(A,A,this.angle);const k=d.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),L=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;k[8]=2*-i.x/this.width,k[9]=2*(i.y+L)/this.height,this.skyboxMatrix=d.multiply(A,k,A);const B=this.point,j=B.x,H=B.y,Z=this.width%2/2,G=this.height%2/2,ne=Math.cos(this.angle),W=Math.sin(this.angle),Q=j-Math.round(j)+ne*Z+W*G,q=H-Math.round(H)+ne*G+W*Z,le=new Float64Array(T);if(d.translate(le,le,[Q>.5?Q-1:Q,q>.5?q-1:q,0]),this.alignedProjMatrix=le,T=d.create(),d.scale(T,T,[this.width/2,-this.height/2,1]),d.translate(T,T,[1,-1,0]),this.labelPlaneMatrix=T,T=d.create(),d.scale(T,T,[1,-1,1]),d.translate(T,T,[-1,-1,0]),d.scale(T,T,[2/this.width,2/this.height,1]),this.glCoordMatrix=T,this.pixelMatrix=d.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},T=d.invert(new Float64Array(16),this.pixelMatrix),!T)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=T,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=d.calculateGlobeMatrix(this);const te=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=d.transformMat4(te,te,v),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=T;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSize,u=this.cameraPixelsPerMeter,g=this._camera.position,v=1/this.height/this._projectionScaler,b=[i,i,u];d.scale$2(b,b,v),d.scale$2(g,g,-1),d.multiply$2(g,g,b);const T=d.create();d.translate(T,T,g),d.scale(T,T,b),this.mercatorFogMatrix=T,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,u,v)}_computeCameraPosition(i){const u=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,g=this._camera.forward(),v=this.point,b=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*u-i/this.worldSize*this._centerAltitude;return[v.x/this.worldSize-g[0]*b,v.y/this.worldSize-g[1]*b,i/this.worldSize*this._centerAltitude-g[2]*b]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const u=this._maxCameraBoundsDistance()*Math.cos(this._pitch),g=i[2];let v=1;g>0&&(v=Math.min((u-this._camera.position[2])/g,1)),this._camera.position=d.scaleAndAdd([],this._camera.position,i,v),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const i=this._camera.position,u=this._camera.forward(),{pitch:g,bearing:v}=this._camera.getPitchBearing(),b=d.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,T=this._mercatorZfromZoom(this._maxZoom)*Math.cos(d.degToRad(this._maxPitch)),D=Math.max((i[2]-b)/Math.cos(g),T),A=this._zoomFromMercatorZ(D);d.scaleAndAdd(i,i,u,D),this._pitch=d.clamp(g,d.degToRad(this.minPitch),d.degToRad(this.maxPitch)),this.angle=d.wrap(v,-Math.PI,Math.PI),this._setZoom(d.clamp(A,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new d.MercatorCoordinate(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(i*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(d.warnOnce("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,u){const g=Math.min(i.x,u.x),v=Math.max(i.x,u.x),b=Math.min(i.y,u.y),T=Math.max(i.y,u.y);if(b<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const D=[new d.pointGeometry(g,b),new d.pointGeometry(v,T),new d.pointGeometry(g,T),new d.pointGeometry(v,b)],A=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const L of D){const B=this.pointRayIntersection(L);if(B.t<0)return!0;const j=this.rayIntersectionCoordinate(B);if(j.x<A||j.y<0||j.x>k||j.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+d.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new d.pointGeometry(0,0),new d.pointGeometry(this.width,this.height))}zoomDeltaToMovement(i,u){const g=d.length(d.sub([],this._camera.position,i)),v=this._zoomFromMercatorZ(g)+u;return g-this._mercatorZfromZoom(v)}getCameraPoint(){if("globe"===this.projection.name){const i=function(u,g){const v=[u[0],u[1],u[2],1];d.transformMat4$1(v,v,g);const b=Math.max(v[3],1e-6);return[v[0]/b,v[1]/b,v[2]/b,b]}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new d.pointGeometry(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new d.pointGeometry(0,i))}}getCameraToCenterDistance(i){const u=Mt(i,this.zoom,this.width,this.height,1024),g=i.pixelSpaceConversion(this.center.lat,this.worldSize,u);return.5/Math.tan(.5*this._fov)*this.height*g}}function Ql(p,i){let u=!1,g=null;const v=()=>{g=null,u&&(p(),g=setTimeout(v,i),u=!1)};return()=>(u=!0,g||v(),g)}class nu{constructor(i){this._hashName=i&&encodeURIComponent(i),d.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ql(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,d.window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),d.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(i){const u=this._map;if(!u)return"";const g=u.getCenter(),v=Math.round(100*u.getZoom())/100,b=Math.ceil((v*Math.LN2+Math.log(512/360/.5))/Math.LN10),T=Math.pow(10,b),D=Math.round(g.lng*T)/T,A=Math.round(g.lat*T)/T,k=u.getBearing(),L=u.getPitch();let B="";if(B+=i?`/${D}/${A}/${v}`:`${v}/${A}/${D}`,(k||L)&&(B+="/"+Math.round(10*k)/10),L&&(B+=`/${Math.round(L)}`),this._hashName){const j=this._hashName;let H=!1;const Z=d.window.location.hash.slice(1).split("&").map(G=>{const ne=G.split("=")[0];return ne===j?(H=!0,`${ne}=${B}`):G}).filter(G=>G);return H||Z.push(`${j}=${B}`),`#${Z.join("&")}`}return`#${B}`}_getCurrentHash(){const i=d.window.location.hash.replace("#","");if(this._hashName){let u;return i.split("&").map(g=>g.split("=")).forEach(g=>{g[0]===this._hashName&&(u=g)}),(u&&u[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const u=this._getCurrentHash();if(u.length>=3&&!u.some(g=>isNaN(g))){const g=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(u[3]||0):i.getBearing();return i.jumpTo({center:[+u[2],+u[1]],zoom:+u[0],bearing:g,pitch:+(u[4]||0)}),!0}return!1}_updateHashUnthrottled(){const i=d.window.location.href.replace(/(#.+)?$/,this.getHashString());d.window.history.replaceState(d.window.history.state,null,i)}}const va={linearity:.3,easing:d.bezier(0,0,.3,1)},Ud=d.extend({deceleration:2500,maxSpeed:1400},va),$e=d.extend({deceleration:20,maxSpeed:1400},va),Zt=d.extend({deceleration:1e3,maxSpeed:360},va),ru=d.extend({deceleration:1e3,maxSpeed:90},va);class Cr{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:d.exported.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,u=d.exported.now();for(;i.length>0&&u-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const u={zoom:0,bearing:0,pitch:0,pan:new d.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:b}of this._inertiaBuffer)u.zoom+=b.zoomDelta||0,u.bearing+=b.bearingDelta||0,u.pitch+=b.pitchDelta||0,b.panDelta&&u.pan._add(b.panDelta),b.around&&(u.around=b.around),b.pinchAround&&(u.pinchAround=b.pinchAround);const g=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,v={};if(u.pan.mag()){const b=mo(u.pan.mag(),g,d.extend({},Ud,i||{}));v.offset=u.pan.mult(b.amount/u.pan.mag()),v.center=this._map.transform.center,dl(v,b)}if(u.zoom){const b=mo(u.zoom,g,$e);v.zoom=this._map.transform.zoom+b.amount,dl(v,b)}if(u.bearing){const b=mo(u.bearing,g,Zt);v.bearing=this._map.transform.bearing+d.clamp(b.amount,-179,179),dl(v,b)}if(u.pitch){const b=mo(u.pitch,g,ru);v.pitch=this._map.transform.pitch+b.amount,dl(v,b)}if(v.zoom||v.bearing){const b=void 0===u.pinchAround?u.around:u.pinchAround;v.around=b?this._map.unproject(b):this._map.getCenter()}return this.clear(),v.noMoveStart=!0,v}}function dl(p,i){(!p.duration||p.duration<i.duration)&&(p.duration=i.duration,p.easing=i.easing)}function mo(p,i,u){const{maxSpeed:g,linearity:v,deceleration:b}=u,T=d.clamp(p*v/(i/1e3),-g,g),D=Math.abs(T)/(b*v);return{easing:u.easing,duration:1e3*D,amount:T*(D/2)}}class tr extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,g,v={}){const b=Et(u.getCanvasContainer(),g),T=u.unproject(b);super(i,d.extend({point:b,lngLat:T,originalEvent:g},v)),this._defaultPrevented=!1,this.target=u}}class xa extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,g){const v="touchend"===i?g.changedTouches:g.touches,b=Ti(u.getCanvasContainer(),v),T=b.map(A=>u.unproject(A)),D=b.reduce((A,k,L,B)=>A.add(k.div(B.length)),new d.pointGeometry(0,0));super(i,{points:b,point:D,lngLats:T,lngLat:u.unproject(D),originalEvent:g}),this._defaultPrevented=!1}}class iu extends d.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,u,g){super(i,{originalEvent:g}),this._defaultPrevented=!1}}class yh{constructor(i,u){this._map=i,this._clickTolerance=u.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new iu(i.type,this._map,i))}mousedown(i,u){return this._mousedownPos=u,this._firePreventable(new tr(i.type,this._map,i))}mouseup(i){this._map.fire(new tr(i.type,this._map,i))}preclick(i){const u=d.extend({},i);u.type="preclick",this._map.fire(new tr(u.type,this._map,u))}click(i,u){this._mousedownPos&&this._mousedownPos.dist(u)>=this._clickTolerance||(this.preclick(i),this._map.fire(new tr(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new tr(i.type,this._map,i))}mouseover(i){this._map.fire(new tr(i.type,this._map,i))}mouseout(i){this._map.fire(new tr(i.type,this._map,i))}touchstart(i){return this._firePreventable(new xa(i.type,this._map,i))}touchmove(i){this._map.fire(new xa(i.type,this._map,i))}touchend(i){this._map.fire(new xa(i.type,this._map,i))}touchcancel(i){this._map.fire(new xa(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class vh{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new tr(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new tr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new tr(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class bf{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=u.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,u){this.isEnabled()&&i.shiftKey&&0===i.button&&($n(),this._startPos=this._lastPos=u,this._active=!0)}mousemoveWindow(i,u){if(!this._active)return;const g=u;if(this._lastPos.equals(g)||!this._box&&g.dist(this._startPos)<this._clickTolerance)return;const v=this._startPos;this._lastPos=g,this._box||(this._box=Lt("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const b=Math.min(v.x,g.x),T=Math.max(v.x,g.x),D=Math.min(v.y,g.y),A=Math.max(v.y,g.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${b}px,${D}px)`,this._box.style.width=T-b+"px",this._box.style.height=A-D+"px")})}mouseupWindow(i,u){if(!this._active||0!==i.button)return;const g=this._startPos,v=u;if(this.reset(),Wa(),g.x!==v.x||g.y!==v.y)return this._map.fire(new d.Event("boxzoomend",{originalEvent:i})),{cameraAnimation:b=>b.fitScreenCoordinates(g,v,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}keydown(i){this._active&&27===i.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),Za(),delete this._startPos,delete this._lastPos}_fireEvent(i,u){return this._map.fire(new d.Event(i,{originalEvent:u}))}}function ba(p,i){const u={};for(let g=0;g<p.length;g++)u[p[g].identifier]=i[g];return u}class qr{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,u,g){(this.centroid||g.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=i.timeStamp),g.length===this.numTouches&&(this.centroid=function(v){const b=new d.pointGeometry(0,0);for(const T of v)b._add(T);return b.div(v.length)}(u),this.touches=ba(g,u)))}touchmove(i,u,g){if(this.aborted||!this.centroid)return;const v=ba(g,u);for(const b in this.touches){const T=this.touches[b],D=v[b];(!D||D.dist(T)>30)&&(this.aborted=!0)}}touchend(i,u,g){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),0===g.length){const v=!this.aborted&&this.centroid;if(this.reset(),v)return v}}}class Ji{constructor(i){this.singleTap=new qr(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,u,g){this.singleTap.touchstart(i,u,g)}touchmove(i,u,g){this.singleTap.touchmove(i,u,g)}touchend(i,u,g){const v=this.singleTap.touchend(i,u,g);if(v){const b=i.timeStamp-this.lastTime<500,T=!this.lastTap||this.lastTap.dist(v)<30;if(b&&T||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=v,this.count===this.numTaps)return this.reset(),v}}}class xh{constructor(){this._zoomIn=new Ji({numTouches:1,numTaps:2}),this._zoomOut=new Ji({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,u,g){this._zoomIn.touchstart(i,u,g),this._zoomOut.touchstart(i,u,g)}touchmove(i,u,g){this._zoomIn.touchmove(i,u,g),this._zoomOut.touchmove(i,u,g)}touchend(i,u,g){const v=this._zoomIn.touchend(i,u,g),b=this._zoomOut.touchend(i,u,g);return v?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()+1,around:T.unproject(v)},{originalEvent:i})}):b?(this._active=!0,i.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:T=>T.easeTo({duration:300,zoom:T.getZoom()-1,around:T.unproject(b)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const go={0:1,2:2};class Qi{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,u){return!1}_move(i,u){return{}}mousedown(i,u){if(this._lastPoint)return;const g=aa(i);this._correctButton(i,g)&&(this._lastPoint=u,this._eventButton=g)}mousemoveWindow(i,u){const g=this._lastPoint;if(g)if(i.preventDefault(),null!=this._eventButton&&function(v,b){const T=go[b];return void 0===v.buttons||(v.buttons&T)!==T}(i,this._eventButton))this.reset();else if(this._moved||!(u.dist(g)<this._clickTolerance))return this._moved=!0,this._lastPoint=u,this._move(g,u)}mouseupWindow(i){this._lastPoint&&aa(i)===this._eventButton&&(this._moved&&Wa(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class jd extends Qi{mousedown(i,u){super.mousedown(i,u),this._lastPoint&&(this._active=!0)}_correctButton(i,u){return 0===u&&!i.ctrlKey}_move(i,u){return{around:u,panDelta:u.sub(i)}}}class ou extends Qi{_correctButton(i,u){return 0===u&&i.ctrlKey||2===u}_move(i,u){const g=.8*(u.x-i.x);if(g)return this._active=!0,{bearingDelta:g}}contextmenu(i){i.preventDefault()}}class bh extends Qi{_correctButton(i,u){return 0===u&&i.ctrlKey||2===u}_move(i,u){const g=-.5*(u.y-i.y);if(g)return this._active=!0,{pitchDelta:g}}contextmenu(i){i.preventDefault()}}class $d{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=u.clickTolerance||1,this.reset(),d.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new d.pointGeometry(0,0)}touchstart(i,u,g){return this._calculateTransform(i,u,g)}touchmove(i,u,g){if(this._active&&!(g.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===g.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.preventDefault(),this._calculateTransform(i,u,g)}}touchend(i,u,g){this._calculateTransform(i,u,g),this._active&&g.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,u,g){g.length>0&&(this._active=!0);const v=ba(g,u),b=new d.pointGeometry(0,0),T=new d.pointGeometry(0,0);let D=0;for(const k in v){const L=v[k],B=this._touches[k];B&&(b._add(L),T._add(L.sub(B)),D++,v[k]=L)}if(this._touches=v,D<this._minTouches||!T.mag())return;const A=T.div(D);return this._sum._add(A),this._sum.mag()<this._clickTolerance?void 0:{around:b.div(D),panDelta:A}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Lt("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class pl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,u,g){return{}}touchstart(i,u,g){this._firstTwoTouches||g.length<2||(this._firstTwoTouches=[g[0].identifier,g[1].identifier],this._start([u[0],u[1]]))}touchmove(i,u,g){const v=this._firstTwoTouches;if(!v)return;i.preventDefault();const[b,T]=v,D=dr(g,u,b),A=dr(g,u,T);if(!D||!A)return;const k=this._aroundCenter?null:D.add(A).div(2);return this._move([D,A],k,i)}touchend(i,u,g){if(!this._firstTwoTouches)return;const[v,b]=this._firstTwoTouches,T=dr(g,u,v),D=dr(g,u,b);T&&D||(this._active&&Wa(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function dr(p,i,u){for(let g=0;g<p.length;g++)if(p[g].identifier===u)return i[g]}function wh(p,i){return Math.log(p/i)/Math.LN2}class su extends pl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,u){const g=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(wh(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:wh(this._distance,g),pinchAround:u}}}function Gd(p,i){return 180*p.angleWith(i)/Math.PI}class Hd extends pl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,u){const g=this._vector;if(this._vector=i[0].sub(i[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:Gd(this._vector,g),pinchAround:u}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const u=25/(Math.PI*this._minDiameter)*360,g=Gd(i,this._startVector);return Math.abs(g)<u}}function vi(p){return Math.abs(p.y)>Math.abs(p.x)}class Eh extends pl{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,vi(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,u,g){const v=this._lastPoints;if(!v)return;const b=i[0].sub(v[0]),T=i[1].sub(v[1]);return this._map._cooperativeGestures&&g.touches.length<3||(this._valid=this.gestureBeginsVertically(b,T,g.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(b.y+T.y)/2*-.5})}gestureBeginsVertically(i,u,g){if(void 0!==this._valid)return this._valid;const v=i.mag()>=2,b=u.mag()>=2;if(!v&&!b)return;if(!v||!b)return null==this._firstMove&&(this._firstMove=g),g-this._firstMove<100&&void 0;const T=i.y>0==u.y>0;return vi(i)&&vi(u)&&T}}const wa={panStep:100,bearingStep:15,pitchStep:10};class _o{constructor(){const i=wa;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let u=0,g=0,v=0,b=0,T=0;switch(i.keyCode){case 61:case 107:case 171:case 187:u=1;break;case 189:case 109:case 173:u=-1;break;case 37:i.shiftKey?g=-1:(i.preventDefault(),b=-1);break;case 39:i.shiftKey?g=1:(i.preventDefault(),b=1);break;case 38:i.shiftKey?v=1:(i.preventDefault(),T=-1);break;case 40:i.shiftKey?v=-1:(i.preventDefault(),T=1);break;default:return}return this._rotationDisabled&&(g=0,v=0),{cameraAnimation:D=>{const A=D.getZoom();D.easeTo({duration:300,easeId:"keyboardHandler",easing:ec,zoom:u?Math.round(A)+u*(i.shiftKey?2:1):A,bearing:D.getBearing()+g*this._bearingStep,pitch:D.getPitch()+v*this._pitchStep,offset:[-b*this._panStep,-T*this._panStep],center:D.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function ec(p){return p*(2-p)}const tt=4.000244140625;class qd{constructor(i,u){this._map=i,this._el=i.getCanvasContainer(),this._handler=u,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,d.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&"center"===i.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let u=i.deltaMode===d.window.WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const g=d.exported.now(),v=g-(this._lastWheelEventTime||0);this._lastWheelEventTime=g,0!==u&&u%tt==0?this._type="wheel":0!==u&&Math.abs(u)<4?this._type="trackpad":v>400?(this._type=null,this._lastValue=u,this._timeout=setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(v*u)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,u+=this._lastValue)),i.shiftKey&&u&&(u/=4),this._type&&(this._lastWheelEvent=i,this._delta-=u,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const u=Et(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:u,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform,u=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(0!==this._delta){const A="wheel"===this._type&&Math.abs(this._delta)>tt?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*A)));this._delta<0&&0!==k&&(k=1/k);const L=u(),B=Math.pow(2,L),j="number"==typeof this._targetZoom?i.zoomScale(this._targetZoom):B;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(j*k))),"wheel"===this._type&&(this._startZoom=u(),this._easing=this._smoothOutEasing(200)),this._delta=0}const g="number"==typeof this._targetZoom?this._targetZoom:u(),v=this._startZoom,b=this._easing;let T,D=!1;if("wheel"===this._type&&v&&b){const A=Math.min((d.exported.now()-this._lastWheelEventTime)/200,1),k=b(A);T=d.number(v,g,k),A<1?this._frameId||(this._frameId=!0):D=!0}else T=g,D=!0;return this._active=!0,D&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!D,zoomDelta:T-u(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let u=d.ease;if(this._prevEase){const g=this._prevEase,v=(d.exported.now()-g.start)/g.duration,b=g.easing(v+.01)-g.easing(v),T=.27/Math.sqrt(b*b+1e-4)*.01,D=Math.sqrt(.0729-T*T);u=d.bezier(T,D,.25,1)}return this._prevEase={start:d.exported.now(),duration:i,easing:u},u}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=Lt("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(d.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!d.window.document.fullscreenElement||!!d.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Zd{constructor(i,u){this._clickZoom=i,this._tapZoom=u}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Tr{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,u){return i.preventDefault(),{cameraAnimation:g=>{g.easeTo({duration:300,zoom:g.getZoom()+(i.shiftKey?-1:1),around:g.unproject(u)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class eo{constructor(){this._tap=new Ji({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,u,g){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?g.length>0&&(this._swipePoint=u[0],this._swipeTouch=g[0].identifier):this._tap.touchstart(i,u,g))}touchmove(i,u,g){if(this._tapTime){if(this._swipePoint){if(g[0].identifier!==this._swipeTouch)return;const v=u[0],b=v.y-this._swipePoint.y;return this._swipePoint=v,i.preventDefault(),this._active=!0,{zoomDelta:b/128}}}else this._tap.touchmove(i,u,g)}touchend(i,u,g){this._tapTime?this._swipePoint&&0===g.length&&this.reset():this._tap.touchend(i,u,g)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class or{constructor(i,u,g){this._el=i,this._mousePan=u,this._touchPan=g}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Wd{constructor(i,u,g){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=u,this._mousePitch=g}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Xd{constructor(i,u,g,v){this._el=i,this._touchZoom=u,this._touchRotate=g,this._tapDragZoom=v,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const tc=p=>p.zoom||p.drag||p.pitch||p.rotate;class Yd extends d.Event{}class Kd{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,u){const g=d.sub([],u,i);this.radius=d.length(g[2]<0?d.div([],g,this.constants):[g[0],g[1],0])}projectRay(i){d.div(i,i,this.constants),d.normalize(i,i),d.mul$1(i,i,this.constants);const u=d.scale$2([],i,this.radius);if(u[2]>0){const g=d.scale$2([],[0,0,1],d.dot(u,[0,0,1])),v=d.scale$2([],d.normalize([],[u[0],u[1],0]),this.radius),b=d.add([],u,d.scale$2([],d.sub([],d.add([],v,g),u),2));u[0]=b[0],u[1]=b[1]}return u}}function nc(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Ea{constructor(i,u){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Cr(i),this._bearingSnap=u.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Kd,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(u),d.bindAll(["handleEvent","handleWindowEvent"],this);const g=this._el;this._listeners=[[g,"touchstart",{passive:!0}],[g,"touchmove",{passive:!1}],[g,"touchend",void 0],[g,"touchcancel",void 0],[g,"mousedown",void 0],[g,"mousemove",void 0],[g,"mouseup",void 0],[d.window.document,"mousemove",{capture:!0}],[d.window.document,"mouseup",void 0],[g,"mouseover",void 0],[g,"mouseout",void 0],[g,"dblclick",void 0],[g,"click",void 0],[g,"keydown",{capture:!1}],[g,"keyup",void 0],[g,"wheel",{passive:!1}],[g,"contextmenu",void 0],[d.window,"blur",void 0]];for(const[v,b,T]of this._listeners)v.addEventListener(b,v===d.window.document?this.handleWindowEvent:this.handleEvent,T)}destroy(){for(const[i,u,g]of this._listeners)i.removeEventListener(u,i===d.window.document?this.handleWindowEvent:this.handleEvent,g)}_addDefaultHandlers(i){const u=this._map,g=u.getCanvasContainer();this._add("mapEvent",new yh(u,i));const v=u.boxZoom=new bf(u,i);this._add("boxZoom",v);const b=new xh,T=new Tr;u.doubleClickZoom=new Zd(T,b),this._add("tapZoom",b),this._add("clickZoom",T);const D=new eo;this._add("tapDragZoom",D);const A=u.touchPitch=new Eh(u);this._add("touchPitch",A);const k=new ou(i),L=new bh(i);u.dragRotate=new Wd(i,k,L),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",L,["mouseRotate"]);const B=new jd(i),j=new $d(u,i);u.dragPan=new or(g,B,j),this._add("mousePan",B),this._add("touchPan",j,["touchZoom","touchRotate"]);const H=new Hd,Z=new su;u.touchZoomRotate=new Xd(g,Z,H,D),this._add("touchRotate",H,["touchPan","touchZoom"]),this._add("touchZoom",Z,["touchPan","touchRotate"]),this._add("blockableMapEvent",new vh(u));const G=u.scrollZoom=new qd(u,this);this._add("scrollZoom",G,["mousePan"]);const ne=u.keyboard=new _o;this._add("keyboard",ne);for(const W of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[W]&&u[W].enable(i[W])}_add(i,u,g){this._handlers.push({handlerName:i,handler:u,allowed:g}),this._handlersById[i]=u}stop(i){if(!this._updatingCamera){for(const{handler:u}of this._handlers)u.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[]}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!tc(this._eventsInProgress)||this.isZooming()}_blockedByActive(i,u,g){for(const v in i)if(v!==g&&(!u||u.indexOf(v)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const u=[];for(const g of i)this._el.contains(g.target)&&u.push(g);return u}handleEvent(i,u){this._updatingCamera=!0;const g="renderFrame"===i.type,v=g?void 0:i,b={needsRenderFrame:!1},T={},D={},A=i.touches?this._getMapTouches(i.touches):void 0,k=A?Ti(this._el,A):g?void 0:Et(this._el,i);for(const{handlerName:j,handler:H,allowed:Z}of this._handlers){if(!H.isEnabled())continue;let G;this._blockedByActive(D,Z,j)?H.reset():H[u||i.type]&&(G=H[u||i.type](i,k,A),this.mergeHandlerResult(b,T,G,j,v),G&&G.needsRenderFrame&&this._triggerRenderFrame()),(G||H.isActive())&&(D[j]=H)}const L={};for(const j in this._previousActiveHandlers)D[j]||(L[j]=v);this._previousActiveHandlers=D,(Object.keys(L).length||nc(b))&&(this._changes.push([b,T,L]),this._triggerRenderFrame()),(Object.keys(D).length||nc(b))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:B}=b;B&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],B(this._map))}mergeHandlerResult(i,u,g,v,b){if(!g)return;d.extend(i,g);const T={handlerName:v,originalEvent:g.originalEvent||b};void 0!==g.zoomDelta&&(u.zoom=T),void 0!==g.panDelta&&(u.drag=T),void 0!==g.pitchDelta&&(u.pitch=T),void 0!==g.bearingDelta&&(u.rotate=T)}_applyChanges(){const i={},u={},g={};for(const[v,b,T]of this._changes)v.panDelta&&(i.panDelta=(i.panDelta||new d.pointGeometry(0,0))._add(v.panDelta)),v.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+v.zoomDelta),v.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+v.bearingDelta),v.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+v.pitchDelta),void 0!==v.around&&(i.around=v.around),void 0!==v.aroundCoord&&(i.aroundCoord=v.aroundCoord),void 0!==v.pinchAround&&(i.pinchAround=v.pinchAround),v.noInertia&&(i.noInertia=v.noInertia),d.extend(u,b),d.extend(g,T);this._updateMapTransform(i,u,g),this._changes=[]}_updateMapTransform(i,u,g){const v=this._map,b=v.transform,T=Q=>[Q.x,Q.y,Q.z];if((Q=>{const q=this._eventsInProgress.drag;return q&&!this._handlersById[q.handlerName].isActive()})()&&!nc(i)){const Q=b.zoom;b.cameraElevationReference="sea",b.recenterOnTerrain(),b.cameraElevationReference="ground",Q!==b.zoom&&this._map._update(!0)}if(!nc(i))return void this._fireEvents(u,g,!0);let{panDelta:D,zoomDelta:A,bearingDelta:k,pitchDelta:L,around:B,aroundCoord:j,pinchAround:H}=i;void 0!==H&&(B=H),(Q=>u.drag&&!this._eventsInProgress.drag)()&&B&&(this._dragOrigin=T(b.pointCoordinate3D(B)),this._trackingEllipsoid.setup(b._camera.position,this._dragOrigin)),b.cameraElevationReference="sea",v._stop(!0),B=B||v.transform.centerPoint,k&&(b.bearing+=k),L&&(b.pitch+=L),b._updateCameraState();const Z=[0,0,0];if(D){const Q=b.pointCoordinate(B);if("globe"===b.projection.name){const q=d.latFromMercatorY(Q.y),le=b.center.lat,te=Math.min(d.mercatorZfromAltitude(1,q)/d.mercatorZfromAltitude(1,le),2);D=D.rotate(-b.angle),Z[0]=-D.x/b.worldSize*te,Z[1]=-D.y/b.worldSize*te}else{const q=b.pointCoordinate(B.sub(D));Q&&q&&(Z[0]=q.x-Q.x,Z[1]=q.y-Q.y)}}const G=b.zoom,ne=[0,0,0];if(A){const Q=T(j||b.pointCoordinate3D(B)),q={dir:d.normalize([],d.sub([],Q,b._camera.position))};if(q.dir[2]<0){const le=b.zoomDeltaToMovement(Q,A);d.scale$2(ne,q.dir,le)}}const W=d.add(Z,Z,ne);b._translateCameraConstrained(W),A&&Math.abs(b.zoom-G)>1e-4&&b.recenterOnTerrain(),b.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(u,g,!0)}_fireEvents(i,u,g){const v=tc(this._eventsInProgress),b=tc(i),T={};for(const L in i){const{originalEvent:B}=i[L];this._eventsInProgress[L]||(T[`${L}start`]=B),this._eventsInProgress[L]=i[L]}!v&&b&&this._fireEvent("movestart",b.originalEvent);for(const L in T)this._fireEvent(L,T[L]);b&&this._fireEvent("move",b.originalEvent);for(const L in i){const{originalEvent:B}=i[L];this._fireEvent(L,B)}const D={};let A;for(const L in this._eventsInProgress){const{handlerName:B,originalEvent:j}=this._eventsInProgress[L];this._handlersById[B].isActive()||(delete this._eventsInProgress[L],A=u[B]||j,D[`${L}end`]=A)}for(const L in D)this._fireEvent(L,D[L]);const k=tc(this._eventsInProgress);if(g&&(v||b)&&!k){this._updatingCamera=!0;const L=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),B=j=>0!==j&&-this._bearingSnap<j&&j<this._bearingSnap;L?(B(L.bearing||this._map.getBearing())&&(L.bearing=0),this._map.easeTo(L,{originalEvent:A})):(this._map.fire(new d.Event("moveend",{originalEvent:A})),B(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,u){this._map.fire(new d.Event(i,u?{originalEvent:u}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(i=>{this._frameId=void 0,this.handleEvent(new Yd("renderFrame",{timeStamp:i})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ca="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Ta extends d.Evented{constructor(i,u){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=u.bearingSnap,d.bindAll(["_renderFrameCallback"],this)}getCenter(){return new d.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(i,u){return this.jumpTo({center:i},u)}panBy(i,u,g){return i=d.pointGeometry.convert(i).mult(-1),this.panTo(this.transform.center,d.extend({offset:i},u),g)}panTo(i,u,g){return this.easeTo(d.extend({center:i},u),g)}getZoom(){return this.transform.zoom}setZoom(i,u){return this.jumpTo({zoom:i},u),this}zoomTo(i,u,g){return this.easeTo(d.extend({zoom:i},u),g)}zoomIn(i,u){return this.zoomTo(this.getZoom()+1,i,u),this}zoomOut(i,u){return this.zoomTo(this.getZoom()-1,i,u),this}getBearing(){return this.transform.bearing}setBearing(i,u){return this.jumpTo({bearing:i},u),this}getPadding(){return this.transform.padding}setPadding(i,u){return this.jumpTo({padding:i},u),this}rotateTo(i,u,g){return this.easeTo(d.extend({bearing:i},u),g)}resetNorth(i,u){return this.rotateTo(0,d.extend({duration:1e3},i),u),this}resetNorthPitch(i,u){return this.easeTo(d.extend({bearing:0,pitch:0,duration:1e3},i),u),this}snapToNorth(i,u){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,u):this}getPitch(){return this.transform.pitch}setPitch(i,u){return this.jumpTo({pitch:i},u),this}cameraForBounds(i,u){"globe"===this.transform.projection.name&&d.warnOnce('Globe projection does not support cameraForBounds API, this API may behave unexpectedly."'),i=d.LngLatBounds.convert(i);const g=u&&u.bearing||0;return this._cameraForBoxAndBearing(i.getNorthWest(),i.getSouthEast(),g,u)}_extendCameraOptions(i){const u={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=d.extend({padding:u,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){const g=i.padding;i.padding={top:g,bottom:g,right:g,left:g}}return i.padding=d.extend(u,i.padding),i}_cameraForBoxAndBearing(i,u,g,v){const b=this._extendCameraOptions(v),T=this.transform,D=T.padding,A=T.project(d.LngLat.convert(i)),k=T.project(d.LngLat.convert(u)),L=new d.pointGeometry(A.x,k.y),B=new d.pointGeometry(k.x,A.y),j=-d.degToRad(g),H=A.rotate(j),Z=k.rotate(j),G=L.rotate(j),ne=B.rotate(j),W=new d.pointGeometry(Math.max(H.x,Z.x,G.x,ne.x),Math.max(H.y,Z.y,G.y,ne.y)),Q=new d.pointGeometry(Math.min(H.x,Z.x,G.x,ne.x),Math.min(H.y,Z.y,G.y,ne.y)),q=W.sub(Q),le=(T.width-((D.left||0)+(D.right||0)+b.padding.left+b.padding.right))/q.x,te=(T.height-((D.top||0)+(D.bottom||0)+b.padding.top+b.padding.bottom))/q.y;if(te<0||le<0)return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const re=Math.min(T.scaleZoom(T.scale*Math.min(le,te)),b.maxZoom),ue="number"==typeof b.offset.x&&"number"==typeof b.offset.y?new d.pointGeometry(b.offset.x,b.offset.y):d.pointGeometry.convert(b.offset),Ce=new d.pointGeometry((b.padding.left-b.padding.right)/2,(b.padding.top-b.padding.bottom)/2).rotate(g*Math.PI/180),Se=ue.add(Ce).mult(T.scale/T.zoomScale(re));return{center:T.unproject(A.add(k).div(2).sub(Se)),zoom:re,bearing:g}}_cameraForBox(i,u,g,v,b){const T=this._extendCameraOptions(b);g=g||0,v=v||0,i=d.LngLat.convert(i),u=d.LngLat.convert(u);const D=this.transform.clone();D.padding=T.padding;const A=this.getFreeCameraOptions(),k=new d.LngLat(.5*(i.lng+u.lng),.5*(i.lat+u.lat)),L=.5*(g+v);if(D._camera.position[2]<d.mercatorZfromAltitude(L,k.lat))return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");A.lookAtPoint(k),D.setFreeCameraOptions(A);const B=d.MercatorCoordinate.fromLngLat(i),j=d.MercatorCoordinate.fromLngLat(u),H=D.pointRayIntersection(D.centerPoint,L),Z=[(G=D.rayIntersectionCoordinate(H)).x,G.y,G.z];var G;const ne=D.screenPointToMercatorRay(D.centerPoint),W="globe"!==D.projection.name;let Q,q=0;do{const le=Math.floor(D.zoom),te=1<<le,re=Math.min(te*B.x,te*j.x),ue=Math.min(te*B.y,te*j.y),Ce=Math.max(te*B.x,te*j.x),Se=Math.max(te*B.y,te*j.y),be=new d.Aabb([re,ue,g],[Ce,Se,v]),Ve=d.Frustum.fromInvProjectionMatrix(D.invProjMatrix,D.worldSize,le,W);if(2!==be.intersects(Ve)){Q&&(D._camera.position=d.scaleAndAdd([],D._camera.position,ne.dir,-Q),D._updateStateFromCamera());break}const ie=d.sub([],D._camera.position,Z);Q=.5*d.length(ie),D._camera.position=d.scaleAndAdd([],D._camera.position,ne.dir,Q);try{D._updateStateFromCamera()}catch(ve){return void d.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++q<10);return{center:D.center,zoom:D.zoom,bearing:D.bearing,pitch:D.pitch}}fitBounds(i,u,g){return"globe"===this.transform.projection.name&&d.warnOnce("Globe projection does not support fitBounds API, this API may behave unexpectedly."),this._fitInternal(this.cameraForBounds(i,u),u,g)}_raycastElevationBox(i,u){const g=this.transform.elevation;if(!g)return;const v=new d.pointGeometry(i.x,u.y),b=new d.pointGeometry(u.x,i.y),T=g.pointCoordinate(i);if(!T)return;const D=g.pointCoordinate(u);if(!D)return;const A=g.pointCoordinate(v);if(!A)return;const k=g.pointCoordinate(b);if(!k)return;const L=new d.MercatorCoordinate(T[0],T[1]).toLngLat(),B=new d.MercatorCoordinate(D[0],D[1]).toLngLat(),j=new d.MercatorCoordinate(A[0],A[1]).toLngLat(),H=new d.MercatorCoordinate(k[0],k[1]).toLngLat(),Z=Math.min(L.lng,Math.min(B.lng,Math.min(j.lng,H.lng))),G=Math.min(L.lat,Math.min(B.lat,Math.min(j.lat,H.lat))),ne=Math.max(L.lng,Math.max(B.lng,Math.max(j.lng,H.lng))),W=Math.max(L.lat,Math.max(B.lat,Math.max(j.lat,H.lat))),Q=Math.min(T[3],Math.min(D[3],Math.min(A[3],k[3]))),q=Math.max(T[3],Math.max(D[3],Math.max(A[3],k[3])));return{minLngLat:new d.LngLat(Z,G),maxLngLat:new d.LngLat(ne,W),minAltitude:Q,maxAltitude:q}}fitScreenCoordinates(i,u,g,v,b){let T,D,A,k;"globe"===this.transform.projection.name&&d.warnOnce("Globe projection does not support fitScreenCoordinates API, this API may behave unexpectedly.");const L=d.pointGeometry.convert(i),B=d.pointGeometry.convert(u),j=this._raycastElevationBox(L,B);if(j)T=j.minLngLat,D=j.maxLngLat,A=j.minAltitude,k=j.maxAltitude;else{if(this.transform.anyCornerOffEdge(L,B))return this;T=this.transform.pointLocation(L),D=this.transform.pointLocation(B)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(d.pointGeometry.convert(i)),this.transform.pointLocation(d.pointGeometry.convert(u)),g,v):this._cameraForBox(T,D,A,k,v),v,b)}_fitInternal(i,u,g){return i?(delete(u=d.extend(i,u)).padding,u.linear?this.easeTo(u,g):this.flyTo(u,g)):this}jumpTo(i,u){this.stop();const g=i.preloadOnly?this.transform.clone():this.transform;let v=!1,b=!1,T=!1;return"zoom"in i&&g.zoom!==+i.zoom&&(v=!0,g.zoom=+i.zoom),void 0!==i.center&&(g.center=d.LngLat.convert(i.center)),"bearing"in i&&g.bearing!==+i.bearing&&(b=!0,g.bearing=+i.bearing),"pitch"in i&&g.pitch!==+i.pitch&&(T=!0,g.pitch=+i.pitch),null==i.padding||g.isPaddingEqual(i.padding)||(g.padding=i.padding),i.preloadOnly?(this._preloadTiles(g),this):(this.fire(new d.Event("movestart",u)).fire(new d.Event("move",u)),v&&this.fire(new d.Event("zoomstart",u)).fire(new d.Event("zoom",u)).fire(new d.Event("zoomend",u)),b&&this.fire(new d.Event("rotatestart",u)).fire(new d.Event("rotate",u)).fire(new d.Event("rotateend",u)),T&&this.fire(new d.Event("pitchstart",u)).fire(new d.Event("pitch",u)).fire(new d.Event("pitchend",u)),this.fire(new d.Event("moveend",u)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||d.warnOnce(Ca),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,u){const g=this.transform;if(!g.projection.supportsFreeCamera)return d.warnOnce(Ca),this;this.stop();const v=g.zoom,b=g.pitch,T=g.bearing;g.setFreeCameraOptions(i);const D=v!==g.zoom,A=b!==g.pitch,k=T!==g.bearing;return this.fire(new d.Event("movestart",u)).fire(new d.Event("move",u)),D&&this.fire(new d.Event("zoomstart",u)).fire(new d.Event("zoom",u)).fire(new d.Event("zoomend",u)),k&&this.fire(new d.Event("rotatestart",u)).fire(new d.Event("rotate",u)).fire(new d.Event("rotateend",u)),A&&this.fire(new d.Event("pitchstart",u)).fire(new d.Event("pitch",u)).fire(new d.Event("pitchend",u)),this.fire(new d.Event("moveend",u)),this}easeTo(i,u){this._stop(!1,i.easeId),(!1===(i=d.extend({offset:[0,0],duration:500,easing:d.ease},i)).animate||!i.essential&&d.exported.prefersReducedMotion)&&(i.duration=0);const g=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),D=this.getPadding(),A="zoom"in i?+i.zoom:v,k="bearing"in i?this._normalizeBearing(i.bearing,b):b,L="pitch"in i?+i.pitch:T,B="padding"in i?i.padding:g.padding,j=d.pointGeometry.convert(i.offset);let H,Z,G;if("globe"===g.projection.name){const Se=d.MercatorCoordinate.fromLngLat(g.center),be=j.rotate(-g.angle);Se.x+=be.x/g.worldSize,Se.y+=be.y/g.worldSize;const Ve=Se.toLngLat(),ie=d.LngLat.convert(i.center||Ve);this._normalizeCenter(ie),H=g.centerPoint.add(be),Z=new d.pointGeometry(Se.x,Se.y).mult(g.worldSize),G=new d.pointGeometry(d.mercatorXfromLng(ie.lng),d.mercatorYfromLat(ie.lat)).mult(g.worldSize).sub(Z)}else{H=g.centerPoint.add(j);const Se=g.pointLocation(H),be=d.LngLat.convert(i.center||Se);this._normalizeCenter(be),Z=g.project(Se),G=g.project(be).sub(Z)}const ne=g.zoomScale(A-v);let W,Q;i.around&&(W=d.LngLat.convert(i.around),Q=g.locationPoint(W));const q=this._zooming||A!==v,le=this._rotating||b!==k,te=this._pitching||L!==T,re=!g.isPaddingEqual(B),ue=Se=>be=>{if(q&&(Se.zoom=d.number(v,A,be)),le&&(Se.bearing=d.number(b,k,be)),te&&(Se.pitch=d.number(T,L,be)),re&&(Se.interpolatePadding(D,B,be),H=Se.centerPoint.add(j)),W)Se.setLocationAtPoint(W,Q);else{const Ve=Se.zoomScale(Se.zoom-v),ie=A>v?Math.min(2,ne):Math.max(.5,ne),ve=Math.pow(ie,1-be),Ie=Se.unproject(Z.add(G.mult(be*ve)).mult(Ve));Se.setLocationAtPoint(Se.renderWorldCopies?Ie.wrap():Ie,H)}return i.preloadOnly||this._fireMoveEvents(u),Se};if(i.preloadOnly){const Se=this._emulate(ue,i.duration,g);return this._preloadTiles(Se),this}const Ce={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=q,this._rotating=le,this._pitching=te,this._padding=re,this._easeId=i.easeId,this._prepareEase(u,i.noMoveStart,Ce),this._ease(ue(g),Se=>{g.recenterOnTerrain(),this._afterEase(u,Se)},i),this}_prepareEase(i,u,g={}){this._moving=!0,this.transform.cameraElevationReference="sea",u||g.moving||this.fire(new d.Event("movestart",i)),this._zooming&&!g.zooming&&this.fire(new d.Event("zoomstart",i)),this._rotating&&!g.rotating&&this.fire(new d.Event("rotatestart",i)),this._pitching&&!g.pitching&&this.fire(new d.Event("pitchstart",i))}_fireMoveEvents(i){this.fire(new d.Event("move",i)),this._zooming&&this.fire(new d.Event("zoom",i)),this._rotating&&this.fire(new d.Event("rotate",i)),this._pitching&&this.fire(new d.Event("pitch",i))}_afterEase(i,u){if(this._easeId&&u&&this._easeId===u)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const g=this._zooming,v=this._rotating,b=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,g&&this.fire(new d.Event("zoomend",i)),v&&this.fire(new d.Event("rotateend",i)),b&&this.fire(new d.Event("pitchend",i)),this.fire(new d.Event("moveend",i))}flyTo(i,u){if(!i.essential&&d.exported.prefersReducedMotion){const Ke=d.pick(i,["center","zoom","bearing","pitch","around"]);return this.jumpTo(Ke,u)}this.stop(),i=d.extend({offset:[0,0],speed:1.2,curve:1.42,easing:d.ease},i);const g=this.transform,v=this.getZoom(),b=this.getBearing(),T=this.getPitch(),D=this.getPadding(),A="zoom"in i?d.clamp(+i.zoom,g.minZoom,g.maxZoom):v,k="bearing"in i?this._normalizeBearing(i.bearing,b):b,L="pitch"in i?+i.pitch:T,B="padding"in i?i.padding:g.padding,j=g.zoomScale(A-v),H=d.pointGeometry.convert(i.offset);let Z=g.centerPoint.add(H);const G=g.pointLocation(Z),ne=d.LngLat.convert(i.center||G);this._normalizeCenter(ne);const W=g.project(G),Q=g.project(ne).sub(W);let q=i.curve;const le=Math.max(g.width,g.height),te=le/j,re=Q.mag();if("minZoom"in i){const Ke=d.clamp(Math.min(i.minZoom,v,A),g.minZoom,g.maxZoom),We=le/g.zoomScale(Ke-v);q=Math.sqrt(We/re*2)}const ue=q*q;function Ce(Ke){const We=(te*te-le*le+(Ke?-1:1)*ue*ue*re*re)/(2*(Ke?te:le)*ue*re);return Math.log(Math.sqrt(We*We+1)-We)}function Se(Ke){return(Math.exp(Ke)-Math.exp(-Ke))/2}function be(Ke){return(Math.exp(Ke)+Math.exp(-Ke))/2}const Ve=Ce(0);let ie=function(Ke){return be(Ve)/be(Ve+q*Ke)},ve=function(Ke){return le*((be(Ve)*(Se(We=Ve+q*Ke)/be(We))-Se(Ve))/ue)/re;var We},Ie=(Ce(1)-Ve)/q;if(Math.abs(re)<1e-6||!isFinite(Ie)){if(Math.abs(le-te)<1e-6)return this.easeTo(i,u);const Ke=te<le?-1:1;Ie=Math.abs(Math.log(te/le))/q,ve=function(){return 0},ie=function(We){return Math.exp(Ke*q*We)}}i.duration="duration"in i?+i.duration:1e3*Ie/("screenSpeed"in i?+i.screenSpeed/q:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const Ze=b!==k,Me=L!==T,it=!g.isPaddingEqual(B),He=Ke=>We=>{const Xe=We*Ie,st=1/ie(Xe);Ke.zoom=1===We?A:v+Ke.scaleZoom(st),Ze&&(Ke.bearing=d.number(b,k,We)),Me&&(Ke.pitch=d.number(T,L,We)),it&&(Ke.interpolatePadding(D,B,We),Z=Ke.centerPoint.add(H));const qe=1===We?ne:Ke.unproject(W.add(Q.mult(ve(Xe))).mult(st));return Ke.setLocationAtPoint(Ke.renderWorldCopies?qe.wrap():qe,Z),Ke._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(u),Ke};if(i.preloadOnly){const Ke=this._emulate(He,i.duration,g);return this._preloadTiles(Ke),this}return this._zooming=!0,this._rotating=Ze,this._pitching=Me,this._padding=it,this._prepareEase(u,!1),this._ease(He(g),()=>this._afterEase(u),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(i,u){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const g=this._onEaseEnd;this._onEaseEnd=void 0,g.call(this,u)}if(!i){const g=this.handlers;g&&g.stop(!1)}return this}_ease(i,u,g){!1===g.animate||0===g.duration?(i(1),u()):(this._easeStart=d.exported.now(),this._easeOptions=g,this._onEaseFrame=i,this._onEaseEnd=u,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((d.exported.now()-this._easeStart)/this._easeOptions.duration,1),u=this._onEaseFrame;u&&u(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,u){i=d.wrap(i,-180,180);const g=Math.abs(i-u);return Math.abs(i-360-u)<g&&(i-=360),Math.abs(i+360-u)<g&&(i+=360),i}_normalizeCenter(i){const u=this.transform;if(!u.renderWorldCopies||u.maxBounds)return;const g=i.lng-u.center.lng;i.lng+=g>180?-360:g<-180?360:0}_emulate(i,u,g){const v=Math.ceil(15*u/1e3),b=[],T=i(g.clone());for(let D=0;D<=v;D++){const A=T(D/v);b.push(A.clone())}return b}}class rc{constructor(i={}){this.options=i,d.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const u=this.options&&this.options.compact;return this._map=i,this._container=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Lt("button","mapboxgl-ctrl-attrib-button",this._container),Lt("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Lt("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),u&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===u&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(i,u){const g=this._map._getUIString(`AttributionControl.${u}`);i.setAttribute("aria-label",g),i.removeAttribute("title"),i.firstElementChild&&i.firstElementChild.setAttribute("title",g)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const u=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||d.config.ACCESS_TOKEN}];if(i){const g=u.reduce((v,b,T)=>(b.value&&(v+=`${b.key}=${b.value}${T<u.length-1?"&":""}`),v),"?");i.href=`${d.config.FEEDBACK_URL}/${g}${this._map._hash?this._map._hash.getHashString(!0):""}`,i.rel="noopener nofollow",this._setElementTitle(i,"MapFeedback")}}_updateData(i){!i||"metadata"!==i.sourceDataType&&"visibility"!==i.sourceDataType&&"style"!==i.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}const u=this._map.style._sourceCaches;for(const v in u){const b=u[v];if(b.used){const T=b.getSource();T.attribution&&i.indexOf(T.attribution)<0&&i.push(T.attribution)}}i.sort((v,b)=>v.length-b.length),i=i.filter((v,b)=>{for(let T=b+1;T<i.length;T++)if(i[T].indexOf(v)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const g=i.join(" | ");g!==this._attribHTML&&(this._attribHTML=g,i.length?(this._innerContainer.innerHTML=g,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class au{constructor(){d.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=Lt("div","mapboxgl-ctrl");const u=Lt("a","mapboxgl-ctrl-logo");return u.target="_blank",u.rel="noopener nofollow",u.href="https://www.mapbox.com/",u.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),u.setAttribute("rel","noopener nofollow"),this._container.appendChild(u),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&"metadata"!==i.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(0===Object.entries(i).length)return!0;for(const u in i){const g=i[u].getSource();if(g.hasOwnProperty("mapbox_logo")&&!g.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const u=i[0];this._map.getCanvasContainer().offsetWidth<250?u.classList.add("mapboxgl-compact"):u.classList.remove("mapboxgl-compact")}}}class Ch{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const u=++this._id;return this._queue.push({callback:i,id:u,cancelled:!1}),u}remove(i){const u=this._currentlyRunning,g=u?this._queue.concat(u):this._queue;for(const v of g)if(v.id===i)return void(v.cancelled=!0)}run(i=0){const u=this._currentlyRunning=this._queue;this._queue=[];for(const g of u)if(!g.cancelled&&(g.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function No(p,i,u){if(p=new d.LngLat(p.lng,p.lat),i){const g=new d.LngLat(p.lng-360,p.lat),v=new d.LngLat(p.lng+360,p.lat),b=360*Math.ceil(Math.abs(p.lng-u.center.lng)/360),T=u.locationPoint(p).distSqr(i),D=i.x<0||i.y<0||i.x>u.width||i.y>u.height;u.locationPoint(g).distSqr(i)<T&&(D||Math.abs(g.lng-u.center.lng)<b)?p=g:u.locationPoint(v).distSqr(i)<T&&(D||Math.abs(v.lng-u.center.lng)<b)&&(p=v)}for(;Math.abs(p.lng-u.center.lng)>180;){const g=u.locationPoint(p);if(g.x>=0&&g.y>=0&&g.x<=u.width&&g.y<=u.height)break;p.lng>u.center.lng?p.lng-=360:p.lng+=360}return p}const Ns={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class lu extends d.Evented{constructor(i,u){if(super(),(i instanceof d.window.HTMLElement||u)&&(i=d.extend({element:i},u)),d.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=i&&i.anchor||"center",this._color=i&&i.color||"#3FB1CE",this._scale=i&&i.scale||1,this._draggable=i&&i.draggable||!1,this._clickTolerance=i&&i.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=i&&i.rotation||0,this._rotationAlignment=i&&i.rotationAlignment||"auto",this._pitchAlignment=i&&i.pitchAlignment&&i.pitchAlignment||"auto",this._updateMoving=()=>this._update(!0),i&&i.element)this._element=i.element,this._offset=d.pointGeometry.convert(i&&i.offset||[0,0]);else{this._defaultMarker=!0,this._element=Lt("div");const v=41,b=27,T=hn("svg",{display:"block",height:v*this._scale+"px",width:b*this._scale+"px",viewBox:`0 0 ${b} ${v}`},this._element),D=hn("radialGradient",{id:"shadowGradient"},hn("defs",{},T));hn("stop",{offset:"10%","stop-opacity":.4},D),hn("stop",{offset:"100%","stop-opacity":.05},D),hn("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},T),hn("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},T),hn("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},T),hn("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},T),this._offset=d.pointGeometry.convert(i&&i.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",v=>{v.preventDefault()}),this._element.addEventListener("mousedown",v=>{v.preventDefault()});const g=this._element.classList;for(const v in Ns)g.remove(`mapboxgl-marker-anchor-${v}`);g.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=d.LngLat.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const v=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[v,-1*(24.6+v)],"bottom-right":[-v,-1*(24.6+v)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=i,i._marker=this,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const u=i.code,g=i.charCode||i.keyCode;"Space"!==u&&"Enter"!==u&&32!==g&&13!==g||this.togglePopup()}_onMapClick(i){const u=i.originalEvent.target,g=this._element;this._popup&&(u===g||g.contains(u))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map;if(!i)return!1;const u=i.unproject(this._pos),g=i.getFreeCameraOptions();if(!g.position)return!1;const v=g.position.toLngLat();return v.distanceTo(u)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const u=this._pos;if(!u||u.x<0||u.x>i.transform.width||u.y<0||u.y>i.transform.height)return void this._clearFadeTimer();const g=i.unproject(u);let v;i._usingGlobe()&&d.isLngLatBehindGlobe(i.transform,this._lngLat)?v=0:(v=1-i._queryFogOpacity(g),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(v*=.2)),this._element.style.opacity=`${v}`,this._element.style.pointerEvents=v>0?"auto":"none",this._popup&&this._popup._setOpacity(v),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const u=this._calculateXYTransform()+this._calculateZTransform(),g=this._offset.mult(this._scale);this._element.style.transform=`\n            translate(${i.x}px,${i.y}px) ${Ns[this._anchor]}\n            ${u}\n            translate(${g.x}px,${g.y}px)\n        `}_calculateXYTransform(){const i=this._pos,u=this._map;if("map"!==this.getPitchAlignment()||!u||!i)return"";if(!u._usingGlobe()){const A=u.getPitch();return A?`rotateX(${A}deg)`:""}const g=d.radToDeg(d.globeTiltAtLngLat(u.transform,this._lngLat)),v=i.sub(d.globeCenterToScreenPoint(u.transform)),b=g/(Math.abs(v.x)+Math.abs(v.y)),T=v.x*b,D=-v.y*b;return D||T?`rotateX(${D}deg) rotateY(${T}deg)`:""}_calculateZTransform(){const i=this._calculateRotation();return i?`rotateZ(${i}deg)`:""}_calculateRotation(){if("viewport"===this._rotationAlignment||"auto"===this._rotationAlignment)return this._rotation;if(this._map&&"map"===this._rotationAlignment){const i=this._map;if(this._pos&&i&&i._usingGlobe()){const u=i.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat+.001)),g=i.project(new d.LngLat(this._lngLat.lng,this._lngLat.lat-.001)).sub(u);return this._rotation+d.radToDeg(Math.atan2(g.y,g.x))-90}return this._rotation-this._map.getBearing()}return 0}_update(i){d.window.cancelAnimationFrame(this._updateFrameId);const u=this._map;u&&(u.transform.renderWorldCopies&&(this._lngLat=No(this._lngLat,this._pos,u.transform)),this._pos=u.project(this._lngLat),!0===i?this._updateFrameId=d.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),u._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(u._usingGlobe()||u.getTerrain()||u.getFog())&&!this._fadeTimer&&(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(i){return this._offset=d.pointGeometry.convert(i),this._update(),this}_onMove(i){const u=this._map;if(u){if(!this._isDragging){const g=this._clickTolerance||u._clickTolerance;this._isDragging=i.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=i.point.sub(this._positionDelta),this._lngLat=u.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new d.Event("dragstart"))),this.fire(new d.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new d.Event("dragend")),this._state="inactive"}_addDragHandler(i){const u=this._map;u&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(this._pos),this._pointerdownPos=i.point,this._state="pending",u.on("mousemove",this._onMove),u.on("touchmove",this._onMove),u.once("mouseup",this._onUp),u.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const u=this._map;return u&&(i?(u.on("mousedown",this._addDragHandler),u.on("touchstart",this._addDragHandler)):(u.off("mousedown",this._addDragHandler),u.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||"auto",this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||"auto",this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}}class Jd{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const u=d.easeCubicInOut((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-u)+this._end*u}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,u,g){this._start=this.getValue(u),this._end=i,this._startTime=u,this._endTime=u+g}}const Da={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},cu={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function uu(p){p.parentNode&&p.parentNode.removeChild(p)}const Qd={showCompass:!0,showZoom:!0,visualizePitch:!1};class wf{constructor(i,u,g=!1){this._clickTolerance=10,this.element=u,this.mouseRotate=new ou({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,g&&(this.mousePitch=new bh({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),d.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),u.addEventListener("mousedown",this.mousedown),u.addEventListener("touchstart",this.touchstart,{passive:!1}),u.addEventListener("touchmove",this.touchmove),u.addEventListener("touchend",this.touchend),u.addEventListener("touchcancel",this.reset)}down(i,u){this.mouseRotate.mousedown(i,u),this.mousePitch&&this.mousePitch.mousedown(i,u),$n()}move(i,u){const g=this.map,v=this.mouseRotate.mousemoveWindow(i,u),b=v&&v.bearingDelta;if(b&&g.setBearing(g.getBearing()+b),this.mousePitch){const T=this.mousePitch.mousemoveWindow(i,u),D=T&&T.pitchDelta;D&&g.setPitch(g.getPitch()+D)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart,{passive:!1}),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){Za(),d.window.removeEventListener("mousemove",this.mousemove),d.window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(d.extend({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Et(this.element,i)),d.window.addEventListener("mousemove",this.mousemove),d.window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Et(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){1!==i.targetTouches.length?this.reset():(this._startPos=this._lastPos=Ti(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){1!==i.targetTouches.length?this.reset():(this._lastPos=Ti(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){0===i.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const ep={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ic={maxWidth:100,unit:"metric"};function Vs(p,i,u,g,v,b){const T=function(A){const k=Math.pow(10,`${Math.floor(A)}`.length-1);let L=A/k;return L=L>=10?10:L>=5?5:L>=3?3:L>=2?2:L>=1?1:function(B){const j=Math.pow(10,Math.ceil(-Math.log(B)/Math.LN10));return Math.round(B*j)/j}(L),k*L}(u),D=T/u;b._requestDomTask(()=>{p.style.width=i*D+"px",p.innerHTML="nautical-mile"!==v?new Intl.NumberFormat(g,{style:"unit",unitDisplay:"narrow",unit:v}).format(T):`${T}&nbsp;nm`})}const hu={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},fl=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function oc(p=new d.pointGeometry(0,0),i="bottom"){if("number"==typeof p){const u=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(i){case"top":return new d.pointGeometry(0,p);case"top-left":return new d.pointGeometry(u,u);case"top-right":return new d.pointGeometry(-u,u);case"bottom":return new d.pointGeometry(0,-p);case"bottom-left":return new d.pointGeometry(u,-u);case"bottom-right":return new d.pointGeometry(-u,-u);case"left":return new d.pointGeometry(p,0);case"right":return new d.pointGeometry(-p,0)}return new d.pointGeometry(0,0)}return p instanceof d.pointGeometry||Array.isArray(p)?d.pointGeometry.convert(p):d.pointGeometry.convert(p[i]||[0,0])}const Sa={version:d.version,supported:Po,setRTLTextPlugin:d.setRTLTextPlugin,getRTLTextPluginStatus:d.getRTLTextPluginStatus,Map:class extends Ta{constructor(p){if(null!=(p=d.extend({},cu,p)).minZoom&&null!=p.maxZoom&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=p.minPitch&&null!=p.maxPitch&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=p.minPitch&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=p.maxPitch&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&d.isSafariWithAntialiasingBug(d.window)&&(p.antialias=!1,d.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new tu(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies),p),this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=p.collectResourceTiming,this._optimizeForTerrain=p.optimizeForTerrain,this._language="auto"===p.language?d.window.navigator.language:p.language,this._worldview=p.worldview,this._renderTaskQueue=new Ch,this._domRenderTaskQueue=new Ch,this._controls=[],this._markers=[],this._mapId=d.uniqueId(),this._locale=d.extend({},Da,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Jd(0),this._explicitProjection=null,this._requestManager=new d.RequestManager(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,"string"==typeof p.container){if(this._container=d.window.document.getElementById(p.container),!this._container)throw new Error(`Container '${p.container}' not found.`)}else{if(!(p.container instanceof d.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&d.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),d.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==d.window&&(d.window.addEventListener("online",this._onWindowOnline,!1),d.window.addEventListener("resize",this._onWindowResize,!1),d.window.addEventListener("orientationchange",this._onWindowResize,!1),d.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Ea(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,p.style&&this.setStyle(p.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this._hash=p.hash&&new nu("string"==typeof p.hash&&p.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch}),p.bounds&&(this.resize(),this.fitBounds(p.bounds,d.extend({},p.fitBoundsOptions,{duration:0})))),this.resize(),p.attributionControl&&this.addControl(new rc({customAttribution:p.customAttribution})),this._logoControl=new au,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",i=>{this._update("style"===i.dataType),this.fire(new d.Event(`${i.dataType}data`,i))}),this.on("dataloading",i=>{this.fire(new d.Event(`${i.dataType}dataloading`,i))})}_getMapId(){return this._mapId}addControl(p,i){if(void 0===i&&(i=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const u=p.onAdd(this);this._controls.push(p);const g=this._controlPositions[i];return-1!==i.indexOf("bottom")?g.insertBefore(u,g.firstChild):g.appendChild(u),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new d.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(p);return i>-1&&this._controls.splice(i,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new d.Event("movestart",p)).fire(new d.Event("move",p)),this.fire(new d.Event("resize",p)),i&&this.fire(new d.Event("moveend",p)),this}getBounds(){return"globe"===this.transform.projection.name&&d.warnOnce('Globe projection does not support getBounds API, this API may behave unexpectedly."'),this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(d.LngLatBounds.convert(p)),this._update()}setMinZoom(p){if((p=null==p?-2:p)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=null==p?22:p)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new d.Event("zoomstart")).fire(new d.Event("zoom")).fire(new d.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=null==p?0:p)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=null==p?85:p)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new d.Event("pitchstart")).fire(new d.Event("pitch")).fire(new d.Event("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this._update()}getLanguage(){return this._language}setLanguage(p){if(this._language="auto"===p?d.window.navigator.language:p,this.style)for(const i in this.style._sourceCaches){const u=this.style._sourceCaches[i]._source;u._setLanguage&&u._setLanguage(this._language)}for(const i of this._controls)i._setLanguage&&i._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){if(this._worldview=p,this.style)for(const i in this.style._sourceCaches){const u=this.style._sourceCaches[i]._source;u._setWorldview&&u._setWorldview(p)}return this}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}_usingGlobe(){return"globe"===this.transform.projection.name}setProjection(p){return this._lazyInitEmptyStyle(),p?"string"==typeof p&&(p={name:p}):p=null,this._updateProjection(p)}_updateProjection(p){const i=this.getProjection();null===p&&(this._explicitProjection=null);const u=p||this.getProjection();let g;if(u&&"globe"===u.name&&this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?(g=this.transform.setProjection({name:"mercator"}),this.transform.mercatorFromTransition=!0):(g=this.transform.setProjection(u),this.transform.mercatorFromTransition=!1),p&&(this._explicitProjection="globe"===p.name?{name:"globe",center:[0,0]}:this.transform.getProjection()),this.style.applyProjectionUpdate(),g){if("globe"===i.name&&"globe"===this.getProjection().name)this.style._forceSymbolLayerUpdate();else{this.painter.clearBackgroundTiles();for(const v in this.style._sourceCaches)this.style._sourceCaches[v].clearTiles()}this._update(!0)}return this}project(p){return this.transform.locationPoint3D(d.LngLat.convert(p))}unproject(p){return this.transform.pointLocation3D(d.pointGeometry.convert(p))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(p,i,u){if("mouseenter"===p||"mouseover"===p){let g=!1;const v=T=>{const D=i.filter(k=>this.getLayer(k)),A=D.length?this.queryRenderedFeatures(T.point,{layers:D}):[];A.length?g||(g=!0,u.call(this,new tr(p,this,T.originalEvent,{features:A}))):g=!1},b=()=>{g=!1};return{layers:new Set(i),listener:u,delegates:{mousemove:v,mouseout:b}}}if("mouseleave"===p||"mouseout"===p){let g=!1;const v=T=>{const D=i.filter(A=>this.getLayer(A));(D.length?this.queryRenderedFeatures(T.point,{layers:D}):[]).length?g=!0:g&&(g=!1,u.call(this,new tr(p,this,T.originalEvent)))},b=T=>{g&&(g=!1,u.call(this,new tr(p,this,T.originalEvent)))};return{layers:new Set(i),listener:u,delegates:{mousemove:v,mouseout:b}}}{const g=v=>{const b=i.filter(D=>this.getLayer(D)),T=b.length?this.queryRenderedFeatures(v.point,{layers:b}):[];T.length&&(v.features=T,u.call(this,v),delete v.features)};return{layers:new Set(i),listener:u,delegates:{[p]:g}}}}on(p,i,u){if(void 0===u)return super.on(p,i);Array.isArray(i)||(i=[i]);const g=this._createDelegatedListener(p,i,u);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(g);for(const v in g.delegates)this.on(v,g.delegates[v]);return this}once(p,i,u){if(void 0===u)return super.once(p,i);Array.isArray(i)||(i=[i]);const g=this._createDelegatedListener(p,i,u);for(const v in g.delegates)this.once(v,g.delegates[v]);return this}off(p,i,u){if(void 0===u)return super.off(p,i);i=new Set(Array.isArray(i)?i:[i]);const g=(b,T)=>{if(b.size!==T.size)return!1;for(const D of b)if(!T.has(D))return!1;return!0},v=this._delegatedListeners?this._delegatedListeners[p]:void 0;return v&&(b=>{for(let T=0;T<b.length;T++){const D=b[T];if(D.listener===u&&g(D.layers,i)){for(const A in D.delegates)this.off(A,D.delegates[A]);return b.splice(T,1),this}}})(v),this}queryRenderedFeatures(p,i){return this.style?(void 0!==i||void 0===p||p instanceof d.pointGeometry||Array.isArray(p)||(i=p,p=void 0),this.style.queryRenderedFeatures(p=p||[[0,0],[this.transform.width,this.transform.height]],i=i||{},this.transform)):[]}querySourceFeatures(p,i){return this.style.querySourceFeatures(p,i)}queryTerrainElevation(p,i){const u=this.transform.elevation;return u?(i=d.extend({},{exaggerated:!0},i),u.getAtPoint(d.MercatorCoordinate.fromLngLat(p),null,i.exaggerated)):null}setStyle(p,i){return!1!==(i=d.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i)).diff&&i.localIdeographFontFamily===this._localIdeographFontFamily&&i.localFontFamily===this._localFontFamily&&this.style&&p?(this._diffStyle(p,i),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(p,i))}_getUIString(p){const i=this._locale[p];if(null==i)throw new Error(`Missing UI string '${p}'`);return i}_updateStyle(p,i){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p&&(this.style=new ni(this,i||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof p?this.style.loadURL(p):this.style.loadJSON(p)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ni(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(p,i){if("string"==typeof p){const u=this._requestManager.normalizeStyleURL(p),g=this._requestManager.transformRequest(u,d.ResourceType.Style);d.getJSON(g,(v,b)=>{v?this.fire(new d.ErrorEvent(v)):b&&this._updateDiff(b,i)})}else"object"==typeof p&&this._updateDiff(p,i)}_updateDiff(p,i){try{this.style.setState(p)&&this._update(!0)}catch(u){d.warnOnce(`Unable to perform style diff: ${u.message||u.error||u}.  Rebuilding the style from scratch.`),this._updateStyle(p,i)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(d.warnOnce("There is no style added to the map."),!1)}addSource(p,i){return this._lazyInitEmptyStyle(),this.style.addSource(p,i),this._update(!0)}isSourceLoaded(p){return!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){const p=this.style&&this.style._sourceCaches;for(const i in p){const u=p[i]._tiles;for(const g in u){const v=u[g];if("loaded"!==v.state&&"errored"!==v.state)return!1}}return!0}addSourceType(p,i,u){this._lazyInitEmptyStyle(),this.style.addSourceType(p,i,u)}removeSource(p){return this.style.removeSource(p),this._updateTerrain(),this._update(!0)}getSource(p){return this.style.getSource(p)}addImage(p,i,{pixelRatio:u=1,sdf:g=!1,stretchX:v,stretchY:b,content:T}={}){if(this._lazyInitEmptyStyle(),i instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&i instanceof d.window.ImageBitmap){const{width:D,height:A,data:k}=d.exported.getImageData(i);this.style.addImage(p,{data:new d.RGBAImage({width:D,height:A},k),pixelRatio:u,stretchX:v,stretchY:b,content:T,sdf:g,version:0})}else if(void 0===i.width||void 0===i.height)this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:D,height:A}=i,k=i;this.style.addImage(p,{data:new d.RGBAImage({width:D,height:A},new Uint8Array(k.data)),pixelRatio:u,stretchX:v,stretchY:b,content:T,sdf:g,version:0,userImage:k}),k.onAdd&&k.onAdd(this,p)}}updateImage(p,i){const u=this.style.getImage(p);if(!u)return void this.fire(new d.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const g=i instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&i instanceof d.window.ImageBitmap?d.exported.getImageData(i):i,{width:v,height:b}=g;void 0!==v&&void 0!==b?v===u.data.width&&b===u.data.height?(u.data.replace(g.data,!(i instanceof d.window.HTMLImageElement||d.window.ImageBitmap&&i instanceof d.window.ImageBitmap)),this.style.updateImage(p,u)):this.fire(new d.ErrorEvent(new Error(`The width and height of the updated image (${v}, ${b})\n                must be that same as the previous version of the image\n                (${u.data.width}, ${u.data.height})`))):this.fire(new d.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(p){return p?!!this.style.getImage(p):(this.fire(new d.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(p)}loadImage(p,i){d.getImage(this._requestManager.transformRequest(p,d.ResourceType.Image),(u,g)=>{i(u,g instanceof d.window.HTMLImageElement?d.exported.getImageData(g):g)})}listImages(){return this.style.listImages()}addLayer(p,i){return this._lazyInitEmptyStyle(),this.style.addLayer(p,i),this._update(!0)}moveLayer(p,i){return this.style.moveLayer(p,i),this._update(!0)}removeLayer(p){return this.style.removeLayer(p),this._update(!0)}getLayer(p){return this.style.getLayer(p)}setLayerZoomRange(p,i,u){return this.style.setLayerZoomRange(p,i,u),this._update(!0)}setFilter(p,i,u={}){return this.style.setFilter(p,i,u),this._update(!0)}getFilter(p){return this.style.getFilter(p)}setPaintProperty(p,i,u,g={}){return this.style.setPaintProperty(p,i,u,g),this._update(!0)}getPaintProperty(p,i){return this.style.getPaintProperty(p,i)}setLayoutProperty(p,i,u,g={}){return this.style.setLayoutProperty(p,i,u,g),this._update(!0)}getLayoutProperty(p,i){return this.style.getLayoutProperty(p,i)}setLight(p,i={}){return this._lazyInitEmptyStyle(),this.style.setLight(p,i),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(d.LngLat.convert(p),this.transform):0}setFeatureState(p,i){return this.style.setFeatureState(p,i),this._update()}removeFeatureState(p,i){return this.style.removeFeatureState(p,i),this._update()}getFeatureState(p){return this.style.getFeatureState(p)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let u,g,v,b=this._container;for(;b&&(!g||!v);){const T=d.window.getComputedStyle(b).transform;T&&"none"!==T&&(u=T.match(/matrix.*\((.+)\)/)[1].split(", "),u[0]&&"0"!==u[0]&&"1"!==u[0]&&(g=u[0]),u[3]&&"0"!==u[3]&&"1"!==u[3]&&(v=u[3])),b=b.parentElement}this._containerWidth=g?Math.abs(p/g):p,this._containerHeight=v?Math.abs(i/v):i}_detectMissingCSS(){"rgb(250, 128, 114)"!==d.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&d.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=Lt("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=Lt("div","mapboxgl-canvas-container",p);this._interactive&&i.classList.add("mapboxgl-interactive"),this._canvas=Lt("canvas","mapboxgl-canvas",i),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const u=this._controlContainer=Lt("div","mapboxgl-control-container",p),g=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(v=>{g[v]=Lt("div",`mapboxgl-ctrl-${v}`,u)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,i){const u=d.exported.devicePixelRatio||1;this._canvas.width=u*Math.ceil(p),this._canvas.height=u*Math.ceil(i),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${i}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const i=this._markers.indexOf(p);-1!==i&&this._markers.splice(i,1)}_setupPainter(){const p=d.extend({},Po.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl",p)||this._canvas.getContext("experimental-webgl",p);i?(d.storeAuthState(i,!0),this.painter=new cl(i,this.transform),this.on("data",u=>{"source"===u.dataType&&this.painter.setTileLoadedFlag(!0)}),d.exported$1.testSupport(i)):this.fire(new d.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new d.Event("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.resize(),this._update(),this.fire(new d.Event("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let i;const u=this.painter.context.extTimerQuery,g=d.exported.now();if(this.listens("gpu-timing-frame")&&(i=u.createQueryEXT(),u.beginQueryEXT(u.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;"globe"===this.getProjection().name&&(this.transform.zoom>=d.GLOBE_ZOOM_THRESHOLD_MAX?"globe"===this.transform.projection.name&&this._updateProjection():"mercator"===this.transform.projection.name&&this._updateProjection());let v=!1;const b=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const A=this.transform.zoom,k=this.transform.pitch,L=d.exported.now();this.style.zoomHistory.update(A,L);const B=new d.EvaluationParameters(A,{now:L,fadeDuration:b,pitch:k,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),j=B.crossFadingFactor();1===j&&j===this._crossFadingFactor||(v=!0,this._crossFadingFactor=j),this.style.update(B)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let T=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),T=this._updateAverageElevation(g),this.style._updateSources(this.transform),this._forceMarkerUpdate()):T=this._updateAverageElevation(g),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,b,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:b,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new d.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new d.Event("load"))),this.style&&(this.style.hasTransitions()||v)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const A=d.exported.now()-g;u.endQueryEXT(u.TIME_ELAPSED_EXT,i),setTimeout(()=>{const k=u.getQueryObjectEXT(i,u.QUERY_RESULT_EXT)/1e6;u.deleteQueryEXT(i),this.fire(new d.Event("gpu-timing-frame",{cpuTime:A,gpuTime:k})),d.window.performance.mark("frame-gpu",{startTime:g,detail:{gpuTime:k}})},50)}if(this.listens("gpu-timing-layer")){const A=this.painter.collectGpuTimers();setTimeout(()=>{const k=this.painter.queryGpuTimers(A);this.fire(new d.Event("gpu-timing-layer",{layerTimes:k}))},50)}if(this.listens("gpu-timing-deferred-render")){const A=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const k=this.painter.queryGpuTimeDeferredRender(A);this.fire(new d.Event("gpu-timing-deferred-render",{gpuTime:k}))},50)}const D=this._sourcesDirty||this._styleDirty||this._placementDirty||T;if(D||this._repaint)this.triggerRepaint();else{const A=!this.isMoving()&&this.loaded();if(A&&(T=this._updateAverageElevation(g,!0)),T)this.triggerRepaint();else if(this._triggerFrame(!1),A&&(this.fire(new d.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new d.Event("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||D||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const p of this._markers)p._update()}_updateAverageElevation(p,i=!1){const u=g=>(this.transform.averageElevation=g,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&u(0);if((i||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const g=this.transform.averageElevation;let v=this.transform.sampleAverageElevation(),b=!1;this.transform.elevation&&(b=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const T=Math.abs(g-v);if(T>1){if(this._isInitialLoad||b)return this._averageElevation.jumpTo(v),u(v);this._averageElevation.easeTo(v,p,300)}else if(T>1e-4)return this._averageElevation.jumpTo(v),u(v)}return!!this._averageElevation.isEasing(p)&&u(this._averageElevation.getValue(p))}_authenticate(){d.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===d.AUTH_ERR_MSG||401===p.status)){const i=this.painter.context.gl;d.storeAuthState(i,!1),this._logoControl instanceof au&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new d.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),d.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const u=this.painter.context.gl,g=u.createFramebuffer();function v(b){u.framebufferTexture2D(u.FRAMEBUFFER,u.COLOR_ATTACHMENT0,u.TEXTURE_2D,b,0);const T=new Uint8Array(u.drawingBufferWidth*u.drawingBufferHeight*4);return u.readPixels(0,0,u.drawingBufferWidth,u.drawingBufferHeight,u.RGBA,u.UNSIGNED_BYTE,T),T}return u.bindFramebuffer(u.FRAMEBUFFER,g),this._canvasPixelComparison(v(p),i.canvasCopies.map(v),i.timeStamps)}_canvasPixelComparison(p,i,u){let g=u[1]-u[0];const v=p.length/4;for(let b=0;b<i.length;b++){const T=i[b];let D=0;for(let A=0;A<T.length;A+=4)T[A]===p[A]&&T[A+1]===p[A+1]&&T[A+2]===p[A+2]&&T[A+3]===p[A+3]&&(D+=1);g+=(u[b+2]-u[b+1])*(1-D/v)}return g}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==d.window&&(d.window.removeEventListener("resize",this._onWindowResize,!1),d.window.removeEventListener("orientationchange",this._onWindowResize,!1),d.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),d.window.removeEventListener("online",this._onWindowOnline,!1));const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),uu(this._canvasContainer),uu(this._controlContainer),uu(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),d.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new d.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=d.exported.frame(i=>{const u=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,u&&this._render(i)}))}_preloadTiles(p){const i=this.style?Object.values(this.style._sourceCaches):[];return d.asyncAll(i,(u,g)=>u._preloadTiles(p,g),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}_setCacheLimits(p,i){d.setCacheLimits(p,i)}get version(){return d.version}},NavigationControl:class{constructor(p){this.options=d.extend({},Qd,p),this._container=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",i=>i.preventDefault()),this.options.showZoom&&(d.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",i=>{this._map&&this._map.zoomIn({},{originalEvent:i})}),Lt("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",i=>{this._map&&this._map.zoomOut({},{originalEvent:i})}),Lt("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(d.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",i=>{const u=this._map;u&&(this.options.visualizePitch?u.resetNorthPitch({},{originalEvent:i}):u.resetNorth({},{originalEvent:i}))}),this._compassIcon=Lt("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const i=p.getZoom(),u=i===p.getMaxZoom(),g=i===p.getMinZoom();this._zoomInButton.disabled=u,this._zoomOutButton.disabled=g,this._zoomInButton.setAttribute("aria-disabled",u.toString()),this._zoomOutButton.setAttribute("aria-disabled",g.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=i)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wf(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,i){const u=Lt("button",p,this._container);return u.type="button",u.addEventListener("click",i),u}_setButtonTitle(p,i){if(!this._map)return;const u=this._map._getUIString(`NavigationControl.${i}`);p.setAttribute("aria-label",u),p.firstElementChild&&p.firstElementChild.setAttribute("title",u)}},GeolocateControl:class extends d.Evented{constructor(p){super(),this.options=d.extend({geolocation:d.window.navigator.geolocation},ep,p),d.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ql(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){void 0!==this._supportsGeolocation?p(this._supportsGeolocation):void 0!==d.window.navigator.permissions?d.window.navigator.permissions.query({name:"geolocation"}).then(i=>{this._supportsGeolocation="denied"!==i.state,p(this._supportsGeolocation)}):(this._supportsGeolocation=!!this.geolocation,p(this._supportsGeolocation))}_isOutOfMapMaxBounds(p){const i=this._map.getMaxBounds(),u=p.coords;return!!i&&(u.longitude<i.getWest()||u.longitude>i.getEast()||u.latitude<i.getSouth()||u.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new d.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(p),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("geolocate",p)),this._finish()}}_updateCamera(p){const i=new d.LngLat(p.coords.longitude,p.coords.latitude),u=p.coords.accuracy,g=this._map.getBearing(),v=d.extend({bearing:g},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(u),v,{geolocateSource:!0})}_updateMarker(p){if(p){const i=new d.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,i=d.mercatorZfromAltitude(1,p._center.lat)*p.worldSize,u=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${u}px`,this._circleElement.style.height=`${u}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(1===p.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===p.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new d.Event("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._container.addEventListener("contextmenu",i=>i.preventDefault()),this._geolocateButton=Lt("button","mapboxgl-ctrl-geolocate",this._container),Lt("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===p){d.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Lt("div","mapboxgl-user-location"),this._dotElement.appendChild(Lt("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(Lt("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new lu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=Lt("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new lu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",i=>{i.geolocateSource||"ACTIVE_LOCK"!==this._watchState||i.originalEvent&&"resize"===i.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new d.Event("trackuserlocationend")))})}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:!0===p.absolute&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return d.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new d.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new d.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new d.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{d.window.addEventListener("ondeviceorientationabsolute"in d.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==d.window.DeviceMotionEvent&&"function"==typeof d.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(i=>{"granted"===i&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),d.window.removeEventListener("deviceorientation",this._onDeviceOrientation),d.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:rc,ScaleControl:class{constructor(p){this.options=d.extend({},ic,p),d.bindAll(["_update","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){!function(p,i,u,g){const v=g&&g.maxWidth||100,b=p._containerHeight/2,T=p._containerWidth/2-v/2,D=p.unproject([T,b]),A=p.unproject([T+v,b]),k=D.distanceTo(A);if(g&&"imperial"===g.unit){const L=3.2808*k;L>5280?Vs(i,v,L/5280,u,"mile",p):Vs(i,v,L,u,"foot",p)}else g&&"nautical"===g.unit?Vs(i,v,k/1852,u,"nautical-mile",p):k>=1e3?Vs(i,v,k/1e3,u,"kilometer",p):Vs(i,v,k,u,"meter",p)}(this._map,this._container,this._language,this.options)}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p){this._fullscreen=!1,p&&p.container&&(p.container instanceof d.window.HTMLElement?this._container=p.container:d.warnOnce("Full screen control 'container' must be a DOM element.")),d.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in d.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in d.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=Lt("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",d.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,d.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!d.window.document.fullscreenEnabled&&!d.window.document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=Lt("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Lt("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),d.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(d.window.document.fullscreenElement||d.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?d.window.document.exitFullscreen?d.window.document.exitFullscreen():d.window.document.webkitCancelFullScreen&&d.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends d.Evented{constructor(p){super(),this.options=d.extend(Object.create(hu),p),d.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new d.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new d.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=d.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(d.window.document.createTextNode(p))}setHTML(p){const i=d.window.document.createDocumentFragment(),u=d.window.document.createElement("body");let g;for(u.innerHTML=p;g=u.firstChild,g;)i.appendChild(g);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=Lt("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(p),this.options.closeButton){const u=this._closeButton=Lt("button","mapboxgl-popup-close-button",i);u.type="button",u.setAttribute("aria-label","Close popup"),u.setAttribute("aria-hidden","true"),u.innerHTML="&#215;",u.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let i;return this._classList.delete(p)?i=!1:(this._classList.add(p),i=!0),this._updateClassList(),i}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const i=this._map,u=this._container,g=this._pos;if(!i||!u||!g)return"bottom";const v=u.offsetWidth,b=u.offsetHeight,T=g.x<v/2,D=g.x>i.transform.width-v/2;if(g.y+p<b)return T?"top-left":D?"top-right":"top";if(g.y>i.transform.height-b){if(T)return"bottom-left";if(D)return"bottom-right"}return T?"left":D?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),p.className=i.join(" ")}_update(p){const i=this._map,u=this._content;if(!i||!this._lngLat&&!this._trackPointer||!u)return;let g=this._container;if(g||(g=this._container=Lt("div","mapboxgl-popup",i.getContainer()),this._tip=Lt("div","mapboxgl-popup-tip",g),g.appendChild(u)),this.options.maxWidth&&g.style.maxWidth!==this.options.maxWidth&&(g.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=No(this._lngLat,this._pos,i.transform)),!this._trackPointer||p){const v=this._pos=this._trackPointer&&p?p:i.project(this._lngLat),b=oc(this.options.offset),T=this._anchor=this._getAnchor(b.y),D=oc(this.options.offset,T),A=v.add(D).round();i._requestDomTask(()=>{this._container&&T&&(this._container.style.transform=`${Ns[T]} translate(${A.x}px,${A.y}px)`)})}if(!this._marker&&i._usingGlobe()){const v=d.isLngLatBehindGlobe(i.transform,this._lngLat)?0:1;this._setOpacity(v)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(fl);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:lu,Style:ni,LngLat:d.LngLat,LngLatBounds:d.LngLatBounds,Point:d.pointGeometry,MercatorCoordinate:d.MercatorCoordinate,FreeCameraOptions:Jl,Evented:d.Evented,config:d.config,prewarm:function(){an().acquire(_t)},clearPrewarmedResources:function(){const p=zt;p&&(p.isPreloaded()&&1===p.numActive()?(p.release(_t),zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return d.config.ACCESS_TOKEN},set accessToken(p){d.config.ACCESS_TOKEN=p},get baseApiUrl(){return d.config.API_URL},set baseApiUrl(p){d.config.API_URL=p},get workerCount(){return dt.workerCount},set workerCount(p){dt.workerCount=p},get maxParallelImageRequests(){return d.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){d.config.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){d.clearTileCache(p)},workerUrl:"",workerClass:null,setNow:d.exported.setNow,restoreNow:d.exported.restoreNow};return Sa}),qa}()}},hf=>{hf(hf.s=939)}]);